var game_shell=function(){return this.version=2,this.config={},this.screens={},this.game={},this.json={},this.init=function(){this.onGameEvent({msg:"loaded"}),alex.statics.copy(this.config),this.gameDiv=document.getElementById("game"),this.gameDiv.style.backgroundColor=alex.statics.BG_COLOR,alex.utils.system=new alex.utils.SystemInfo,alex.utils.system.run(!0),this.eventQueue=new alex.utils.EventQueue,this.screenMgr=new alex.screens.ScreenMgr,this.eventQueue.addEventListener(alex.events.GAME_EVENT,this.onGameEvent.bind(this)),this.pixiStage=new alex.display.PixiStage(alex.statics.STAGE_W,alex.statics.STAGE_H,alex.statics.BG_COLOR),this.screenMgr.init(this.pixiStage),this.renderLoop="undefined"!=typeof stats?new alex.utils.RenderLoopStats(this.pixiStage):new alex.utils.RenderLoop(this.pixiStage),this.pauseGame=new alex.utils.PauseGame,alex.utils.system.isMobile&&window.scrollTo(0,1),alex.statics.FULLSCREEN_ENABLED&&(this.fullscreenMgr=new alex.utils.FullscreenMgr),this.viewport=new alex.utils.Viewport,this.viewport.addEventListener("resize",this.pauseGame.onResized),this.viewport.checkSD()&&alex.statics.setSD(),this.viewport.resize(),this.sndMgr=new alex.audio.SndMgr,this.runLoop=new alex.utils.RunLoop,this.runLoop.updateGame=this.updateGame.bind(this),this.runLoop.start(),"function"==typeof this.onReady&&this.onReady(),this.renderLoop.start()},this.updateGame=function(a){TWEEN.update(this.runLoop.currentTime),this.screenMgr.update(a),this.eventQueue.dispatchQueuedEvents()},this.onGameEvent=function(a){console.log("onGameEvent : "+a.msg)},this.getJsFiles=function(){for(var a=this.config.files||["js/pixi.dev.js","js/alex.source.js"],b=[],c=a.length,d=0;c>d;d++)b[d]=a[d];return b},this.loadScripts=function(){var a=this;ScriptLoader.load(this.getJsFiles(),function(){void 0!==document.attachEvent?document.attachEvent("ontouchmove",function(a){a.preventDefault()}):document.addEventListener("touchmove",function(a){a.preventDefault()},!1),setTimeout(function(){a.init.call(a)},1e3)})},this.toString=function(){return"[game_shell]"},this}.call(new Object),ScriptLoader=function(){function a(a,c){d=a,e=c,b()}function b(){if(d.length>0){var a=d.shift();c(a,b)}else e()}function c(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript",d.src=a,d.onload=b,d.onreadystatechange=function(){"complete"==this.readyState&&b()},c.appendChild(d)}var d,e;return{load:a}}();(function(){var a=this,b=b||{};b.WEBGL_RENDERER=0,b.CANVAS_RENDERER=1,b.VERSION="v1.6",b.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},b.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1},b._UID=0,"undefined"!=typeof Float32Array?(b.Float32Array=Float32Array,b.Uint16Array=Uint16Array):(b.Float32Array=Array,b.Uint16Array=Array),b.INTERACTION_FREQUENCY=30,b.AUTO_PREVENT_DEFAULT=!0,b.RAD_TO_DEG=180/Math.PI,b.DEG_TO_RAD=Math.PI/180,b.dontSayHello=!1,b.sayHello=function(a){if(!b.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var c=["%c %c %c Pixi.js "+b.VERSION+" - "+a+"  %c  %c  http://pixijs.com  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,c)}else window.console&&console.log("Pixi.js "+b.VERSION+" - http://pixjs.com");b.dontSayHello=!0}},b.Point=function(a,b){this.x=a||0,this.y=b||0},b.Point.prototype.clone=function(){return new b.Point(this.x,this.y)},b.Point.prototype.set=function(a,b){this.x=a||0,this.y=b||(0!==b?this.x:0)},b.Point.prototype.constructor=b.Point,b.Rectangle=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},b.Rectangle.prototype.clone=function(){return new b.Rectangle(this.x,this.y,this.width,this.height)},b.Rectangle.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=this.x;if(a>=c&&a<=c+this.width){var d=this.y;if(b>=d&&b<=d+this.height)return!0}return!1},b.Rectangle.prototype.constructor=b.Rectangle,b.EmptyRectangle=new b.Rectangle(0,0,0,0),b.Polygon=function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var c=[],d=0,e=a.length;e>d;d+=2)c.push(new b.Point(a[d],a[d+1]));a=c}this.points=a},b.Polygon.prototype.clone=function(){for(var a=[],c=0;c<this.points.length;c++)a.push(this.points[c].clone());return new b.Polygon(a)},b.Polygon.prototype.contains=function(a,b){for(var c=!1,d=0,e=this.points.length-1;d<this.points.length;e=d++){var f=this.points[d].x,g=this.points[d].y,h=this.points[e].x,i=this.points[e].y,j=g>b!=i>b&&(h-f)*(b-g)/(i-g)+f>a;j&&(c=!c)}return c},b.Polygon.prototype.constructor=b.Polygon,b.Circle=function(a,b,c){this.x=a||0,this.y=b||0,this.radius=c||0},b.Circle.prototype.clone=function(){return new b.Circle(this.x,this.y,this.radius)},b.Circle.prototype.contains=function(a,b){if(this.radius<=0)return!1;var c=this.x-a,d=this.y-b,e=this.radius*this.radius;return c*=c,d*=d,e>=c+d},b.Circle.prototype.getBounds=function(){return new b.Rectangle(this.x-this.radius,this.y-this.radius,this.width,this.height)},b.Circle.prototype.constructor=b.Circle,b.Ellipse=function(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0},b.Ellipse.prototype.clone=function(){return new b.Ellipse(this.x,this.y,this.width,this.height)},b.Ellipse.prototype.contains=function(a,b){if(this.width<=0||this.height<=0)return!1;var c=(a-this.x)/this.width,d=(b-this.y)/this.height;return c*=c,d*=d,1>=c+d},b.Ellipse.prototype.getBounds=function(){return new b.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)},b.Ellipse.prototype.constructor=b.Ellipse,b.Matrix=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0},b.Matrix.prototype.fromArray=function(a){this.a=a[0],this.b=a[1],this.c=a[3],this.d=a[4],this.tx=a[2],this.ty=a[5]},b.Matrix.prototype.toArray=function(a){this.array||(this.array=new Float32Array(9));var b=this.array;return a?(b[0]=this.a,b[1]=this.c,b[2]=0,b[3]=this.b,b[4]=this.d,b[5]=0,b[6]=this.tx,b[7]=this.ty,b[8]=1):(b[0]=this.a,b[1]=this.b,b[2]=this.tx,b[3]=this.c,b[4]=this.d,b[5]=this.ty,b[6]=0,b[7]=0,b[8]=1),b},b.identityMatrix=new b.Matrix,b.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array},b.Matrix2=b.determineMatrixArrayType(),b.DisplayObject=function(){this.position=new b.Point,this.scale=new b.Point(1,1),this.pivot=new b.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.hitArea=null,this.buttonMode=!1,this.renderable=!1,this.parent=null,this.stage=null,this.worldAlpha=1,this._interactive=!1,this.defaultCursor="pointer",this.worldTransform=new b.Matrix,this.color=[],this.dynamic=!0,this._sr=0,this._cr=1,this.filterArea=null,this._bounds=new b.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null,this._cacheAsBitmap=!1,this._cacheIsDirty=!1},b.DisplayObject.prototype.constructor=b.DisplayObject,b.DisplayObject.prototype.setInteractive=function(a){this.interactive=a},Object.defineProperty(b.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a,this.stage&&(this.stage.dirty=!0)}}),Object.defineProperty(b.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}}),Object.defineProperty(b.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1),this._mask=a,this._mask&&(this._mask.isMask=!0)}}),Object.defineProperty(b.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].passes,e=0;e<d.length;e++)b.push(d[e]);this._filterBlock={target:this,filterPasses:b}}this._filters=a}}),Object.defineProperty(b.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}}),b.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var a=this.parent.worldTransform,b=this.worldTransform,c=this.pivot.x,d=this.pivot.y,e=this._cr*this.scale.x,f=-this._sr*this.scale.y,g=this._sr*this.scale.x,h=this._cr*this.scale.y,i=this.position.x-e*c-d*f,j=this.position.y-h*d-c*g,k=a.a,l=a.b,m=a.c,n=a.d;b.a=k*e+l*g,b.b=k*f+l*h,b.tx=k*i+l*j+a.tx,b.c=m*e+n*g,b.d=m*f+n*h,b.ty=m*i+n*j+a.ty,this.worldAlpha=this.alpha*this.parent.worldAlpha},b.DisplayObject.prototype.getBounds=function(a){return a=a,b.EmptyRectangle},b.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(b.identityMatrix)},b.DisplayObject.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0)},b.DisplayObject.prototype.generateTexture=function(a){var c=this.getLocalBounds(),d=new b.RenderTexture(0|c.width,0|c.height,a);return d.render(this,new b.Point(-c.x,-c.y)),d},b.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()},b.DisplayObject.prototype._renderCachedSprite=function(a){this._cachedSprite.worldAlpha=this.worldAlpha,a.gl?b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):b.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)},b.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|a.width,0|a.height);else{var c=new b.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new b.Sprite(c),this._cachedSprite.worldTransform=this.worldTransform}var d=this._filters;this._filters=null,this._cachedSprite.filters=d,this._cachedSprite.texture.render(this,new b.Point(-a.x,-a.y)),this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._filters=d,this._cacheAsBitmap=!0},b.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)},b.DisplayObject.prototype._renderWebGL=function(a){a=a},b.DisplayObject.prototype._renderCanvas=function(a){a=a},Object.defineProperty(b.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(b.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),b.DisplayObjectContainer=function(){b.DisplayObject.call(this),this.children=[]},b.DisplayObjectContainer.prototype=Object.create(b.DisplayObject.prototype),b.DisplayObjectContainer.prototype.constructor=b.DisplayObjectContainer,Object.defineProperty(b.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){this.scale.x=a/(this.getLocalBounds().width/this.scale.x),this._width=a}}),Object.defineProperty(b.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(a){this.scale.y=a/(this.getLocalBounds().height/this.scale.y),this._height=a}}),b.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)},b.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(b>=0&&b<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this.stage&&a.setStageReference(this.stage),a;throw new Error(a+" The index "+b+" supplied is out of bounds "+this.children.length)},b.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a!==b){var c=this.children.indexOf(a),d=this.children.indexOf(b);if(0>c||0>d)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[c]=b,this.children[d]=a}},b.DisplayObjectContainer.prototype.getChildAt=function(a){if(a>=0&&a<this.children.length)return this.children[a];throw new Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller")},b.DisplayObjectContainer.prototype.removeChild=function(a){return this.removeChildAt(this.children.indexOf(a))},b.DisplayObjectContainer.prototype.removeChildAt=function(a){var b=this.getChildAt(a);return this.stage&&b.removeStageReference(),b.parent=void 0,this.children.splice(a,1),b},b.DisplayObjectContainer.prototype.removeChildren=function(a,b){var c=a||0,d="number"==typeof b?b:this.children.length,e=d-c;if(e>0&&d>=e){for(var f=this.children.splice(c,e),g=0;g<f.length;g++){var h=f[g];this.stage&&h.removeStageReference(),h.parent=void 0}return f}throw new Error("Range Error, numeric values are outside the acceptable range")},b.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(b.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var a=0,c=this.children.length;c>a;a++)this.children[a].updateTransform()},b.DisplayObjectContainer.prototype.getBounds=function(a){if(0===this.children.length)return b.EmptyRectangle;if(a){var c=this.worldTransform;this.worldTransform=a,this.updateTransform(),this.worldTransform=c}for(var d,e,f,g=1/0,h=1/0,i=-1/0,j=-1/0,k=!1,l=0,m=this.children.length;m>l;l++){var n=this.children[l];n.visible&&(k=!0,d=this.children[l].getBounds(a),g=g<d.x?g:d.x,h=h<d.y?h:d.y,e=d.width+d.x,f=d.height+d.y,i=i>e?i:e,j=j>f?j:f)}if(!k)return b.EmptyRectangle;var o=this._bounds;return o.x=g,o.y=h,o.width=i-g,o.height=j-h,o},b.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=b.identityMatrix;for(var c=0,d=this.children.length;d>c;c++)this.children[c].updateTransform();var e=this.getBounds();return this.worldTransform=a,e},b.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a,this._interactive&&(this.stage.dirty=!0);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d.setStageReference(a)}},b.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0,b=this.children.length;b>a;a++){var c=this.children[a];c.removeStageReference()}this._interactive&&(this.stage.dirty=!0),this.stage=null},b.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);var b,c;if(this._mask||this._filters){for(this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),a.spriteBatch.start()}else for(b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},b.DisplayObjectContainer.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);this._mask&&a.maskManager.pushMask(this._mask,a.context);for(var b=0,c=this.children.length;c>b;b++){var d=this.children[b];d._renderCanvas(a)}this._mask&&a.maskManager.popMask(a.context)}},b.Sprite=function(a){b.DisplayObjectContainer.call(this),this.anchor=new b.Point,this.texture=a,this._width=0,this._height=0,this.tint=16777215,this.blendMode=b.blendModes.NORMAL,a.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind)),this.renderable=!0},b.Sprite.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Sprite.prototype.constructor=b.Sprite,Object.defineProperty(b.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(b.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}}),b.Sprite.prototype.setTexture=function(a){this.texture.baseTexture!==a.baseTexture?(this.textureChange=!0,this.texture=a):this.texture=a,this.cachedTint=16777215},b.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width),this._height&&(this.scale.y=this._height/this.texture.frame.height)},b.Sprite.prototype.getBounds=function(a){var b=this.texture.frame.width,c=this.texture.frame.height,d=b*(1-this.anchor.x),e=b*-this.anchor.x,f=c*(1-this.anchor.y),g=c*-this.anchor.y,h=a||this.worldTransform,i=h.a,j=h.c,k=h.b,l=h.d,m=h.tx,n=h.ty,o=i*e+k*g+m,p=l*g+j*e+n,q=i*d+k*g+m,r=l*g+j*d+n,s=i*d+k*f+m,t=l*f+j*d+n,u=i*e+k*f+m,v=l*f+j*e+n,w=-1/0,x=-1/0,y=1/0,z=1/0;y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,z=z>p?p:z,z=z>r?r:z,z=z>t?t:z,z=z>v?v:z,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w,x=p>x?p:x,x=r>x?r:x,x=t>x?t:x,x=v>x?v:x;var A=this._bounds;return A.x=y,A.width=w-y,A.y=z,A.height=x-z,this._currentBounds=A,A},b.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){var b,c;if(this._mask||this._filters){var d=a.spriteBatch;for(this._filters&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start()),d.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);d.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&a.filterManager.popFilter(),d.start()}else for(a.spriteBatch.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}},b.Sprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a.context),this.texture.valid){a.context.globalAlpha=this.worldAlpha,a.roundPixels?a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,0|this.worldTransform.tx,0|this.worldTransform.ty):a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty),a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,a.context[a.smoothProperty]=a.scaleMode===b.scaleModes.LINEAR);var c=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,d=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=b.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,c,d,this.texture.crop.width,this.texture.crop.height)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,c,d,this.texture.crop.width,this.texture.crop.height)}for(var e=0,f=this.children.length;f>e;e++)this.children[e]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}},b.Sprite.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw new Error('The frameId "'+a+'" does not exist in the texture cache'+this);return new b.Sprite(c)},b.Sprite.fromImage=function(a,c,d){var e=b.Texture.fromImage(a,c,d);return new b.Sprite(e)},b.SpriteBatch=function(a){b.DisplayObjectContainer.call(this),this.textureThing=a,this.ready=!1},b.SpriteBatch.prototype=Object.create(b.DisplayObjectContainer.prototype),b.SpriteBatch.constructor=b.SpriteBatch,b.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new b.WebGLFastSpriteBatch(a),this.ready=!0},b.SpriteBatch.prototype.updateTransform=function(){b.DisplayObject.prototype.updateTransform.call(this)},b.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())},b.SpriteBatch.prototype._renderCanvas=function(a){var c=a.context;c.globalAlpha=this.worldAlpha,b.DisplayObject.prototype.updateTransform.call(this);for(var d=this.worldTransform,e=!0,f=0;f<this.children.length;f++){var g=this.children[f];if(g.visible){var h=g.texture,i=h.frame;if(c.globalAlpha=this.worldAlpha*g.alpha,g.rotation%(2*Math.PI)===0)e&&(c.setTransform(d.a,d.c,d.b,d.d,d.tx,d.ty),e=!1),c.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*-i.width*g.scale.x+g.position.x+.5|0,g.anchor.y*-i.height*g.scale.y+g.position.y+.5|0,i.width*g.scale.x,i.height*g.scale.y);else{e||(e=!0),b.DisplayObject.prototype.updateTransform.call(g);var j=g.worldTransform;a.roundPixels?c.setTransform(j.a,j.c,j.b,j.d,0|j.tx,0|j.ty):c.setTransform(j.a,j.c,j.b,j.d,j.tx,j.ty),c.drawImage(h.baseTexture.source,i.x,i.y,i.width,i.height,g.anchor.x*-i.width+.5|0,g.anchor.y*-i.height+.5|0,i.width,i.height)}}}},b.MovieClip=function(a){b.Sprite.call(this,a[0]),this.textures=a,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this.currentFrame=0,this.playing=!1},b.MovieClip.prototype=Object.create(b.Sprite.prototype),b.MovieClip.prototype.constructor=b.MovieClip,Object.defineProperty(b.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),b.MovieClip.prototype.stop=function(){this.playing=!1},b.MovieClip.prototype.play=function(){this.playing=!0},b.MovieClip.prototype.gotoAndStop=function(a){this.playing=!1,this.currentFrame=a;var b=this.currentFrame+.5|0;this.setTexture(this.textures[b%this.textures.length])},b.MovieClip.prototype.gotoAndPlay=function(a){this.currentFrame=a,this.playing=!0},b.MovieClip.prototype.updateTransform=function(){if(b.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=this.animationSpeed;var a=this.currentFrame+.5|0;this.currentFrame=this.currentFrame%this.textures.length,this.loop||a<this.textures.length?this.setTexture(this.textures[a%this.textures.length]):a>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}},b.MovieClip.fromFrames=function(a){for(var c=[],d=0;d<a.length;d++)c.push(new b.Texture.fromFrame(a[d]));return new b.MovieClip(c)},b.MovieClip.fromImages=function(a){for(var c=[],d=0;d<a.length;d++)c.push(new b.Texture.fromImage(a[d]));return new b.MovieClip(c)},b.FilterBlock=function(){this.visible=!0,this.renderable=!0},b.Text=function(a,c){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),b.Sprite.call(this,b.Texture.fromCanvas(this.canvas)),this.setText(a),this.setStyle(c)},b.Text.prototype=Object.create(b.Sprite.prototype),b.Text.prototype.constructor=b.Text,Object.defineProperty(b.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(b.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}}),b.Text.prototype.setStyle=function(a){a=a||{},a.font=a.font||"bold 20pt Arial",a.fill=a.fill||"black",a.align=a.align||"left",a.stroke=a.stroke||"black",a.strokeThickness=a.strokeThickness||0,a.wordWrap=a.wordWrap||!1,a.wordWrapWidth=a.wordWrapWidth||100,a.wordWrapWidth=a.wordWrapWidth||100,a.dropShadow=a.dropShadow||!1,a.dropShadowAngle=a.dropShadowAngle||Math.PI/6,a.dropShadowDistance=a.dropShadowDistance||4,a.dropShadowColor=a.dropShadowColor||"black",this.style=a,this.dirty=!0},b.Text.prototype.setText=function(a){this.text=a.toString()||" ",this.dirty=!0},b.Text.prototype.updateText=function(){this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));for(var b=a.split(/(?:\r\n|\r|\n)/),c=[],d=0,e=0;e<b.length;e++){var f=this.context.measureText(b[e]).width;c[e]=f,d=Math.max(d,f)}var g=d+this.style.strokeThickness;this.style.dropShadow&&(g+=this.style.dropShadowDistance),this.canvas.width=g+this.context.lineWidth;var h=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness,i=h*b.length;this.style.dropShadow&&(i+=this.style.dropShadowDistance),this.canvas.height=i,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top";var j,k;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;var l=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,m=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance;for(e=0;e<b.length;e++)j=this.style.strokeThickness/2,k=this.style.strokeThickness/2+e*h,"right"===this.style.align?j+=d-c[e]:"center"===this.style.align&&(j+=(d-c[e])/2),this.style.fill&&this.context.fillText(b[e],j+l,k+m)}for(this.context.fillStyle=this.style.fill,e=0;e<b.length;e++)j=this.style.strokeThickness/2,k=this.style.strokeThickness/2+e*h,"right"===this.style.align?j+=d-c[e]:"center"===this.style.align&&(j+=(d-c[e])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(b[e],j,k),this.style.fill&&this.context.fillText(b[e],j,k);this.updateTexture()},b.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width,this.texture.baseTexture.height=this.canvas.height,this.texture.crop.width=this.texture.frame.width=this.canvas.width,this.texture.crop.height=this.texture.frame.height=this.canvas.height,this._width=this.canvas.width,this._height=this.canvas.height,this.requiresUpdate=!0},b.Text.prototype._renderWebGL=function(a){this.requiresUpdate&&(this.requiresUpdate=!1,b.updateWebGLTexture(this.texture.baseTexture,a.gl)),b.Sprite.prototype._renderWebGL.call(this,a)},b.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),b.Sprite.prototype.updateTransform.call(this)},b.Text.prototype.determineFontHeight=function(a){var c=b.Text.heightCache[a];if(!c){var d=document.getElementsByTagName("body")[0],e=document.createElement("div"),f=document.createTextNode("M");e.appendChild(f),e.setAttribute("style",a+";position:absolute;top:0;left:0"),d.appendChild(e),c=e.offsetHeight,b.Text.heightCache[a]=c,d.removeChild(e)}return c},b.Text.prototype.wordWrap=function(a){for(var b="",c=a.split("\n"),d=0;d<c.length;d++){for(var e=this.style.wordWrapWidth,f=c[d].split(" "),g=0;g<f.length;g++){var h=this.context.measureText(f[g]).width,i=h+this.context.measureText(" ").width;0===g||i>e?(g>0&&(b+="\n"),b+=f[g],e=this.style.wordWrapWidth-h):(e-=i,b+=" "+f[g])}d<c.length-1&&(b+="\n")}return b},b.Text.prototype.destroy=function(a){this.context=null,this.canvas=null,this.texture.destroy(void 0===a?!0:a)},b.Text.heightCache={},b.BitmapText=function(a,c){b.DisplayObjectContainer.call(this),this._pool=[],this.setText(a),this.setStyle(c),this.updateText(),this.dirty=!1},b.BitmapText.prototype=Object.create(b.DisplayObjectContainer.prototype),b.BitmapText.prototype.constructor=b.BitmapText,b.BitmapText.prototype.setText=function(a){this.text=a||" ",this.dirty=!0},b.BitmapText.prototype.setStyle=function(a){a=a||{},a.align=a.align||"left",this.style=a;var c=a.font.split(" ");this.fontName=c[c.length-1],this.fontSize=c.length>=2?parseInt(c[c.length-2],10):b.BitmapText.fonts[this.fontName].size,this.dirty=!0,this.tint=a.tint},b.BitmapText.prototype.updateText=function(){for(var a=b.BitmapText.fonts[this.fontName],c=new b.Point,d=null,e=[],f=0,g=[],h=0,i=this.fontSize/a.size,j=0;j<this.text.length;j++){var k=this.text.charCodeAt(j);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(j)))g.push(c.x),f=Math.max(f,c.x),h++,c.x=0,c.y+=a.lineHeight,d=null;else{var l=a.chars[k];l&&(d&&l[d]&&(c.x+=l.kerning[d]),e.push({texture:l.texture,line:h,charCode:k,position:new b.Point(c.x+l.xOffset,c.y+l.yOffset)}),c.x+=l.xAdvance,d=k)}}g.push(c.x),f=Math.max(f,c.x);var m=[];for(j=0;h>=j;j++){var n=0;"right"===this.style.align?n=f-g[j]:"center"===this.style.align&&(n=(f-g[j])/2),m.push(n)}var o=this.children.length,p=e.length,q=this.tint||16777215;for(j=0;p>j;j++){var r=o>j?this.children[j]:this._pool.pop();r?r.setTexture(e[j].texture):r=new b.Sprite(e[j].texture),r.position.x=(e[j].position.x+m[e[j].line])*i,r.position.y=e[j].position.y*i,r.scale.x=r.scale.y=i,r.tint=q,r.parent||this.addChild(r)}for(;this.children.length>p;){var s=this.getChildAt(this.children.length-1);this._pool.push(s),this.removeChild(s)}this.textWidth=f*i,this.textHeight=(c.y+a.lineHeight)*i},b.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1),b.DisplayObjectContainer.prototype.updateTransform.call(this)},b.BitmapText.fonts={},b.InteractionData=function(){this.global=new b.Point,this.target=null,this.originalEvent=null},b.InteractionData.prototype.getLocalPosition=function(a){var c=a.worldTransform,d=this.global,e=c.a,f=c.b,g=c.tx,h=c.c,i=c.d,j=c.ty,k=1/(e*i+f*-h);return new b.Point(i*k*d.x+-f*k*d.y+(j*f-g*i)*k,e*k*d.y+-h*k*d.x+(-j*e+g*h)*k)},b.InteractionData.prototype.constructor=b.InteractionData,b.InteractionManager=function(a){this.stage=a,this.mouse=new b.InteractionData,this.touchs={},this.tempPoint=new b.Point,this.mouseoverEnabled=!0,this.pool=[],this.interactiveItems=[],this.interactionDOMElement=null,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this.mouseOut=!1},b.InteractionManager.prototype.constructor=b.InteractionManager,b.InteractionManager.prototype.collectInteractiveSprite=function(a,b){for(var c=a.children,d=c.length,e=d-1;e>=0;e--){var f=c[e];f._interactive?(b.interactiveChildren=!0,this.interactiveItems.push(f),f.children.length>0&&this.collectInteractiveSprite(f,f)):(f.__iParent=null,f.children.length>0&&this.collectInteractiveSprite(f,b))}},b.InteractionManager.prototype.setTarget=function(a){this.target=a,null===this.interactionDOMElement&&this.setTargetDomElement(a.view)},b.InteractionManager.prototype.setTargetDomElement=function(a){this.removeEvents(),window.navigator.msPointerEnabled&&(a.style["-ms-content-zooming"]="none",a.style["-ms-touch-action"]="none"),this.interactionDOMElement=a,a.addEventListener("mousemove",this.onMouseMove,!0),a.addEventListener("mousedown",this.onMouseDown,!0),a.addEventListener("mouseout",this.onMouseOut,!0),a.addEventListener("touchstart",this.onTouchStart,!0),a.addEventListener("touchend",this.onTouchEnd,!0),a.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0)},b.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]="",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0))
},b.InteractionManager.prototype.update=function(){if(this.target){var a=Date.now(),c=a-this.last;if(c=c*b.INTERACTION_FREQUENCY/1e3,!(1>c)){this.last=a;var d=0;this.dirty&&this.rebuildInteractiveGraph();var e=this.interactiveItems.length,f="inherit",g=!1;for(d=0;e>d;d++){var h=this.interactiveItems[d];h.__hit=this.hitTest(h,this.mouse),this.mouse.target=h,h.__hit&&!g?(h.buttonMode&&(f=h.defaultCursor),h.interactiveChildren||(g=!0),h.__isOver||(h.mouseover&&h.mouseover(this.mouse),h.__isOver=!0)):h.__isOver&&(h.mouseout&&h.mouseout(this.mouse),h.__isOver=!1)}this.currentCursorStyle!==f&&(this.currentCursorStyle=f,this.interactionDOMElement.style.cursor=f)}}},b.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var a=this.interactiveItems.length,b=0;a>b;b++)this.interactiveItems[b].interactiveChildren=!1;this.interactiveItems=[],this.stage.interactive&&this.interactiveItems.push(this.stage),this.collectInteractiveSprite(this.stage,this.stage)},b.InteractionManager.prototype.onMouseMove=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a||window.event;var b=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(a.clientX-b.left)*(this.target.width/b.width),this.mouse.global.y=(a.clientY-b.top)*(this.target.height/b.height);for(var c=this.interactiveItems.length,d=0;c>d;d++){var e=this.interactiveItems[d];e.mousemove&&e.mousemove(this.mouse)}},b.InteractionManager.prototype.onMouseDown=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a||window.event,b.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var c=this.interactiveItems.length,d=0;c>d;d++){var e=this.interactiveItems[d];if((e.mousedown||e.click)&&(e.__mouseIsDown=!0,e.__hit=this.hitTest(e,this.mouse),e.__hit&&(e.mousedown&&e.mousedown(this.mouse),e.__isDown=!0,!e.interactiveChildren)))break}},b.InteractionManager.prototype.onMouseOut=function(){this.dirty&&this.rebuildInteractiveGraph();var a=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var b=0;a>b;b++){var c=this.interactiveItems[b];c.__isOver&&(this.mouse.target=c,c.mouseout&&c.mouseout(this.mouse),c.__isOver=!1)}this.mouseOut=!0,this.mouse.global.x=-1e4,this.mouse.global.y=-1e4},b.InteractionManager.prototype.onMouseUp=function(a){this.dirty&&this.rebuildInteractiveGraph(),this.mouse.originalEvent=a||window.event;for(var b=this.interactiveItems.length,c=!1,d=0;b>d;d++){var e=this.interactiveItems[d];e.__hit=this.hitTest(e,this.mouse),e.__hit&&!c?(e.mouseup&&e.mouseup(this.mouse),e.__isDown&&e.click&&e.click(this.mouse),e.interactiveChildren||(c=!0)):e.__isDown&&e.mouseupoutside&&e.mouseupoutside(this.mouse),e.__isDown=!1}},b.InteractionManager.prototype.hitTest=function(a,c){var d=c.global;if(!a.worldVisible)return!1;var e=a instanceof b.Sprite,f=a.worldTransform,g=f.a,h=f.b,i=f.tx,j=f.c,k=f.d,l=f.ty,m=1/(g*k+h*-j),n=k*m*d.x+-h*m*d.y+(l*h-i*k)*m,o=g*m*d.y+-j*m*d.x+(-l*g+i*j)*m;if(c.target=a,a.hitArea&&a.hitArea.contains)return a.hitArea.contains(n,o)?(c.target=a,!0):!1;if(e){var p,q=a.texture.frame.width,r=a.texture.frame.height,s=-q*a.anchor.x;if(n>s&&s+q>n&&(p=-r*a.anchor.y,o>p&&p+r>o))return c.target=a,!0}for(var t=a.children.length,u=0;t>u;u++){var v=a.children[u],w=this.hitTest(v,c);if(w)return c.target=a,!0}return!1},b.InteractionManager.prototype.onTouchMove=function(a){this.dirty&&this.rebuildInteractiveGraph();var b,c=this.interactionDOMElement.getBoundingClientRect(),d=a.changedTouches,e=0;for(e=0;e<d.length;e++){var f=d[e];b=this.touchs[f.identifier],b.originalEvent=a||window.event,b.global.x=(f.clientX-c.left)*(this.target.width/c.width),b.global.y=(f.clientY-c.top)*(this.target.height/c.height),navigator.isCocoonJS&&(b.global.x=f.clientX,b.global.y=f.clientY);for(var g=0;g<this.interactiveItems.length;g++){var h=this.interactiveItems[g];h.touchmove&&h.__touchData&&h.__touchData[f.identifier]&&h.touchmove(b)}}},b.InteractionManager.prototype.onTouchStart=function(a){this.dirty&&this.rebuildInteractiveGraph();var c=this.interactionDOMElement.getBoundingClientRect();b.AUTO_PREVENT_DEFAULT&&a.preventDefault();for(var d=a.changedTouches,e=0;e<d.length;e++){var f=d[e],g=this.pool.pop();g||(g=new b.InteractionData),g.originalEvent=a||window.event,this.touchs[f.identifier]=g,g.global.x=(f.clientX-c.left)*(this.target.width/c.width),g.global.y=(f.clientY-c.top)*(this.target.height/c.height),navigator.isCocoonJS&&(g.global.x=f.clientX,g.global.y=f.clientY);for(var h=this.interactiveItems.length,i=0;h>i;i++){var j=this.interactiveItems[i];if((j.touchstart||j.tap)&&(j.__hit=this.hitTest(j,g),j.__hit&&(j.touchstart&&j.touchstart(g),j.__isDown=!0,j.__touchData=j.__touchData||{},j.__touchData[f.identifier]=g,!j.interactiveChildren)))break}}},b.InteractionManager.prototype.onTouchEnd=function(a){this.dirty&&this.rebuildInteractiveGraph();for(var b=this.interactionDOMElement.getBoundingClientRect(),c=a.changedTouches,d=0;d<c.length;d++){var e=c[d],f=this.touchs[e.identifier],g=!1;f.global.x=(e.clientX-b.left)*(this.target.width/b.width),f.global.y=(e.clientY-b.top)*(this.target.height/b.height),navigator.isCocoonJS&&(f.global.x=e.clientX,f.global.y=e.clientY);for(var h=this.interactiveItems.length,i=0;h>i;i++){var j=this.interactiveItems[i];j.__touchData&&j.__touchData[e.identifier]&&(j.__hit=this.hitTest(j,j.__touchData[e.identifier]),f.originalEvent=a||window.event,(j.touchend||j.tap)&&(j.__hit&&!g?(j.touchend&&j.touchend(f),j.__isDown&&j.tap&&j.tap(f),j.interactiveChildren||(g=!0)):j.__isDown&&j.touchendoutside&&j.touchendoutside(f),j.__isDown=!1),j.__touchData[e.identifier]=null)}this.pool.push(f),this.touchs[e.identifier]=null}},b.Stage=function(a){b.DisplayObjectContainer.call(this),this.worldTransform=new b.Matrix,this.interactive=!0,this.interactionManager=new b.InteractionManager(this),this.dirty=!0,this.stage=this,this.stage.hitArea=new b.Rectangle(0,0,1e5,1e5),this.setBackgroundColor(a)},b.Stage.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Stage.prototype.constructor=b.Stage,b.Stage.prototype.setInteractionDelegate=function(a){this.interactionManager.setTargetDomElement(a)},b.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0),this.interactive&&this.interactionManager.update()},b.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0,this.backgroundColorSplit=b.hex2rgb(this.backgroundColor);var c=this.backgroundColor.toString(16);c="000000".substr(0,6-c.length)+c,this.backgroundColorString="#"+c},b.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var c=0,d=["ms","moz","webkit","o"],e=0;e<d.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[d[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[d[e]+"CancelAnimationFrame"]||window[d[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),d=Math.max(0,16-(b-c)),e=window.setTimeout(function(){a(b+d)},d);return c=b+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)}),window.requestAnimFrame=window.requestAnimationFrame,b.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]},b.rgb2hex=function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]},"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(b){function c(){var f=e.concat(a.call(arguments));d.apply(this instanceof c?this:b,f)}var d=this,e=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return c.prototype=function f(a){return a&&(f.prototype=a),this instanceof f?void 0:new f}(d.prototype),c}}()),b.AjaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(c){}},b.canUseNewCanvasBlendModes=function(){var a=document.createElement("canvas");a.width=1,a.height=1;var b=a.getContext("2d");return b.fillStyle="#000",b.fillRect(0,0,1,1),b.globalCompositeOperation="multiply",b.fillStyle="#fff",b.fillRect(0,0,1,1),0===b.getImageData(0,0,1,1).data[0]},b.getNextPowerOfTwo=function(a){if(a>0&&0===(a&a-1))return a;for(var b=1;a>b;)b<<=1;return b},b.EventTarget=function(){var a={};this.addEventListener=this.on=function(b,c){void 0===a[b]&&(a[b]=[]),-1===a[b].indexOf(c)&&a[b].unshift(c)},this.dispatchEvent=this.emit=function(b){if(a[b.type]&&a[b.type].length)for(var c=a[b.type].length-1;c>=0;c--)a[b.type][c](b)},this.removeEventListener=this.off=function(b,c){if(void 0!==a[b]){var d=a[b].indexOf(c);-1!==d&&a[b].splice(d,1)}},this.removeAllEventListeners=function(b){var c=a[b];c&&(c.length=0)}},b.autoDetectRenderer=function(a,c,d,e,f){a||(a=800),c||(c=600);var g=function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}();return g?new b.WebGLRenderer(a,c,d,e,f):new b.CanvasRenderer(a,c,d,e)},b.autoDetectRecommendedRenderer=function(a,c,d,e,f){a||(a=800),c||(c=600);var g=function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),h=/Android/i.test(navigator.userAgent);return g&&!h?new b.WebGLRenderer(a,c,d,e,f):new b.CanvasRenderer(a,c,d,e)},b.PolyK={},b.PolyK.Triangulate=function(a){var c=!0,d=a.length>>1;if(3>d)return[];for(var e=[],f=[],g=0;d>g;g++)f.push(g);g=0;for(var h=d;h>3;){var i=f[(g+0)%h],j=f[(g+1)%h],k=f[(g+2)%h],l=a[2*i],m=a[2*i+1],n=a[2*j],o=a[2*j+1],p=a[2*k],q=a[2*k+1],r=!1;if(b.PolyK._convex(l,m,n,o,p,q,c)){r=!0;for(var s=0;h>s;s++){var t=f[s];if(t!==i&&t!==j&&t!==k&&b.PolyK._PointInTriangle(a[2*t],a[2*t+1],l,m,n,o,p,q)){r=!1;break}}}if(r)e.push(i,j,k),f.splice((g+1)%h,1),h--,g=0;else if(g++>3*h){if(!c)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(e=[],f=[],g=0;d>g;g++)f.push(g);g=0,h=d,c=!1}}return e.push(f[0],f[1],f[2]),e},b.PolyK._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},b.PolyK._convex=function(a,b,c,d,e,f,g){return(b-d)*(e-c)+(c-a)*(f-d)>=0===g},b.initDefaultShaders=function(){},b.CompileVertexShader=function(a,c){return b._CompileShader(a,c,a.VERTEX_SHADER)},b.CompileFragmentShader=function(a,c){return b._CompileShader(a,c,a.FRAGMENT_SHADER)},b._CompileShader=function(a,b,c){var d=b.join("\n"),e=a.createShader(c);return a.shaderSource(e,d),a.compileShader(e),a.getShaderParameter(e,a.COMPILE_STATUS)?e:(window.console.log(a.getShaderInfoLog(e)),null)},b.compileProgram=function(a,c,d){var e=b.CompileFragmentShader(a,d),f=b.CompileVertexShader(a,c),g=a.createProgram();return a.attachShader(g,f),a.attachShader(g,e),a.linkProgram(g),a.getProgramParameter(g,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),g},b.PixiShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.textureCount=0,this.attributes=[],this.init()},b.PixiShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc||b.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(c),this.uSampler=a.getUniformLocation(c,"uSampler"),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.dimensions=a.getUniformLocation(c,"dimensions"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(c,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(var d in this.uniforms)this.uniforms[d].uniformLocation=a.getUniformLocation(c,d);this.initUniforms(),this.program=c},b.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,b=this.gl;for(var c in this.uniforms){a=this.uniforms[c];var d=a.type;"sampler2D"===d?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===d||"mat3"===d||"mat4"===d?(a.glMatrix=!0,a.glValueLength=1,"mat2"===d?a.glFunc=b.uniformMatrix2fv:"mat3"===d?a.glFunc=b.uniformMatrix3fv:"mat4"===d&&(a.glFunc=b.uniformMatrix4fv)):(a.glFunc=b["uniform"+d],a.glValueLength="2f"===d||"2i"===d?2:"3f"===d||"3i"===d?3:"4f"===d||"4i"===d?4:1)}},b.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var b=this.gl;if(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]),a.textureData){var c=a.textureData,d=c.magFilter?c.magFilter:b.LINEAR,e=c.minFilter?c.minFilter:b.LINEAR,f=c.wrapS?c.wrapS:b.CLAMP_TO_EDGE,g=c.wrapT?c.wrapT:b.CLAMP_TO_EDGE,h=c.luminance?b.LUMINANCE:b.RGBA;if(c.repeat&&(f=b.REPEAT,g=b.REPEAT),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!!c.flipY),c.width){var i=c.width?c.width:512,j=c.height?c.height:2,k=c.border?c.border:0;b.texImage2D(b.TEXTURE_2D,0,h,i,j,k,h,b.UNSIGNED_BYTE,null)}else b.texImage2D(b.TEXTURE_2D,0,h,b.RGBA,b.UNSIGNED_BYTE,a.value.baseTexture.source);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,e),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,f),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,g)}b.uniform1i(a.uniformLocation,this.textureCount),a._init=!0,this.textureCount++}},b.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,c=this.gl;for(var d in this.uniforms)a=this.uniforms[d],1===a.glValueLength?a.glMatrix===!0?a.glFunc.call(c,a.uniformLocation,a.transpose,a.value):a.glFunc.call(c,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(c,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(c.activeTexture(c["TEXTURE"+this.textureCount]),c.bindTexture(c.TEXTURE_2D,a.value.baseTexture._glTextures[c.id]||b.createWebGLTexture(a.value.baseTexture,c)),c.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))},b.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},b.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"],b.PixiFastShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"],this.textureCount=0,this.init()},b.PixiFastShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.uSampler=a.getUniformLocation(c,"uSampler"),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.dimensions=a.getUniformLocation(c,"dimensions"),this.uMatrix=a.getUniformLocation(c,"uMatrix"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.aPositionCoord=a.getAttribLocation(c,"aPositionCoord"),this.aScale=a.getAttribLocation(c,"aScale"),this.aRotation=a.getAttribLocation(c,"aRotation"),this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(c,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute],this.program=c},b.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attributes=null},b.StripShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"],this.init()},b.StripShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.uSampler=a.getUniformLocation(c,"uSampler"),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.colorAttribute=a.getAttribLocation(c,"aColor"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(c,"aTextureCoord"),this.attributes=[this.aVertexPosition,this.aTextureCoord],this.translationMatrix=a.getUniformLocation(c,"translationMatrix"),this.alpha=a.getUniformLocation(c,"alpha"),this.program=c},b.PrimitiveShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"],this.init()},b.PrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.tintColor=a.getUniformLocation(c,"tint"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.colorAttribute=a.getAttribLocation(c,"aColor"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(c,"translationMatrix"),this.alpha=a.getUniformLocation(c,"alpha"),this.program=c},b.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},b.ComplexPrimitiveShader=function(a){this._UID=b._UID++,this.gl=a,this.program=null,this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"],this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"],this.init()},b.ComplexPrimitiveShader.prototype.init=function(){var a=this.gl,c=b.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(c),this.projectionVector=a.getUniformLocation(c,"projectionVector"),this.offsetVector=a.getUniformLocation(c,"offsetVector"),this.tintColor=a.getUniformLocation(c,"tint"),this.color=a.getUniformLocation(c,"color"),this.aVertexPosition=a.getAttribLocation(c,"aVertexPosition"),this.attributes=[this.aVertexPosition,this.colorAttribute],this.translationMatrix=a.getUniformLocation(c,"translationMatrix"),this.alpha=a.getUniformLocation(c,"alpha"),this.program=c},b.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.uniforms=null,this.gl=null,this.attribute=null},b.WebGLGraphics=function(){},b.WebGLGraphics.renderGraphics=function(a,c){var d,e=c.gl,f=c.projection,g=c.offset,h=c.shaderManager.primitiveShader;a.dirty&&b.WebGLGraphics.updateGraphics(a,e);for(var i=a._webGL[e.id],j=0;j<i.data.length;j++)1===i.data[j].mode?(d=i.data[j],c.stencilManager.pushStencil(a,d,c),e.drawElements(e.TRIANGLE_FAN,4,e.UNSIGNED_SHORT,2*(d.indices.length-4)),c.stencilManager.popStencil(a,d,c),this.last=d.mode):(d=i.data[j],c.shaderManager.setShader(h),h=c.shaderManager.primitiveShader,e.uniformMatrix3fv(h.translationMatrix,!1,a.worldTransform.toArray(!0)),e.uniform2f(h.projectionVector,f.x,-f.y),e.uniform2f(h.offsetVector,-g.x,-g.y),e.uniform3fv(h.tintColor,b.hex2rgb(a.tint)),e.uniform1f(h.alpha,a.worldAlpha),e.bindBuffer(e.ARRAY_BUFFER,d.buffer),e.vertexAttribPointer(h.aVertexPosition,2,e.FLOAT,!1,24,0),e.vertexAttribPointer(h.colorAttribute,4,e.FLOAT,!1,24,8),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,d.indexBuffer),e.drawElements(e.TRIANGLE_STRIP,d.indices.length,e.UNSIGNED_SHORT,0))},b.WebGLGraphics.updateGraphics=function(a,c){var d=a._webGL[c.id];d||(d=a._webGL[c.id]={lastIndex:0,data:[],gl:c}),a.dirty=!1;var e;if(a.clearDirty){for(a.clearDirty=!1,e=0;e<d.data.length;e++){var f=d.data[e];f.reset(),b.WebGLGraphics.graphicsDataPool.push(f)}d.data=[],d.lastIndex=0}var g;for(e=d.lastIndex;e<a.graphicsData.length;e++){var h=a.graphicsData[e];h.type===b.Graphics.POLY?(h.fill&&h.points.length>6&&(h.points.length>10?(g=b.WebGLGraphics.switchMode(d,1),b.WebGLGraphics.buildComplexPoly(h,g)):(g=b.WebGLGraphics.switchMode(d,0),b.WebGLGraphics.buildPoly(h,g))),h.lineWidth>0&&(g=b.WebGLGraphics.switchMode(d,0),b.WebGLGraphics.buildLine(h,g))):(g=b.WebGLGraphics.switchMode(d,0),h.type===b.Graphics.RECT?b.WebGLGraphics.buildRectangle(h,g):h.type===b.Graphics.CIRC||h.type===b.Graphics.ELIP?b.WebGLGraphics.buildCircle(h,g):h.type===b.Graphics.RREC&&b.WebGLGraphics.buildRoundedRectangle(h,d)),d.lastIndex++}for(e=0;e<d.data.length;e++)g=d.data[e],g.dirty&&g.upload()},b.WebGLGraphics.switchMode=function(a,c){var d;return a.data.length?(d=a.data[a.data.length-1],(d.mode!==c||1===c)&&(d=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(a.gl),d.mode=c,a.data.push(d))):(d=b.WebGLGraphics.graphicsDataPool.pop()||new b.WebGLGraphicsData(a.gl),d.mode=c,a.data.push(d)),d.dirty=!0,d},b.WebGLGraphics.buildRectangle=function(a,c){var d=a.points,e=d[0],f=d[1],g=d[2],h=d[3];if(a.fill){var i=b.hex2rgb(a.fillColor),j=a.fillAlpha,k=i[0]*j,l=i[1]*j,m=i[2]*j,n=c.points,o=c.indices,p=n.length/6;n.push(e,f),n.push(k,l,m,j),n.push(e+g,f),n.push(k,l,m,j),n.push(e,f+h),n.push(k,l,m,j),n.push(e+g,f+h),n.push(k,l,m,j),o.push(p,p,p+1,p+2,p+3,p+3)}if(a.lineWidth){var q=a.points;a.points=[e,f,e+g,f,e+g,f+h,e,f+h,e,f],b.WebGLGraphics.buildLine(a,c),a.points=q}},b.WebGLGraphics.buildRoundedRectangle=function(a,c){function d(a,b,c,d,e,f){function g(a,b,c){var d=b-a;return a+d*c}for(var h,i,j,k,l,m,n=20,o=[],p=0,q=0;n>=q;q++)p=q/n,h=g(a,c,p),i=g(b,d,p),j=g(c,e,p),k=g(d,f,p),l=g(h,j,p),m=g(i,k,p),o.push(l,m);return o}var e=a.points,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=[];if(k.push(f,g+j),k=k.concat(d(f,g+i-j,f,g+i,f+j,g+i)),k=k.concat(d(f+h-j,g+i,f+h,g+i,f+h,g+i-j)),k=k.concat(d(f+h,g+j,f+h,g,f+h-j,g)),k=k.concat(d(f+j,g,f,g,f,g+j)),a.fill){var l=b.hex2rgb(a.fillColor),m=a.fillAlpha,n=l[0]*m,o=l[1]*m,p=l[2]*m,q=c.points,r=c.indices,s=q.length/6,t=b.PolyK.Triangulate(k),u=0;for(u=0;u<t.length;u+=3)r.push(t[u]+s),r.push(t[u]+s),r.push(t[u+1]+s),r.push(t[u+2]+s),r.push(t[u+2]+s);for(u=0;u<k.length;u++)q.push(k[u],k[++u],n,o,p,m)}if(a.lineWidth){var v=a.points;a.points=k,b.WebGLGraphics.buildLine(a,c),a.points=v}},b.WebGLGraphics.buildCircle=function(a,c){var d=a.points,e=d[0],f=d[1],g=d[2],h=d[3],i=40,j=2*Math.PI/i,k=0;if(a.fill){var l=b.hex2rgb(a.fillColor),m=a.fillAlpha,n=l[0]*m,o=l[1]*m,p=l[2]*m,q=c.points,r=c.indices,s=q.length/6;for(r.push(s),k=0;i+1>k;k++)q.push(e,f,n,o,p,m),q.push(e+Math.sin(j*k)*g,f+Math.cos(j*k)*h,n,o,p,m),r.push(s++,s++);r.push(s-1)}if(a.lineWidth){var t=a.points;for(a.points=[],k=0;i+1>k;k++)a.points.push(e+Math.sin(j*k)*g,f+Math.cos(j*k)*h);b.WebGLGraphics.buildLine(a,c),a.points=t}},b.WebGLGraphics.buildLine=function(a,c){var d=0,e=a.points;if(0!==e.length){if(a.lineWidth%2)for(d=0;d<e.length;d++)e[d]+=.5;var f=new b.Point(e[0],e[1]),g=new b.Point(e[e.length-2],e[e.length-1]);if(f.x===g.x&&f.y===g.y){e=e.slice(),e.pop(),e.pop(),g=new b.Point(e[e.length-2],e[e.length-1]);var h=g.x+.5*(f.x-g.x),i=g.y+.5*(f.y-g.y);e.unshift(h,i),e.push(h,i)}var j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=c.points,H=c.indices,I=e.length/2,J=e.length,K=G.length/6,L=a.lineWidth/2,M=b.hex2rgb(a.lineColor),N=a.lineAlpha,O=M[0]*N,P=M[1]*N,Q=M[2]*N;for(l=e[0],m=e[1],n=e[2],o=e[3],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(l-r,m-s,O,P,Q,N),G.push(l+r,m+s,O,P,Q,N),d=1;I-1>d;d++)l=e[2*(d-1)],m=e[2*(d-1)+1],n=e[2*d],o=e[2*d+1],p=e[2*(d+1)],q=e[2*(d+1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,t=-(o-q),u=n-p,F=Math.sqrt(t*t+u*u),t/=F,u/=F,t*=L,u*=L,x=-s+m-(-s+o),y=-r+n-(-r+l),z=(-r+l)*(-s+o)-(-r+n)*(-s+m),A=-u+q-(-u+o),B=-t+n-(-t+p),C=(-t+p)*(-u+o)-(-t+n)*(-u+q),D=x*B-A*y,Math.abs(D)<.1?(D+=10.1,G.push(n-r,o-s,O,P,Q,N),G.push(n+r,o+s,O,P,Q,N)):(j=(y*C-B*z)/D,k=(A*z-x*C)/D,E=(j-n)*(j-n)+(k-o)+(k-o),E>19600?(v=r-t,w=s-u,F=Math.sqrt(v*v+w*w),v/=F,w/=F,v*=L,w*=L,G.push(n-v,o-w),G.push(O,P,Q,N),G.push(n+v,o+w),G.push(O,P,Q,N),G.push(n-v,o-w),G.push(O,P,Q,N),J++):(G.push(j,k),G.push(O,P,Q,N),G.push(n-(j-n),o-(k-o)),G.push(O,P,Q,N)));for(l=e[2*(I-2)],m=e[2*(I-2)+1],n=e[2*(I-1)],o=e[2*(I-1)+1],r=-(m-o),s=l-n,F=Math.sqrt(r*r+s*s),r/=F,s/=F,r*=L,s*=L,G.push(n-r,o-s),G.push(O,P,Q,N),G.push(n+r,o+s),G.push(O,P,Q,N),H.push(K),d=0;J>d;d++)H.push(K++);H.push(K-1)}},b.WebGLGraphics.buildComplexPoly=function(a,c){var d=a.points.slice();if(!(d.length<6)){var e=c.indices;c.points=d,c.alpha=a.fillAlpha,c.color=b.hex2rgb(a.fillColor);for(var f,g,h=1/0,i=-1/0,j=1/0,k=-1/0,l=0;l<d.length;l+=2)f=d[l],g=d[l+1],h=h>f?f:h,i=f>i?f:i,j=j>g?g:j,k=g>k?g:k;d.push(h,j,i,j,i,k,h,k);var m=d.length/2;for(l=0;m>l;l++)e.push(l)}},b.WebGLGraphics.buildPoly=function(a,c){var d=a.points;if(!(d.length<6)){var e=c.points,f=c.indices,g=d.length/2,h=b.hex2rgb(a.fillColor),i=a.fillAlpha,j=h[0]*i,k=h[1]*i,l=h[2]*i,m=b.PolyK.Triangulate(d),n=e.length/6,o=0;for(o=0;o<m.length;o+=3)f.push(m[o]+n),f.push(m[o]+n),f.push(m[o+1]+n),f.push(m[o+2]+n),f.push(m[o+2]+n);for(o=0;g>o;o++)e.push(d[2*o],d[2*o+1],j,k,l,i)}},b.WebGLGraphics.graphicsDataPool=[],b.WebGLGraphicsData=function(a){this.gl=a,this.color=[0,0,0],this.points=[],this.indices=[],this.lastIndex=0,this.buffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0},b.WebGLGraphicsData.prototype.reset=function(){this.points=[],this.indices=[],this.lastIndex=0},b.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW),this.glIndicies=new Uint16Array(this.indices),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW),this.dirty=!1},b.glContexts=[],b.WebGLRenderer=function(a,c,d,e,f,g){b.defaultRenderer||(b.sayHello("webGL"),b.defaultRenderer=this),this.type=b.WEBGL_RENDERER,this.transparent=!!e,this.preserveDrawingBuffer=g,this.width=a||800,this.height=c||600,this.view=d||document.createElement("canvas"),this.view.width=this.width,this.view.height=this.height,this.contextLost=this.handleContextLost.bind(this),this.contextRestoredLost=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.contextLost,!1),this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1),this.options={alpha:this.transparent,antialias:!!f,premultipliedAlpha:!!e,stencil:!0,preserveDrawingBuffer:g};var h=null;if(["experimental-webgl","webgl"].forEach(function(a){try{h=h||this.view.getContext(a,this.options)}catch(b){}},this),!h)throw new Error("This browser does not support webGL. Try using the canvas renderer"+this);this.gl=h,this.glContextId=h.id=b.WebGLRenderer.glContextId++,b.glContexts[this.glContextId]=h,b.blendModesWebGL||(b.blendModesWebGL=[],b.blendModesWebGL[b.blendModes.NORMAL]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.ADD]=[h.SRC_ALPHA,h.DST_ALPHA],b.blendModesWebGL[b.blendModes.MULTIPLY]=[h.DST_COLOR,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SCREEN]=[h.SRC_ALPHA,h.ONE],b.blendModesWebGL[b.blendModes.OVERLAY]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DARKEN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LIGHTEN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR_DODGE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR_BURN]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HARD_LIGHT]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SOFT_LIGHT]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.DIFFERENCE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.EXCLUSION]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.HUE]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.SATURATION]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.COLOR]=[h.ONE,h.ONE_MINUS_SRC_ALPHA],b.blendModesWebGL[b.blendModes.LUMINOSITY]=[h.ONE,h.ONE_MINUS_SRC_ALPHA]),this.projection=new b.Point,this.projection.x=this.width/2,this.projection.y=-this.height/2,this.offset=new b.Point(0,0),this.resize(this.width,this.height),this.contextLost=!1,this.shaderManager=new b.WebGLShaderManager(h),this.spriteBatch=new b.WebGLSpriteBatch(h),this.maskManager=new b.WebGLMaskManager(h),this.filterManager=new b.WebGLFilterManager(h,this.transparent),this.stencilManager=new b.WebGLStencilManager(h),this.blendModeManager=new b.WebGLBlendModeManager(h),this.renderSession={},this.renderSession.gl=this.gl,this.renderSession.drawCount=0,this.renderSession.shaderManager=this.shaderManager,this.renderSession.maskManager=this.maskManager,this.renderSession.filterManager=this.filterManager,this.renderSession.blendModeManager=this.blendModeManager,this.renderSession.spriteBatch=this.spriteBatch,this.renderSession.stencilManager=this.stencilManager,this.renderSession.renderer=this,h.useProgram(this.shaderManager.defaultShader.program),h.disable(h.DEPTH_TEST),h.disable(h.CULL_FACE),h.enable(h.BLEND),h.colorMask(!0,!0,!0,this.transparent)
},b.WebGLRenderer.prototype.constructor=b.WebGLRenderer,b.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(a.interactive&&a.interactionManager.removeEvents(),this.__stage=a),b.WebGLRenderer.updateTextures(),a.updateTransform(),a._interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)));var c=this.gl;c.viewport(0,0,this.width,this.height),c.bindFramebuffer(c.FRAMEBUFFER,null),this.transparent?c.clearColor(0,0,0,0):c.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),c.clear(c.COLOR_BUFFER_BIT),this.renderDisplayObject(a,this.projection),a.interactive?a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)):a._interactiveEventsAdded&&(a._interactiveEventsAdded=!1,a.interactionManager.setTarget(this))}},b.WebGLRenderer.prototype.renderDisplayObject=function(a,c,d){this.renderSession.blendModeManager.setBlendMode(b.blendModes.NORMAL),this.renderSession.drawCount=0,this.renderSession.currentBlendMode=9999,this.renderSession.projection=c,this.renderSession.offset=this.offset,this.spriteBatch.begin(this.renderSession),this.filterManager.begin(this.renderSession,d),a._renderWebGL(this.renderSession),this.spriteBatch.end()},b.WebGLRenderer.updateTextures=function(){var a=0;for(a=0;a<b.Texture.frameUpdates.length;a++)b.WebGLRenderer.updateTextureFrame(b.Texture.frameUpdates[a]);for(a=0;a<b.texturesToDestroy.length;a++)b.WebGLRenderer.destroyTexture(b.texturesToDestroy[a]);b.texturesToUpdate.length=0,b.texturesToDestroy.length=0,b.Texture.frameUpdates.length=0},b.WebGLRenderer.destroyTexture=function(a){for(var c=a._glTextures.length-1;c>=0;c--){var d=a._glTextures[c],e=b.glContexts[c];e&&d&&e.deleteTexture(d)}a._glTextures.length=0},b.WebGLRenderer.updateTextureFrame=function(a){a._updateWebGLuvs()},b.WebGLRenderer.prototype.resize=function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b,this.gl.viewport(0,0,this.width,this.height),this.projection.x=this.width/2,this.projection.y=-this.height/2},b.createWebGLTexture=function(a,c){return a.hasLoaded&&(a._glTextures[c.id]=c.createTexture(),c.bindTexture(c.TEXTURE_2D,a._glTextures[c.id]),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.source),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),a._powerOf2?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)),c.bindTexture(c.TEXTURE_2D,null),a._dirty[c.id]=!1),a._glTextures[c.id]},b.updateWebGLTexture=function(a,c){a._glTextures[c.id]&&(c.bindTexture(c.TEXTURE_2D,a._glTextures[c.id]),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,a.source),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,a.scaleMode===b.scaleModes.LINEAR?c.LINEAR:c.NEAREST),a._powerOf2?(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT)):(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE)),a._dirty[c.id]=!1)},b.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault(),this.contextLost=!0},b.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(a){try{this.gl=this.view.getContext("webgl",this.options)}catch(c){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this)}}var d=this.gl;d.id=b.WebGLRenderer.glContextId++,this.shaderManager.setContext(d),this.spriteBatch.setContext(d),this.primitiveBatch.setContext(d),this.maskManager.setContext(d),this.filterManager.setContext(d),this.renderSession.gl=this.gl,d.disable(d.DEPTH_TEST),d.disable(d.CULL_FACE),d.enable(d.BLEND),d.colorMask(!0,!0,!0,this.transparent),this.gl.viewport(0,0,this.width,this.height);for(var e in b.TextureCache){var f=b.TextureCache[e].baseTexture;f._glTextures=[]}this.contextLost=!1},b.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost),this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost),b.glContexts[this.glContextId]=null,this.projection=null,this.offset=null,this.shaderManager.destroy(),this.spriteBatch.destroy(),this.primitiveBatch.destroy(),this.maskManager.destroy(),this.filterManager.destroy(),this.shaderManager=null,this.spriteBatch=null,this.maskManager=null,this.filterManager=null,this.gl=null,this.renderSession=null},b.WebGLRenderer.glContextId=0,b.WebGLBlendModeManager=function(a){this.gl=a,this.currentBlendMode=99999},b.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;var c=b.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(c[0],c[1]),!0},b.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null},b.WebGLMaskManager=function(a){this.maskStack=[],this.maskPosition=0,this.setContext(a),this.reverse=!1,this.count=0},b.WebGLMaskManager.prototype.setContext=function(a){this.gl=a},b.WebGLMaskManager.prototype.pushMask=function(a,c){var d=c.gl;a.dirty&&b.WebGLGraphics.updateGraphics(a,d),a._webGL[d.id].data.length&&c.stencilManager.pushStencil(a,a._webGL[d.id].data[0],c)},b.WebGLMaskManager.prototype.popMask=function(a,b){var c=this.gl;b.stencilManager.popStencil(a,a._webGL[c.id].data[0],b)},b.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},b.WebGLStencilManager=function(a){this.stencilStack=[],this.setContext(a),this.reverse=!0,this.count=0},b.WebGLStencilManager.prototype.setContext=function(a){this.gl=a},b.WebGLStencilManager.prototype.pushStencil=function(a,b,c){var d=this.gl;this.bindGraphics(a,b,c),0===this.stencilStack.length&&(d.enable(d.STENCIL_TEST),d.clear(d.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(b);var e=this.count;d.colorMask(!1,!1,!1,!1),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,d.KEEP,d.INVERT),1===b.mode?(d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?(d.stencilFunc(d.EQUAL,255-e,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,e,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),this.reverse?d.stencilFunc(d.EQUAL,255-(e+1),255):d.stencilFunc(d.EQUAL,e+1,255),this.reverse=!this.reverse):(this.reverse?(d.stencilFunc(d.EQUAL,e,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,255-e,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e+1,255):d.stencilFunc(d.EQUAL,255-(e+1),255)),d.colorMask(!0,!0,!0,!0),d.stencilOp(d.KEEP,d.KEEP,d.KEEP),this.count++},b.WebGLStencilManager.prototype.bindGraphics=function(a,c,d){this._currentGraphics=a;var e,f=this.gl,g=d.projection,h=d.offset;1===c.mode?(e=d.shaderManager.complexPrimativeShader,d.shaderManager.setShader(e),f.uniformMatrix3fv(e.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(e.projectionVector,g.x,-g.y),f.uniform2f(e.offsetVector,-h.x,-h.y),f.uniform3fv(e.tintColor,b.hex2rgb(a.tint)),f.uniform3fv(e.color,c.color),f.uniform1f(e.alpha,a.worldAlpha*c.alpha),f.bindBuffer(f.ARRAY_BUFFER,c.buffer),f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,8,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.indexBuffer)):(e=d.shaderManager.primitiveShader,d.shaderManager.setShader(e),f.uniformMatrix3fv(e.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(e.projectionVector,g.x,-g.y),f.uniform2f(e.offsetVector,-h.x,-h.y),f.uniform3fv(e.tintColor,b.hex2rgb(a.tint)),f.uniform1f(e.alpha,a.worldAlpha),f.bindBuffer(f.ARRAY_BUFFER,c.buffer),f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,24,0),f.vertexAttribPointer(e.colorAttribute,4,f.FLOAT,!1,24,8),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c.indexBuffer))},b.WebGLStencilManager.prototype.popStencil=function(a,b,c){var d=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)d.disable(d.STENCIL_TEST);else{var e=this.count;this.bindGraphics(a,b,c),d.colorMask(!1,!1,!1,!1),1===b.mode?(this.reverse=!this.reverse,this.reverse?(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,d.KEEP,d.INVERT),d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255)):(this.reverse?(d.stencilFunc(d.EQUAL,e+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,255-(e+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,e,255):d.stencilFunc(d.EQUAL,255-e,255)),d.colorMask(!0,!0,!0,!0),d.stencilOp(d.KEEP,d.KEEP,d.KEEP)}},b.WebGLStencilManager.prototype.destroy=function(){this.maskStack=null,this.gl=null},b.WebGLShaderManager=function(a){this.maxAttibs=10,this.attribState=[],this.tempAttribState=[],this.shaderMap=[];for(var b=0;b<this.maxAttibs;b++)this.attribState[b]=!1;this.setContext(a)},b.WebGLShaderManager.prototype.setContext=function(a){this.gl=a,this.primitiveShader=new b.PrimitiveShader(a),this.complexPrimativeShader=new b.ComplexPrimitiveShader(a),this.defaultShader=new b.PixiShader(a),this.fastShader=new b.PixiFastShader(a),this.stripShader=new b.StripShader(a),this.setShader(this.defaultShader)},b.WebGLShaderManager.prototype.setAttribs=function(a){var b;for(b=0;b<this.tempAttribState.length;b++)this.tempAttribState[b]=!1;for(b=0;b<a.length;b++){var c=a[b];this.tempAttribState[c]=!0}var d=this.gl;for(b=0;b<this.attribState.length;b++)this.attribState[b]!==this.tempAttribState[b]&&(this.attribState[b]=this.tempAttribState[b],this.tempAttribState[b]?d.enableVertexAttribArray(b):d.disableVertexAttribArray(b))},b.WebGLShaderManager.prototype.setShader=function(a){return this._currentId===a._UID?!1:(this._currentId=a._UID,this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes),!0)},b.WebGLShaderManager.prototype.destroy=function(){this.attribState=null,this.tempAttribState=null,this.primitiveShader.destroy(),this.defaultShader.destroy(),this.fastShader.destroy(),this.stripShader.destroy(),this.gl=null},b.WebGLSpriteBatch=function(a){this.vertSize=6,this.size=2e3;var b=4*this.size*this.vertSize,c=6*this.size;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.lastIndexCount=0;for(var d=0,e=0;c>d;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.setContext(a),this.dirty=!0},b.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW),this.currentBlendMode=99999},b.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a,this.shader=this.renderSession.shaderManager.defaultShader,this.start()},b.WebGLSpriteBatch.prototype.end=function(){this.flush()},b.WebGLSpriteBatch.prototype.render=function(a){var b=a.texture,c=this.renderSession.blendModeManager.currentBlendMode!==a.blendMode;(b.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size||c)&&(this.flush(),this.currentBaseTexture=b.baseTexture,this.renderSession.blendModeManager.setBlendMode(a.blendMode));var d=b._uvs;if(d){var e,f,g,h,i=a.worldAlpha,j=a.tint,k=this.vertices,l=a.anchor.x,m=a.anchor.y;if(b.trim){var n=b.trim;f=n.x-l*n.width,e=f+b.crop.width,h=n.y-m*n.height,g=h+b.crop.height}else e=b.frame.width*(1-l),f=b.frame.width*-l,g=b.frame.height*(1-m),h=b.frame.height*-m;var o=4*this.currentBatchSize*this.vertSize,p=a.worldTransform,q=p.a,r=p.c,s=p.b,t=p.d,u=p.tx,v=p.ty;k[o++]=q*f+s*h+u,k[o++]=t*h+r*f+v,k[o++]=d.x0,k[o++]=d.y0,k[o++]=i,k[o++]=j,k[o++]=q*e+s*h+u,k[o++]=t*h+r*e+v,k[o++]=d.x1,k[o++]=d.y1,k[o++]=i,k[o++]=j,k[o++]=q*e+s*g+u,k[o++]=t*g+r*e+v,k[o++]=d.x2,k[o++]=d.y2,k[o++]=i,k[o++]=j,k[o++]=q*f+s*g+u,k[o++]=t*g+r*f+v,k[o++]=d.x3,k[o++]=d.y3,k[o++]=i,k[o++]=j,this.currentBatchSize++}},b.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var c=a.tilingTexture,d=this.renderSession.blendModeManager.currentBlendMode!==a.blendMode;(c.baseTexture!==this.currentBaseTexture||this.currentBatchSize>=this.size||d)&&(this.flush(),this.currentBaseTexture=c.baseTexture,this.renderSession.blendModeManager.setBlendMode(a.blendMode)),a._uvs||(a._uvs=new b.TextureUvs);var e=a._uvs;a.tilePosition.x%=c.baseTexture.width*a.tileScaleOffset.x,a.tilePosition.y%=c.baseTexture.height*a.tileScaleOffset.y;var f=a.tilePosition.x/(c.baseTexture.width*a.tileScaleOffset.x),g=a.tilePosition.y/(c.baseTexture.height*a.tileScaleOffset.y),h=a.width/c.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),i=a.height/c.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);e.x0=0-f,e.y0=0-g,e.x1=1*h-f,e.y1=0-g,e.x2=1*h-f,e.y2=1*i-g,e.x3=0-f,e.y3=1*i-g;var j=a.worldAlpha,k=a.tint,l=this.vertices,m=a.width,n=a.height,o=a.anchor.x,p=a.anchor.y,q=m*(1-o),r=m*-o,s=n*(1-p),t=n*-p,u=4*this.currentBatchSize*this.vertSize,v=a.worldTransform,w=v.a,x=v.c,y=v.b,z=v.d,A=v.tx,B=v.ty;l[u++]=w*r+y*t+A,l[u++]=z*t+x*r+B,l[u++]=e.x0,l[u++]=e.y0,l[u++]=j,l[u++]=k,l[u++]=w*q+y*t+A,l[u++]=z*t+x*q+B,l[u++]=e.x1,l[u++]=e.y1,l[u++]=j,l[u++]=k,l[u++]=w*q+y*s+A,l[u++]=z*s+x*q+B,l[u++]=e.x2,l[u++]=e.y2,l[u++]=j,l[u++]=k,l[u++]=w*r+y*s+A,l[u++]=z*s+x*r+B,l[u++]=e.x3,l[u++]=e.y3,l[u++]=j,l[u++]=k,this.currentBatchSize++},b.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.renderSession.shaderManager.setShader(this.renderSession.shaderManager.defaultShader),this.dirty){this.dirty=!1,a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var c=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,c.x,c.y);var d=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,d,0),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,d,8),a.vertexAttribPointer(this.shader.colorAttribute,2,a.FLOAT,!1,d,16)}if(a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]||b.createWebGLTexture(this.currentBaseTexture,a)),this.currentBaseTexture._dirty[a.id]&&b.updateWebGLTexture(this.currentBaseTexture,a),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var e=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,e)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},b.WebGLSpriteBatch.prototype.stop=function(){this.flush()},b.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0},b.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null,this.indices=null,this.gl.deleteBuffer(this.vertexBuffer),this.gl.deleteBuffer(this.indexBuffer),this.currentBaseTexture=null,this.gl=null},b.WebGLFastSpriteBatch=function(a){this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize;var b=4*this.size*this.vertSize,c=6*this.maxSize;this.vertices=new Float32Array(b),this.indices=new Uint16Array(c),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0;for(var d=0,e=0;c>d;d+=6,e+=4)this.indices[d+0]=e+0,this.indices[d+1]=e+1,this.indices[d+2]=e+2,this.indices[d+3]=e+0,this.indices[d+4]=e+2,this.indices[d+5]=e+3;this.drawing=!1,this.currentBatchSize=0,this.currentBaseTexture=null,this.currentBlendMode=0,this.renderSession=null,this.shader=null,this.matrix=null,this.setContext(a)},b.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a,this.vertexBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)},b.WebGLFastSpriteBatch.prototype.begin=function(a,b){this.renderSession=b,this.shader=this.renderSession.shaderManager.fastShader,this.matrix=a.worldTransform.toArray(!0),this.start()},b.WebGLFastSpriteBatch.prototype.end=function(){this.flush()},b.WebGLFastSpriteBatch.prototype.render=function(a){var b=a.children,c=b[0];if(c.texture._uvs){this.currentBaseTexture=c.texture.baseTexture,c.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(c.blendMode));for(var d=0,e=b.length;e>d;d++)this.renderSprite(b[d]);this.flush()}},b.WebGLFastSpriteBatch.prototype.renderSprite=function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=a.texture.baseTexture,a.texture._uvs))){var b,c,d,e,f,g,h,i,j=this.vertices;if(b=a.texture._uvs,c=a.texture.frame.width,d=a.texture.frame.height,a.texture.trim){var k=a.texture.trim;f=k.x-a.anchor.x*k.width,e=f+a.texture.crop.width,h=k.y-a.anchor.y*k.height,g=h+a.texture.crop.height}else e=a.texture.frame.width*(1-a.anchor.x),f=a.texture.frame.width*-a.anchor.x,g=a.texture.frame.height*(1-a.anchor.y),h=a.texture.frame.height*-a.anchor.y;i=4*this.currentBatchSize*this.vertSize,j[i++]=f,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x0,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=h,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x1,j[i++]=b.y1,j[i++]=a.alpha,j[i++]=e,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x2,j[i++]=b.y2,j[i++]=a.alpha,j[i++]=f,j[i++]=g,j[i++]=a.position.x,j[i++]=a.position.y,j[i++]=a.scale.x,j[i++]=a.scale.y,j[i++]=a.rotation,j[i++]=b.x3,j[i++]=b.y3,j[i++]=a.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush()}},b.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||b.createWebGLTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var c=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,c)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},b.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()},b.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y),a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);var c=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,c,0),a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,c,8),a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,c,16),a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,c,24),a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,c,28),a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,c,36)},b.WebGLFilterManager=function(a,b){this.transparent=b,this.filterStack=[],this.offsetX=0,this.offsetY=0,this.setContext(a)},b.WebGLFilterManager.prototype.setContext=function(a){this.gl=a,this.texturePool=[],this.initShaderBuffers()},b.WebGLFilterManager.prototype.begin=function(a,b){this.renderSession=a,this.defaultShader=a.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=2*c.x,this.height=2*-c.y,this.buffer=b},b.WebGLFilterManager.prototype.pushFilter=function(a){var c=this.gl,d=this.renderSession.projection,e=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds(),this.filterStack.push(a);var f=a.filterPasses[0];this.offsetX+=a._filterArea.x,this.offsetY+=a._filterArea.y;var g=this.texturePool.pop();g?g.resize(this.width,this.height):g=new b.FilterTexture(this.gl,this.width,this.height),c.bindTexture(c.TEXTURE_2D,g.texture);var h=a._filterArea,i=f.padding;h.x-=i,h.y-=i,h.width+=2*i,h.height+=2*i,h.x<0&&(h.x=0),h.width>this.width&&(h.width=this.width),h.y<0&&(h.y=0),h.height>this.height&&(h.height=this.height),c.bindFramebuffer(c.FRAMEBUFFER,g.frameBuffer),c.viewport(0,0,h.width,h.height),d.x=h.width/2,d.y=-h.height/2,e.x=-h.x,e.y=-h.y,this.renderSession.shaderManager.setShader(this.defaultShader),c.uniform2f(this.defaultShader.projectionVector,h.width/2,-h.height/2),c.uniform2f(this.defaultShader.offsetVector,-h.x,-h.y),c.colorMask(!0,!0,!0,!0),c.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT),a._glFilterTexture=g},b.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,c=this.filterStack.pop(),d=c._filterArea,e=c._glFilterTexture,f=this.renderSession.projection,g=this.renderSession.offset;if(c.filterPasses.length>1){a.viewport(0,0,d.width,d.height),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=d.height,this.vertexArray[2]=d.width,this.vertexArray[3]=d.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=d.width,this.vertexArray[7]=0,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=d.width/this.width,this.uvArray[5]=d.height/this.height,this.uvArray[6]=d.width/this.width,this.uvArray[7]=d.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var h=e,i=this.texturePool.pop();i||(i=new b.FilterTexture(this.gl,this.width,this.height)),i.resize(this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.BLEND);for(var j=0;j<c.filterPasses.length-1;j++){var k=c.filterPasses[j];a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,h.texture),this.applyFilterPass(k,d,d.width,d.height);var l=h;h=i,i=l}a.enable(a.BLEND),e=h,this.texturePool.push(i)}var m=c.filterPasses[c.filterPasses.length-1];this.offsetX-=d.x,this.offsetY-=d.y;var n=this.width,o=this.height,p=0,q=0,r=this.buffer;if(0===this.filterStack.length)a.colorMask(!0,!0,!0,!0);else{var s=this.filterStack[this.filterStack.length-1];d=s._filterArea,n=d.width,o=d.height,p=d.x,q=d.y,r=s._glFilterTexture.frameBuffer}f.x=n/2,f.y=-o/2,g.x=p,g.y=q,d=c._filterArea;var t=d.x-p,u=d.y-q;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=t,this.vertexArray[1]=u+d.height,this.vertexArray[2]=t+d.width,this.vertexArray[3]=u+d.height,this.vertexArray[4]=t,this.vertexArray[5]=u,this.vertexArray[6]=t+d.width,this.vertexArray[7]=u,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=d.width/this.width,this.uvArray[5]=d.height/this.height,this.uvArray[6]=d.width/this.width,this.uvArray[7]=d.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray),a.viewport(0,0,n,o),a.bindFramebuffer(a.FRAMEBUFFER,r),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,e.texture),this.applyFilterPass(m,d,n,o),this.renderSession.shaderManager.setShader(this.defaultShader),a.uniform2f(this.defaultShader.projectionVector,n/2,-o/2),a.uniform2f(this.defaultShader.offsetVector,-p,-q),this.texturePool.push(e),c._glFilterTexture=null},b.WebGLFilterManager.prototype.applyFilterPass=function(a,c,d,e){var f=this.gl,g=a.shaders[f.id];g||(g=new b.PixiShader(f),g.fragmentSrc=a.fragmentSrc,g.uniforms=a.uniforms,g.init(),a.shaders[f.id]=g),this.renderSession.shaderManager.setShader(g),f.uniform2f(g.projectionVector,d/2,-e/2),f.uniform2f(g.offsetVector,0,0),a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=this.width,a.uniforms.dimensions.value[1]=this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]),g.syncUniforms(),f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer),f.vertexAttribPointer(g.aVertexPosition,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer),f.vertexAttribPointer(g.aTextureCoord,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer),f.vertexAttribPointer(g.colorAttribute,2,f.FLOAT,!1,0,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0),this.renderSession.drawCount++},b.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer(),this.uvBuffer=a.createBuffer(),this.colorBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW),this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)},b.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null,this.offsetX=0,this.offsetY=0;for(var b=0;b<this.texturePool.length;b++)this.texturePool[b].destroy();this.texturePool=null,a.deleteBuffer(this.vertexBuffer),a.deleteBuffer(this.uvBuffer),a.deleteBuffer(this.colorBuffer),a.deleteBuffer(this.indexBuffer)},b.FilterTexture=function(a,c,d,e){this.gl=a,this.frameBuffer=a.createFramebuffer(),this.texture=a.createTexture(),e=e||b.scaleModes.DEFAULT,a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e===b.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e===b.scaleModes.LINEAR?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer),a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0),this.renderBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,this.renderBuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderBuffer),this.resize(c,d)},b.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0),a.clear(a.COLOR_BUFFER_BIT)},b.FilterTexture.prototype.resize=function(a,b){if(this.width!==a||this.height!==b){this.width=a,this.height=b;var c=this.gl;c.bindTexture(c.TEXTURE_2D,this.texture),c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null),c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer),c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_STENCIL,a,b)}},b.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer),a.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null},b.CanvasMaskManager=function(){},b.CanvasMaskManager.prototype.pushMask=function(a,c){c.save();var d=a.alpha,e=a.worldTransform;c.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty),b.CanvasGraphics.renderGraphicsMask(a,c),c.clip(),a.worldAlpha=d},b.CanvasMaskManager.prototype.popMask=function(a){a.restore()},b.CanvasTinter=function(){},b.CanvasTinter.getTintedTexture=function(a,c){var d=a.texture;c=b.CanvasTinter.roundColor(c);var e="#"+("00000"+(0|c).toString(16)).substr(-6);if(d.tintCache=d.tintCache||{},d.tintCache[e])return d.tintCache[e];var f=b.CanvasTinter.canvas||document.createElement("canvas");if(b.CanvasTinter.tintMethod(d,c,f),b.CanvasTinter.convertTintToImage){var g=new Image;g.src=f.toDataURL(),d.tintCache[e]=g}else d.tintCache[e]=f,b.CanvasTinter.canvas=null;return f},b.CanvasTinter.tintWithMultiply=function(a,b,c){var d=c.getContext("2d"),e=a.frame;c.width=e.width,c.height=e.height,d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="multiply",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},b.CanvasTinter.tintWithOverlay=function(a,b,c){var d=c.getContext("2d"),e=a.frame;c.width=e.width,c.height=e.height,d.globalCompositeOperation="copy",d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6),d.fillRect(0,0,e.width,e.height),d.globalCompositeOperation="destination-atop",d.drawImage(a.baseTexture.source,e.x,e.y,e.width,e.height,0,0,e.width,e.height)},b.CanvasTinter.tintWithPerPixel=function(a,c,d){var e=d.getContext("2d"),f=a.frame;d.width=f.width,d.height=f.height,e.globalCompositeOperation="copy",e.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);for(var g=b.hex2rgb(c),h=g[0],i=g[1],j=g[2],k=e.getImageData(0,0,f.width,f.height),l=k.data,m=0;m<l.length;m+=4)l[m+0]*=h,l[m+1]*=i,l[m+2]*=j;e.putImageData(k,0,0)},b.CanvasTinter.roundColor=function(a){var c=b.CanvasTinter.cacheStepsPerColorChannel,d=b.hex2rgb(a);return d[0]=Math.min(255,d[0]/c*c),d[1]=Math.min(255,d[1]/c*c),d[2]=Math.min(255,d[2]/c*c),b.rgb2hex(d)},b.CanvasTinter.cacheStepsPerColorChannel=8,b.CanvasTinter.convertTintToImage=!1,b.CanvasTinter.canUseMultiply=b.canUseNewCanvasBlendModes(),b.CanvasTinter.tintMethod=b.CanvasTinter.canUseMultiply?b.CanvasTinter.tintWithMultiply:b.CanvasTinter.tintWithPerPixel,b.CanvasRenderer=function(a,c,d,e){b.defaultRenderer||(b.sayHello("Canvas"),b.defaultRenderer=this),this.type=b.CANVAS_RENDERER,this.clearBeforeRender=!0,this.transparent=!!e,b.blendModesCanvas||(b.blendModesCanvas=[],b.canUseNewCanvasBlendModes()?(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="multiply",b.blendModesCanvas[b.blendModes.SCREEN]="screen",b.blendModesCanvas[b.blendModes.OVERLAY]="overlay",b.blendModesCanvas[b.blendModes.DARKEN]="darken",b.blendModesCanvas[b.blendModes.LIGHTEN]="lighten",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="color-dodge",b.blendModesCanvas[b.blendModes.COLOR_BURN]="color-burn",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="hard-light",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="soft-light",b.blendModesCanvas[b.blendModes.DIFFERENCE]="difference",b.blendModesCanvas[b.blendModes.EXCLUSION]="exclusion",b.blendModesCanvas[b.blendModes.HUE]="hue",b.blendModesCanvas[b.blendModes.SATURATION]="saturation",b.blendModesCanvas[b.blendModes.COLOR]="color",b.blendModesCanvas[b.blendModes.LUMINOSITY]="luminosity"):(b.blendModesCanvas[b.blendModes.NORMAL]="source-over",b.blendModesCanvas[b.blendModes.ADD]="lighter",b.blendModesCanvas[b.blendModes.MULTIPLY]="source-over",b.blendModesCanvas[b.blendModes.SCREEN]="source-over",b.blendModesCanvas[b.blendModes.OVERLAY]="source-over",b.blendModesCanvas[b.blendModes.DARKEN]="source-over",b.blendModesCanvas[b.blendModes.LIGHTEN]="source-over",b.blendModesCanvas[b.blendModes.COLOR_DODGE]="source-over",b.blendModesCanvas[b.blendModes.COLOR_BURN]="source-over",b.blendModesCanvas[b.blendModes.HARD_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.SOFT_LIGHT]="source-over",b.blendModesCanvas[b.blendModes.DIFFERENCE]="source-over",b.blendModesCanvas[b.blendModes.EXCLUSION]="source-over",b.blendModesCanvas[b.blendModes.HUE]="source-over",b.blendModesCanvas[b.blendModes.SATURATION]="source-over",b.blendModesCanvas[b.blendModes.COLOR]="source-over",b.blendModesCanvas[b.blendModes.LUMINOSITY]="source-over")),this.width=a||800,this.height=c||600,this.view=d||document.createElement("canvas"),this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.view.width=this.width,this.view.height=this.height,this.count=0,this.maskManager=new b.CanvasMaskManager,this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1},"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")
},b.CanvasRenderer.prototype.constructor=b.CanvasRenderer,b.CanvasRenderer.prototype.render=function(a){b.texturesToUpdate.length=0,b.texturesToDestroy.length=0,a.updateTransform(),this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height),this.renderDisplayObject(a),a.interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this))),b.Texture.frameUpdates.length>0&&(b.Texture.frameUpdates.length=0)},b.CanvasRenderer.prototype.resize=function(a,b){this.width=a,this.height=b,this.view.width=a,this.view.height=b},b.CanvasRenderer.prototype.renderDisplayObject=function(a,b){this.renderSession.context=b||this.context,a._renderCanvas(this.renderSession)},b.CanvasRenderer.prototype.renderStripFlat=function(a){var b=this.context,c=a.verticies,d=c.length/2;this.count++,b.beginPath();for(var e=1;d-2>e;e++){var f=2*e,g=c[f],h=c[f+2],i=c[f+4],j=c[f+1],k=c[f+3],l=c[f+5];b.moveTo(g,j),b.lineTo(h,k),b.lineTo(i,l)}b.fillStyle="#FF0000",b.fill(),b.closePath()},b.CanvasRenderer.prototype.renderStrip=function(a){var b=this.context,c=a.verticies,d=a.uvs,e=c.length/2;this.count++;for(var f=1;e-2>f;f++){var g=2*f,h=c[g],i=c[g+2],j=c[g+4],k=c[g+1],l=c[g+3],m=c[g+5],n=d[g]*a.texture.width,o=d[g+2]*a.texture.width,p=d[g+4]*a.texture.width,q=d[g+1]*a.texture.height,r=d[g+3]*a.texture.height,s=d[g+5]*a.texture.height;b.save(),b.beginPath(),b.moveTo(h,k),b.lineTo(i,l),b.lineTo(j,m),b.closePath(),b.clip();var t=n*r+q*p+o*s-r*p-q*o-n*s,u=h*r+q*j+i*s-r*j-q*i-h*s,v=n*i+h*p+o*j-i*p-h*o-n*j,w=n*r*j+q*i*p+h*o*s-h*r*p-q*o*j-n*i*s,x=k*r+q*m+l*s-r*m-q*l-k*s,y=n*l+k*p+o*m-l*p-k*o-n*m,z=n*r*m+q*l*p+k*o*s-k*r*p-q*o*m-n*l*s;b.transform(u/t,x/t,v/t,y/t,w/t,z/t),b.drawImage(a.texture.baseTexture.source,0,0),b.restore()}},b.CanvasBuffer=function(a,b){this.width=a,this.height=b,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b},b.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},b.CanvasBuffer.prototype.resize=function(a,b){this.width=this.canvas.width=a,this.height=this.canvas.height=b},b.CanvasGraphics=function(){},b.CanvasGraphics.renderGraphics=function(a,c){for(var d=a.worldAlpha,e="",f=0;f<a.graphicsData.length;f++){var g=a.graphicsData[f],h=g.points;if(c.strokeStyle=e="#"+("00000"+(0|g.lineColor).toString(16)).substr(-6),c.lineWidth=g.lineWidth,g.type===b.Graphics.POLY){c.beginPath(),c.moveTo(h[0],h[1]);for(var i=1;i<h.length/2;i++)c.lineTo(h[2*i],h[2*i+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&c.closePath(),g.fill&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke())}else if(g.type===b.Graphics.RECT)(g.fillColor||0===g.fillColor)&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fillRect(h[0],h[1],h[2],h[3])),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.strokeRect(h[0],h[1],h[2],h[3]));else if(g.type===b.Graphics.CIRC)c.beginPath(),c.arc(h[0],h[1],h[2],0,2*Math.PI),c.closePath(),g.fill&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke());else if(g.type===b.Graphics.ELIP){var j=g.points,k=2*j[2],l=2*j[3],m=j[0]-k/2,n=j[1]-l/2;c.beginPath();var o=.5522848,p=k/2*o,q=l/2*o,r=m+k,s=n+l,t=m+k/2,u=n+l/2;c.moveTo(m,u),c.bezierCurveTo(m,u-q,t-p,n,t,n),c.bezierCurveTo(t+p,n,r,u-q,r,u),c.bezierCurveTo(r,u+q,t+p,s,t,s),c.bezierCurveTo(t-p,s,m,u+q,m,u),c.closePath(),g.fill&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke())}else if(g.type===b.Graphics.RREC){var v=h[0],w=h[1],x=h[2],y=h[3],z=h[4],A=Math.min(x,y)/2|0;z=z>A?A:z,c.beginPath(),c.moveTo(v,w+z),c.lineTo(v,w+y-z),c.quadraticCurveTo(v,w+y,v+z,w+y),c.lineTo(v+x-z,w+y),c.quadraticCurveTo(v+x,w+y,v+x,w+y-z),c.lineTo(v+x,w+z),c.quadraticCurveTo(v+x,w,v+x-z,w),c.lineTo(v+z,w),c.quadraticCurveTo(v,w,v,w+z),c.closePath(),(g.fillColor||0===g.fillColor)&&(c.globalAlpha=g.fillAlpha*d,c.fillStyle=e="#"+("00000"+(0|g.fillColor).toString(16)).substr(-6),c.fill()),g.lineWidth&&(c.globalAlpha=g.lineAlpha*d,c.stroke())}}},b.CanvasGraphics.renderGraphicsMask=function(a,c){var d=a.graphicsData.length;if(0!==d){d>1&&(d=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object"));for(var e=0;1>e;e++){var f=a.graphicsData[e],g=f.points;if(f.type===b.Graphics.POLY){c.beginPath(),c.moveTo(g[0],g[1]);for(var h=1;h<g.length/2;h++)c.lineTo(g[2*h],g[2*h+1]);g[0]===g[g.length-2]&&g[1]===g[g.length-1]&&c.closePath()}else if(f.type===b.Graphics.RECT)c.beginPath(),c.rect(g[0],g[1],g[2],g[3]),c.closePath();else if(f.type===b.Graphics.CIRC)c.beginPath(),c.arc(g[0],g[1],g[2],0,2*Math.PI),c.closePath();else if(f.type===b.Graphics.ELIP){var i=f.points,j=2*i[2],k=2*i[3],l=i[0]-j/2,m=i[1]-k/2;c.beginPath();var n=.5522848,o=j/2*n,p=k/2*n,q=l+j,r=m+k,s=l+j/2,t=m+k/2;c.moveTo(l,t),c.bezierCurveTo(l,t-p,s-o,m,s,m),c.bezierCurveTo(s+o,m,q,t-p,q,t),c.bezierCurveTo(q,t+p,s+o,r,s,r),c.bezierCurveTo(s-o,r,l,t+p,l,t),c.closePath()}else if(f.type===b.Graphics.RREC){var u=g[0],v=g[1],w=g[2],x=g[3],y=g[4],z=Math.min(w,x)/2|0;y=y>z?z:y,c.beginPath(),c.moveTo(u,v+y),c.lineTo(u,v+x-y),c.quadraticCurveTo(u,v+x,u+y,v+x),c.lineTo(u+w-y,v+x),c.quadraticCurveTo(u+w,v+x,u+w,v+x-y),c.lineTo(u+w,v+y),c.quadraticCurveTo(u+w,v,u+w-y,v),c.lineTo(u+y,v),c.quadraticCurveTo(u,v,u,v+y),c.closePath()}}}},b.Graphics=function(){b.DisplayObjectContainer.call(this),this.renderable=!0,this.fillAlpha=1,this.lineWidth=0,this.lineColor="black",this.graphicsData=[],this.tint=16777215,this.blendMode=b.blendModes.NORMAL,this.currentPath={points:[]},this._webGL=[],this.isMask=!1,this.bounds=null,this.boundsPadding=10,this.dirty=!0},b.Graphics.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Graphics.prototype.constructor=b.Graphics,Object.defineProperty(b.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap=a,this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}}),b.Graphics.prototype.lineStyle=function(a,c,d){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=a||0,this.lineColor=c||0,this.lineAlpha=arguments.length<3?1:d,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.graphicsData.push(this.currentPath),this},b.Graphics.prototype.moveTo=function(a,c){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.currentPath.points.push(a,c),this.graphicsData.push(this.currentPath),this},b.Graphics.prototype.lineTo=function(a,b){return this.currentPath.points.push(a,b),this.dirty=!0,this},b.Graphics.prototype.quadraticCurveTo=function(a,b,c,d){0===this.currentPath.points.length&&this.moveTo(0,0);var e,f,g=20,h=this.currentPath.points;0===h.length&&this.moveTo(0,0);for(var i=h[h.length-2],j=h[h.length-1],k=0,l=1;g>=l;l++)k=l/g,e=i+(a-i)*k,f=j+(b-j)*k,h.push(e+(a+(c-a)*k-e)*k,f+(b+(d-b)*k-f)*k);return this.dirty=!0,this},b.Graphics.prototype.bezierCurveTo=function(a,b,c,d,e,f){0===this.currentPath.points.length&&this.moveTo(0,0);for(var g,h,i,j,k,l=20,m=this.currentPath.points,n=m[m.length-2],o=m[m.length-1],p=0,q=1;l>q;q++)p=q/l,g=1-p,h=g*g,i=h*g,j=p*p,k=j*p,m.push(i*n+3*h*p*a+3*g*j*c+k*e,i*o+3*h*p*b+3*g*j*d+k*f);return this.dirty=!0,this},b.Graphics.prototype.arcTo=function(a,b,c,d,e){0===this.currentPath.points.length&&this.moveTo(a,b);var f=this.currentPath.points,g=f[f.length-2],h=f[f.length-1],i=h-b,j=g-a,k=d-b,l=c-a,m=Math.abs(i*l-j*k);if(1e-8>m||0===e)f.push(a,b);else{var n=i*i+j*j,o=k*k+l*l,p=i*k+j*l,q=e*Math.sqrt(n)/m,r=e*Math.sqrt(o)/m,s=q*p/n,t=r*p/o,u=q*l+r*j,v=q*k+r*i,w=j*(r+s),x=i*(r+s),y=l*(q+t),z=k*(q+t),A=Math.atan2(x-v,w-u),B=Math.atan2(z-v,y-u);this.arc(u+a,v+b,e,A,B,j*k>l*i)}return this.dirty=!0,this},b.Graphics.prototype.arc=function(a,b,c,d,e,f){var g=a+Math.cos(d)*c,h=b+Math.sin(d)*c,i=this.currentPath.points;if((0!==i.length&&i[i.length-2]!==g||i[i.length-1]!==h)&&(this.moveTo(g,h),i=this.currentPath.points),d===e)return this;!f&&d>=e?e+=2*Math.PI:f&&e>=d&&(d+=2*Math.PI);var j=f?-1*(d-e):e-d,k=Math.abs(j)/(2*Math.PI)*40;if(0===j)return this;for(var l=j/(2*k),m=2*l,n=Math.cos(l),o=Math.sin(l),p=k-1,q=p%1/p,r=0;p>=r;r++){var s=r+q*r,t=l+d+m*s,u=Math.cos(t),v=-Math.sin(t);i.push((n*u+o*v)*c+a,(n*-v+o*u)*c+b)}return this.dirty=!0,this},b.Graphics.prototype.drawPath=function(a){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:b.Graphics.POLY},this.graphicsData.push(this.currentPath),this.currentPath.points=this.currentPath.points.concat(a),this.dirty=!0,this},b.Graphics.prototype.beginFill=function(a,b){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=arguments.length<2?1:b,this},b.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},b.Graphics.prototype.drawRect=function(a,c,d,e){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,d,e],type:b.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this},b.Graphics.prototype.drawRoundedRect=function(a,c,d,e,f){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,d,e,f],type:b.Graphics.RREC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},b.Graphics.prototype.drawCircle=function(a,c,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,d,d],type:b.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this},b.Graphics.prototype.drawEllipse=function(a,c,d,e){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,c,d,e],type:b.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0,this},b.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this},b.Graphics.prototype.generateTexture=function(){var a=this.getBounds(),c=new b.CanvasBuffer(a.width,a.height),d=b.Texture.fromCanvas(c.canvas);return c.context.translate(-a.x,-a.y),b.CanvasGraphics.renderGraphics(this,c.context),d},b.Graphics.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){if(this._cacheAsBitmap)return this.dirty&&(this._generateCachedSprite(),b.updateWebGLTexture(this._cachedSprite.texture.baseTexture,a.gl),this.dirty=!1),this._cachedSprite.alpha=this.alpha,void b.Sprite.prototype._renderWebGL.call(this._cachedSprite,a);if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var c=b.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(c[0],c[1])}if(b.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var d=0,e=this.children.length;e>d;d++)this.children[d]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter(),this._mask&&a.maskManager.popMask(this.mask,a),a.drawCount++,a.spriteBatch.start()}},b.Graphics.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha&&this.isMask!==!0){var c=a.context,d=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a.context),c.setTransform(d.a,d.c,d.b,d.d,d.tx,d.ty),b.CanvasGraphics.renderGraphics(this,c);for(var e=0,f=this.children.length;f>e;e++)this.children[e]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}},b.Graphics.prototype.getBounds=function(a){this.bounds||this.updateBounds();var b=this.bounds.x,c=this.bounds.width+this.bounds.x,d=this.bounds.y,e=this.bounds.height+this.bounds.y,f=a||this.worldTransform,g=f.a,h=f.c,i=f.b,j=f.d,k=f.tx,l=f.ty,m=g*c+i*e+k,n=j*e+h*c+l,o=g*b+i*e+k,p=j*e+h*b+l,q=g*b+i*d+k,r=j*d+h*b+l,s=g*c+i*d+k,t=j*d+h*c+l,u=m,v=n,w=m,x=n;w=w>o?o:w,w=w>q?q:w,w=w>s?s:w,x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,u=o>u?o:u,u=q>u?q:u,u=s>u?s:u,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v;var y=this._bounds;return y.x=w,y.width=u-w,y.y=x,y.height=v-x,y},b.Graphics.prototype.updateBounds=function(){for(var a,c,d,e,f,g=1/0,h=-1/0,i=1/0,j=-1/0,k=0;k<this.graphicsData.length;k++){var l=this.graphicsData[k],m=l.type,n=l.lineWidth;if(a=l.points,m===b.Graphics.RECT)c=a[0]-n/2,d=a[1]-n/2,e=a[2]+n,f=a[3]+n,g=g>c?c:g,h=c+e>h?c+e:h,i=i>d?c:i,j=d+f>j?d+f:j;else if(m===b.Graphics.CIRC||m===b.Graphics.ELIP)c=a[0],d=a[1],e=a[2]+n/2,f=a[3]+n/2,g=g>c-e?c-e:g,h=c+e>h?c+e:h,i=i>d-f?d-f:i,j=d+f>j?d+f:j;else for(var o=0;o<a.length;o+=2)c=a[o],d=a[o+1],g=g>c-n?c-n:g,h=c+n>h?c+n:h,i=i>d-n?d-n:i,j=d+n>j?d+n:j}var p=this.boundsPadding;this.bounds=new b.Rectangle(g-p,i-p,h-g+2*p,j-i+2*p)},b.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var c=new b.CanvasBuffer(a.width,a.height),d=b.Texture.fromCanvas(c.canvas);this._cachedSprite=new b.Sprite(d),this._cachedSprite.buffer=c,this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=-(a.x/a.width),this._cachedSprite.anchor.y=-(a.y/a.height),this._cachedSprite.buffer.context.translate(-a.x,-a.y),b.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context),this._cachedSprite.alpha=this.alpha},b.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0),this._cachedSprite=null},b.Graphics.POLY=0,b.Graphics.RECT=1,b.Graphics.CIRC=2,b.Graphics.ELIP=3,b.Graphics.RREC=4,b.Strip=function(a){b.DisplayObjectContainer.call(this),this.texture=a,this.uvs=new b.Float32Array([0,1,1,1,1,0,0,1]),this.verticies=new b.Float32Array([0,0,100,0,100,100,0,100]),this.colors=new b.Float32Array([1,1,1,1]),this.indices=new b.Uint16Array([0,1,2,3]),this.dirty=!0},b.Strip.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Strip.prototype.constructor=b.Strip,b.Strip.prototype._renderWebGL=function(a){!this.visible||this.alpha<=0||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),a.spriteBatch.start())},b.Strip.prototype._initWebGL=function(a){var b=a.gl;this._vertexBuffer=b.createBuffer(),this._indexBuffer=b.createBuffer(),this._uvBuffer=b.createBuffer(),this._colorBuffer=b.createBuffer(),b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.verticies,b.DYNAMIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW),b.bindBuffer(b.ARRAY_BUFFER,this._colorBuffer),b.bufferData(b.ARRAY_BUFFER,this.colors,b.STATIC_DRAW),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this.indices,b.STATIC_DRAW)},b.Strip.prototype._renderStrip=function(a){var c=a.gl,d=a.projection,e=a.offset,f=a.shaderManager.stripShader;c.blendFunc(c.ONE,c.ONE_MINUS_SRC_ALPHA),c.uniformMatrix3fv(f.translationMatrix,!1,this.worldTransform.toArray(!0)),c.uniform2f(f.projectionVector,d.x,-d.y),c.uniform2f(f.offsetVector,-e.x,-e.y),c.uniform1f(f.alpha,1),this.dirty?(this.dirty=!1,c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.bufferData(c.ARRAY_BUFFER,this.verticies,c.STATIC_DRAW),c.vertexAttribPointer(f.aVertexPosition,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this._uvBuffer),c.bufferData(c.ARRAY_BUFFER,this.uvs,c.STATIC_DRAW),c.vertexAttribPointer(f.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.texture.baseTexture._glTextures[c.id]||b.createWebGLTexture(this.texture.baseTexture,c)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,this.indices,c.STATIC_DRAW)):(c.bindBuffer(c.ARRAY_BUFFER,this._vertexBuffer),c.bufferSubData(c.ARRAY_BUFFER,0,this.verticies),c.vertexAttribPointer(f.aVertexPosition,2,c.FLOAT,!1,0,0),c.bindBuffer(c.ARRAY_BUFFER,this._uvBuffer),c.vertexAttribPointer(f.aTextureCoord,2,c.FLOAT,!1,0,0),c.activeTexture(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,this.texture.baseTexture._glTextures[c.id]||b.createWebGLTexture(this.texture.baseTexture,c)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer)),c.drawElements(c.TRIANGLE_STRIP,this.indices.length,c.UNSIGNED_SHORT,0)},b.Strip.prototype._renderCanvas=function(a){var b=a.context,c=this.worldTransform;a.roundPixels?b.setTransform(c.a,c.c,c.b,c.d,0|c.tx,0|c.ty):b.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty);var d=this,e=d.verticies,f=d.uvs,g=e.length/2;this.count++;for(var h=0;g-2>h;h++){var i=2*h,j=e[i],k=e[i+2],l=e[i+4],m=e[i+1],n=e[i+3],o=e[i+5],p=(j+k+l)/3,q=(m+n+o)/3,r=j-p,s=m-q,t=Math.sqrt(r*r+s*s);j=p+r/t*(t+3),m=q+s/t*(t+3),r=k-p,s=n-q,t=Math.sqrt(r*r+s*s),k=p+r/t*(t+3),n=q+s/t*(t+3),r=l-p,s=o-q,t=Math.sqrt(r*r+s*s),l=p+r/t*(t+3),o=q+s/t*(t+3);var u=f[i]*d.texture.width,v=f[i+2]*d.texture.width,w=f[i+4]*d.texture.width,x=f[i+1]*d.texture.height,y=f[i+3]*d.texture.height,z=f[i+5]*d.texture.height;b.save(),b.beginPath(),b.moveTo(j,m),b.lineTo(k,n),b.lineTo(l,o),b.closePath(),b.clip();var A=u*y+x*w+v*z-y*w-x*v-u*z,B=j*y+x*l+k*z-y*l-x*k-j*z,C=u*k+j*w+v*l-k*w-j*v-u*l,D=u*y*l+x*k*w+j*v*z-j*y*w-x*v*l-u*k*z,E=m*y+x*o+n*z-y*o-x*n-m*z,F=u*n+m*w+v*o-n*w-m*v-u*o,G=u*y*o+x*n*w+m*v*z-m*y*w-x*v*o-u*n*z;b.transform(B/A,E/A,C/A,F/A,D/A,G/A),b.drawImage(d.texture.baseTexture.source,0,0),b.restore()}},b.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0},b.Rope=function(a,c){b.Strip.call(this,a),this.points=c,this.verticies=new b.Float32Array(4*c.length),this.uvs=new b.Float32Array(4*c.length),this.colors=new b.Float32Array(2*c.length),this.indices=new b.Uint16Array(2*c.length),this.refresh()},b.Rope.prototype=Object.create(b.Strip.prototype),b.Rope.prototype.constructor=b.Rope,b.Rope.prototype.refresh=function(){var a=this.points;if(!(a.length<1)){var b=this.uvs,c=a[0],d=this.indices,e=this.colors;this.count-=.2,b[0]=0,b[1]=0,b[2]=0,b[3]=1,e[0]=1,e[1]=1,d[0]=0,d[1]=1;for(var f,g,h,i=a.length,j=1;i>j;j++)f=a[j],g=4*j,h=j/(i-1),j%2?(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1):(b[g]=h,b[g+1]=0,b[g+2]=h,b[g+3]=1),g=2*j,e[g]=1,e[g+1]=1,g=2*j,d[g]=g,d[g+1]=g+1,c=f}},b.Rope.prototype.updateTransform=function(){var a=this.points;if(!(a.length<1)){var c,d=a[0],e={x:0,y:0};this.count-=.2;for(var f,g,h,i,j,k=this.verticies,l=a.length,m=0;l>m;m++)f=a[m],g=4*m,c=m<a.length-1?a[m+1]:f,e.y=-(c.x-d.x),e.x=c.y-d.y,h=10*(1-m/(l-1)),h>1&&(h=1),i=Math.sqrt(e.x*e.x+e.y*e.y),j=this.texture.height/2,e.x/=i,e.y/=i,e.x*=j,e.y*=j,k[g]=f.x+e.x,k[g+1]=f.y+e.y,k[g+2]=f.x-e.x,k[g+3]=f.y-e.y,d=f;b.DisplayObjectContainer.prototype.updateTransform.call(this)}},b.Rope.prototype.setTexture=function(a){this.texture=a},b.TilingSprite=function(a,c,d){b.Sprite.call(this,a),this.width=c||100,this.height=d||100,this.tileScale=new b.Point(1,1),this.tileScaleOffset=new b.Point(1,1),this.tilePosition=new b.Point(0,0),this.renderable=!0,this.tint=16777215,this.blendMode=b.blendModes.NORMAL},b.TilingSprite.prototype=Object.create(b.Sprite.prototype),b.TilingSprite.prototype.constructor=b.TilingSprite,Object.defineProperty(b.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}}),Object.defineProperty(b.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}}),b.TilingSprite.prototype.setTexture=function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)},b.TilingSprite.prototype._renderWebGL=function(a){if(this.visible!==!1&&0!==this.alpha){var c,d;for(this.mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this.filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(b.updateWebGLTexture(this.tilingTexture.baseTexture,a.gl),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this),c=0,d=this.children.length;d>c;c++)this.children[c]._renderWebGL(a);a.spriteBatch.stop(),this.filters&&a.filterManager.popFilter(),this.mask&&a.maskManager.popMask(a),a.spriteBatch.start()}},b.TilingSprite.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){var c=a.context;this._mask&&a.maskManager.pushMask(this._mask,c),c.globalAlpha=this.worldAlpha;var d,e,f=this.worldTransform;if(c.setTransform(f.a,f.c,f.b,f.d,f.tx,f.ty),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=c.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,c.globalCompositeOperation=b.blendModesCanvas[a.currentBlendMode]);var g=this.tilePosition,h=this.tileScale;for(g.x%=this.tilingTexture.baseTexture.width,g.y%=this.tilingTexture.baseTexture.height,c.scale(h.x,h.y),c.translate(g.x,g.y),c.fillStyle=this.__tilePattern,c.fillRect(-g.x+this.anchor.x*-this._width,-g.y+this.anchor.y*-this._height,this._width/h.x,this._height/h.y),c.scale(1/h.x,1/h.y),c.translate(-g.x,-g.y),this._mask&&a.maskManager.popMask(a.context),d=0,e=this.children.length;e>d;d++)this.children[d]._renderCanvas(a)}},b.TilingSprite.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,e=b*(1-this.anchor.y),f=b*-this.anchor.y,g=this.worldTransform,h=g.a,i=g.c,j=g.b,k=g.d,l=g.tx,m=g.ty,n=h*d+j*f+l,o=k*f+i*d+m,p=h*c+j*f+l,q=k*f+i*c+m,r=h*c+j*e+l,s=k*e+i*c+m,t=h*d+j*e+l,u=k*e+i*d+m,v=-1/0,w=-1/0,x=1/0,y=1/0;x=x>n?n:x,x=x>p?p:x,x=x>r?r:x,x=x>t?t:x,y=y>o?o:y,y=y>q?q:y,y=y>s?s:y,y=y>u?u:y,v=n>v?n:v,v=p>v?p:v,v=r>v?r:v,v=t>v?t:v,w=o>w?o:w,w=q>w?q:w,w=s>w?s:w,w=u>w?u:w;var z=this._bounds;return z.x=x,z.width=v-x,z.y=y,z.height=w-y,this._currentBounds=z,z},b.TilingSprite.prototype.generateTilingTexture=function(a){if(this.texture.baseTexture.hasLoaded){var c,d,e=this.texture,f=e.frame,g=f.width!==e.baseTexture.width||f.height!==e.baseTexture.height,h=!1;if(a?(c=b.getNextPowerOfTwo(f.width),d=b.getNextPowerOfTwo(f.height),(f.width!==c||f.height!==d)&&(h=!0)):g&&(c=f.width,d=f.height,h=!0),h){var i;this.tilingTexture&&this.tilingTexture.isTiling?(i=this.tilingTexture.canvasBuffer,i.resize(c,d),this.tilingTexture.baseTexture.width=c,this.tilingTexture.baseTexture.height=d,this.tilingTexture.needsUpdate=!0):(i=new b.CanvasBuffer(c,d),this.tilingTexture=b.Texture.fromCanvas(i.canvas),this.tilingTexture.canvasBuffer=i,this.tilingTexture.isTiling=!0),i.context.drawImage(e.baseTexture.source,e.crop.x,e.crop.y,e.crop.width,e.crop.height,0,0,c,d),this.tileScaleOffset.x=f.width/c,this.tileScaleOffset.y=f.height/d}else this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=e;this.refreshTexture=!1,this.tilingTexture.baseTexture._powerOf2=!0}};var f={};f.BoneData=function(a,b){this.name=a,this.parent=b},f.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1},f.SlotData=function(a,b){this.name=a,this.boneData=b},f.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null},f.Bone=function(a,b){this.data=a,this.parent=b,this.setToSetupPose()},f.Bone.yDown=!1,f.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(a,b){var c=this.parent;null!=c?(this.worldX=this.x*c.m00+this.y*c.m01+c.worldX,this.worldY=this.x*c.m10+this.y*c.m11+c.worldY,this.worldScaleX=c.worldScaleX*this.scaleX,this.worldScaleY=c.worldScaleY*this.scaleY,this.worldRotation=c.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var d=this.worldRotation*Math.PI/180,e=Math.cos(d),g=Math.sin(d);this.m00=e*this.worldScaleX,this.m10=g*this.worldScaleX,this.m01=-g*this.worldScaleY,this.m11=e*this.worldScaleY,a&&(this.m00=-this.m00,this.m01=-this.m01),b&&(this.m10=-this.m10,this.m11=-this.m11),f.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var a=this.data;this.x=a.x,this.y=a.y,this.rotation=a.rotation,this.scaleX=a.scaleX,this.scaleY=a.scaleY}},f.Slot=function(a,b,c){this.data=a,this.skeleton=b,this.bone=c,this.setToSetupPose()},f.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(a){this.attachment=a,this._attachmentTime=this.skeleton.time},setAttachmentTime:function(a){this._attachmentTime=this.skeleton.time-a},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var a=this.data;this.r=a.r,this.g=a.g,this.b=a.b,this.a=a.a;for(var b=this.skeleton.data.slots,c=0,d=b.length;d>c;c++)if(b[c]==a){this.setAttachment(a.attachmentName?this.skeleton.getAttachmentBySlotIndex(c,a.attachmentName):null);break}}},f.Skin=function(a){this.name=a,this.attachments={}},f.Skin.prototype={addAttachment:function(a,b,c){this.attachments[a+":"+b]=c},getAttachment:function(a,b){return this.attachments[a+":"+b]},_attachAll:function(a,b){for(var c in b.attachments){var d=c.indexOf(":"),e=parseInt(c.substring(0,d),10),f=c.substring(d+1),g=a.slots[e];if(g.attachment&&g.attachment.name==f){var h=this.getAttachment(e,f);h&&g.setAttachment(h)}}}},f.Animation=function(a,b,c){this.name=a,this.timelines=b,this.duration=c},f.Animation.prototype={apply:function(a,b,c){c&&this.duration&&(b%=this.duration);for(var d=this.timelines,e=0,f=d.length;f>e;e++)d[e].apply(a,b,1)},mix:function(a,b,c,d){c&&this.duration&&(b%=this.duration);for(var e=this.timelines,f=0,g=e.length;g>f;f++)e[f].apply(a,b,d)}},f.binarySearch=function(a,b,c){var d=0,e=Math.floor(a.length/c)-2;if(!e)return c;for(var f=e>>>1;;){if(a[(f+1)*c]<=b?d=f+1:e=f,d==e)return(d+1)*c;f=d+e>>>1}},f.linearSearch=function(a,b,c){for(var d=0,e=a.length-c;e>=d;d+=c)if(a[d]>b)return d;return-1},f.Curves=function(a){this.curves=[],this.curves.length=6*(a-1)},f.Curves.prototype={setLinear:function(a){this.curves[6*a]=0},setStepped:function(a){this.curves[6*a]=-1},setCurve:function(a,b,c,d,e){var f=.1,g=f*f,h=g*f,i=3*f,j=3*g,k=6*g,l=6*h,m=2*-b+d,n=2*-c+e,o=3*(b-d)+1,p=3*(c-e)+1,q=6*a,r=this.curves;r[q]=b*i+m*j+o*h,r[q+1]=c*i+n*j+p*h,r[q+2]=m*k+o*l,r[q+3]=n*k+p*l,r[q+4]=o*l,r[q+5]=p*l},getCurvePercent:function(a,b){b=0>b?0:b>1?1:b;var c=6*a,d=this.curves,e=d[c];if(!e)return b;if(-1==e)return 0;for(var f=d[c+1],g=d[c+2],h=d[c+3],i=d[c+4],j=d[c+5],k=e,l=f,m=8;;){if(k>=b){var n=k-e,o=l-f;return o+(l-o)*(b-n)/(k-n)}if(!m)break;m--,e+=g,f+=h,g+=i,h+=j,k+=e,l+=f}return l+(1-l)*(b-k)/(1-k)}},f.RotateTimeline=function(a){this.curves=new f.Curves(a),this.frames=[],this.frames.length=2*a},f.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(a,b,c){a*=2,this.frames[a]=b,this.frames[a+1]=c},apply:function(a,b,c){var d,e=this.frames;if(!(b<e[0])){var g=a.bones[this.boneIndex];if(b>=e[e.length-2]){for(d=g.data.rotation+e[e.length-1]-g.rotation;d>180;)d-=360;for(;-180>d;)d+=360;return void(g.rotation+=d*c)}var h=f.binarySearch(e,b,2),i=e[h-1],j=e[h],k=1-(b-j)/(e[h-2]-j);for(k=this.curves.getCurvePercent(h/2-1,k),d=e[h+1]-i;d>180;)d-=360;for(;-180>d;)d+=360;for(d=g.data.rotation+(i+d*k)-g.rotation;d>180;)d-=360;for(;-180>d;)d+=360;g.rotation+=d*c}}},f.TranslateTimeline=function(a){this.curves=new f.Curves(a),this.frames=[],this.frames.length=3*a},f.TranslateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var e=a.bones[this.boneIndex];if(b>=d[d.length-3])return e.x+=(e.data.x+d[d.length-2]-e.x)*c,void(e.y+=(e.data.y+d[d.length-1]-e.y)*c);var g=f.binarySearch(d,b,3),h=d[g-2],i=d[g-1],j=d[g],k=1-(b-j)/(d[g+-3]-j);k=this.curves.getCurvePercent(g/3-1,k),e.x+=(e.data.x+h+(d[g+1]-h)*k-e.x)*c,e.y+=(e.data.y+i+(d[g+2]-i)*k-e.y)*c}}},f.ScaleTimeline=function(a){this.curves=new f.Curves(a),this.frames=[],this.frames.length=3*a},f.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var e=a.bones[this.boneIndex];if(b>=d[d.length-3])return e.scaleX+=(e.data.scaleX-1+d[d.length-2]-e.scaleX)*c,void(e.scaleY+=(e.data.scaleY-1+d[d.length-1]-e.scaleY)*c);var g=f.binarySearch(d,b,3),h=d[g-2],i=d[g-1],j=d[g],k=1-(b-j)/(d[g+-3]-j);k=this.curves.getCurvePercent(g/3-1,k),e.scaleX+=(e.data.scaleX-1+h+(d[g+1]-h)*k-e.scaleX)*c,e.scaleY+=(e.data.scaleY-1+i+(d[g+2]-i)*k-e.scaleY)*c}}},f.ColorTimeline=function(a){this.curves=new f.Curves(a),this.frames=[],this.frames.length=5*a},f.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(a,b,c,d,e,f){a*=5,this.frames[a]=b,this.frames[a+1]=c,this.frames[a+2]=d,this.frames[a+3]=e,this.frames[a+4]=f},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){var e=a.slots[this.slotIndex];if(b>=d[d.length-5]){var g=d.length-1;return e.r=d[g-3],e.g=d[g-2],e.b=d[g-1],void(e.a=d[g])}var h=f.binarySearch(d,b,5),i=d[h-4],j=d[h-3],k=d[h-2],l=d[h-1],m=d[h],n=1-(b-m)/(d[h-5]-m);n=this.curves.getCurvePercent(h/5-1,n);var o=i+(d[h+1]-i)*n,p=j+(d[h+2]-j)*n,q=k+(d[h+3]-k)*n,r=l+(d[h+4]-l)*n;1>c?(e.r+=(o-e.r)*c,e.g+=(p-e.g)*c,e.b+=(q-e.b)*c,e.a+=(r-e.a)*c):(e.r=o,e.g=p,e.b=q,e.a=r)}}},f.AttachmentTimeline=function(a){this.curves=new f.Curves(a),this.frames=[],this.frames.length=a,this.attachmentNames=[],this.attachmentNames.length=a},f.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(a,b,c){this.frames[a]=b,this.attachmentNames[a]=c},apply:function(a,b){var c=this.frames;if(!(b<c[0])){var d;d=b>=c[c.length-1]?c.length-1:f.binarySearch(c,b,1)-1;var e=this.attachmentNames[d];a.slots[this.slotIndex].setAttachment(e?a.getAttachmentBySlotIndex(this.slotIndex,e):null)}}},f.SkeletonData=function(){this.bones=[],this.slots=[],this.skins=[],this.animations=[]},f.SkeletonData.prototype={defaultSkin:null,findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];
return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return slot[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSkin:function(a){for(var b=this.skins,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},findAnimation:function(a){for(var b=this.animations,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null}},f.Skeleton=function(a){this.data=a,this.bones=[];for(var b=0,c=a.bones.length;c>b;b++){var d=a.bones[b],e=d.parent?this.bones[a.bones.indexOf(d.parent)]:null;this.bones.push(new f.Bone(d,e))}for(this.slots=[],this.drawOrder=[],b=0,c=a.slots.length;c>b;b++){var g=a.slots[b],h=this.bones[a.bones.indexOf(g.boneData)],i=new f.Slot(g,this,h);this.slots.push(i),this.drawOrder.push(i)}},f.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var a=this.flipX,b=this.flipY,c=this.bones,d=0,e=c.length;e>d;d++)c[d].updateWorldTransform(a,b)},setToSetupPose:function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var a=this.bones,b=0,c=a.length;c>b;b++)a[b].setToSetupPose()},setSlotsToSetupPose:function(){for(var a=this.slots,b=0,c=a.length;c>b;b++)a[b].setToSetupPose(b)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return b[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},setSkinByName:function(a){var b=this.data.findSkin(a);if(!b)throw"Skin not found: "+a;this.setSkin(b)},setSkin:function(a){this.skin&&a&&a._attachAll(this,this.skin),this.skin=a},getAttachmentBySlotName:function(a,b){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(a),b)},getAttachmentBySlotIndex:function(a,b){if(this.skin){var c=this.skin.getAttachment(a,b);if(c)return c}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(a,b):null},setAttachment:function(a,b){for(var c=this.slots,d=0,e=c.size;e>d;d++){var f=c[d];if(f.data.name==a){var g=null;if(b&&(g=this.getAttachment(d,b),null==g))throw"Attachment not found: "+b+", for slot: "+a;return void f.setAttachment(g)}}throw"Slot not found: "+a},update:function(a){time+=a}},f.AttachmentType={region:0},f.RegionAttachment=function(){this.offset=[],this.offset.length=8,this.uvs=[],this.uvs.length=8},f.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(a,b,c,d,e){var f=this.uvs;e?(f[2]=a,f[3]=d,f[4]=a,f[5]=b,f[6]=c,f[7]=b,f[0]=c,f[1]=d):(f[0]=a,f[1]=d,f[2]=a,f[3]=b,f[4]=c,f[5]=b,f[6]=c,f[7]=d)},updateOffset:function(){var a=this.width/this.regionOriginalWidth*this.scaleX,b=this.height/this.regionOriginalHeight*this.scaleY,c=-this.width/2*this.scaleX+this.regionOffsetX*a,d=-this.height/2*this.scaleY+this.regionOffsetY*b,e=c+this.regionWidth*a,f=d+this.regionHeight*b,g=this.rotation*Math.PI/180,h=Math.cos(g),i=Math.sin(g),j=c*h+this.x,k=c*i,l=d*h+this.y,m=d*i,n=e*h+this.x,o=e*i,p=f*h+this.y,q=f*i,r=this.offset;r[0]=j-m,r[1]=l+k,r[2]=j-q,r[3]=p+k,r[4]=n-q,r[5]=p+o,r[6]=n-m,r[7]=l+o},computeVertices:function(a,b,c,d){a+=c.worldX,b+=c.worldY;var e=c.m00,f=c.m01,g=c.m10,h=c.m11,i=this.offset;d[0]=i[0]*e+i[1]*f+a,d[1]=i[0]*g+i[1]*h+b,d[2]=i[2]*e+i[3]*f+a,d[3]=i[2]*g+i[3]*h+b,d[4]=i[4]*e+i[5]*f+a,d[5]=i[4]*g+i[5]*h+b,d[6]=i[6]*e+i[7]*f+a,d[7]=i[6]*g+i[7]*h+b}},f.AnimationStateData=function(a){this.skeletonData=a,this.animationToMixTime={}},f.AnimationStateData.prototype={defaultMix:0,setMixByName:function(a,b,c){var d=this.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;var e=this.skeletonData.findAnimation(b);if(!e)throw"Animation not found: "+b;this.setMix(d,e,c)},setMix:function(a,b,c){this.animationToMixTime[a.name+":"+b.name]=c},getMix:function(a,b){var c=this.animationToMixTime[a.name+":"+b.name];return c?c:this.defaultMix}},f.AnimationState=function(a){this.data=a,this.queue=[]},f.AnimationState.prototype={animationSpeed:1,current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(a){if(this.currentTime+=a*this.animationSpeed,this.previousTime+=a,this.mixTime+=a,this.queue.length>0){var b=this.queue[0];this.currentTime>=b.delay&&(this._setAnimation(b.animation,b.loop),this.queue.shift())}},apply:function(a){if(this.current)if(this.previous){this.previous.apply(a,this.previousTime,this.previousLoop);var b=this.mixTime/this.mixDuration;b>=1&&(b=1,this.previous=null),this.current.mix(a,this.currentTime,this.currentLoop,b)}else this.current.apply(a,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null,this.current=null,this.queue.length=0},_setAnimation:function(a,b){this.previous=null,a&&this.current&&(this.mixDuration=this.data.getMix(this.current,a),this.mixDuration>0&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop)),this.current=a,this.currentLoop=b,this.currentTime=0},setAnimationByName:function(a,b){var c=this.data.skeletonData.findAnimation(a);if(!c)throw"Animation not found: "+a;this.setAnimation(c,b)},setAnimation:function(a,b){this.queue.length=0,this._setAnimation(a,b)},addAnimationByName:function(a,b,c){var d=this.data.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;this.addAnimation(d,b,c)},addAnimation:function(a,b,c){var d={};if(d.animation=a,d.loop=b,!c||0>=c){var e=this.queue.length?this.queue[this.queue.length-1].animation:this.current;c=null!=e?e.duration-this.data.getMix(e,a)+(c||0):0}d.delay=c,this.queue.push(d)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}},f.SkeletonJson=function(a){this.attachmentLoader=a},f.SkeletonJson.prototype={scale:1,readSkeletonData:function(a){for(var b,c=new f.SkeletonData,d=a.bones,e=0,g=d.length;g>e;e++){var h=d[e],i=null;if(h.parent&&(i=c.findBone(h.parent),!i))throw"Parent bone not found: "+h.parent;b=new f.BoneData(h.name,i),b.length=(h.length||0)*this.scale,b.x=(h.x||0)*this.scale,b.y=(h.y||0)*this.scale,b.rotation=h.rotation||0,b.scaleX=h.scaleX||1,b.scaleY=h.scaleY||1,c.bones.push(b)}var j=a.slots;for(e=0,g=j.length;g>e;e++){var k=j[e];if(b=c.findBone(k.bone),!b)throw"Slot bone not found: "+k.bone;var l=new f.SlotData(k.name,b),m=k.color;m&&(l.r=f.SkeletonJson.toColor(m,0),l.g=f.SkeletonJson.toColor(m,1),l.b=f.SkeletonJson.toColor(m,2),l.a=f.SkeletonJson.toColor(m,3)),l.attachmentName=k.attachment,c.slots.push(l)}var n=a.skins;for(var o in n)if(n.hasOwnProperty(o)){var p=n[o],q=new f.Skin(o);for(var r in p)if(p.hasOwnProperty(r)){var s=c.findSlotIndex(r),t=p[r];for(var u in t)if(t.hasOwnProperty(u)){var v=this.readAttachment(q,u,t[u]);null!=v&&q.addAttachment(s,u,v)}}c.skins.push(q),"default"==q.name&&(c.defaultSkin=q)}var w=a.animations;for(var x in w)w.hasOwnProperty(x)&&this.readAnimation(x,w[x],c);return c},readAttachment:function(a,b,c){b=c.name||b;var d=f.AttachmentType[c.type||"region"];if(d==f.AttachmentType.region){var e=new f.RegionAttachment;return e.x=(c.x||0)*this.scale,e.y=(c.y||0)*this.scale,e.scaleX=c.scaleX||1,e.scaleY=c.scaleY||1,e.rotation=c.rotation||0,e.width=(c.width||32)*this.scale,e.height=(c.height||32)*this.scale,e.updateOffset(),e.rendererObject={},e.rendererObject.name=b,e.rendererObject.scale={},e.rendererObject.scale.x=e.scaleX,e.rendererObject.scale.y=e.scaleY,e.rendererObject.rotation=-e.rotation*Math.PI/180,e}throw"Unknown attachment type: "+d},readAnimation:function(a,b,c){var d,e,g,h,i,j,k,l=[],m=0,n=b.bones;for(var o in n)if(n.hasOwnProperty(o)){var p=c.findBoneIndex(o);if(-1==p)throw"Bone not found: "+o;var q=n[o];for(g in q)if(q.hasOwnProperty(g))if(i=q[g],"rotate"==g){for(e=new f.RotateTimeline(i.length),e.boneIndex=p,d=0,j=0,k=i.length;k>j;j++)h=i[j],e.setFrame(d,h.time,h.angle),f.SkeletonJson.readCurve(e,d,h),d++;l.push(e),m=Math.max(m,e.frames[2*e.getFrameCount()-2])}else{if("translate"!=g&&"scale"!=g)throw"Invalid timeline type for a bone: "+g+" ("+o+")";var r=1;for("scale"==g?e=new f.ScaleTimeline(i.length):(e=new f.TranslateTimeline(i.length),r=this.scale),e.boneIndex=p,d=0,j=0,k=i.length;k>j;j++){h=i[j];var s=(h.x||0)*r,t=(h.y||0)*r;e.setFrame(d,h.time,s,t),f.SkeletonJson.readCurve(e,d,h),d++}l.push(e),m=Math.max(m,e.frames[3*e.getFrameCount()-3])}}var u=b.slots;for(var v in u)if(u.hasOwnProperty(v)){var w=u[v],x=c.findSlotIndex(v);for(g in w)if(w.hasOwnProperty(g))if(i=w[g],"color"==g){for(e=new f.ColorTimeline(i.length),e.slotIndex=x,d=0,j=0,k=i.length;k>j;j++){h=i[j];var y=h.color,z=f.SkeletonJson.toColor(y,0),A=f.SkeletonJson.toColor(y,1),B=f.SkeletonJson.toColor(y,2),C=f.SkeletonJson.toColor(y,3);e.setFrame(d,h.time,z,A,B,C),f.SkeletonJson.readCurve(e,d,h),d++}l.push(e),m=Math.max(m,e.frames[5*e.getFrameCount()-5])}else{if("attachment"!=g)throw"Invalid timeline type for a slot: "+g+" ("+v+")";for(e=new f.AttachmentTimeline(i.length),e.slotIndex=x,d=0,j=0,k=i.length;k>j;j++)h=i[j],e.setFrame(d++,h.time,h.name);l.push(e),m=Math.max(m,e.frames[e.getFrameCount()-1])}}c.animations.push(new f.Animation(a,l,m))}},f.SkeletonJson.readCurve=function(a,b,c){var d=c.curve;d&&("stepped"==d?a.curves.setStepped(b):d instanceof Array&&a.curves.setCurve(b,d[0],d[1],d[2],d[3]))},f.SkeletonJson.toColor=function(a,b){if(8!=a.length)throw"Color hexidecimal length must be 8, recieved: "+a;return parseInt(a.substr(2*b,2),16)/255},f.Atlas=function(a,b){this.textureLoader=b,this.pages=[],this.regions=[];var c=new f.AtlasReader(a),d=[];d.length=4;for(var e=null;;){var g=c.readLine();if(null==g)break;if(g=c.trim(g),g.length)if(e){var h=new f.AtlasRegion;h.name=g,h.page=e,h.rotate="true"==c.readValue(),c.readTuple(d);var i=parseInt(d[0],10),j=parseInt(d[1],10);c.readTuple(d);var k=parseInt(d[0],10),l=parseInt(d[1],10);h.u=i/e.width,h.v=j/e.height,h.rotate?(h.u2=(i+l)/e.width,h.v2=(j+k)/e.height):(h.u2=(i+k)/e.width,h.v2=(j+l)/e.height),h.x=i,h.y=j,h.width=Math.abs(k),h.height=Math.abs(l),4==c.readTuple(d)&&(h.splits=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],4==c.readTuple(d)&&(h.pads=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],c.readTuple(d))),h.originalWidth=parseInt(d[0],10),h.originalHeight=parseInt(d[1],10),c.readTuple(d),h.offsetX=parseInt(d[0],10),h.offsetY=parseInt(d[1],10),h.index=parseInt(c.readValue(),10),this.regions.push(h)}else{e=new f.AtlasPage,e.name=g,e.format=f.Atlas.Format[c.readValue()],c.readTuple(d),e.minFilter=f.Atlas.TextureFilter[d[0]],e.magFilter=f.Atlas.TextureFilter[d[1]];var m=c.readValue();e.uWrap=f.Atlas.TextureWrap.clampToEdge,e.vWrap=f.Atlas.TextureWrap.clampToEdge,"x"==m?e.uWrap=f.Atlas.TextureWrap.repeat:"y"==m?e.vWrap=f.Atlas.TextureWrap.repeat:"xy"==m&&(e.uWrap=e.vWrap=f.Atlas.TextureWrap.repeat),b.load(e,g),this.pages.push(e)}else e=null}},f.Atlas.prototype={findRegion:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},dispose:function(){for(var a=this.pages,b=0,c=a.length;c>b;b++)this.textureLoader.unload(a[b].rendererObject)},updateUVs:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++){var e=b[c];e.page==a&&(e.u=e.x/a.width,e.v=e.y/a.height,e.rotate?(e.u2=(e.x+e.height)/a.width,e.v2=(e.y+e.width)/a.height):(e.u2=(e.x+e.width)/a.width,e.v2=(e.y+e.height)/a.height))}}},f.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6},f.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6},f.Atlas.TextureWrap={mirroredRepeat:0,clampToEdge:1,repeat:2},f.AtlasPage=function(){},f.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0},f.AtlasRegion=function(){},f.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null},f.AtlasReader=function(a){this.lines=a.split(/\r\n|\r|\n/)},f.AtlasReader.prototype={index:0,trim:function(a){return a.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var a=this.readLine(),b=a.indexOf(":");if(-1==b)throw"Invalid line: "+a;return this.trim(a.substring(b+1))},readTuple:function(a){var b=this.readLine(),c=b.indexOf(":");if(-1==c)throw"Invalid line: "+b;for(var d=0,e=c+1;3>d;d++){var f=b.indexOf(",",e);if(-1==f){if(!d)throw"Invalid line: "+b;break}a[d]=this.trim(b.substr(e,f-e)),e=f+1}return a[d]=this.trim(b.substring(e)),d+1}},f.AtlasAttachmentLoader=function(a){this.atlas=a},f.AtlasAttachmentLoader.prototype={newAttachment:function(a,b,c){switch(b){case f.AttachmentType.region:var d=this.atlas.findRegion(c);if(!d)throw"Region not found in atlas: "+c+" ("+b+")";var e=new f.RegionAttachment(c);return e.rendererObject=d,e.setUVs(d.u,d.v,d.u2,d.v2,d.rotate),e.regionOffsetX=d.offsetX,e.regionOffsetY=d.offsetY,e.regionWidth=d.width,e.regionHeight=d.height,e.regionOriginalWidth=d.originalWidth,e.regionOriginalHeight=d.originalHeight,e}throw"Unknown attachment type: "+b}},f.Bone.yDown=!0,b.AnimCache={},b.Spine=function(a){if(b.DisplayObjectContainer.call(this),this.spineData=b.AnimCache[a],!this.spineData)throw new Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+a);this.skeleton=new f.Skeleton(this.spineData),this.skeleton.updateWorldTransform(),this.stateData=new f.AnimationStateData(this.spineData),this.state=new f.AnimationState(this.stateData),this.slotContainers=[];for(var c=0,d=this.skeleton.drawOrder.length;d>c;c++){var e=this.skeleton.drawOrder[c],g=e.attachment,h=new b.DisplayObjectContainer;if(this.slotContainers.push(h),this.addChild(h),g instanceof f.RegionAttachment){var i=g.rendererObject.name,j=this.createSprite(e,g.rendererObject);e.currentSprite=j,e.currentSpriteName=i,h.addChild(j)}}},b.Spine.prototype=Object.create(b.DisplayObjectContainer.prototype),b.Spine.prototype.constructor=b.Spine,b.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||Date.now();var a=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.state.update(a),this.state.apply(this.skeleton),this.skeleton.updateWorldTransform();for(var c=this.skeleton.drawOrder,d=0,e=c.length;e>d;d++){var g=c[d],h=g.attachment,i=this.slotContainers[d];if(h instanceof f.RegionAttachment){if(h.rendererObject&&(!g.currentSpriteName||g.currentSpriteName!=h.name)){var j=h.rendererObject.name;if(void 0!==g.currentSprite&&(g.currentSprite.visible=!1),g.sprites=g.sprites||{},void 0!==g.sprites[j])g.sprites[j].visible=!0;else{var k=this.createSprite(g,h.rendererObject);i.addChild(k)}g.currentSprite=g.sprites[j],g.currentSpriteName=j}i.visible=!0;var l=g.bone;i.position.x=l.worldX+h.x*l.m00+h.y*l.m01,i.position.y=l.worldY+h.x*l.m10+h.y*l.m11,i.scale.x=l.worldScaleX,i.scale.y=l.worldScaleY,i.rotation=-(g.bone.worldRotation*Math.PI/180),i.alpha=g.a,g.currentSprite.tint=b.rgb2hex([g.r,g.g,g.b])}else i.visible=!1}b.DisplayObjectContainer.prototype.updateTransform.call(this)},b.Spine.prototype.createSprite=function(a,c){var d=b.TextureCache[c.name]?c.name:c.name+".png",e=new b.Sprite(b.Texture.fromFrame(d));return e.scale=c.scale,e.rotation=c.rotation,e.anchor.x=e.anchor.y=.5,a.sprites=a.sprites||{},a.sprites[c.name]=e,e},b.BaseTextureCache={},b.texturesToUpdate=[],b.texturesToDestroy=[],b.BaseTextureCacheIdGenerator=0,b.BaseTexture=function(a,c){if(b.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=c||b.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,this.id=b.BaseTextureCacheIdGenerator++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[],a){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,b.texturesToUpdate.push(this);else{var d=this;this.source.onload=function(){d.hasLoaded=!0,d.width=d.source.width,d.height=d.source.height;for(var a=0;a<d._glTextures.length;a++)d._dirty[a]=!0;d.dispatchEvent({type:"loaded",content:d})},this.source.onerror=function(){d.dispatchEvent({type:"error",content:d})}}this.imageUrl=null,this._powerOf2=!1}},b.BaseTexture.prototype.constructor=b.BaseTexture,b.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete b.BaseTextureCache[this.imageUrl],delete b.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null):this.source&&this.source._pixiId&&delete b.BaseTextureCache[this.source._pixiId],this.source=null,b.texturesToDestroy.push(this)},b.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1,this.source.src=null,this.source.src=a},b.BaseTexture.fromImage=function(a,c,d){var e=b.BaseTextureCache[a];if(void 0===c&&-1===a.indexOf("data:")&&(c=!0),!e){var f=new Image;c&&(f.crossOrigin=""),f.src=a,e=new b.BaseTexture(f,d),e.imageUrl=a,b.BaseTextureCache[a]=e}return e},b.BaseTexture.fromCanvas=function(a,c){a._pixiId||(a._pixiId="canvas_"+b.TextureCacheIdGenerator++);var d=b.BaseTextureCache[a._pixiId];return d||(d=new b.BaseTexture(a,c),b.BaseTextureCache[a._pixiId]=d),d},b.TextureCache={},b.FrameCache={},b.TextureCacheIdGenerator=0,b.Texture=function(a,c){if(b.EventTarget.call(this),this.noFrame=!1,c||(this.noFrame=!0,c=new b.Rectangle(0,0,1,1)),a instanceof b.Texture&&(a=a.baseTexture),this.baseTexture=a,this.frame=c,this.trim=null,this.valid=!1,this.scope=this,this._uvs=null,this.width=0,this.height=0,this.crop=new b.Rectangle(0,0,1,1),a.hasLoaded)this.noFrame&&(c=new b.Rectangle(0,0,a.width,a.height)),this.setFrame(c);else{var d=this;a.addEventListener("loaded",function(){d.onBaseTextureLoaded()})}},b.Texture.prototype.constructor=b.Texture,b.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;a.removeEventListener("loaded",this.onLoaded),this.noFrame&&(this.frame=new b.Rectangle(0,0,a.width,a.height)),this.setFrame(this.frame),this.scope.dispatchEvent({type:"update",content:this})},b.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy(),this.valid=!1},b.Texture.prototype.setFrame=function(a){if(this.noFrame=!1,this.frame=a,this.width=a.width,this.height=a.height,this.crop.x=a.x,this.crop.y=a.y,this.crop.width=a.width,this.crop.height=a.height,!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded,this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height),this.valid&&b.Texture.frameUpdates.push(this)},b.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new b.TextureUvs);var a=this.crop,c=this.baseTexture.width,d=this.baseTexture.height;this._uvs.x0=a.x/c,this._uvs.y0=a.y/d,this._uvs.x1=(a.x+a.width)/c,this._uvs.y1=a.y/d,this._uvs.x2=(a.x+a.width)/c,this._uvs.y2=(a.y+a.height)/d,this._uvs.x3=a.x/c,this._uvs.y3=(a.y+a.height)/d},b.Texture.fromImage=function(a,c,d){var e=b.TextureCache[a];return e||(e=new b.Texture(b.BaseTexture.fromImage(a,c,d)),b.TextureCache[a]=e),e},b.Texture.fromFrame=function(a){var c=b.TextureCache[a];if(!c)throw new Error('The frameId "'+a+'" does not exist in the texture cache ');return c},b.Texture.fromCanvas=function(a,c){var d=b.BaseTexture.fromCanvas(a,c);return new b.Texture(d)},b.Texture.addTextureToCache=function(a,c){b.TextureCache[c]=a},b.Texture.removeTextureFromCache=function(a){var c=b.TextureCache[a];return delete b.TextureCache[a],delete b.BaseTextureCache[a],c},b.Texture.frameUpdates=[],b.TextureUvs=function(){this.x0=0,this.y0=0,this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.x3=0,this.y3=0},b.RenderTexture=function(a,c,d,e){if(b.EventTarget.call(this),this.width=a||100,this.height=c||100,this.frame=new b.Rectangle(0,0,this.width,this.height),this.crop=new b.Rectangle(0,0,this.width,this.height),this.baseTexture=new b.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.scaleMode=e||b.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,this.renderer=d||b.defaultRenderer,this.renderer.type===b.WEBGL_RENDERER){var f=this.renderer.gl;this.textureBuffer=new b.FilterTexture(f,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[f.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new b.Point(this.width/2,-this.height/2)}else this.render=this.renderCanvas,this.textureBuffer=new b.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,b.Texture.frameUpdates.push(this)},b.RenderTexture.prototype=Object.create(b.Texture.prototype),b.RenderTexture.prototype.constructor=b.RenderTexture,b.RenderTexture.prototype.resize=function(a,c,d){(a!==this.width||c!==this.height)&&(this.width=this.frame.width=this.crop.width=a,this.height=this.frame.height=this.crop.height=c,d&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===b.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.textureBuffer.resize(this.width,this.height))},b.RenderTexture.prototype.clear=function(){this.renderer.type===b.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear()},b.RenderTexture.prototype.renderWebGL=function(a,c,d){var e=this.renderer.gl;e.colorMask(!0,!0,!0,!0),e.viewport(0,0,this.width,this.height),e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),d&&this.textureBuffer.clear();var f=a.children,g=a.worldTransform;a.worldTransform=b.RenderTexture.tempMatrix,a.worldTransform.d=-1,a.worldTransform.ty=-2*this.projection.y,c&&(a.worldTransform.tx=c.x,a.worldTransform.ty-=c.y);for(var h=0,i=f.length;i>h;h++)f[h].updateTransform();b.WebGLRenderer.updateTextures(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),a.worldTransform=g,this.renderer.spriteBatch.dirty=!0},b.RenderTexture.prototype.renderCanvas=function(a,c,d){var e=a.children,f=a.worldTransform;a.worldTransform=b.RenderTexture.tempMatrix,c?(a.worldTransform.tx=c.x,a.worldTransform.ty=c.y):(a.worldTransform.tx=0,a.worldTransform.ty=0);for(var g=0,h=e.length;h>g;g++)e[g].updateTransform();d&&this.textureBuffer.clear();var i=this.textureBuffer.context;this.renderer.renderDisplayObject(a,i),i.setTransform(1,0,0,1,0,0),a.worldTransform=f},b.RenderTexture.tempMatrix=new b.Matrix,b.AssetLoader=function(a,c){b.EventTarget.call(this),this.assetURLs=a,this.crossorigin=c,this.loadersByType={jpg:b.ImageLoader,jpeg:b.ImageLoader,png:b.ImageLoader,gif:b.ImageLoader,webp:b.ImageLoader,json:b.JsonLoader,atlas:b.AtlasLoader,anim:b.SpineLoader,xml:b.BitmapFontLoader,fnt:b.BitmapFontLoader}},b.AssetLoader.prototype.constructor=b.AssetLoader,b.AssetLoader.prototype._getDataType=function(a){var b="data:",c=a.slice(0,b.length).toLowerCase();if(c===b){var d=a.slice(b.length),e=d.indexOf(",");if(-1===e)return null;var f=d.slice(0,e).split(";")[0];return f&&"text/plain"!==f.toLowerCase()?f.split("/").pop().toLowerCase():"txt"}return null},b.AssetLoader.prototype.load=function(){function a(a){b.onAssetLoaded(a.content)}var b=this;this.loadCount=this.assetURLs.length;for(var c=0;c<this.assetURLs.length;c++){var d=this.assetURLs[c],e=this._getDataType(d);e||(e=d.split("?").shift().split(".").pop().toLowerCase());var f=this.loadersByType[e];if(!f)throw new Error(e+" is an unsupported file type");var g=new f(d,this.crossorigin);g.addEventListener("loaded",a),g.load()}},b.AssetLoader.prototype.onAssetLoaded=function(a){this.loadCount--,this.dispatchEvent({type:"onProgress",content:this,loader:a}),this.onProgress&&this.onProgress(a),this.loadCount||(this.dispatchEvent({type:"onComplete",content:this}),this.onComplete&&this.onComplete())},b.JsonLoader=function(a,c){b.EventTarget.call(this),this.url=a,this.crossorigin=c,this.baseUrl=a.replace(/[^\/]*$/,""),this.loaded=!1},b.JsonLoader.prototype.constructor=b.JsonLoader,b.JsonLoader.prototype.load=function(){var a=this;window.XDomainRequest&&a.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3e3,this.ajaxRequest.onerror=function(){a.onError()},this.ajaxRequest.ontimeout=function(){a.onError()},this.ajaxRequest.onprogress=function(){}):this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP"),this.ajaxRequest.onload=function(){a.onJSONLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.send()},b.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return void this.onError();if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var a=this,c=this.baseUrl+this.json.meta.image,d=new b.ImageLoader(c,this.crossorigin),e=this.json.frames;this.texture=d.texture.baseTexture,d.addEventListener("loaded",function(){a.onLoaded()});for(var g in e){var h=e[g].frame;if(h&&(b.TextureCache[g]=new b.Texture(this.texture,{x:h.x,y:h.y,width:h.w,height:h.h}),b.TextureCache[g].crop=new b.Rectangle(h.x,h.y,h.w,h.h),e[g].trimmed)){var i=e[g].sourceSize,j=e[g].spriteSourceSize;b.TextureCache[g].trim=new b.Rectangle(j.x,j.y,i.w,i.h)}}d.load()}else if(this.json.bones){var k=new f.SkeletonJson,l=k.readSkeletonData(this.json);b.AnimCache[this.url]=l,this.onLoaded()}else this.onLoaded()},b.JsonLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},b.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},b.AtlasLoader=function(a,c){b.EventTarget.call(this),this.url=a,this.baseUrl=a.replace(/[^\/]*$/,""),this.crossorigin=c,this.loaded=!1},b.AtlasLoader.constructor=b.AtlasLoader,b.AtlasLoader.prototype.load=function(){this.ajaxRequest=new b.AjaxRequest,this.ajaxRequest.onreadystatechange=this.onAtlasLoaded.bind(this),this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},b.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};var a=this.ajaxRequest.responseText.split(/\r?\n/),c=-3,d=0,e=null,f=!1,g=0,h=0,i=this.onLoaded.bind(this);for(g=0;g<a.length;g++)if(a[g]=a[g].replace(/^\s+|\s+$/g,""),""===a[g]&&(f=g+1),a[g].length>0){if(f===g)this.atlas.meta.image.push(a[g]),d=this.atlas.meta.image.length-1,this.atlas.frames.push({}),c=-3;else if(c>0)if(c%7===1)null!=e&&(this.atlas.frames[d][e.name]=e),e={name:a[g],frame:{}};else{var j=a[g].split(" ");if(c%7===3)e.frame.x=Number(j[1].replace(",","")),e.frame.y=Number(j[2]);else if(c%7===4)e.frame.w=Number(j[1].replace(",","")),e.frame.h=Number(j[2]);else if(c%7===5){var k={x:0,y:0,w:Number(j[1].replace(",","")),h:Number(j[2])};k.w>e.frame.w||k.h>e.frame.h?(e.trimmed=!0,e.realSize=k):e.trimmed=!1}}c++}if(null!=e&&(this.atlas.frames[d][e.name]=e),this.atlas.meta.image.length>0){for(this.images=[],h=0;h<this.atlas.meta.image.length;h++){var l=this.baseUrl+this.atlas.meta.image[h],m=this.atlas.frames[h];this.images.push(new b.ImageLoader(l,this.crossorigin));for(g in m){var n=m[g].frame;n&&(b.TextureCache[g]=new b.Texture(this.images[h].texture.baseTexture,{x:n.x,y:n.y,width:n.w,height:n.h}),m[g].trimmed&&(b.TextureCache[g].realSize=m[g].realSize,b.TextureCache[g].trim.x=0,b.TextureCache[g].trim.y=0))}}for(this.currentImageId=0,h=0;h<this.images.length;h++)this.images[h].addEventListener("loaded",i);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()},b.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.dispatchEvent({type:"loaded",content:this}))},b.AtlasLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})},b.SpriteSheetLoader=function(a,c){b.EventTarget.call(this),this.url=a,this.crossorigin=c,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null,this.frames={}},b.SpriteSheetLoader.prototype.constructor=b.SpriteSheetLoader,b.SpriteSheetLoader.prototype.load=function(){var a=this,c=new b.JsonLoader(this.url,this.crossorigin);c.addEventListener("loaded",function(b){a.json=b.content.json,a.onLoaded()}),c.load()},b.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},b.ImageLoader=function(a,c){b.EventTarget.call(this),this.texture=b.Texture.fromImage(a,c),this.frames=[]},b.ImageLoader.prototype.constructor=b.ImageLoader,b.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var a=this;this.texture.baseTexture.addEventListener("loaded",function(){a.onLoaded()})}},b.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},b.ImageLoader.prototype.loadFramedSpriteSheet=function(a,c,d){this.frames=[];for(var e=Math.floor(this.texture.width/a),f=Math.floor(this.texture.height/c),g=0,h=0;f>h;h++)for(var i=0;e>i;i++,g++){var j=new b.Texture(this.texture,{x:i*a,y:h*c,width:a,height:c});this.frames.push(j),d&&(b.TextureCache[d+"-"+g]=j)}if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var k=this;this.texture.baseTexture.addEventListener("loaded",function(){k.onLoaded()})}},b.BitmapFontLoader=function(a,c){b.EventTarget.call(this),this.url=a,this.crossorigin=c,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null},b.BitmapFontLoader.prototype.constructor=b.BitmapFontLoader,b.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new b.AjaxRequest;var a=this;this.ajaxRequest.onreadystatechange=function(){a.onXMLLoaded()},this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},b.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var a=this.ajaxRequest.responseXML;if(!a||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var c=new DOMParser;a=c.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var d=document.createElement("div");d.innerHTML=this.ajaxRequest.responseText,a=d}var e=this.baseUrl+a.getElementsByTagName("page")[0].getAttribute("file"),f=new b.ImageLoader(e,this.crossorigin);this.texture=f.texture.baseTexture;var g={},h=a.getElementsByTagName("info")[0],i=a.getElementsByTagName("common")[0];g.font=h.getAttribute("face"),g.size=parseInt(h.getAttribute("size"),10),g.lineHeight=parseInt(i.getAttribute("lineHeight"),10),g.chars={};for(var j=a.getElementsByTagName("char"),k=0;k<j.length;k++){var l=parseInt(j[k].getAttribute("id"),10),m=new b.Rectangle(parseInt(j[k].getAttribute("x"),10),parseInt(j[k].getAttribute("y"),10),parseInt(j[k].getAttribute("width"),10),parseInt(j[k].getAttribute("height"),10));g.chars[l]={xOffset:parseInt(j[k].getAttribute("xoffset"),10),yOffset:parseInt(j[k].getAttribute("yoffset"),10),xAdvance:parseInt(j[k].getAttribute("xadvance"),10),kerning:{},texture:b.TextureCache[l]=new b.Texture(this.texture,m)}
}var n=a.getElementsByTagName("kerning");for(k=0;k<n.length;k++){var o=parseInt(n[k].getAttribute("first"),10),p=parseInt(n[k].getAttribute("second"),10),q=parseInt(n[k].getAttribute("amount"),10);g.chars[p].kerning[o]=q}b.BitmapText.fonts[g.font]=g;var r=this;f.addEventListener("loaded",function(){r.onLoaded()}),f.load()}},b.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})},b.SpineLoader=function(a,c){b.EventTarget.call(this),this.url=a,this.crossorigin=c,this.loaded=!1},b.SpineLoader.prototype.constructor=b.SpineLoader,b.SpineLoader.prototype.load=function(){var a=this,c=new b.JsonLoader(this.url,this.crossorigin);c.addEventListener("loaded",function(b){a.json=b.content.json,a.onLoaded()}),c.load()},b.SpineLoader.prototype.onLoaded=function(){this.loaded=!0,this.dispatchEvent({type:"loaded",content:this})},b.AbstractFilter=function(a,b){this.passes=[this],this.shaders=[],this.dirty=!0,this.padding=0,this.uniforms=b||{},this.fragmentSrc=a||[]},b.AlphaMaskFilter=function(a){b.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={mask:{type:"sampler2D",value:a},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mask.value.x=a.width,this.uniforms.mask.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]},b.AlphaMaskFilter.prototype=Object.create(b.AbstractFilter.prototype),b.AlphaMaskFilter.prototype.constructor=b.AlphaMaskFilter,b.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height,this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(b.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(a){this.uniforms.mask.value=a}}),b.ColorMatrixFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]},b.ColorMatrixFilter.prototype=Object.create(b.AbstractFilter.prototype),b.ColorMatrixFilter.prototype.constructor=b.ColorMatrixFilter,Object.defineProperty(b.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(a){this.uniforms.matrix.value=a}}),b.GrayFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={gray:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]},b.GrayFilter.prototype=Object.create(b.AbstractFilter.prototype),b.GrayFilter.prototype.constructor=b.GrayFilter,Object.defineProperty(b.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(a){this.uniforms.gray.value=a}}),b.DisplacementFilter=function(a){b.AbstractFilter.call(this),this.passes=[this],a.baseTexture._powerOf2=!0,this.uniforms={displacementMap:{type:"sampler2D",value:a},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}},a.baseTexture.hasLoaded?(this.uniforms.mapDimensions.value.x=a.width,this.uniforms.mapDimensions.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction)),this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]},b.DisplacementFilter.prototype=Object.create(b.AbstractFilter.prototype),b.DisplacementFilter.prototype.constructor=b.DisplacementFilter,b.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width,this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height,this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)},Object.defineProperty(b.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},set:function(a){this.uniforms.displacementMap.value=a}}),Object.defineProperty(b.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}}),Object.defineProperty(b.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}}),b.PixelateFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",value:new Float32Array([1e4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);","}"]},b.PixelateFilter.prototype=Object.create(b.AbstractFilter.prototype),b.PixelateFilter.prototype.constructor=b.PixelateFilter,Object.defineProperty(b.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.dirty=!0,this.uniforms.pixelSize.value=a}}),b.BlurXFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]},b.BlurXFilter.prototype=Object.create(b.AbstractFilter.prototype),b.BlurXFilter.prototype.constructor=b.BlurXFilter,Object.defineProperty(b.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.dirty=!0,this.uniforms.blur.value=1/7e3*a}}),b.BlurYFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]},b.BlurYFilter.prototype=Object.create(b.AbstractFilter.prototype),b.BlurYFilter.prototype.constructor=b.BlurYFilter,Object.defineProperty(b.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),b.BlurFilter=function(){this.blurXFilter=new b.BlurXFilter,this.blurYFilter=new b.BlurYFilter,this.passes=[this.blurXFilter,this.blurYFilter]},Object.defineProperty(b.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a}}),Object.defineProperty(b.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=a}}),Object.defineProperty(b.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(a){this.blurYFilter.blur=a}}),b.InvertFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={invert:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]},b.InvertFilter.prototype=Object.create(b.AbstractFilter.prototype),b.InvertFilter.prototype.constructor=b.InvertFilter,Object.defineProperty(b.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(a){this.uniforms.invert.value=a}}),b.SepiaFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={sepia:{type:"1f",value:1}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;","const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]},b.SepiaFilter.prototype=Object.create(b.AbstractFilter.prototype),b.SepiaFilter.prototype.constructor=b.SepiaFilter,Object.defineProperty(b.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(a){this.uniforms.sepia.value=a}}),b.TwistFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:.5,y:.5}}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);","   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]},b.TwistFilter.prototype=Object.create(b.AbstractFilter.prototype),b.TwistFilter.prototype.constructor=b.TwistFilter,Object.defineProperty(b.TwistFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.dirty=!0,this.uniforms.offset.value=a}}),Object.defineProperty(b.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(a){this.dirty=!0,this.uniforms.radius.value=a}}),Object.defineProperty(b.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),b.ColorStepFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={step:{type:"1f",value:5}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]},b.ColorStepFilter.prototype=Object.create(b.AbstractFilter.prototype),b.ColorStepFilter.prototype.constructor=b.ColorStepFilter,Object.defineProperty(b.ColorStepFilter.prototype,"step",{get:function(){return this.uniforms.step.value},set:function(a){this.uniforms.step.value=a}}),b.DotScreenFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {","   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]},b.DotScreenFilter.prototype=Object.create(b.AbstractFilter.prototype),b.DotScreenFilter.prototype.constructor=b.DotScreenFilter,Object.defineProperty(b.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.dirty=!0,this.uniforms.scale.value=a}}),Object.defineProperty(b.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0,this.uniforms.angle.value=a}}),b.CrossHatchFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={blur:{type:"1f",value:1/512}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]},b.CrossHatchFilter.prototype=Object.create(b.AbstractFilter.prototype),b.CrossHatchFilter.prototype.constructor=b.BlurYFilter,Object.defineProperty(b.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),b.RGBSplitFilter=function(){b.AbstractFilter.call(this),this.passes=[this],this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}},this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]},b.RGBSplitFilter.prototype=Object.create(b.AbstractFilter.prototype),b.RGBSplitFilter.prototype.constructor=b.RGBSplitFilter,Object.defineProperty(b.RGBSplitFilter.prototype,"angle",{get:function(){return this.uniforms.blur.value/(1/7e3)},set:function(a){this.uniforms.blur.value=1/7e3*a}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.PIXI=b):"undefined"!=typeof define&&define.amd?define(b):a.PIXI=b}).call(this);var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},dragonBones;!function(a){!function(a){var b=function(){function a(a,b){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),this.x=a,this.y=b}return a.prototype.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},a}();a.Point=b;var c=function(){function a(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.x=a,this.y=b,this.width=c,this.height=d}return a}();a.Rectangle=c;var d=function(){function a(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}return a.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f},a}();a.Matrix=d;var e=function(){function a(){this.alphaMultiplier=0,this.alphaOffset=0,this.blueMultiplier=0,this.blueOffset=0,this.greenMultiplier=0,this.greenOffset=0,this.redMultiplier=0,this.redOffset=0}return a}();a.ColorTransform=e}(a.geom||(a.geom={}));var b=a.geom;!function(a){var b=function(){function a(a){this.type=a}return a}();a.Event=b;var c=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.FADE_IN="fadeIn",b.FADE_OUT="fadeOut",b.START="start",b.COMPLETE="complete",b.LOOP_COMPLETE="loopComplete",b.FADE_IN_COMPLETE="fadeInComplete",b.FADE_OUT_COMPLETE="fadeOutComplete",b}(b);a.AnimationEvent=c;var d=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.Z_ORDER_UPDATED="zOrderUpdated",b}(b);a.ArmatureEvent=d;var e=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.ANIMATION_FRAME_EVENT="animationFrameEvent",b.BONE_FRAME_EVENT="boneFrameEvent",b}(b);a.FrameEvent=e;var f=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.SOUND="sound",b.BONE_FRAME_EVENT="boneFrameEvent",b}(b);a.SoundEvent=f;var g=function(){function a(){}return a.prototype.hasEventListener=function(a){return this._listenersMap&&this._listenersMap[a]?!0:!1},a.prototype.addEventListener=function(a,b){if(a&&b){this._listenersMap||(this._listenersMap={});var c=this._listenersMap[a];c&&this.removeEventListener(a,b),c?c.push(b):this._listenersMap[a]=[b]}},a.prototype.removeEventListener=function(a,b){if(this._listenersMap&&a&&b){var c=this._listenersMap[a];if(c)for(var d=c.length,e=0;d>e;e++)c[e]==b&&(1==d?(c.length=0,delete this._listenersMap[a]):c.splice(e,1))}},a.prototype.removeAllEventListeners=function(a){a?delete this._listenersMap[a]:this._listenersMap=null},a.prototype.dispatchEvent=function(a){if(a){var b=this._listenersMap[a.type];if(b){a.target=this;for(var c=b.concat(),d=b.length,e=0;d>e;e++)c[e](a)}}},a}();a.EventDispatcher=g;var h=function(a){function b(){if(a.call(this),b._instance)throw new Error("Singleton already constructed!")}return __extends(b,a),b.getInstance=function(){return b._instance||(b._instance=new b),b._instance},b}(g);a.SoundEventManager=h}(a.events||(a.events={}));var c=a.events;!function(a){var d=function(){function a(){this.timeScale=1,this.time=.001*(new Date).getTime(),this._animatableList=[]}return a.prototype.contains=function(a){return this._animatableList.indexOf(a)>=0},a.prototype.add=function(a){a&&-1==this._animatableList.indexOf(a)&&this._animatableList.push(a)},a.prototype.remove=function(a){var b=this._animatableList.indexOf(a);b>=0&&(this._animatableList[b]=null)},a.prototype.clear=function(){this._animatableList.length=0},a.prototype.advanceTime=function(a){if(0>a){var b=.001*(new Date).getTime();a=b-this.time,this.time=b}a*=this.timeScale;var c=this._animatableList.length;if(0!=c){for(var d=0,e=0;c>e;e++){var f=this._animatableList[e];f&&(d!=e&&(this._animatableList[d]=f,this._animatableList[e]=null),f.advanceTime(a),d++)}if(d!=e){for(c=this._animatableList.length;c>e;)this._animatableList[d++]=this._animatableList[e++];this._animatableList.length=d}}},a.clock=new a,a}();a.WorldClock=d;var g=function(){function a(){this.transform=new e.DBTransform,this.pivot=new b.Point,this._durationTransform=new e.DBTransform,this._durationPivot=new b.Point,this._durationColor=new b.ColorTransform}return a._borrowObject=function(){return 0==a._pool.length?new a:a._pool.pop()},a._returnObject=function(b){a._pool.indexOf(b)<0&&(a._pool[a._pool.length]=b),b.clear()},a._clear=function(){for(var b=a._pool.length;b--;)a._pool[b].clear();a._pool.length=0},a.getEaseValue=function(b,c){if(c>1){var d=.5*(1-Math.cos(b*Math.PI))-b;c-=1}else c>0?d=Math.sin(b*a.HALF_PI)-b:0>c&&(d=1-Math.cos(b*a.HALF_PI)-b,c*=-1);return d*c+b},a.prototype.fadeIn=function(a,b,c){switch(this._bone=a,this._animationState=b,this._timeline=c,this._originTransform=this._timeline.originTransform,this._originPivot=this._timeline.originPivot,this._tweenTransform=!1,this._tweenColor=!1,this._totalTime=this._animationState.totalTime,this.transform.x=0,this.transform.y=0,this.transform.scaleX=0,this.transform.scaleY=0,this.transform.skewX=0,this.transform.skewY=0,this.pivot.x=0,this.pivot.y=0,this._durationTransform.x=0,this._durationTransform.y=0,this._durationTransform.scaleX=0,this._durationTransform.scaleY=0,this._durationTransform.skewX=0,this._durationTransform.skewY=0,this._durationPivot.x=0,this._durationPivot.y=0,this._currentFrame=null,this._timeline.getFrameList().length){case 0:this._bone._arriveAtFrame(null,this,this._animationState,!1),this._updateState=0;break;case 1:this._updateState=-1;break;default:this._updateState=1}},a.prototype.fadeOut=function(){this.transform.skewX=f.TransformUtil.formatRadian(this.transform.skewX),this.transform.skewY=f.TransformUtil.formatRadian(this.transform.skewY)},a.prototype.update=function(b){if(this._updateState)if(this._updateState>0){0==this._timeline.scale?b=1:b/=this._timeline.scale,1==b&&(b=.99999999),b+=this._timeline.offset;var c=Math.floor(b);b-=c;for(var d,e=this._totalTime*b,g=!1;!this._currentFrame||e>this._currentFramePosition+this._currentFrameDuration||e<this._currentFramePosition;)g&&this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!0),g=!0,this._currentFrame?(d=this._timeline.getFrameList().indexOf(this._currentFrame)+1,d>=this._timeline.getFrameList().length&&(d=0),this._currentFrame=this._timeline.getFrameList()[d]):(d=0,this._currentFrame=this._timeline.getFrameList()[0]),this._currentFrameDuration=this._currentFrame.duration,this._currentFramePosition=this._currentFrame.position;if(g){this.tweenActive=this._currentFrame.displayIndex>=0,d++,d>=this._timeline.getFrameList().length&&(d=0);var h=this._timeline.getFrameList()[d];0==d&&this._animationState.loop&&this._animationState.loopCount>=Math.abs(this._animationState.loop)-1&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+c-this._timeline.offset)*this._timeline.scale>.99999999?(this._updateState=0,this._tweenEasing=0/0):this._tweenEasing=this._currentFrame.displayIndex<0||h.displayIndex<0||!this._animationState.tweenEnabled?0/0:isNaN(this._animationState.clip.tweenEasing)?this._currentFrame.tweenEasing:this._animationState.clip.tweenEasing,isNaN(this._tweenEasing)?(this._tweenTransform=!1,this._tweenColor=!1):(this._durationTransform.x=h.transform.x-this._currentFrame.transform.x,this._durationTransform.y=h.transform.y-this._currentFrame.transform.y,this._durationTransform.skewX=h.transform.skewX-this._currentFrame.transform.skewX,this._durationTransform.skewY=h.transform.skewY-this._currentFrame.transform.skewY,this._durationTransform.scaleX=h.transform.scaleX-this._currentFrame.transform.scaleX,this._durationTransform.scaleY=h.transform.scaleY-this._currentFrame.transform.scaleY,0==d&&(this._durationTransform.skewX=f.TransformUtil.formatRadian(this._durationTransform.skewX),this._durationTransform.skewY=f.TransformUtil.formatRadian(this._durationTransform.skewY)),this._durationPivot.x=h.pivot.x-this._currentFrame.pivot.x,this._durationPivot.y=h.pivot.y-this._currentFrame.pivot.y,this._tweenTransform=0!=this._durationTransform.x||0!=this._durationTransform.y||0!=this._durationTransform.skewX||0!=this._durationTransform.skewY||0!=this._durationTransform.scaleX||0!=this._durationTransform.scaleY||0!=this._durationPivot.x||0!=this._durationPivot.y?!0:!1,this._currentFrame.color&&h.color?(this._durationColor.alphaOffset=h.color.alphaOffset-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=h.color.redOffset-this._currentFrame.color.redOffset,this._durationColor.greenOffset=h.color.greenOffset-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=h.color.blueOffset-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=h.color.alphaMultiplier-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=h.color.redMultiplier-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=h.color.greenMultiplier-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=h.color.blueMultiplier-this._currentFrame.color.blueMultiplier,this._tweenColor=0!=this._durationColor.alphaOffset||0!=this._durationColor.redOffset||0!=this._durationColor.greenOffset||0!=this._durationColor.blueOffset||0!=this._durationColor.alphaMultiplier||0!=this._durationColor.redMultiplier||0!=this._durationColor.greenMultiplier||0!=this._durationColor.blueMultiplier?!0:!1):this._currentFrame.color?(this._tweenColor=!0,this._durationColor.alphaOffset=-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=-this._currentFrame.color.redOffset,this._durationColor.greenOffset=-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=1-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=1-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=1-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=1-this._currentFrame.color.blueMultiplier):h.color?(this._tweenColor=!0,this._durationColor.alphaOffset=h.color.alphaOffset,this._durationColor.redOffset=h.color.redOffset,this._durationColor.greenOffset=h.color.greenOffset,this._durationColor.blueOffset=h.color.blueOffset,this._durationColor.alphaMultiplier=h.color.alphaMultiplier-1,this._durationColor.redMultiplier=h.color.redMultiplier-1,this._durationColor.greenMultiplier=h.color.greenMultiplier-1,this._durationColor.blueMultiplier=h.color.blueMultiplier-1):this._tweenColor=!1),this._tweenTransform||(this._animationState.blend?(this.transform.x=this._originTransform.x+this._currentFrame.transform.x,this.transform.y=this._originTransform.y+this._currentFrame.transform.y,this.transform.skewX=this._originTransform.skewX+this._currentFrame.transform.skewX,this.transform.skewY=this._originTransform.skewY+this._currentFrame.transform.skewY,this.transform.scaleX=this._originTransform.scaleX+this._currentFrame.transform.scaleX,this.transform.scaleY=this._originTransform.scaleY+this._currentFrame.transform.scaleY,this.pivot.x=this._originPivot.x+this._currentFrame.pivot.x,this.pivot.y=this._originPivot.y+this._currentFrame.pivot.y):(this.transform.x=this._currentFrame.transform.x,this.transform.y=this._currentFrame.transform.y,this.transform.skewX=this._currentFrame.transform.skewX,this.transform.skewY=this._currentFrame.transform.skewY,this.transform.scaleX=this._currentFrame.transform.scaleX,this.transform.scaleY=this._currentFrame.transform.scaleY,this.pivot.x=this._currentFrame.pivot.x,this.pivot.y=this._currentFrame.pivot.y)),this._tweenColor||(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._isColorChanged&&this._bone._updateColor(0,0,0,0,1,1,1,1,!1)),this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1)}if((this._tweenTransform||this._tweenColor)&&(b=(e-this._currentFramePosition)/this._currentFrameDuration,this._tweenEasing&&(b=a.getEaseValue(b,this._tweenEasing))),this._tweenTransform){var i=this._currentFrame.transform,j=this._currentFrame.pivot;this._animationState.blend?(this.transform.x=this._originTransform.x+i.x+this._durationTransform.x*b,this.transform.y=this._originTransform.y+i.y+this._durationTransform.y*b,this.transform.skewX=this._originTransform.skewX+i.skewX+this._durationTransform.skewX*b,this.transform.skewY=this._originTransform.skewY+i.skewY+this._durationTransform.skewY*b,this.transform.scaleX=this._originTransform.scaleX+i.scaleX+this._durationTransform.scaleX*b,this.transform.scaleY=this._originTransform.scaleY+i.scaleY+this._durationTransform.scaleY*b,this.pivot.x=this._originPivot.x+j.x+this._durationPivot.x*b,this.pivot.y=this._originPivot.y+j.y+this._durationPivot.y*b):(this.transform.x=i.x+this._durationTransform.x*b,this.transform.y=i.y+this._durationTransform.y*b,this.transform.skewX=i.skewX+this._durationTransform.skewX*b,this.transform.skewY=i.skewY+this._durationTransform.skewY*b,this.transform.scaleX=i.scaleX+this._durationTransform.scaleX*b,this.transform.scaleY=i.scaleY+this._durationTransform.scaleY*b,this.pivot.x=j.x+this._durationPivot.x*b,this.pivot.y=j.y+this._durationPivot.y*b)}this._tweenColor&&(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset+this._durationColor.alphaOffset*b,this._currentFrame.color.redOffset+this._durationColor.redOffset*b,this._currentFrame.color.greenOffset+this._durationColor.greenOffset*b,this._currentFrame.color.blueOffset+this._durationColor.blueOffset*b,this._currentFrame.color.alphaMultiplier+this._durationColor.alphaMultiplier*b,this._currentFrame.color.redMultiplier+this._durationColor.redMultiplier*b,this._currentFrame.color.greenMultiplier+this._durationColor.greenMultiplier*b,this._currentFrame.color.blueMultiplier+this._durationColor.blueMultiplier*b,!0):this._bone._updateColor(this._durationColor.alphaOffset*b,this._durationColor.redOffset*b,this._durationColor.greenOffset*b,this._durationColor.blueOffset*b,1+this._durationColor.alphaMultiplier*b,1+this._durationColor.redMultiplier*b,1+this._durationColor.greenMultiplier*b,1+this._durationColor.blueMultiplier*b,!0))
}else this._updateState=0,this._animationState.blend?(this.transform.copy(this._originTransform),this.pivot.x=this._originPivot.x,this.pivot.y=this._originPivot.y):(this.transform.x=this.transform.y=this.transform.skewX=this.transform.skewY=this.transform.scaleX=this.transform.scaleY=0,this.pivot.x=0,this.pivot.y=0),this._currentFrame=this._timeline.getFrameList()[0],this.tweenActive=this._currentFrame.displayIndex>=0,this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._updateColor(0,0,0,0,1,1,1,1,!1),this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1)},a.prototype.clear=function(){this._updateState=0,this._bone=null,this._animationState=null,this._timeline=null,this._currentFrame=null,this._originTransform=null,this._originPivot=null},a.HALF_PI=.5*Math.PI,a._pool=[],a}();a.TimelineState=g;var h=function(){function a(){this.loop=0,this.layer=0,this._timelineStates={}}return a._borrowObject=function(){return 0==a._pool.length?new a:a._pool.pop()},a._returnObject=function(b){a._pool.indexOf(b)<0&&(a._pool[a._pool.length]=b),b.clear()},a._clear=function(){for(var b=a._pool.length;b--;)a._pool[b].clear();a._pool.length=0},a.prototype.fadeIn=function(a,b,c,d,e,f,g,h){this.layer=f,this.clip=b,this.name=this.clip.name,this.totalTime=this.clip.duration,this._armature=a,Math.round(this.clip.duration*this.clip.frameRate)<2||1/0==d?(this.timeScale=1,this.currentTime=this.totalTime,this.loop=this.loop>=0?1:-1):(this.timeScale=d,this.currentTime=0,this.loop=e),this._pauseBeforeFadeInComplete=h,this._fadeInTime=c*this.timeScale,this._fadeState=1,this._fadeOutBeginTime=0,this._fadeOutWeight=-1,this._fadeWeight=0,this._fadeIn=!0,this._fadeOut=!1,this.loopCount=-1,this.displayControl=g,this.isPlaying=!0,this.isComplete=!1,this.weight=1,this.blend=!0,this.enabled=!0,this.tweenEnabled=!0,this.updateTimelineStates()},a.prototype.fadeOut=function(a,b){if("undefined"==typeof b&&(b=!1),this._armature&&!(this._fadeOutWeight>=0)){this._fadeState=-1,this._fadeOutWeight=this._fadeWeight,this._fadeOutTime=a*this.timeScale,this._fadeOutBeginTime=this.currentTime,this._fadeOut=!0,this.isPlaying=!b,this.displayControl=!1;for(var c in this._timelineStates)this._timelineStates[c].fadeOut();this.enabled=!0}},a.prototype.play=function(){this.isPlaying=!0},a.prototype.stop=function(){this.isPlaying=!1},a.prototype.getMixingTransform=function(a){return this._mixingTransforms?Number(this._mixingTransforms[a]):-1},a.prototype.addMixingTransform=function(a,b,c){if("undefined"==typeof b&&(b=2),"undefined"==typeof c&&(c=!0),!this.clip||!this.clip.getTimeline(a))throw new Error;if(this._mixingTransforms||(this._mixingTransforms={}),c)for(var d,e,f=this._armature._boneList.length;f--;)d=this._armature._boneList[f],d.name==a&&(e=d),e&&(e==d||e.contains(d))&&(this._mixingTransforms[d.name]=b);else this._mixingTransforms[a]=b;this.updateTimelineStates()},a.prototype.removeMixingTransform=function(a,b){if("undefined"==typeof a&&(a=null),"undefined"==typeof b&&(b=!0),a){if(b)for(var c,d,e=this._armature._boneList.length;e--;)c=this._armature._boneList[e],c.name==a&&(d=c),d&&(d==c||d.contains(c))&&delete this._mixingTransforms[c.name];else delete this._mixingTransforms[a];for(var f in this._mixingTransforms){var g=!0;break}g||(this._mixingTransforms=null)}else this._mixingTransforms=null;this.updateTimelineStates()},a.prototype.advanceTime=function(a){if(!this.enabled)return!1;var b,d;if(this._fadeIn&&(this._fadeIn=!1,this._armature.hasEventListener(c.AnimationEvent.FADE_IN)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_IN),b.animationState=this,this._armature._eventList.push(b))),this._fadeOut&&(this._fadeOut=!1,this._armature.hasEventListener(c.AnimationEvent.FADE_OUT)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_OUT),b.animationState=this,this._armature._eventList.push(b))),this.currentTime+=a*this.timeScale,this.isPlaying&&!this.isComplete){var e,f;this._pauseBeforeFadeInComplete?(this._pauseBeforeFadeInComplete=!1,this.isPlaying=!1,e=0,f=Math.floor(e)):(e=this.currentTime/this.totalTime,f=Math.floor(e),f!=this.loopCount&&(-1==this.loopCount&&this._armature.hasEventListener(c.AnimationEvent.START)&&(b=new c.AnimationEvent(c.AnimationEvent.START),b.animationState=this,this._armature._eventList.push(b)),this.loopCount=f,this.loopCount&&(this.loop&&this.loopCount*this.loopCount>=this.loop*this.loop-1?(d=!0,e=1,f=0,this._armature.hasEventListener(c.AnimationEvent.COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.COMPLETE),b.animationState=this,this._armature._eventList.push(b))):this._armature.hasEventListener(c.AnimationEvent.LOOP_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.LOOP_COMPLETE),b.animationState=this,this._armature._eventList.push(b)))));for(var g in this._timelineStates)this._timelineStates[g].update(e);var h=this.clip.getFrameList();if(h.length>0){for(var i,j=this.totalTime*(e-f),k=!1;!this._currentFrame||j>this._currentFrame.position+this._currentFrame.duration||j<this._currentFrame.position;)k&&this._armature._arriveAtFrame(this._currentFrame,null,this,!0),k=!0,this._currentFrame?(i=h.indexOf(this._currentFrame),i++,i>=h.length&&(i=0),this._currentFrame=h[i]):this._currentFrame=h[0];k&&this._armature._arriveAtFrame(this._currentFrame,null,this,!1)}}if(this._fadeState>0)0==this._fadeInTime?(this._fadeWeight=1,this._fadeState=0,this.isPlaying=!0,this._armature.hasEventListener(c.AnimationEvent.FADE_IN_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_IN_COMPLETE),b.animationState=this,this._armature._eventList.push(b))):(this._fadeWeight=this.currentTime/this._fadeInTime,this._fadeWeight>=1&&(this._fadeWeight=1,this._fadeState=0,this.isPlaying||(this.currentTime-=this._fadeInTime),this.isPlaying=!0,this._armature.hasEventListener(c.AnimationEvent.FADE_IN_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_IN_COMPLETE),b.animationState=this,this._armature._eventList.push(b))));else if(this._fadeState<0){if(0==this._fadeOutTime)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(c.AnimationEvent.FADE_OUT_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_OUT_COMPLETE),b.animationState=this,this._armature._eventList.push(b)),!0;if(this._fadeWeight=(1-(this.currentTime-this._fadeOutBeginTime)/this._fadeOutTime)*this._fadeOutWeight,this._fadeWeight<=0)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(c.AnimationEvent.FADE_OUT_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_OUT_COMPLETE),b.animationState=this,this._armature._eventList.push(b)),!0}return d&&(this.isComplete=!0,this.loop<0&&this.fadeOut((this._fadeOutWeight||this._fadeInTime)/this.timeScale,!0)),!1},a.prototype.updateTimelineStates=function(){if(this._mixingTransforms){for(var a in this._timelineStates)null==this._mixingTransforms[a]&&this.removeTimelineState(a);for(a in this._mixingTransforms)this._timelineStates[a]||this.addTimelineState(a)}else for(a in this.clip.getTimelines())this._timelineStates[a]||this.addTimelineState(a)},a.prototype.addTimelineState=function(a){var b=this._armature.getBone(a);if(b){var c=g._borrowObject(),d=this.clip.getTimeline(a);c.fadeIn(b,this,d),this._timelineStates[a]=c}},a.prototype.removeTimelineState=function(a){g._returnObject(this._timelineStates[a]),delete this._timelineStates[a]},a.prototype.clear=function(){this.clip=null,this.enabled=!1,this._armature=null,this._currentFrame=null,this._mixingTransforms=null;for(var a in this._timelineStates)this.removeTimelineState(a)},a._pool=[],a}();a.AnimationState=h;var i=function(){function a(a){this._armature=a,this._animationLayer=[],this._isPlaying=!1,this.animationNameList=[],this.tweenEnabled=!0,this.timeScale=1}return a.prototype.getLastAnimationName=function(){return this._lastAnimationState?this._lastAnimationState.name:null},a.prototype.getLastAnimationState=function(){return this._lastAnimationState},a.prototype.getAnimationDataList=function(){return this._animationDataList},a.prototype.setAnimationDataList=function(a){this._animationDataList=a,this.animationNameList.length=0;for(var b in this._animationDataList)this.animationNameList[this.animationNameList.length]=this._animationDataList[b].name},a.prototype.getIsPlaying=function(){return this._isPlaying&&!this.getIsComplete()},a.prototype.getIsComplete=function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete)return!1;for(var a=this._animationLayer.length;a--;)for(var b=this._animationLayer[a],c=b.length;c--;)if(!b[c].isComplete)return!1;return!0}return!1},a.prototype.dispose=function(){if(this._armature){this.stop();for(var a=this._animationLayer.length;a--;){for(var b=this._animationLayer[a],c=b.length;c--;)h._returnObject(b[c]);b.length=0}this._animationLayer.length=0,this.animationNameList.length=0,this._armature=null,this._animationLayer=null,this._animationDataList=null,this.animationNameList=null}},a.prototype.gotoAndPlay=function(b,c,d,e,f,g,i,j,k,l){if("undefined"==typeof c&&(c=-1),"undefined"==typeof d&&(d=-1),"undefined"==typeof e&&(e=0/0),"undefined"==typeof f&&(f=0),"undefined"==typeof g&&(g=null),"undefined"==typeof i&&(i=a.SAME_LAYER_AND_GROUP),"undefined"==typeof j&&(j=!0),"undefined"==typeof k&&(k=!0),"undefined"==typeof l&&(l=!0),!this._animationDataList)return null;for(var m,n=this._animationDataList.length;n--;)if(this._animationDataList[n].name==b){m=this._animationDataList[n];break}if(!m)return null;this._isPlaying=!0,c=0>c?m.fadeInTime<0?.3:m.fadeInTime:c;var o;o=0>d?m.scale<0?1:m.scale:d/m.duration,e=isNaN(e)?m.loop:e,f=this.addLayer(f);var p,q;switch(i){case a.NONE:break;case a.SAME_LAYER:for(q=this._animationLayer[f],n=q.length;n--;)p=q[n],p.fadeOut(c,k);break;case a.SAME_GROUP:for(r=this._animationLayer.length;r--;)for(q=this._animationLayer[r],n=q.length;n--;)p=q[n],p.group==g&&p.fadeOut(c,k);break;case a.ALL:for(var r=this._animationLayer.length;r--;)for(q=this._animationLayer[r],n=q.length;n--;)p=q[n],p.fadeOut(c,k);break;case a.SAME_LAYER_AND_GROUP:default:for(q=this._animationLayer[f],n=q.length;n--;)p=q[n],p.group==g&&p.fadeOut(c,k)}this._lastAnimationState=h._borrowObject(),this._lastAnimationState.group=g,this._lastAnimationState.tweenEnabled=this.tweenEnabled,this._lastAnimationState.fadeIn(this._armature,m,c,1/o,e,f,j,l),this.addState(this._lastAnimationState);var s,t,u=this._armature._slotList;for(n=u.length;n--;)s=u[n],t=s.getChildArmature(),t&&t.animation.gotoAndPlay(b,c);return this._lastAnimationState},a.prototype.play=function(){this._animationDataList&&0!=this._animationDataList.length&&(this._lastAnimationState?this._isPlaying?this.gotoAndPlay(this._lastAnimationState.name):this._isPlaying=!0:this.gotoAndPlay(this._animationDataList[0].name))},a.prototype.stop=function(){this._isPlaying=!1},a.prototype.getState=function(a,b){"undefined"==typeof b&&(b=0);var c=this._animationLayer.length;if(0==c)return null;b>=c&&(b=c-1);var d=this._animationLayer[b];if(!d)return null;for(var e=d.length;e--;)if(d[e].name==a)return d[e];return null},a.prototype.hasAnimation=function(a){for(var b=this._animationDataList.length;b--;)if(this._animationDataList[b].name==a)return!0;return!1},a.prototype.advanceTime=function(a){if(this._isPlaying){a*=this.timeScale;var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this._armature._boneList.length,x=w;for(w--;x--;){for(e=this._armature._boneList[x],f=e.name,g=1,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,b=this._animationLayer.length;b--;){for(p=0,q=this._animationLayer[b],d=q.length,c=0;d>c;c++)r=q[c],x==w&&r.advanceTime(a)?(this.removeState(r),c--,d--):(s=r._timelineStates[f],s&&s.tweenActive&&(t=r._fadeWeight*r.weight*g,u=s.transform,v=s.pivot,h+=u.x*t,i+=u.y*t,j+=u.skewX*t,k+=u.skewY*t,l+=u.scaleX*t,m+=u.scaleY*t,n+=v.x*t,o+=v.y*t,p+=t));if(p>=g)break;g-=p}u=e.tween,v=e._tweenPivot,u.x=h,u.y=i,u.skewX=j,u.skewY=k,u.scaleX=l,u.scaleY=m,v.x=n,v.y=o}}},a.prototype.addLayer=function(a){return a>=this._animationLayer.length&&(a=this._animationLayer.length,this._animationLayer[a]=[]),a},a.prototype.addState=function(a){var b=this._animationLayer[a.layer];b.push(a)},a.prototype.removeState=function(a){var b=a.layer,c=this._animationLayer[b];c.splice(c.indexOf(a),1),h._returnObject(a),0==c.length&&b==this._animationLayer.length-1&&this._animationLayer.length--},a.NONE="none",a.SAME_LAYER="sameLayer",a.SAME_GROUP="sameGroup",a.SAME_LAYER_AND_GROUP="sameLayerAndGroup",a.ALL="all",a}();a.Animation=i}(a.animation||(a.animation={}));var d=a.animation;!function(a){var c=function(){function a(){this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.scaleX=1,this.scaleY=1}return a.prototype.getRotation=function(){return this.skewX},a.prototype.setRotation=function(a){this.skewX=this.skewY=a},a.prototype.copy=function(a){this.x=a.x,this.y=a.y,this.skewX=a.skewX,this.skewY=a.skewY,this.scaleX=a.scaleX,this.scaleY=a.scaleY},a.prototype.toString=function(){return"[DBTransform (x="+this.x+" y="+this.y+" skewX="+this.skewX+" skewY="+this.skewY+" scaleX="+this.scaleX+" scaleY="+this.scaleY+")]"},a}();a.DBTransform=c;var d=function(){function a(){this.position=0,this.duration=0}return a.prototype.dispose=function(){},a}();a.Frame=d;var e=function(a){function d(){a.call(this),this.tweenEasing=0,this.tweenRotate=0,this.displayIndex=0,this.zOrder=0/0,this.visible=!0,this.global=new c,this.transform=new c,this.pivot=new b.Point}return __extends(d,a),d.prototype.dispose=function(){a.prototype.dispose.call(this),this.global=null,this.transform=null,this.pivot=null,this.color=null},d}(d);a.TransformFrame=e;var g=function(){function a(){this._frameList=[],this.duration=0,this.scale=1}return a.prototype.getFrameList=function(){return this._frameList},a.prototype.dispose=function(){for(var a=this._frameList.length;a--;)this._frameList[a].dispose();this._frameList.length=0,this._frameList=null},a.prototype.addFrame=function(a){if(!a)throw new Error;if(!(this._frameList.indexOf(a)<0))throw new Error;this._frameList[this._frameList.length]=a},a}();a.Timeline=g;var h=function(a){function d(){a.call(this),this.originTransform=new c,this.originPivot=new b.Point,this.offset=0,this.transformed=!1}return __extends(d,a),d.prototype.dispose=function(){this!=d.HIDE_TIMELINE&&(a.prototype.dispose.call(this),this.originTransform=null,this.originPivot=null)},d.HIDE_TIMELINE=new d,d}(g);a.TransformTimeline=h;var i=function(a){function b(){a.call(this),this.frameRate=0,this.loop=0,this.tweenEasing=0/0,this.fadeInTime=0,this._timelines={}}return __extends(b,a),b.prototype.getTimelines=function(){return this._timelines},b.prototype.dispose=function(){a.prototype.dispose.call(this);for(var b in this._timelines)this._timelines[b].dispose();this._timelines=null},b.prototype.getTimeline=function(a){return this._timelines[a]},b.prototype.addTimeline=function(a,b){if(!a)throw new Error;this._timelines[b]=a},b}(g);a.AnimationData=i;var j=function(){function a(){this.transform=new c}return a.prototype.dispose=function(){this.transform=null,this.pivot=null},a.ARMATURE="armature",a.IMAGE="image",a}();a.DisplayData=j;var k=function(){function a(){this._displayDataList=[],this.zOrder=0}return a.prototype.getDisplayDataList=function(){return this._displayDataList},a.prototype.dispose=function(){for(var a=this._displayDataList.length;a--;)this._displayDataList[a].dispose();this._displayDataList.length=0,this._displayDataList=null},a.prototype.addDisplayData=function(a){if(!a)throw new Error;if(!(this._displayDataList.indexOf(a)<0))throw new Error;this._displayDataList[this._displayDataList.length]=a},a.prototype.getDisplayData=function(a){for(var b=this._displayDataList.length;b--;)if(this._displayDataList[b].name==a)return this._displayDataList[b];return null},a}();a.SlotData=k;var l=function(){function a(){this.length=0,this.global=new c,this.transform=new c}return a.prototype.dispose=function(){this.global=null,this.transform=null},a}();a.BoneData=l;var m=function(){function a(){this._slotDataList=[]}return a.prototype.getSlotDataList=function(){return this._slotDataList},a.prototype.dispose=function(){for(var a=this._slotDataList.length;a--;)this._slotDataList[a].dispose();this._slotDataList.length=0,this._slotDataList=null},a.prototype.getSlotData=function(a){for(var b=this._slotDataList.length;b--;)if(this._slotDataList[b].name==a)return this._slotDataList[b];return null},a.prototype.addSlotData=function(a){if(!a)throw new Error;if(!(this._slotDataList.indexOf(a)<0))throw new Error;this._slotDataList[this._slotDataList.length]=a},a}();a.SkinData=m;var n=function(){function a(){this._boneDataList=[],this._skinDataList=[],this._animationDataList=[]}return a.prototype.getBoneDataList=function(){return this._boneDataList},a.prototype.getSkinDataList=function(){return this._skinDataList},a.prototype.getAnimationDataList=function(){return this._animationDataList},a.prototype.dispose=function(){for(var a=this._boneDataList.length;a--;)this._boneDataList[a].dispose();for(a=this._skinDataList.length;a--;)this._skinDataList[a].dispose();for(a=this._animationDataList.length;a--;)this._animationDataList[a].dispose();this._boneDataList.length=0,this._skinDataList.length=0,this._animationDataList.length=0,this._boneDataList=null,this._skinDataList=null,this._animationDataList=null},a.prototype.getBoneData=function(a){for(var b=this._boneDataList.length;b--;)if(this._boneDataList[b].name==a)return this._boneDataList[b];return null},a.prototype.getSkinData=function(a){if(!a)return this._skinDataList[0];for(var b=this._skinDataList.length;b--;)if(this._skinDataList[b].name==a)return this._skinDataList[b];return null},a.prototype.getAnimationData=function(a){for(var b=this._animationDataList.length;b--;)if(this._animationDataList[b].name==a)return this._animationDataList[b];return null},a.prototype.addBoneData=function(a){if(!a)throw new Error;if(!(this._boneDataList.indexOf(a)<0))throw new Error;this._boneDataList[this._boneDataList.length]=a},a.prototype.addSkinData=function(a){if(!a)throw new Error;if(!(this._skinDataList.indexOf(a)<0))throw new Error;this._skinDataList[this._skinDataList.length]=a},a.prototype.addAnimationData=function(a){if(!a)throw new Error;this._animationDataList.indexOf(a)<0&&(this._animationDataList[this._animationDataList.length]=a)},a.prototype.sortBoneDataList=function(){var a=this._boneDataList.length;if(0!=a){for(var b=[];a--;){for(var c=this._boneDataList[a],d=0,e=c;e&&e.parent;)d++,e=this.getBoneData(e.parent);b[a]={level:d,boneData:c}}for(b.sort(this.sortBoneData),a=b.length;a--;)this._boneDataList[a]=b[a].boneData}},a.prototype.sortBoneData=function(a,b){return a.level>b.level?1:-1},a}();a.ArmatureData=n;var o=function(){function a(){this._armatureDataList=[],this._subTexturePivots={}}return a.prototype.getArmatureNames=function(){var a=[];for(var b in this._armatureDataList)a[a.length]=this._armatureDataList[b].name;return a},a.prototype.getArmatureDataList=function(){return this._armatureDataList},a.prototype.dispose=function(){for(var a in this._armatureDataList)this._armatureDataList[a].dispose();this._armatureDataList.length=0,this._armatureDataList=null,this._subTexturePivots=null},a.prototype.getArmatureData=function(a){for(var b=this._armatureDataList.length;b--;)if(this._armatureDataList[b].name==a)return this._armatureDataList[b];return null},a.prototype.addArmatureData=function(a){if(!a)throw new Error;if(!(this._armatureDataList.indexOf(a)<0))throw new Error;this._armatureDataList[this._armatureDataList.length]=a},a.prototype.removeArmatureData=function(a){var b=this._armatureDataList.indexOf(a);b>=0&&this._armatureDataList.splice(b,1)},a.prototype.removeArmatureDataByName=function(a){for(var b=this._armatureDataList.length;b--;)this._armatureDataList[b].name==a&&this._armatureDataList.splice(b,1)},a.prototype.getSubTexturePivot=function(a){return this._subTexturePivots[a]},a.prototype.addSubTexturePivot=function(a,c,d){var e=this._subTexturePivots[d];return e?(e.x=a,e.y=c):this._subTexturePivots[d]=e=new b.Point(a,c),e},a.prototype.removeSubTexturePivot=function(a){if(a)delete this._subTexturePivots[a];else for(a in this._subTexturePivots)delete this._subTexturePivots[a]},a}();a.SkeletonData=o;var p=function(){function a(){}return a.parseTextureAtlasData=function(a,c){if("undefined"==typeof c&&(c=1),!a)throw new Error;var d={};d.__name=a[f.ConstValues.A_NAME];var e=a[f.ConstValues.SUB_TEXTURE];for(var g in e){var h=e[g],i=h[f.ConstValues.A_NAME],j=new b.Rectangle(Number(h[f.ConstValues.A_X])/c,Number(h[f.ConstValues.A_Y])/c,Number(h[f.ConstValues.A_WIDTH])/c,Number(h[f.ConstValues.A_HEIGHT])/c);d[i]=j}return d},a.parseSkeletonData=function(b){if(!b)throw new Error;var c=Number(b[f.ConstValues.A_FRAME_RATE]),d=new o;d.name=b[f.ConstValues.A_NAME];var e=b[f.ConstValues.ARMATURE];for(var g in e){var h=e[g];d.addArmatureData(a.parseArmatureData(h,d,c))}return d},a.parseArmatureData=function(b,c,d){var e=new n;e.name=b[f.ConstValues.A_NAME];var g=b[f.ConstValues.BONE];for(var h in g){var i=g[h];e.addBoneData(a.parseBoneData(i))}var j=b[f.ConstValues.SKIN];for(var h in j){var k=j[h];e.addSkinData(a.parseSkinData(k,c))}f.DBDataUtil.transformArmatureData(e),e.sortBoneDataList();var l=b[f.ConstValues.ANIMATION];for(var h in l){var m=l[h];e.addAnimationData(a.parseAnimationData(m,e,d))}return e},a.parseBoneData=function(b){var c=new l;return c.name=b[f.ConstValues.A_NAME],c.parent=b[f.ConstValues.A_PARENT],c.length=Number(b[f.ConstValues.A_LENGTH])||0,a.parseTransform(b[f.ConstValues.TRANSFORM],c.global),c.transform.copy(c.global),c},a.parseSkinData=function(b,c){var d=new m;d.name=b[f.ConstValues.A_NAME];var e=b[f.ConstValues.SLOT];for(var g in e){var h=e[g];d.addSlotData(a.parseSlotData(h,c))}return d},a.parseSlotData=function(b,c){var d=new k;d.name=b[f.ConstValues.A_NAME],d.parent=b[f.ConstValues.A_PARENT],d.zOrder=Number(b[f.ConstValues.A_Z_ORDER]);var e=b[f.ConstValues.DISPLAY];for(var g in e){var h=e[g];d.addDisplayData(a.parseDisplayData(h,c))}return d},a.parseDisplayData=function(b,c){var d=new j;return d.name=b[f.ConstValues.A_NAME],d.type=b[f.ConstValues.A_TYPE],d.pivot=c.addSubTexturePivot(0,0,d.name),a.parseTransform(b[f.ConstValues.TRANSFORM],d.transform,d.pivot),d},a.parseAnimationData=function(b,c,d){var e=new i;if(e.name=b[f.ConstValues.A_NAME],e.frameRate=d,e.loop=Number(b[f.ConstValues.A_LOOP])||0,e.fadeInTime=Number(b[f.ConstValues.A_FADE_IN_TIME]),e.duration=Number(b[f.ConstValues.A_DURATION])/d,e.scale=Number(b[f.ConstValues.A_SCALE]),b.hasOwnProperty(f.ConstValues.A_TWEEN_EASING)){var g=b[f.ConstValues.A_TWEEN_EASING];e.tweenEasing=void 0==g||null==g?0/0:Number(g)}else e.tweenEasing=0/0;a.parseTimeline(b,e,a.parseMainFrame,d);var h,j,k=b[f.ConstValues.TIMELINE];for(var l in k){var m=k[l];h=a.parseTransformTimeline(m,e.duration,d),j=m[f.ConstValues.A_NAME],e.addTimeline(h,j)}return f.DBDataUtil.addHideTimeline(e,c),f.DBDataUtil.transformAnimationData(e,c),e},a.parseTimeline=function(a,b,c,d){var e,g=0,h=a[f.ConstValues.FRAME];for(var i in h){var j=h[i];e=c(j,d),e.position=g,b.addFrame(e),g+=e.duration}e&&(e.duration=b.duration-e.position)},a.parseTransformTimeline=function(b,c,d){var e=new h;return e.duration=c,a.parseTimeline(b,e,a.parseTransformFrame,d),e.scale=Number(b[f.ConstValues.A_SCALE]),e.offset=Number(b[f.ConstValues.A_OFFSET]),e},a.parseFrame=function(a,b,c){b.duration=Number(a[f.ConstValues.A_DURATION])/c,b.action=a[f.ConstValues.A_ACTION],b.event=a[f.ConstValues.A_EVENT],b.sound=a[f.ConstValues.A_SOUND]},a.parseMainFrame=function(b,c){var e=new d;return a.parseFrame(b,e,c),e},a.parseTransformFrame=function(c,d){var g=new e;if(a.parseFrame(c,g,d),g.visible=1!=Number(c[f.ConstValues.A_HIDE]),c.hasOwnProperty(f.ConstValues.A_TWEEN_EASING)){var h=c[f.ConstValues.A_TWEEN_EASING];g.tweenEasing=void 0==h||null==h?0/0:Number(h)}else g.tweenEasing=0;g.tweenRotate=Number(c[f.ConstValues.A_TWEEN_ROTATE])||0,g.displayIndex=Number(c[f.ConstValues.A_DISPLAY_INDEX])||0,g.zOrder=Number(c[f.ConstValues.A_Z_ORDER])||0,a.parseTransform(c[f.ConstValues.TRANSFORM],g.global,g.pivot),g.transform.copy(g.global);var i=c[f.ConstValues.COLOR_TRANSFORM];return i&&(g.color=new b.ColorTransform,g.color.alphaOffset=Number(i[f.ConstValues.A_ALPHA_OFFSET]),g.color.redOffset=Number(i[f.ConstValues.A_RED_OFFSET]),g.color.greenOffset=Number(i[f.ConstValues.A_GREEN_OFFSET]),g.color.blueOffset=Number(i[f.ConstValues.A_BLUE_OFFSET]),g.color.alphaMultiplier=.01*Number(i[f.ConstValues.A_ALPHA_MULTIPLIER]),g.color.redMultiplier=.01*Number(i[f.ConstValues.A_RED_MULTIPLIER]),g.color.greenMultiplier=.01*Number(i[f.ConstValues.A_GREEN_MULTIPLIER]),g.color.blueMultiplier=.01*Number(i[f.ConstValues.A_BLUE_MULTIPLIER])),g},a.parseTransform=function(a,b,c){"undefined"==typeof c&&(c=null),a&&(b&&(b.x=Number(a[f.ConstValues.A_X]),b.y=Number(a[f.ConstValues.A_Y]),b.skewX=Number(a[f.ConstValues.A_SKEW_X])*f.ConstValues.ANGLE_TO_RADIAN,b.skewY=Number(a[f.ConstValues.A_SKEW_Y])*f.ConstValues.ANGLE_TO_RADIAN,b.scaleX=Number(a[f.ConstValues.A_SCALE_X]),b.scaleY=Number(a[f.ConstValues.A_SCALE_Y])),c&&(c.x=Number(a[f.ConstValues.A_PIVOT_X]),c.y=Number(a[f.ConstValues.A_PIVOT_Y])))},a}();a.DataParser=p}(a.objects||(a.objects={}));var e=a.objects;!function(b){var d=function(b){function c(){b.call(this),this._dataDic={},this._textureAtlasDic={},this._textureAtlasLoadingDic={}}return __extends(c,b),c.prototype.getSkeletonData=function(a){return this._dataDic[a]},c.prototype.addSkeletonData=function(a,b){if(!a)throw new Error;if(b=b||a.name,!b)throw new Error("Unnamed data!");this._dataDic[b],this._dataDic[b]=a},c.prototype.removeSkeletonData=function(a){delete this._dataDic[a]},c.prototype.getTextureAtlas=function(a){return this._textureAtlasDic[a]},c.prototype.addTextureAtlas=function(a,b){if(!a)throw new Error;if(b=b||a.name,!b)throw new Error("Unnamed data!");this._textureAtlasDic[b],this._textureAtlasDic[b]=a},c.prototype.removeTextureAtlas=function(a){delete this._textureAtlasDic[a]},c.prototype.dispose=function(a){if("undefined"==typeof a&&(a=!0),a){for(var b in this._dataDic)this._dataDic[b].dispose();for(var b in this._textureAtlasDic)this._textureAtlasDic[b].dispose()}this._dataDic=null,this._textureAtlasDic=null,this._textureAtlasLoadingDic=null,this._currentDataName=null,this._currentTextureAtlasName=null},c.prototype.buildArmature=function(b,c,d,f,g){if(d){var h=this._dataDic[d];if(h)var i=h.getArmatureData(b)}else for(d in this._dataDic)if(h=this._dataDic[d],i=h.getArmatureData(b))break;if(!i)return null;this._currentDataName=d,this._currentTextureAtlasName=f||d;var j=this._generateArmature();j.name=b;var k,l,m=i.getBoneDataList();for(var n in m)l=m[n],k=new a.Bone,k.name=l.name,k.origin.copy(l.transform),i.getBoneData(l.parent)?j.addChild(k,l.parent):j.addChild(k,null);if(c&&c!=b){var o=h.getArmatureData(c);if(!o)for(d in this._dataDic)if(h=this._dataDic[d],o=h.getArmatureData(c))break}j.animation.setAnimationDataList(o?o.getAnimationDataList():i.getAnimationDataList());var p=i.getSkinData(g);if(!p)throw new Error;var q,r,s,t,u,v,w=[],x=p.getSlotDataList();for(var n in x)if(u=x[n],k=j.getBone(u.parent)){for(v=u.getDisplayDataList(),q=this._generateSlot(),q.name=u.name,q._originZOrder=u.zOrder,q._dislayDataList=v,w.length=0,t=v.length;t--;)switch(r=v[t],r.type){case e.DisplayData.ARMATURE:s=this.buildArmature(r.name,null,this._currentDataName,this._currentTextureAtlasName,null),s&&(w[t]=s);break;case e.DisplayData.IMAGE:default:w[t]=this._generateDisplay(this._textureAtlasDic[this._currentTextureAtlasName],r.name,r.pivot.x,r.pivot.y)}q.setDisplayList(w),q._changeDisplay(0),k.addChild(q)}return j._slotsZOrderChanged=!0,j.advanceTime(0),j},c.prototype.getTextureDisplay=function(a,b,c,d){if(b)var e=this._textureAtlasDic[b];if(!e&&!b)for(b in this._textureAtlasDic){if(e=this._textureAtlasDic[b],e.getRegion(a))break;e=null}if(e){if(isNaN(c)||isNaN(d)){var f=this._dataDic[b];if(f){var g=f.getSubTexturePivot(a);g&&(c=g.x,d=g.y)}}return this._generateDisplay(e,a,c,d)}return null},c.prototype._generateArmature=function(){return null},c.prototype._generateSlot=function(){return null},c.prototype._generateDisplay=function(){return null},c}(c.EventDispatcher);b.BaseFactory=d}(a.factorys||(a.factorys={}));a.factorys;!function(a){var c=function(){function a(){}return a.ANGLE_TO_RADIAN=Math.PI/180,a.DRAGON_BONES="dragonBones",a.ARMATURE="armature",a.SKIN="skin",a.BONE="bone",a.SLOT="slot",a.DISPLAY="display",a.ANIMATION="animation",a.TIMELINE="timeline",a.FRAME="frame",a.TRANSFORM="transform",a.COLOR_TRANSFORM="colorTransform",a.TEXTURE_ATLAS="TextureAtlas",a.SUB_TEXTURE="SubTexture",a.A_VERSION="version",a.A_IMAGE_PATH="imagePath",a.A_FRAME_RATE="frameRate",a.A_NAME="name",a.A_PARENT="parent",a.A_LENGTH="length",a.A_TYPE="type",a.A_FADE_IN_TIME="fadeInTime",a.A_DURATION="duration",a.A_SCALE="scale",a.A_OFFSET="offset",a.A_LOOP="loop",a.A_EVENT="event",a.A_SOUND="sound",a.A_ACTION="action",a.A_HIDE="hide",a.A_TWEEN_EASING="tweenEasing",a.A_TWEEN_ROTATE="tweenRotate",a.A_DISPLAY_INDEX="displayIndex",a.A_Z_ORDER="z",a.A_WIDTH="width",a.A_HEIGHT="height",a.A_X="x",a.A_Y="y",a.A_SKEW_X="skX",a.A_SKEW_Y="skY",a.A_SCALE_X="scX",a.A_SCALE_Y="scY",a.A_PIVOT_X="pX",a.A_PIVOT_Y="pY",a.A_ALPHA_OFFSET="aO",a.A_RED_OFFSET="rO",a.A_GREEN_OFFSET="gO",a.A_BLUE_OFFSET="bO",a.A_ALPHA_MULTIPLIER="aM",a.A_RED_MULTIPLIER="rM",a.A_GREEN_MULTIPLIER="gM",a.A_BLUE_MULTIPLIER="bM",a}();a.ConstValues=c;var f=function(){function a(){}return a.transformPointWithParent=function(b,c){var d=a._helpMatrix;a.transformToMatrix(c,d),d.invert();var e=b.x,f=b.y;b.x=d.a*e+d.c*f+d.tx,b.y=d.d*f+d.b*e+d.ty,b.skewX=a.formatRadian(b.skewX-c.skewX),b.skewY=a.formatRadian(b.skewY-c.skewY)},a.transformToMatrix=function(a,b){b.a=a.scaleX*Math.cos(a.skewY),b.b=a.scaleX*Math.sin(a.skewY),b.c=-a.scaleY*Math.sin(a.skewX),b.d=a.scaleY*Math.cos(a.skewX),b.tx=a.x,b.ty=a.y},a.formatRadian=function(b){return b%=a.DOUBLE_PI,b>Math.PI&&(b-=a.DOUBLE_PI),b<-Math.PI&&(b+=a.DOUBLE_PI),b},a.DOUBLE_PI=2*Math.PI,a._helpMatrix=new b.Matrix,a}();a.TransformUtil=f;var g=function(){function a(){}return a.transformArmatureData=function(a){for(var b,c,d=a.getBoneDataList(),e=d.length;e--;)b=d[e],b.parent&&(c=a.getBoneData(b.parent),c&&(b.transform.copy(b.global),f.transformPointWithParent(b.transform,c.global)))},a.transformArmatureDataAnimations=function(b){for(var c=b.getAnimationDataList(),d=c.length;d--;)a.transformAnimationData(c[d],b)},a.transformAnimationData=function(b,c){for(var d,e,g,h,i,j,k,l,m,n,o=c.getSkinData(null),p=c.getBoneDataList(),q=o.getSlotDataList(),r=p.length;r--;)if(d=p[r],e=b.getTimeline(d.name)){g=null;for(var s in q)if(g=q[s],g.parent==d.name)break;h=d.parent?b.getTimeline(d.parent):null,i=e.getFrameList(),j=null,k=null,l=null,n=i.length;for(var t=0;n>t;t++){if(m=i[t],h?(a._helpTransform1.copy(m.global),a.getTimelineTransform(h,m.position,a._helpTransform2),f.transformPointWithParent(a._helpTransform1,a._helpTransform2),m.transform.copy(a._helpTransform1)):m.transform.copy(m.global),m.transform.x-=d.transform.x,m.transform.y-=d.transform.y,m.transform.skewX-=d.transform.skewX,m.transform.skewY-=d.transform.skewY,m.transform.scaleX-=d.transform.scaleX,m.transform.scaleY-=d.transform.scaleY,e.transformed||g&&(m.zOrder-=g.zOrder),j||(j=e.originTransform,j.copy(m.transform),j.skewX=f.formatRadian(j.skewX),j.skewY=f.formatRadian(j.skewY),k=e.originPivot,k.x=m.pivot.x,k.y=m.pivot.y),m.transform.x-=j.x,m.transform.y-=j.y,m.transform.skewX=f.formatRadian(m.transform.skewX-j.skewX),m.transform.skewY=f.formatRadian(m.transform.skewY-j.skewY),m.transform.scaleX-=j.scaleX,m.transform.scaleY-=j.scaleY,e.transformed||(m.pivot.x-=k.x,m.pivot.y-=k.y),l){var u=m.transform.skewX-l.transform.skewX;l.tweenRotate?l.tweenRotate>0?(0>u&&(m.transform.skewX+=2*Math.PI,m.transform.skewY+=2*Math.PI),l.tweenRotate>1&&(m.transform.skewX+=2*Math.PI*(l.tweenRotate-1),m.transform.skewY+=2*Math.PI*(l.tweenRotate-1))):(u>0&&(m.transform.skewX-=2*Math.PI,m.transform.skewY-=2*Math.PI),l.tweenRotate<1&&(m.transform.skewX+=2*Math.PI*(l.tweenRotate+1),m.transform.skewY+=2*Math.PI*(l.tweenRotate+1))):(m.transform.skewX=l.transform.skewX+f.formatRadian(m.transform.skewX-l.transform.skewX),m.transform.skewY=l.transform.skewY+f.formatRadian(m.transform.skewY-l.transform.skewY))
}l=m}e.transformed=!0}},a.getTimelineTransform=function(a,b,c){for(var e,g,h,i,j=a.getFrameList(),k=j.length;k--;)if(e=j[k],e.position<=b&&e.position+e.duration>b){g=e.tweenEasing,k==j.length-1||isNaN(g)||b==e.position?c.copy(e.global):(h=(b-e.position)/e.duration,g&&(h=d.TimelineState.getEaseValue(h,g)),i=j[k+1],c.x=e.global.x+(i.global.x-e.global.x)*h,c.y=e.global.y+(i.global.y-e.global.y)*h,c.skewX=f.formatRadian(e.global.skewX+(i.global.skewX-e.global.skewX)*h),c.skewY=f.formatRadian(e.global.skewY+(i.global.skewY-e.global.skewY)*h),c.scaleX=e.global.scaleX+(i.global.scaleX-e.global.scaleX)*h,c.scaleY=e.global.scaleY+(i.global.scaleY-e.global.scaleY)*h);break}},a.addHideTimeline=function(a,b){for(var c,d,f=b.getBoneDataList(),g=f.length;g--;)c=f[g],d=c.name,a.getTimeline(d)||a.addTimeline(e.TransformTimeline.HIDE_TIMELINE,d)},a._helpTransform1=new e.DBTransform,a._helpTransform2=new e.DBTransform,a}();a.DBDataUtil=g}(a.utils||(a.utils={}));var f=a.utils,g=function(){function a(){this.global=new e.DBTransform,this.origin=new e.DBTransform,this.offset=new e.DBTransform,this.tween=new e.DBTransform,this.tween.scaleX=this.tween.scaleY=0,this._globalTransformMatrix=new b.Matrix,this._visible=!0,this._isColorChanged=!1,this._isDisplayOnStage=!1,this._scaleType=0,this.fixedRotation=!1}return a.prototype.getVisible=function(){return this._visible},a.prototype.setVisible=function(a){this._visible=a},a.prototype._setParent=function(a){this.parent=a},a.prototype._setArmature=function(a){this.armature&&this.armature._removeDBObject(this),this.armature=a,this.armature&&this.armature._addDBObject(this)},a.prototype.dispose=function(){this.parent=null,this.armature=null,this.global=null,this.origin=null,this.offset=null,this.tween=null,this._globalTransformMatrix=null},a.prototype._update=function(){if(this.global.scaleX=(this.origin.scaleX+this.tween.scaleX)*this.offset.scaleX,this.global.scaleY=(this.origin.scaleY+this.tween.scaleY)*this.offset.scaleY,this.parent){var a=this.origin.x+this.offset.x+this.tween.x,b=this.origin.y+this.offset.y+this.tween.y,c=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx=this.global.x=c.a*a+c.c*b+c.tx,this._globalTransformMatrix.ty=this.global.y=c.d*b+c.b*a+c.ty,this.fixedRotation?(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY):(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX+this.parent.global.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY+this.parent.global.skewY),this.parent.scaleMode>=this._scaleType&&(this.global.scaleX*=this.parent.global.scaleX,this.global.scaleY*=this.parent.global.scaleY)}else this._globalTransformMatrix.tx=this.global.x=this.origin.x+this.offset.x+this.tween.x,this._globalTransformMatrix.ty=this.global.y=this.origin.y+this.offset.y+this.tween.y,this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY;this._globalTransformMatrix.a=this.global.scaleX*Math.cos(this.global.skewY),this._globalTransformMatrix.b=this.global.scaleX*Math.sin(this.global.skewY),this._globalTransformMatrix.c=-this.global.scaleY*Math.sin(this.global.skewX),this._globalTransformMatrix.d=this.global.scaleY*Math.cos(this.global.skewX)},a}();a.DBObject=g;var h=function(a){function b(b){a.call(this),this._displayBridge=b,this._displayList=[],this._displayIndex=-1,this._scaleType=1,this._originZOrder=0,this._tweenZorder=0,this._offsetZOrder=0,this._isDisplayOnStage=!1,this._isHideDisplay=!1}return __extends(b,a),b.prototype.getZOrder=function(){return this._originZOrder+this._tweenZorder+this._offsetZOrder},b.prototype.setZOrder=function(a){this.getZOrder()!=a&&(this._offsetZOrder=a-this._originZOrder-this._tweenZorder,this.armature&&(this.armature._slotsZOrderChanged=!0))},b.prototype.getDisplay=function(){var a=this._displayList[this._displayIndex];return a instanceof j?a.getDisplay():a},b.prototype.setDisplay=function(a){this._displayList[this._displayIndex]=a,this._setDisplay(a)},b.prototype.getChildArmature=function(){var a=this._displayList[this._displayIndex];return a instanceof j?a:null},b.prototype.setChildArmature=function(a){this._displayList[this._displayIndex]=a,a&&this._setDisplay(a.getDisplay())},b.prototype.getDisplayList=function(){return this._displayList},b.prototype.setDisplayList=function(a){if(!a)throw new Error;for(var b=this._displayList.length=a.length;b--;)this._displayList[b]=a[b];if(this._displayIndex>=0){var c=this._displayIndex;this._displayIndex=-1,this._changeDisplay(c)}},b.prototype._setDisplay=function(a){this._displayBridge.getDisplay()?this._displayBridge.setDisplay(a):(this._displayBridge.setDisplay(a),this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)),this.updateChildArmatureAnimation(),this._isDisplayOnStage=!this._isHideDisplay&&this._displayBridge.getDisplay()?!0:!1},b.prototype._changeDisplay=function(a){if(0>a)this._isHideDisplay||(this._isHideDisplay=!0,this._displayBridge.removeDisplay(),this.updateChildArmatureAnimation());else{if(this._isHideDisplay){this._isHideDisplay=!1;var b=!0;this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)}var c=this._displayList.length;if(a>=c&&c>0&&(a=c-1),this._displayIndex!=a){this._displayIndex=a;var d=this._displayList[this._displayIndex];this._setDisplay(d instanceof j?d.getDisplay():d),this._dislayDataList&&this._displayIndex<=this._dislayDataList.length&&this.origin.copy(this._dislayDataList[this._displayIndex].transform)}else b&&this.updateChildArmatureAnimation()}this._isDisplayOnStage=!this._isHideDisplay&&this._displayBridge.getDisplay()?!0:!1},b.prototype.setVisible=function(a){a!=this._visible&&(this._visible=a,this._updateVisible(this._visible))},b.prototype._setArmature=function(b){a.prototype._setArmature.call(this,b),this.armature?(this.armature._slotsZOrderChanged=!0,this._displayBridge.addDisplay(this.armature.getDisplay(),-1)):this._displayBridge.removeDisplay()},b.prototype.dispose=function(){this._displayBridge&&(a.prototype.dispose.call(this),this._displayBridge.dispose(),this._displayList.length=0,this._displayBridge=null,this._displayList=null,this._dislayDataList=null)},b.prototype._update=function(){if(a.prototype._update.call(this),this._isDisplayOnStage){var b=this.parent._tweenPivot.x,c=this.parent._tweenPivot.y;if(b||c){var d=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx+=d.a*b+d.c*c,this._globalTransformMatrix.ty+=d.b*b+d.d*c}this._displayBridge.updateTransform(this._globalTransformMatrix,this.global)}},b.prototype._updateVisible=function(a){this._displayBridge.setVisible(this.parent.getVisible()&&this._visible&&a)},b.prototype.updateChildArmatureAnimation=function(){var a=this.getChildArmature();if(a)if(this._isHideDisplay)a.animation.stop(),a.animation._lastAnimationState=null;else{var b=this.armature?this.armature.animation.getLastAnimationName():null;b&&a.animation.hasAnimation(b)?a.animation.gotoAndPlay(b):a.animation.play()}},b}(g);a.Slot=h;var i=function(a){function d(){a.call(this),this._children=[],this._scaleType=2,this._tweenPivot=new b.Point,this.scaleMode=1}return __extends(d,a),d.prototype.setVisible=function(a){if(this._visible!=a){this._visible=a;for(var b=this._children.length;b--;){var c=this._children[b];c instanceof h&&c._updateVisible(this._visible)}}},d.prototype._setArmature=function(b){a.prototype._setArmature.call(this,b);for(var c=this._children.length;c--;)this._children[c]._setArmature(this.armature)},d.prototype.dispose=function(){if(this._children){a.prototype.dispose.call(this);for(var b=this._children.length;b--;)this._children[b].dispose();this._children.length=0,this._children=null,this._tweenPivot=null,this.slot=null}},d.prototype.contains=function(a){if(!a)throw new Error;if(a==this)return!1;for(var b=a;b!=this&&null!=b;)b=b.parent;return b==this},d.prototype.addChild=function(a){if(!a)throw new Error;if(a==this||a instanceof d&&a.contains(this))throw new Error("An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)");a.parent&&a.parent.removeChild(a),this._children[this._children.length]=a,a._setParent(this),a._setArmature(this.armature),!this.slot&&a instanceof h&&(this.slot=a)},d.prototype.removeChild=function(a){if(!a)throw new Error;var b=this._children.indexOf(a);if(!(b>=0))throw new Error;this._children.splice(b,1),a._setParent(null),a._setArmature(null),a==this.slot&&(this.slot=null)},d.prototype.getSlots=function(){for(var a=[],b=this._children.length;b--;)this._children[b]instanceof h&&a.unshift(this._children[b]);return a},d.prototype._arriveAtFrame=function(a,b,e){if(a){var f=e.getMixingTransform(name);if(!(!e.displayControl||2!=f&&-1!=f||this.displayController&&this.displayController!=e.name)){var g=a;if(this.slot){var i=g.displayIndex;i>=0&&(isNaN(g.zOrder)||g.zOrder==this.slot._tweenZorder||(this.slot._tweenZorder=g.zOrder,this.armature._slotsZOrderChanged=!0)),this.slot._changeDisplay(i),this.slot._updateVisible(g.visible)}}if(a.event&&this.armature.hasEventListener(c.FrameEvent.BONE_FRAME_EVENT)){var j=new c.FrameEvent(c.FrameEvent.BONE_FRAME_EVENT);j.bone=this,j.animationState=e,j.frameLabel=a.event,this.armature._eventList.push(j)}if(a.sound&&d._soundManager.hasEventListener(c.SoundEvent.SOUND)){var k=new c.SoundEvent(c.SoundEvent.SOUND);k.armature=this.armature,k.animationState=e,k.sound=a.sound,d._soundManager.dispatchEvent(k)}if(a.action)for(var l in this._children)if(this._children[l]instanceof h){var m=this._children[l].getChildArmature();m&&m.animation.gotoAndPlay(a.action)}}else this.slot&&this.slot._changeDisplay(-1)},d.prototype._updateColor=function(a,b,c,d,e,f,g,h,i){(i||this._isColorChanged)&&this.slot._displayBridge.updateColor(a,b,c,d,e,f,g,h),this._isColorChanged=i},d._soundManager=c.SoundEventManager.getInstance(),d}(g);a.Bone=i;var j=function(b){function e(a){b.call(this),this.animation=new d.Animation(this),this._display=a,this._slotsZOrderChanged=!1,this._slotList=[],this._boneList=[],this._eventList=[]}return __extends(e,b),e.prototype.getDisplay=function(){return this._display},e.prototype.dispose=function(){if(this.animation){a.animation.WorldClock.clock.remove(this),this.animation.dispose();for(var b=this._slotList.length;b--;)this._slotList[b].dispose();for(b=this._boneList.length;b--;)this._boneList[b].dispose();this._slotList.length=0,this._boneList.length=0,this._eventList.length=0,this._slotList=null,this._boneList=null,this._eventList=null,this._display=null,this.animation=null}},e.prototype.advanceTime=function(a){this.animation.advanceTime(a),a*=this.animation.timeScale;for(var b=this._boneList.length;b--;)this._boneList[b]._update();b=this._slotList.length;for(var d;b--;)if(d=this._slotList[b],d._update(),d._isDisplayOnStage){var e=d.getChildArmature();e&&e.advanceTime(a)}if(this._slotsZOrderChanged&&(this.updateSlotsZOrder(),this.hasEventListener(c.ArmatureEvent.Z_ORDER_UPDATED)&&this.dispatchEvent(new c.ArmatureEvent(c.ArmatureEvent.Z_ORDER_UPDATED))),this._eventList.length){var f=this._eventList.length;for(b=0;f>b;b++)this.dispatchEvent(this._eventList[b]);this._eventList.length=0}},e.prototype.getSlots=function(a){return"undefined"==typeof a&&(a=!0),a?this._slotList.concat():this._slotList},e.prototype.getBones=function(a){return"undefined"==typeof a&&(a=!0),a?this._boneList.concat():this._boneList},e.prototype.getSlot=function(a){for(var b=this._slotList.length;b--;)if(this._slotList[b].name==a)return this._slotList[b];return null},e.prototype.getSlotByDisplay=function(a){if(a)for(var b=this._slotList.length;b--;)if(this._slotList[b].getDisplay()==a)return this._slotList[b];return null},e.prototype.removeSlot=function(a){if(!a)throw new Error;if(!(this._slotList.indexOf(a)>=0))throw new Error;a.parent.removeChild(a)},e.prototype.removeSlotByName=function(a){if(a){var b=this.getSlot(a);b&&this.removeSlot(b)}},e.prototype.getBone=function(a){for(var b=this._boneList.length;b--;)if(this._boneList[b].name==a)return this._boneList[b];return null},e.prototype.getBoneByDisplay=function(a){var b=this.getSlotByDisplay(a);return b?b.parent:null},e.prototype.removeBone=function(a){if(!a)throw new Error;if(!(this._boneList.indexOf(a)>=0))throw new Error;a.parent?a.parent.removeChild(a):a._setArmature(null)},e.prototype.removeBoneByName=function(a){if(a){var b=this.getBone(a);b&&this.removeBone(b)}},e.prototype.addChild=function(a,b){if(!a)throw new Error;if(b){var c=this.getBone(b);if(!c)throw new Error;c.addChild(a)}else a.parent&&a.parent.removeChild(a),a._setArmature(this)},e.prototype.updateSlotsZOrder=function(){this._slotList.sort(this.sortSlot);for(var a,b=this._slotList.length;b--;)a=this._slotList[b],a._isDisplayOnStage&&a._displayBridge.addDisplay(this._display,-1);this._slotsZOrderChanged=!1},e.prototype._addDBObject=function(a){if(a instanceof h){var b=a;this._slotList.indexOf(b)<0&&(this._slotList[this._slotList.length]=b)}else if(a instanceof i){var c=a;this._boneList.indexOf(c)<0&&(this._boneList[this._boneList.length]=c,this._sortBoneList())}},e.prototype._removeDBObject=function(a){if(a instanceof h){var b=a,c=this._slotList.indexOf(b);c>=0&&this._slotList.splice(c,1)}else if(a instanceof i){var d=a;c=this._boneList.indexOf(d),c>=0&&this._boneList.splice(c,1)}},e.prototype._sortBoneList=function(){var a=this._boneList.length;if(0!=a){for(var b,c,d,e=[];a--;){for(b=0,c=this._boneList[a],d=c;d;)b++,d=d.parent;e[a]={level:b,bone:c}}for(e.sort(this.sortBone),a=e.length;a--;)this._boneList[a]=e[a].bone}},e.prototype._arriveAtFrame=function(a,b,d){if(a.event&&this.hasEventListener(c.FrameEvent.ANIMATION_FRAME_EVENT)){var f=new c.FrameEvent(c.FrameEvent.ANIMATION_FRAME_EVENT);f.animationState=d,f.frameLabel=a.event,this._eventList.push(f)}if(a.sound&&e._soundManager.hasEventListener(c.SoundEvent.SOUND)){var g=new c.SoundEvent(c.SoundEvent.SOUND);g.armature=this,g.animationState=d,g.sound=a.sound,e._soundManager.dispatchEvent(g)}a.action&&d.isPlaying&&this.animation.gotoAndPlay(a.action)},e.prototype.sortSlot=function(a,b){return a.getZOrder()<b.getZOrder()?1:-1},e.prototype.sortBone=function(a,b){return a.level<b.level?1:-1},e._soundManager=c.SoundEventManager.getInstance(),e}(c.EventDispatcher);a.Armature=j}(dragonBones||(dragonBones={}));var alex={VERSION:2,load:{},utils:{},display:{},ui:{},motion:{},screens:{},audio:{},log:function(a){this.statics.LOG_ENABLED&&"undefined"!=typeof console&&console&&console.log&&console.log(a)}};alex.statics={DEFAULT_W:1136,MIN_W:960,DEFAULT_H:640,STAGE_W:1136,STAGE_H:640,SCALE_FACTOR:1,PIXEL_RATIO:1,CONTENT_SCALE:1,FONT:"Arial",BG_COLOR:"black",MUTE_STATE:!1,LOG_ENABLED:!0,FULLSCREEN_ENABLED:!0,WEB_AUDIO_ENABLED:!0,WEB_GL_ENABLED:!0,AUDIO_ENABLED:!0,FORCE_SD:!1,copy:function(a){for(var b in a)this[b]=a[b]},setSD:function(){this.SCALE_FACTOR=.5,this.STAGE_H*=this.SCALE_FACTOR,this.STAGE_W*=this.SCALE_FACTOR,alex.log("setSD!")}},alex.statics.IMG_DIR="./img/",alex.statics.SND_DIR="./snd/",alex.statics.JSON_DIR="./json/",alex.statics.ANIM_DIR="./animation/",alex.statics.FONT_DIR="./font/",alex.events={NEXT_SCREEN:"next_screen",NEW_SCREEN:"new_screen",COMPLETE:"complete",LOADED:"loaded",PROGRESS:"progress",GAME_EVENT:"game_event"},void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var TWEEN=TWEEN||function(){var a=[];return{REVISION:"7a",getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(b){var c=a.indexOf(b);-1!==c&&a.splice(c,1)},update:function(b){if(0===a.length)return!1;var c=0,d=a.length;for(b=void 0!==b?b:Date.now();d>c;)a[c].update(b)?c++:(a.splice(c,1),d--);return!0}}}();TWEEN.Tween=function(a){var b=a,c={},d={},e=1e3,f=0,g=null,h=TWEEN.Easing.Linear.None,i=TWEEN.Interpolation.Linear,j=[],k=null,l=!1,m=null,n=null;this.to=function(a,b){return void 0!==b&&(e=b),d=a,this},this.start=function(a){TWEEN.add(this),l=!1,g=void 0!==a?a:Date.now(),g+=f;for(var e in d)if(null!==b[e]){if(d[e]instanceof Array){if(0===d[e].length)continue;d[e]=[b[e]].concat(d[e])}c[e]=b[e]}return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(a){return f=a,this},this.easing=function(a){return h=a,this},this.interpolation=function(a){return i=a,this},this.chain=function(){return j=arguments,this},this.onStart=function(a){return k=a,this},this.onUpdate=function(a){return m=a,this},this.onComplete=function(a){return n=a,this},this.restart=function(a){g+=a},this.changeDuration=function(a){e=a},this.update=function(a){if(g>a)return!0;l===!1&&(null!==k&&k.call(b),l=!0);var f=(a-g)/e;f=f>1?1:f;var o=h(f);for(var p in c){var q=c[p],r=d[p];b[p]=r instanceof Array?i(r,o):q+(r-q)*o}if(null!==m&&m.call(b,o),1==f){null!==n&&n.call(b);for(var s=0,t=j.length;t>s;s++)j[s].start(a);return!1}return!0}},TWEEN.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return(a*=2)<1?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return(a*=2)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return(a*=2)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:(a*=2)<1?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),-(c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)))},Out:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),c*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/d)+1)},InOut:function(a){var b,c=.1,d=.4;return 0===a?0:1===a?1:(!c||1>c?(c=1,b=d/4):b=d*Math.asin(1/c)/(2*Math.PI),(a*=2)<1?-.5*c*Math.pow(2,10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d):c*Math.pow(2,-10*(a-=1))*Math.sin(2*(a-b)*Math.PI/d)*.5+1)}},Back:{In:function(a){var b=1.70158;return a*a*((b+1)*a-b)},Out:function(a){var b=1.70158;return--a*a*((b+1)*a+b)+1},InOut:function(a){var b=2.5949095;return(a*=2)<1?.5*a*a*((b+1)*a-b):.5*((a-=2)*a*((b+1)*a+b)+2)}},Bounce:{In:function(a){return 1-TWEEN.Easing.Bounce.Out(1-a)},Out:function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*TWEEN.Easing.Bounce.In(2*a):.5*TWEEN.Easing.Bounce.Out(2*a-1)+.5}}},TWEEN.Interpolation={Linear:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TWEEN.Interpolation.Utils.Linear;return 0>b?f(a[0],a[1],d):b>1?f(a[c],a[c-1],c-d):f(a[e],a[e+1>c?c:e+1],d-e)},Bezier:function(a,b){var c,d=0,e=a.length-1,f=Math.pow,g=TWEEN.Interpolation.Utils.Bernstein;for(c=0;e>=c;c++)d+=f(1-b,e-c)*f(b,c)*a[c]*g(e,c);return d},CatmullRom:function(a,b){var c=a.length-1,d=c*b,e=Math.floor(d),f=TWEEN.Interpolation.Utils.CatmullRom;return a[0]===a[c]?(0>b&&(e=Math.floor(d=c*(1+b))),f(a[(e-1+c)%c],a[e],a[(e+1)%c],a[(e+2)%c],d-e)):0>b?a[0]-(f(a[0],a[0],a[1],a[1],-d)-a[0]):b>1?a[c]-(f(a[c],a[c],a[c-1],a[c-1],d-c)-a[c]):f(a[e?e-1:0],a[e],a[e+1>c?c:e+1],a[e+2>c?c:e+2],d-e)},Utils:{Linear:function(a,b,c){return(b-a)*c+a},Bernstein:function(a,b){var c=TWEEN.Interpolation.Utils.Factorial;return c(a)/c(b)/c(a-b)},Factorial:function(){var a=[1];return function(b){var c,d=1;if(a[b])return a[b];for(c=b;c>1;c--)d*=c;return a[b]=d}}(),CatmullRom:function(a,b,c,d,e){var f=.5*(c-a),g=.5*(d-b),h=e*e,i=e*h;return(2*b-2*c+f+g)*i+(-3*b+3*c-2*f-g)*h+f*e+b}}},game_shell.Keys={_pressed:{},LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,SPACE_KEY:32,SHIFT_KEY:16,UP:0,JUST_PRESSED:1,DOWN:2,isDown:function(a){return this._pressed[a]>0},wasPressed:function(a){return this._pressed[a]===this.JUST_PRESSED},keyDown2:function(a){game_shell.Keys.onKeydown(a)},onKeydown:function(a){this._pressed[a.keyCode]||(this._pressed[a.keyCode]=this.JUST_PRESSED)},keyUp2:function(a){game_shell.Keys.onKeyup(a)},onKeyup:function(a){delete this._pressed[a.keyCode]},update:function(){for(var a in this._pressed)this._pressed[a]===this.JUST_PRESSED&&(this._pressed[a]=this.DOWN)},clear:function(){for(var a in this._pressed)delete this._pressed[a]},enable:function(a){window.removeEventListener("keyup",game_shell.Keys.keyUp2),window.removeEventListener("keydown",game_shell.Keys.keyDown2),a&&(window.addEventListener("keyup",game_shell.Keys.keyUp2,!1),window.addEventListener("keydown",game_shell.Keys.keyDown2,!1))}},alex.utils.EventDispatcher=function(){},alex.utils.EventDispatcher.prototype={constructor:alex.utils.EventDispatcher,apply:function(a){a.addEventListener=alex.utils.EventDispatcher.prototype.addEventListener,a.hasEventListener=alex.utils.EventDispatcher.prototype.hasEventListener,a.removeEventListener=alex.utils.EventDispatcher.prototype.removeEventListener,a.removeEventListeners=alex.utils.EventDispatcher.prototype.removeEventListeners,a.dispatchEvent=alex.utils.EventDispatcher.prototype.dispatchEvent},addEventListener:function(a,b){void 0===this._listeners&&(this._listeners={});var c=this._listeners;void 0===c[a]&&(c[a]=[]),-1===c[a].indexOf(b)&&c[a].push(b)},hasEventListener:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0!==this._listeners){var c=this._listeners,d=c[a].indexOf(b);-1!==d&&c[a].splice(d,1)}},removeEventListeners:function(){if(void 0!==this._listeners){var a=this._listeners;for(var b in a)delete a[b]}},dispatchEvent:function(a){if(void 0!==this._listeners){var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;e>d;d++)c[d].call(this,a)}}},dispose:function(){void 0!==this._listeners&&(this._listeners.length=0,this._listeners=null)}},alex.utils.EventQueue=function(){alex.utils.EventDispatcher.call(this),this.queue=[],this.queueEvent=function(a){this.queue[this.queue.length]=a},this.dispatchQueuedEvents=function(){for(;this.queue.length>0;){var a=this.queue[0];this.queue.shift(),this.dispatchEvent(a)}}},alex.utils.EventQueue.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.utils.EventQueue.constructor=alex.utils.EventQueue,alex.utils.Randomise=function(){function a(a){f.length=0;var b,c=a.length;for(b=0;c>b;b++)f[b]=a[b];for(a.length=0;f.length>0;){var d=e(f.length-1);a[a.length]=f.splice(d,1)[0]}}function b(a){for(var b=new Array,c=a.slice();c.length>0;){var d=e(c.length-1);b[b.length]=c.splice(d,1)[0]}return b}function c(a){return Math.random()*a}function d(a,b){var c=b-a;return a+Math.random()*c}function e(a){return Math.floor(Math.random()*(a+1))}var f=[];return{randomise:a,randomNumber:c,randomInRange:d,randomisedCopy:b,randomInt:e}}(),alex.utils.Timer=function(a,b){alex.utils.EventDispatcher.call(this),this.interval=a,this.repeat=-1,"undefined"!=typeof b&&(this.repeat=b),this.running=!1,this.currentTime=0,this.tickCount=0,this.evt={time:0,count:0},this.onTimer=function(){},this.onTimerComplete=function(){}},alex.utils.Timer.constructor=alex.utils.Timer,alex.utils.Timer.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.utils.Timer.prototype.start=function(){this.running=!0,this.currentTime=0,this.tickCount=0},alex.utils.Timer.prototype.stop=function(){this.running=!1},alex.utils.Timer.prototype.resume=function(){this.running=!0},alex.utils.Timer.prototype.reset=function(){this.running=!1,this.currentTime=0,this.tickCount=0},Object.defineProperty(alex.utils.Timer.prototype,"isComplete",{get:function(){return this.tickCount===this.repeat},set:function(){}}),Object.defineProperty(alex.utils.Timer.prototype,"remaining",{get:function(){return this.repeat-this.tickCount},set:function(){}}),alex.utils.Timer.prototype.update=function(a){this.running&&(this.currentTime+=a,this.currentTime>this.interval&&(this.currentTime-=this.interval,this.tickCount++,this.evt.time=this.currentTime,this.evt.count=this.tickCount,this.evt.countDown=this.repeat-this.tickCount,this.evt.type="timer",this.dispatchEvent(this.evt),this.onTimer(this.tickCount),this.tickCount===this.repeat&&(this.stop(),this.evt.type="complete",this.dispatchEvent(this.evt),this.onTimerComplete())))},alex.utils.Timer.prototype.dispose=function(){this.onTimer=null,this.onTimerComplete=null,alex.utils.EventDispatcher.prototype.dispose.call(this)},alex.utils.DelayedAction=function(){var a=-1,b=null;this.delay=function(c,d){a=d||-1,b=c||null},this.update=function(c){var d=!1;if(null!==b&&a>0&&(a-=c,0>=a)){var e=b;b=null,d=!0,e()}return d},this.dispose=function(){b=null,a=-1}},alex.utils.SystemInfo=function(){this.browser=-1,this.os=-1,this.device=-1,this.browserUnknown=-1,this.browserSafari=1,this.browserIE=2,this.browserFirefox=3,this.browserChrome=4,this.browserAndroidStock=5,this.browserKindleSilk=6,this.browserOpera=7,this.deviceUnknown=-1,this.deviceDesktop=1,this.deviceMobile=2,this.osUnknown=-1,this.osWindows=1,this.osOSX=2,this.osLinux=3,this.osIOS=4,this.osAndroid=5,this.osBlackberry=6,this.osVersion=-1,this.audioType="",this.webAudio=!1},alex.utils.SystemInfo.prototype.run=function(){function a(){if(this.isIOS||this.browser===this.browserSafari)return!1;var a=document.createElement("audio");return!(!a.canPlayType||!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""))}var b=navigator.userAgent;if(b.length>0)if(this.device=null!==b.match(/mobile/i)?this.deviceMobile:null!==b.match(/tablet/i)?this.deviceMobile:null!==b.match(/android/i)?this.deviceMobile:this.deviceDesktop,null!==b.match(/windows/i)?this.os=this.osWindows:null!==b.match(/iphone os/i)?this.os=this.osIOS:null!==b.match(/ipad/i)?this.os=this.osIOS:null!==b.match(/mac os x/i)?this.os=this.device===this.deviceMobile?this.osIOS:this.osOSX:null!==b.match(/android/i)?this.os=this.osAndroid:null!==b.match(/linux/i)&&(this.os=this.osLinux),null!==b.match(/MSIE/i)||null!==b.match(/rv:11.0/i)?this.browser=this.browserIE:this.os!==this.osAndroid||null===b.match(/samsung/i)&&null===b.match(/534.30/i)&&null===b.match(/535.19/i)?null!==b.match(/silk/i)||null!==b.match(/kindle fire/i)?this.browser=this.browserKindleSilk:null!==b.match(/chrome/i)?this.browser=this.browserChrome:null!==b.match(/CriOS/i)?this.browser=this.browserChrome:null!==b.match(/Firefox/i)?this.browser=this.browserFirefox:null!==b.match(/safari/i)&&(this.browser=this.browserSafari):this.browser=this.browserAndroidStock,this.os===this.osIOS)null!==b.match(/iPhone OS 5/i)?this.osVersion=5:null!==b.match(/iPhone OS 6/i)&&(this.osVersion=6);else if(this.os===this.osAndroid)try{var c=b.match(/Android [\d+(?:\.\d+]{3,5}/)[0].replace("Android ","");this.osVersion=parseFloat(c)}catch(d){this.osVersion=-1}var e=a.call(this);this.audioType=e?".ogg":".m4a",this.webAudio=window.AudioContext?!0:window.webkitAudioContext?!0:!1,alex.log("this.webAudio: "+this.webAudio)},Object.defineProperty(alex.utils.SystemInfo.prototype,"isAndroidStock",{get:function(){return this.browser===this.browserAndroidStock}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isIOS",{get:function(){return this.os===this.osIOS}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isMobile",{get:function(){return this.device===this.deviceMobile}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isAndroid",{get:function(){return this.os===this.osAndroid}}),Object.defineProperty(alex.utils.SystemInfo.prototype,"isMobileSafari",{get:function(){return this.os===this.osIOS&&this.browser===this.browserSafari}}),alex.utils.FullscreenMgr=function(a){function b(){var a=document.documentElement;a.allowfullscreen=!0;var b=a.requestFullscreen||a.webkitRequestFullscreen||a.msRequestFullscreen||a.mozRequestFullScreen;return b&&(document.onfullscreenchange=function(a){c(a)},document.onwebkitfullscreenchange=function(a){c(a)},document.onmozfullscreenchange=function(a){c(a)},document.onmsfullscreenchange=function(a){c(a)},document.onfullscreenerror=function(a){d(a)},document.onmozfullscreenerror=function(a){d(a)},document.onwebkitfullscreenerror=function(a){d(a)},document.onmsfullscreenerror=function(a){d(a)}),b}function c(){var a=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;i.isFullScreen=null!==a&&"undefined"!=typeof a,console.log("FullscreenMg -> fullscreenChanged -- isFullScreen: "+i.isFullScreen),i.isFullScreen||h&&e(!0)}function d(a){alex.log("* !!!! fullscreenError !!! * "+a),alex.log("* event.message: "+a.message),c(null)}function e(a){j=a,g.removeEventListener("click",f),g.removeEventListener("touchstart",f),a&&(g.addEventListener("click",f,!1),g.addEventListener("touchstart",f,!1))}function f(){var a=document.documentElement;a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen(),e(!1)}var g=a||game_shell.pixiStage.renderer.view,h=alex.utils.system.isMobile,i=this,j=!1;this.isFullScreen=!1,this.isAvailable=b(),e(this.isAvailable),this.reactivate=function(){e(!this.isFullScreen)}},alex.utils.RunLoop=function(){this.boundGameLoop=null,this.gameLoopId=-1,this.interval=1e3/30,this.accumulator=0,this.gamePaused=!1,this.currentTime=0,this.gameLoop=function(){var a=Date.now(),b=a-this.currentTime;this.currentTime=a,this.accumulator+=b;for(var c=this.interval;this.accumulator>c;)this.accumulator-=c,this.updateGame(c)},this.boundGameLoop=this.gameLoop.bind(this),this.start=function(){clearInterval(this.gameLoopId),this.currentTime=Date.now(),this.gameLoopId=setInterval(this.boundGameLoop,this.interval)},this.stop=function(){clearInterval(this.gameLoopId)},this.updateGame=function(){}},alex.utils.RenderLoop=function(a){var b=a,c=-1;this.start=function(){this.render()},this.stop=function(){cancelAnimationFrame(c)},this.render=function(){b.draw(),c=requestAnimationFrame(this.render)}.bind(this)},alex.utils.RenderLoopStats=function(a){var b=a,c=-1;this.start=function(){this.render()},this.stop=function(){cancelAnimationFrame(c)},this.render=function(){stats.begin(),b.draw(),stats.end(),c=requestAnimationFrame(this.render)}.bind(this)},alex.utils.Viewport=function(){alex.utils.EventDispatcher.call(this),this.statics=alex.statics,this.settings={},this.settings.width=this.statics.STAGE_W,this.settings.height=this.statics.STAGE_H,this.settings.scale=1,this.pixelRatio=window.devicePixelRatio||1,this.statics.PIXEL_RATIO=this.pixelRatio,this.rotateImg=document.getElementById("rotate"),this.gameDiv=game_shell.gameDiv,this.checkSD=function(){var a=window.devicePixelRatio||1,b=alex.utils.system.isMobile?640:321,c=window.innerHeight*a<b,d=alex.utils.system.osVersion;d>-1&&!Number.isNaN(d)&&(alex.utils.system.isIOS&&6>d?alex.statics.FORCE_SD=!0:alex.utils.system.isAndroid&&4>d&&(alex.statics.FORCE_SD=!0));var e=!1;return(c||alex.utils.system.isAndroidStock||alex.statics.FORCE_SD)&&(e=!0),e},this.resize=function(){var a=this.getSize();null!==a?(game_shell.pixiStage.resize(a),game_shell.screenMgr.resize(a),this.dispatchEvent({type:"resize",landscape:!0})):this.dispatchEvent({type:"resize",landscape:!1}),alex.utils.system.isMobile&&window.scrollTo(0,1)}.bind(this),window.addEventListener("resize",this.resize,!1),window.addEventListener("orientationchange",this.resize,!1),this.toString=function(){return"[Viewport]"
}},alex.utils.Viewport.constructor=alex.utils.Viewport,alex.utils.Viewport.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.utils.Viewport.prototype.getSize=function(){var a=window.innerWidth,b=window.innerHeight;if(b>a)return this.gameDiv.style.display="none",this.rotateImg.style.display="block",null;this.rotateImg.style.display="none",this.gameDiv.style.display="block";var c=this.statics.DEFAULT_W,d=this.statics.DEFAULT_H,e=this.statics.MIN_W,f=c/d,g=a/b,h=e/d;f>g&&(f=g>=h?g:h);var i=a,j=b;a>f*b?i=Math.ceil(f*b):j=Math.ceil(a/f);var k=j/d,l=alex.statics.SCALE_FACTOR;return this.statics.STAGE_W=Math.floor(i/k)*l,this.statics.STAGE_H=Math.floor(j/k)*l,this.statics.CONTENT_SCALE=k/l,this.settings.pixelWidth=i,this.settings.pointWidth=this.statics.STAGE_W,this.settings.pixelHeight=j,this.settings.pointHeight=this.statics.STAGE_H,this.settings.scale=this.statics.CONTENT_SCALE,this.settings},alex.utils.PauseGame=function(){this.isPaused=!0,this.pausedAsPortrait=!1;var a,b;"undefined"!=typeof document.hidden?(a="hidden",b="visibilitychange"):"undefined"!=typeof document.mozHidden?(a="mozHidden",b="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(a="msHidden",b="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange"),this.pause=function(a){a&&!this.isPaused?(alex.log("PauseGame -> "+a),game_shell.runLoop.stop(),game_shell.renderLoop.stop(),game_shell.sndMgr.mute(!0),this.isPaused=!0):!a&&this.isPaused&&(alex.log("PauseGame -> "+a),game_shell.runLoop.start(),game_shell.renderLoop.start(),game_shell.sndMgr.mute(!1),this.isPaused=!0)},this.pageHidden=function(){this.pause(!0)}.bind(this),this.pageShown=function(){this.pause(!1)}.bind(this),this.onResized=function(a){var b=a.landscape;b?(this.pausedAsPortrait&&this.pause(!1),this.pausedAsPortrait=!1):this.isPaused||(this.pause(!0),this.pausedAsPortrait=!0)}.bind(this),window.addEventListener("blur",this.pageHidden,!1),window.addEventListener("focus",this.pageShown,!1);var c=this;document.addEventListener(b,function(){document[a]?c.pageHidden():c.pageShown()})},alex.load.ImageLoader=function(){function a(){function b(){console.log("TRANSFER ERROR LOADING IMAGE! "+n.src),h[n.id]=null,i[n.id]="error",n.loadState=2,c(null,n),a()}function l(a){if(a.lengthComputable){var b=a.loaded/a.total,c=p+b,d=c/o;k.dispatchEvent({type:"progress",progress:d}),k.onLoadProgress&&k.onLoadProgress(d)}}for(var m,n,o=g.length,p=0,q=0;o>q;q++){if(m=g[q],0===m.loadState){n=m;break}p++}if(n){var r;i[n.id]="loading...";var s=e(n.src);if(j){var t=new XMLHttpRequest;t.open("GET",n.src,!0),t.responseType="arraybuffer",t.send(null),t.onload=function(){200==this.status&&4==this.readyState?(r=f(this.response,s),r.onload=function(){try{window.URL.revokeObjectURL(r.src)}catch(b){console.log("got an error on revoke")}h[n.id]=r,i[n.id]="success",n.loadState=1,p++,c(r,n),a()}):(404==this.status||403==this.status)&&(console.log("404 ERROR - MISSING IMAGE! "+n.src),h[n.id]=null,i[n.id]="not found",n.loadState=2,c(null,n),a())},t.addEventListener("progress",l,!1),t.addEventListener("error",b,!1)}else r=new Image,r.onload=function(){h[n.id]=r,i[n.id]="success",n.loadState=1,c(r,n),a()},r.onerror=function(){h[n.id]=null,console.log("ERROR - image load failed: "+n.src),i[n.id]="failed",n.loadState=2,c(null,n),a()},r.src=n.src}else g.length=0,d()}function b(){var a,b,c,d,d=g.length;for(c=0,b=0;d>b;b++)a=g[b],a.loadState>0&&c++;return c/d}function c(a,c){var d=b(),e=null!==a;k.dispatchEvent({type:"loaded",progress:d,img:a,success:e,src:c.src,data:c}),k.onLoadProgress&&k.onLoadProgress(d)}function d(){k.dispatchEvent({type:"complete"}),k.onLoadComplete&&k.onLoadComplete()}function e(a){var b=a.lastIndexOf("."),c=a.substr(b+1);return"png"==c?"image/png":"jpg"==c?"image/jpg":void 0}function f(a,b){for(var c=new Uint8Array(a),d=c.length,e=new Array(d);d--;)e[d]=String.fromCharCode(c[d]);var f=e.join(""),g=window.btoa(f),h=document.createElement("img");return h.src="data:"+b+";base64,"+g,h}alex.utils.EventDispatcher.call(this);var g,h=new Object,i=new Object;window.URL=window.URL||window.webkitURL;var j=!0;window.URL?window.URL.createObjectURL||(j=!1):j=!1;var k=this;this.load=function(b,c){void 0!==c&&(j=c?!0:!1);var d=alex.utils.system;j&&d.isAndroid&&d.osVersion<=3&&(j=!1);var e,f,h=b.length;for(f=0;h>f;f++)e=b[f],e.loadState=0;g=g?g.concat(b):b,alex.log("imageLoader load -> useXHR: "+j),a()},this.getAsset=function(a){return h[a]},this.setAsset=function(a,b){h[a]=b},this.getAssetId=function(a){var b=null;for(s in h)if(h[s]===a){b=s;break}return b}},alex.load.ImageLoader.constructor=alex.load.ImageLoader,alex.load.ImageLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.ManifestLoadState=function(a){function b(a){for(var b,c=alex.utils.system.audioType,d=a.length,e=alex.statics.SND_DIR,f=0;d>f;f++)b=a[f],b.src=e+b.src+c;return a}this.toString=function(){return"[ManifestLoadState]"};var c=alex.statics,d=.5===c.SCALE_FACTOR,e=(c.WEB_AUDIO_ENABLED&&alex.utils.system.webAudio,a);this.manifest=null,this.load=function(){var a=new alex.load.JsonLoader(e.manifestPath),b=this;a.addEventListener("loaded",function(a){var c=a.data;b.parseConfig.call(b,c),e.flow.next()}),a.load()},this.parseConfig=function(a){this.manifest=a,d?(e.jsonManifest=this.manifest.json_sd,e.imgManifest=this.manifest.img_sd,e.fontManifest=this.manifest.bm_font_sd):(e.jsonManifest=this.manifest.json_hd,e.imgManifest=this.manifest.img_hd,e.fontManifest=this.manifest.bm_font_hd),this.manifest.hasOwnProperty("json")&&(e.jsonManifest=e.jsonManifest.concat(this.manifest.json)),e.urls.storeLookup(e.jsonManifest),e.urls.storeLookup(e.imgManifest),e.urls.storeLookup(e.fontManifest),e.webAudioManifest=b(this.manifest.snd_webaudio),e.audioSpriteManifest=this.manifest.snd_sprite}},alex.load.JSONLoadState=function(a){function b(a,b){e.progressTracker.progressJSON=a/b,e.loadProgress()}function c(a){for(var b=a.meta.image,c=e.imgManifest,d=c.length,f=null,g=0;d>g;g++)if(f=c[g],f.id==b)return;var h={};h.src=alex.statics.IMG_DIR+b,alex.log("addImageToQueue: "+b),h.id=b,h.atlasData=a,c[c.length]=h}function d(a){for(var b=null,c=!0,d=a.length,e=0;d>e;e++)if(b=a[e],!b.loaded){c=!1;break}return c}var e=a;this.toString=function(){return"[JSONLoadState]"},this.load=function(){var a,f,g,h,i=e.jsonManifest,j=i.length,k=!1,l=0,m=this;for(a=0;j>a;a++)f=i[a],h=f.id,f.loaded=!1,g=new alex.load.JsonLoader(f.src,k),g.addEventListener("loaded",function(a){var f=e.urls.getAssetData(a.target.url);f.jsonData=a.target.jsonData,f.loaded=!0,l++,b.call(m,l,j),"atlas"==f.type?c.call(m,f.jsonData):"skeleton"==f.type,game_shell.json[f.id]=f.jsonData,d(i)&&e.flow.next()}),g.load()}},alex.load.ImageLoadState=function(a,b){function c(a,b){var c=new PIXI.BaseTexture(a,f),d=b.frames,e=null,g=0,h=null;if(Array.isArray(d)){var i=d.length,j=null,k=null;for(g=0;i>g;g++)k=d[g],h=k.frame,h&&(j=k.filename,e=new PIXI.Texture(c,{x:h.x,y:h.y,width:h.w,height:h.h}),PIXI.TextureCache[j]=e,k.trimmed&&(e.realSize=k.sourceSize,e.trim=new PIXI.Point,e.trim.x=0,e.trim.y=0))}else for(g in d)h=d[g].frame,h&&(e=new PIXI.Texture(c,{x:h.x,y:h.y,width:h.w,height:h.h}),PIXI.TextureCache[g]=e,d[g].trimmed&&(e.realSize=d[g].sourceSize,e.trim=new PIXI.Point,e.trim.x=0,e.trim.y=0))}function d(a,b){if(null!==a){var c=new PIXI.BaseTexture(a,f),d=new PIXI.Texture(c);PIXI.TextureCache[b]=d}}this.toString=function(){return"[ImageLoadState]"};var e=a,f=b||PIXI.scaleModes.DEFAULT;this.load=function(){var a=e.imgManifest;0===a.length?e.flow.next():(alex.load.imageLoader=new alex.load.ImageLoader,alex.load.imageLoader.addEventListener("loaded",function(a){var b=a.img,f=a.src,g=a.data;g.hasOwnProperty("atlasData")?c(b,g.atlasData):d(b,f),e.progressTracker.progressImages=a.progress,e.loadProgress()}),alex.load.imageLoader.addEventListener("progress",function(a){e.progressTracker.progressImages=a.progress,e.loadProgress()}),alex.load.imageLoader.addEventListener("complete",function(){e.flow.next()}),alex.load.imageLoader.load(a,!0))}},alex.load.AudioLoadState=function(a){var b=a;this.toString=function(){return"[AudioLoadState]"},this.load=function(){0===b.webAudioManifest.length?b.flow.next():(alex.audio.soundLoader.onLoadProgress=function(a){b.progressTracker.progressSounds=a,b.loadProgress()},alex.audio.soundLoader.onLoadComplete=function(){alex.audio.soundLoader.onLoadProgress=null,alex.audio.soundLoader.onLoadComplete=null,b.progressTracker.progressSounds=1,b.loadProgress(),b.flow.next()},alex.audio.soundLoader.load(b.webAudioManifest))}},alex.load.FontLoadState=function(a){var b=a;this.toString=function(){return"[FontLoadState]"},this.load=function(){var a=b.fontManifest,c=a.length;if(0===c)b.flow.next();else for(var d=0,e=null,f=null,g=!1,h=0;c>h;h++)f=a[h],e=new PIXI.BitmapFontLoader(f.src,g),e.addEventListener("loaded",function(){d++,b.progressTracker.progressFonts=d/c,b.loadProgress(),d===c&&b.flow.next()}),e.load()}},alex.load.BulkLoader=function(a){alex.utils.EventDispatcher.call(this),this.flow=new alex.load.LoadFlowManager(this,a),this.urls=new alex.utils.UrlLookup,this.load=function(a){this.manifestPath=a,this.flow.next()},this.progressTracker=new alex.load.ProgressTracker,this.loadProgress=function(){var a=this.progressTracker.overallProgress();this.dispatchEvent({type:"progress",value:a})},this.loadComplete=function(){alex.log("loadComplete"),this.flow.debug&&(this.flow.log+=this.progressTracker.debugLog()),this.dispatchEvent({type:"complete"})},this.toString=function(){return"[BulkLoader]"}},alex.load.BulkLoader.constructor=alex.load.BulkLoader,alex.load.BulkLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.LoadFlowManager=function(a,b){var c=alex.statics.WEB_AUDIO_ENABLED&&alex.utils.system.webAudio;this.owner=a,this.debug=!1,this.log="* LoadFlowManager \n\r",this.manifestLoad=new alex.load.ManifestLoadState(this.owner),this.jsonLoad=new alex.load.JSONLoadState(this.owner),this.imageLoad=new alex.load.ImageLoadState(this.owner,b),this.audioLoad=new alex.load.AudioLoadState(this.owner),this.fontLoad=new alex.load.FontLoadState(this.owner),this.currentState=null,this.next=function(){switch(this.debug&&(this.log+=null===this.currentState?" - next -> currentState = null \n\r":" - next -> currentState = "+this.currentState.toString()+" \n\r"),this.currentState){case null:this.currentState=this.manifestLoad;break;case this.manifestLoad:this.currentState=this.jsonLoad;break;case this.jsonLoad:this.currentState=this.imageLoad;break;case this.imageLoad:this.currentState=this.fontLoad;break;case this.fontLoad:this.currentState=c?this.audioLoad:null;break;case this.audioLoad:this.currentState=null}null!==this.currentState?this.currentState.load():this.owner.loadComplete()}},alex.utils.UrlLookup=function(){this.storeLookup=function(a){for(var b,c=a.length,d=0;c>d;d++)b=a[d],this[b.src]=b,this[b.id]=b},this.getAssetData=function(a){return this[a]},this.getURL=function(a){var b=this[a];return b?b.src:(alex.log("ERROR - no asset found for key  -> "+a),null)}},alex.load.ProgressTracker=function(){var a=alex.statics.WEB_AUDIO_ENABLED&&alex.utils.system.webAudio;this.progressJSON=0,this.progressImages=0,this.progressSounds=0,this.progressFonts=0,this.total=a?4:3,this.debugLog=function(){var a="* ProgressTracker: \n\r";return a+=" - total: "+this.total+" \n\r",a+=" - overall: "+this.totalProgress()+" \n\r",a+=" - progressJSON: "+this.progressJSON+" \n\r",a+=" - progressImages: "+this.progressImages+" \n\r",a+=" - progressSounds: "+this.progressSounds+" \n\r",a+=" - progressFonts: "+this.progressFonts+" \n\r"},this.totalProgress=function(){var b=this.progressJSON+this.progressImages+this.progressFonts;return a&&(b+=this.progressSounds),b},this.overallProgress=function(){var a=this.totalProgress();return a/this.total}},alex.load.JsonLoader=function(a,b){alex.utils.EventDispatcher.call(this),this.url=a,this.baseUrl=a.replace(/[^\/]*$/,""),this.texture=null,this.frames={},this.crossorigin=b,this.id},alex.load.JsonLoader.constructor=alex.load.JsonLoader,alex.load.JsonLoader.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.JsonLoader.prototype.load=function(){this.ajaxRequest=new PIXI.AjaxRequest;var a=this;this.ajaxRequest.onreadystatechange=function(){a.onJSONLoaded()},this.jsonData,this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},alex.load.JsonLoader.prototype.onJSONLoaded=function(){4==this.ajaxRequest.readyState&&(200==this.ajaxRequest.status||-1==window.location.href.indexOf("http"))&&(this.jsonData=eval("("+this.ajaxRequest.responseText+")"),this.dispatchEvent({type:"loaded",data:this.jsonData}))},alex.load.JsonQueue=function(){alex.utils.EventDispatcher.call(this),this.manifest,this.results={}},alex.load.JsonQueue.constructor=alex.load.JsonQueue,alex.load.JsonQueue.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.load.JsonQueue.prototype.loadFiles=function(a){this.manifest=a,this.boundCallback=this.onJsonLoaded.bind(this),this.loadNext()},alex.load.JsonQueue.prototype.loadNext=function(){if(this.manifest.length>0){var a=this.manifest.pop(),b=a.id,c=a.src;this.results[b]=null;var d=new alex.load.JsonLoader(c);d.id=b,d.addEventListener("loaded",this.boundCallback),d.load()}else this.dispatchEvent({type:"complete",results:this.results})},alex.load.JsonQueue.prototype.onJsonLoaded=function(a){var b=a.target,c=b.jsonData,d=b.id;this.results[d]=c,b.removeEventListeners(),this.dispatchEvent({type:"loaded",id:d,jsonData:c}),this.loadNext()},alex.audio.soundLoader=function(){function a(a){i||b(),g=g?g.concat(a):a,c()}function b(){window.AudioContext?i=new AudioContext:window.webkitAudioContext&&(i=new webkitAudioContext)}function c(){for(var a,b,d=g.length,e=0,f=0;d>f;f++){if(a=g[f],!j.hasOwnProperty(a.id)){b=a;break}e++}if(b){var m=new XMLHttpRequest;m.open("GET",b.src,!0),m.responseType="arraybuffer",k[b.id]="loading...",m.onload=function(){"function"==typeof i.decodeAudioData?i.decodeAudioData(m.response,function(a){b.soundData=a,j[b.id]=b,k[b.id]="success",l.onLoadProgress&&l.onLoadProgress(e/d),c()},function(){j[b.id]=null,k[b.id]="failed",l.onLoadProgress&&l.onLoadProgress(e/d),c()}):(200===m.status?(b.soundData=window.AudioContext?i.createBuffer(m.response,1,44100):i.createBuffer(m.response,!0),j[b.id]=b,k[b.id]="success"):(j[b.id]=null,k[b.id]="failed"),l.onLoadProgress&&l.onLoadProgress(e/d),c())},m.onerror=function(){h("SoundLoader: XHR error"),j[b.id]=null,k[b.id]="failed",l.onLoadProgress&&l.onLoadProgress(e/d),c()};try{m.send()}catch(n){h("SoundLoader: XHR error "+m.status)}}else g.length=0,l.onLoadComplete&&l.onLoadComplete()}function d(a){return j[a]}function e(){return j}function f(){return i}var g,h=function(a){console.log(a)},i=null,j=new Object,k=new Object,l={load:a,context:f,onLoadComplete:function(){},onLoadProgress:function(){},getAssets:e,getAsset:d,success:k};return l}(),alex.audio.SoundGroup=function(a){this.id=a,this.sounds=[],this.isMuted=!1,this.addSound=function(a){this.sounds[this.sounds.length]=a}},alex.audio.MusicLoop=function(a,b,c){function d(){var d=alex.utils.system.audioType;a+=d,this.audio=document.createElement("audio"),this.audio.preload="auto",this.audio.addEventListener("canplay",e.bind(this),!1),this.volume=b,this.audio.volume=b,this.audio.loop=!0;var f="boolean"==typeof(new Audio).loop;alex.log("loopingSupported: "+f),f||this.audio.addEventListener("ended",function(){alex.log("sound ended! "+this),this.currentTime=0,this.play()},!1),this.audio.autoplay=c,this.audio.src=a}function e(){alex.log("MusicLoop can play")}this.grp="music",d.call(this),this.start=function(){this.audio.play()},this.end=function(){this.audio.pause()},this.play=function(){},this.stop=function(){},this.stopAll=function(){},this.isMuted=!1,this.mute=function(a){this.isMuted=a,this.audio.muted=a,this.audio.volume=a?0:this.volume},this.muteGroup=function(a,b){a==this.grp&&this.mute(b)},this.isGroupMuted=function(a){return a==this.grp?this.isMuted:!1},this.isPaused=!0,this.pause=function(a){this.isPaused=a,this.isPaused?this.audio.pause():this.audio.play()},this.isPlaying=function(){return!this.isPaused},this.update=function(){},this.dispose=function(){null!==this.audio&&(this.audio.pause(),this.audio=null)}},alex.audio.SndSprite=function(a,b){function c(a){var b=new alex.audio.SoundGroup(a);return g[a]=b,b}function d(a){for(var b,c,d=a.length,e=[],f=0;d>f;f++)b=a[f],!b.hasOwnProperty("end")&&b.hasOwnProperty("duration")&&(b.end=b.start+b.duration),b.hasOwnProperty("grp")||(b.grp="sfx"),e[f]=b,c=g[b.grp],c.addSound(b);return e}function e(a){var b=alex.utils.system.audioType;a+=b;var c=document.createElement("audio");return c.preload="auto",c.autoplay=!0,c.addEventListener("canplay",f,!1),c.src=a,i=2.5,alex.utils.system.isIOS&&c.play(),c}function f(){k=!0,l.play()}var g={};c("sfx"),c("music");var h=d(b),i=-1,j=this;this.isMuted=!1,this.isGamePaused=!1;var k=!1,l=e(a);this.mute=function(a){j.isMuted=a,a&&j.stop()},this.muteGroup=function(a,b){var c=g[a];c.isMuted=b},this.isGroupMuted=function(a){var b=g[a];return b?b.isMuted:!1},this.pause=function(a){j.isGamePaused=a,a&&j.stop()},this.isPlaying=function(){return!l.paused},this.update=function(){i>-1&&l.currentTime>=i&&(l.pause(),i=-1,k=!0)},this.play=function(a){if(k){var b=l.duration;if(!(isNaN(b)||2>b)){if(j.isMuted)return void j.stop();if(!j.isGamePaused){for(var c,d=null,e=h.length,f=0;e>f;f++)if(c=h[f],c.id===a){d=c;break}if(null!==d){var m=d.grp,n=g[m];if(n.isMuted)return;i=d.end;try{l.paused||l.pause(),l.currentTime=d.start,l.play()}catch(o){i=-1}}}}}},this.stop=function(){l&&(l.pause(),i=-1)},this.stopAll=function(){l&&(l.pause(),i=-1)},this.dispose=function(){null!==l&&(l.pause(),i=-1,l=null)}},alex.audio.Channel=function(a,b,c,d,e){function f(){return g.createGainNode?g.createGainNode():g.createGain?g.createGain():null}alex.utils.EventDispatcher.call(this);var g=a;this.id=c;var h=g.createBufferSource(),i=this;e||(h.onended=function(){i.dispatchEvent({type:"complete"})}),h.buffer=b,h.loop=e===!0?!0:!1;var j=f();h.connect(j);var k=null;this.connect=function(a){j.connect(a),k=a},this.getGainNode=function(){return j};var l=1;void 0===d||1===d||(l=d,j.gain.value=d),this.play=function(){h.start?h.start(0):h.noteOn&&h.noteOn(0)},this.stop=function(){h.stop?h.stop(0):h.noteOff&&h.noteOff(0),h.disconnect(j)},this.fadeOut=function(a){var b=g.currentTime,c=0,d=void 0===a?1:a,e=b+d;return j.gain.linearRampToValueAtTime(l,b),j.gain.linearRampToValueAtTime(c,e),d},this.fadeIn=function(a,b){var c=g.currentTime,d=0;l=a;var e=void 0===b?1:b,f=c+e;j.gain.linearRampToValueAtTime(d,c),j.gain.linearRampToValueAtTime(a,f)},this.dispose=function(){this.removeEventListeners(),null!==g&&(i.stop(),h=null,j.disconnect(k),k=null,j=null,g=null,i=null)}},alex.audio.Channel.constructor=alex.audio.Channel,alex.audio.Channel.prototype=Object.create(alex.utils.EventDispatcher.prototype),Object.defineProperty(alex.audio.Channel.prototype,"volume",{get:function(){var a=this.getGainNode();return a.gain.value}}),alex.audio.WebAudioMgr=function(){function a(){var a=alex.audio.soundLoader.context();return"undefined"!=typeof a&&(a=h()),a}function b(a){this.id=a,this.node=g(),this.isMuted=!1,this.connect=function(a){this.node.connect(a)}}function c(a){var c=new b(a);return c.connect(m.node),n[a]=c,c}function d(a){return n[a]}function e(a){var b=a.target;f(b)}function f(a){var b=a.id;k[b]===a&&delete k[b],a.dispose(),a=null}function g(){return i.createGainNode?i.createGainNode():i.createGain?i.createGain():(l("gain node not created"),null)}function h(){var a;return window.AudioContext?a=new AudioContext:window.webkitAudioContext&&(a=new webkitAudioContext),a}var i=a();Object.defineProperty(b.prototype,"volume",{get:function(){return this.node.gain.value},set:function(a){this.node.gain.value=a}});var j={},k={},l=function(a){console.log(a)},m=new b("master");m.connect(i.destination);var n={};c("sfx"),c("music"),this.isGroupMuted=function(a){var b=d(a);return b?b.isMuted:!1},this.addSounds=function(a){var b,c;for(b in a)j.hasOwnProperty(b)||(c=a[b],null!==c.soundData&&(j[b]=c),c.hasOwnProperty("grp")||(c.grp="sfx"))},this.addSounds(alex.audio.soundLoader.getAssets()),this.update=function(){},this.mute=function(a){m.isMuted=a,m.volume=a?0:1},this.muteGroup=function(a,b){var c=d(a);c.volume=b?0:1,c.isMuted=b},this.muteAllGroups=function(a){for(var b in n)this.muteGroup(b,a)},this.pause=function(a){a?m.volume=0:m.isMuted||(m.volume=1)},this.play=function(a,b,c){var f=j[a],g=f.soundData;if(null!==g&&void 0!==g){var h=new alex.audio.Channel(i,g,a,b,c);h.addEventListener("complete",e);var l=d(f.grp);h.connect(l.node),k[a]=h,h.play()}},this.stop=function(a){if(k.hasOwnProperty(a)){var b=k[a];f(b)}},this.stopAll=function(){var a,b;for(a in k)b=k[a],f(b)},this.fadeOut=function(a,b){if(k.hasOwnProperty(a)){var c=k[a],d=void 0===b?1:b;c.fadeOut(b);var e=1e3*d;setTimeout(f,e,c)}},this.fadeIn=function(a,b,c){if(k.hasOwnProperty(a)){var d=k[a];if(d){var e=void 0===c?1:c,f=void 0===b?1:b;d.fadeIn(f,e)}}},this.wakeAudioSystem=function(){var a=i.createBuffer(1,1,22050),b=i.createBufferSource();b.buffer=a,b.connect(i.destination),b.play?b.play(0):b.noteOn&&b.noteOn(0)}},alex.audio.SndMgr=function(a,b){var c=this;this.snd=new alex.audio.SndNone,this.mode=-1,this.isMuted=alex.statics.MUTE_STATE,a&&b&&c.init(a,b),this.initWebAudio=function(){this.snd=new alex.audio.WebAudioMgr},this.prepare=function(){this.webAudio&&this.snd.wakeAudioSystem()},this.initAudioSprite=function(a,b){this.snd=new alex.audio.SndSprite(a,b)},this.checkReady=function(){return null!==this.snd},this.initNone=function(){this.snd=new alex.audio.SndNone},this.addSounds=function(a){this.webAudio&&this.snd.addSounds(a)},this.mute=function(a){c.isMuted=a,this.snd.mute(a)},this.muteGroup=function(a,b){this.snd.muteGroup(a,b)},this.isGroupMuted=function(a){return this.snd&&this.snd.isGroupMuted(a)},this.muteAllGroups=function(a){this.webAudio?this.snd.muteAllGroups(a):this.snd.mute(a)},this.pause=function(a){this.snd.pause(a)},this.play=function(a,b,c){this.snd.play(a,b,c)},this.stop=function(a){this.snd.stop(a)},this.stopAll=function(){this.snd.stopAll()},this.isPlaying=function(){return c.webAudio?!1:this.snd.isPlaying()},this.update=function(a){this.snd.update(a)},this.fadeOut=function(a,b){c.webAudio&&this.snd.fadeOut(a,b)},this.fadeIn=function(a,b){c.webAudio?this.snd.fadeIn(a,b):this.snd.play(a)}},Object.defineProperty(alex.audio.SndMgr.prototype,"isReady",{get:function(){return this.checkReady()},set:function(){}}),Object.defineProperty(alex.audio.SndMgr.prototype,"webAudio",{get:function(){return this.mode===alex.audio.AudioModes.WEB_AUDIO}}),alex.audio.AudioModes={NONE:0,WEB_AUDIO:1,AUDIO_SPRITE:2,MUSIC_LOOP:3},alex.audio.SndMgr.prototype.init=function(a,b){function c(){e.removeEventListener(g,c),f.prepare()}var d=alex.utils.system.isIOS;if(alex.statics.AUDIO_ENABLED?alex.statics.WEB_AUDIO_ENABLED&&alex.utils.system.webAudio?(this.mode=alex.audio.AudioModes.WEB_AUDIO,this.initWebAudio(),d||this.prepare()):(this.mode=alex.audio.AudioModes.AUDIO_SPRITE,this.initAudioSprite(a,b)):(this.mode=alex.audio.AudioModes.NONE,this.initNone()),d&&this.mode!==alex.audio.AudioModes.NONE){var e=game_shell.pixiStage.renderer.view,f=this,g="touchstart";e.addEventListener(g,c,!1)}return this.mode},alex.audio.SndNone=function(){this.mute=function(){},this.muteGroup=function(){},this.muteAllGroups=function(){},this.isGroupMuted=function(){return!0},this.pause=function(){},this.isPlaying=function(){return!1},this.update=function(){return!1},this.play=function(){},this.stop=function(){},this.stopAll=function(){},this.dispose=function(){}},function(){PIXI.MovieClip=function(a){PIXI.Sprite.call(this,a[0]),alex.utils.EventDispatcher.prototype.apply(this),this.textures=a,this.loop=!0,this.fps=25,this.onComplete=null,this.currentFrame=0,this.currentTime=0,this.playing=!1,this.duration=0,this.lastFrame=0,this.setDuration()},PIXI.MovieClip.prototype=Object.create(PIXI.Sprite.prototype),PIXI.MovieClip.prototype.constructor=PIXI.MovieClip,Object.defineProperty(PIXI.MovieClip.prototype,"totalFrames",{get:function(){return this.textures.length}}),PIXI.MovieClip.prototype.stop=function(){this.playing=!1},PIXI.MovieClip.prototype.play=function(){this.playing=!0},PIXI.MovieClip.prototype.updateTransform=function(){PIXI.Sprite.prototype.updateTransform.call(this)},PIXI.MovieClip.prototype.setDuration=function(){var a=this.textures.length;this.duration=1e3/this.fps*a,this.lastFrame=a-1},PIXI.MovieClip.prototype.update=function(a){if(this.playing){this.currentTime+=a,this.currentTime>this.duration&&(this.loop?this.currentTime-=this.duration:(this.currentTime=this.duration,this.stop(),this.isComplete=!0,this.onComplete(),this.dispatchEvent({type:"complete"})));var b=Math.floor(this.currentTime/this.duration*(this.lastFrame+1));b>this.lastFrame&&(b=this.lastFrame),this.currentFrame=b,this.setTexture(this.textures[this.currentFrame])}},PIXI.MovieClip.prototype.gotoAndStop=function(a){this.playing=!1,this.currentTime=a*(1e3/this.fps),this.currentFrame=a;var b=this.currentFrame+.5|0;this.setTexture(this.textures[b%this.textures.length])},PIXI.MovieClip.prototype.gotoAndPlay=function(a){this.currentFrame=a,this.currentTime=a*(1e3/this.fps),this.playing=!0}}(),alex.display.PixiStage=function(a,b,c){function d(){var a=this.renderer.view,b=document.getElementById("game");b.appendChild(a),a.style.top="0px",a.style.left="0px",a.style.marginLeft="auto",a.style.marginRight="auto",a.style.display="block"}"undefined"==typeof c&&(c=16763904),this.stage=new PIXI.Stage(c);var e=!1;this.renderer=alex.statics.WEB_GL_ENABLED?PIXI.autoDetectRecommendedRenderer(a,b,null,e):new PIXI.CanvasRenderer(a,b,null,e),this.content=new PIXI.DisplayObjectContainer,this.content.x=.5*a,this.stage.addChild(this.content),d.call(this),this.resize=function(a){var b=a.pixelWidth,c=a.pixelHeight,d=a.scale;this.renderer.resize(b,c),this.content.x=.5*b,this.content.scale.x=this.content.scale.y=d},this.draw=function(){this.renderer.render(this.stage)}},alex.display.Quad=function(a,b,c){PIXI.Graphics.call(this),"undefined"==typeof c&&(c=16711680),"undefined"==typeof b&&(b=100),"undefined"==typeof a&&(a=100),this.tint=c,this.beginFill(this.tint),this.drawRect(0,0,a,b),this.endFill(),this._width=a,this._height=b,this.hitArea=new PIXI.Rectangle(0,0,a,b)},alex.display.Quad.prototype.constructor=alex.display.Quad,alex.display.Quad.prototype=Object.create(PIXI.Graphics.prototype),Object.defineProperty(alex.display.Quad.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a,this.clear(),this.beginFill(this.tint),this.drawRect(0,0,this._width,this._height),this.endFill(),this.hitArea.width=a}}),Object.defineProperty(alex.display.Quad.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a,this.clear(),this.beginFill(this.tint),this.drawRect(0,0,this._width,this._height),this.endFill(),this.hitArea.height=a}}),alex.display.Circle=function(a,b){PIXI.Graphics.call(this),this.tint="undefined"!=typeof b?b:16711680,this.radius="undefined"!=typeof a?a:50},alex.display.Circle.prototype.constructor=alex.display.Circle,alex.display.Circle.prototype=Object.create(PIXI.Graphics.prototype),Object.defineProperty(alex.display.Quad.prototype,"radius",{get:function(){return this._radius},set:function(a){this._radius=a,this.clear(),this.beginFill(this.tint),this.drawCircle(0,0,this._radius),this.endFill()}}),PIXI.DisplayObject.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},alex.display.Button=function(a,b){var c=PIXI.TextureCache[a],d=PIXI.TextureCache[b];PIXI.Sprite.call(this,c),alex.utils.EventDispatcher.prototype.apply(this),this.interactive=!0,this.buttonMode=!0;var e=this.width,f=this.height;this.isEnabled=!0,this.mousedown=this.touchstart=function(){this.isPressed=!0,this.setTexture(d),this.dispatchEvent({type:"press"})},this.mouseup=this.touchend=this.mouseupoutside=this.touchendoutside=function(a){this.isPressed=!1,this.setTexture(c);var b=a.getLocalPosition(this),d=b.x,g=b.y;d>0&&e>d&&g>0&&f>g&&this.dispatchEvent({type:"release"})}},alex.display.Button.constructor=alex.display.Button,alex.display.Button.prototype=Object.create(PIXI.Sprite.prototype),Object.defineProperty(alex.display.Button.prototype,"enabled",{get:function(){return this.interactive},set:function(a){this.interactive=a,this.isEnabled=a,this.buttonMode=a}}),alex.display.MaskJpeg=function(a,b,c){var d=a,e=b,f=document.createElement("canvas");f.width=d.width,f.height=d.height;var g=f.getContext("2d");g.drawImage(d,0,0),g.globalCompositeOperation="xor",g.drawImage(e,0,0);var h=new Image;return c&&(h.onload=function(){c(h)}),h.src=f.toDataURL(),h},alex.display.Toggle=function(a,b,c){this.isOn=c===!1?!1:!0,this.txOn=PIXI.TextureCache[a],this.txOff=PIXI.TextureCache[b];var d=this.isOn?this.txOn:this.txOff;PIXI.Sprite.call(this,d),alex.utils.EventDispatcher.prototype.apply(this);var e=this.width,f=this.height;this.interactive=!0,this.buttonMode=!0,this.mousedown=this.touchstart=function(){this.isPressed=!0},this.mouseup=this.touchend=this.mouseupoutside=this.touchendoutside=function(a){this.isPressed=!1;var b=a.getLocalPosition(this),c=b.x,d=b.y;c>0&&e>c&&d>0&&f>d&&this.toggle()}},alex.display.Toggle.constructor=alex.display.Toggle,alex.display.Toggle.prototype=Object.create(alex.display.Button.prototype),alex.display.Toggle.prototype.toggle=function(){this.isOn=!this.isOn,this.setTexture(this.isOn?this.txOn:this.txOff);var a=this.isOn;this.dispatchEvent({type:"toggle",state:a})},alex.display.Toggle.prototype.setOff=function(){this.setTexture(this.txOff),this.isOn=!1},alex.display.Toggle.prototype.setOn=function(){this.setTexture(this.txOn),this.isOn=!0},Object.defineProperty(alex.display.Toggle.prototype,"enabled",{get:function(){return this.interactive},set:function(a){this.interactive=a,this.buttonMode=a}}),alex.display.Toggle.prototype.dispose=function(){this.txOff=null,this.txOn=null},alex.screens.ScreenBase=function(){PIXI.DisplayObjectContainer.call(this),alex.utils.EventDispatcher.prototype.apply(this),this.screenW=alex.statics.STAGE_W,this.screenH=alex.statics.STAGE_H,this.defaultW=alex.statics.DEFAULT_W,this.scaleFactor=alex.statics.SCALE_FACTOR,this.delayedAction=new alex.utils.DelayedAction,this.updateItems=[this.delayedAction],this.toString=function(){return"[ScreenBase]"}},alex.screens.ScreenBase.constructor=alex.screens.ScreenBase,alex.screens.ScreenBase.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),alex.screens.ScreenBase.prototype.run=function(){},alex.screens.ScreenBase.prototype.delay=function(a,b){this.delayedAction.delay(a,b)},alex.screens.ScreenBase.prototype.dispose=function(){this.parent&&this.parent.removeChild(this),this.updateItems.length=0},alex.screens.ScreenBase.prototype.update=function(a){for(var b,c=this.updateItems.length,d=c-1;d>-1;d--)b=this.updateItems[d],b.update(a)},alex.screens.ScreenBase.prototype.addUpdateItem=function(a){-1===this.updateItems.indexOf(a)&&(this.updateItems[this.updateItems.length]=a)},alex.screens.ScreenBase.prototype.removeUpdateItem=function(a){var b=this.updateItems.indexOf(a);b>-1&&this.updateItems.splice(b,1)},alex.screens.ScreenBase.prototype.resize=function(a,b){this.screenW=a,this.screenH=b},alex.screens.ScreenBase.prototype.newScreen=function(a){game_shell.eventQueue.queueEvent({type:alex.events.NEW_SCREEN,screenId:a})},alex.screens.ScreenMgr=function(){this.currentScreen=null,this.pixiStage=null,this.init=function(a){this.pixiStage=a;var b=this;game_shell.eventQueue.addEventListener(alex.events.NEW_SCREEN,function(a){var c=a.screenId;b.showScreen(c)})},this.resize=function(a){if(null!==this.currentScreen){var b=a.pointWidth,c=a.pointHeight;this.currentScreen.resize(b,c)}},this.showScreen=function(a){alex.log("ScreenMgr showScreen : "+a),this.disposeScreen(),this.currentScreen=this.createScreen(a),this.pixiStage.content.addChild(this.currentScreen),this.currentScreen.run()
},this.createScreen=function(){return null},this.update=function(a){this.currentScreen.update(a)},this.disposeScreen=function(){null!==this.currentScreen&&(this.currentScreen.dispose(),this.currentScreen=null)}},alex.screens.ScreenMgr.constructor=alex.screens.ScreenMgr,alex.screens.ScreenMgr.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.ui.LoadBar=function(a,b,c,d){PIXI.DisplayObjectContainer.call(this),this.fullW=a;var e=alex.statics.SCALE_FACTOR,f=c||0,g=new PIXI.Graphics;g.beginFill(f,1);var h=5*e,i=.5*h;g.lineStyle(h,16777215,1),g.drawRect(-i,-i,a+h,b+h),g.endFill(),this.addChild(g);var j=d||13408512,k=new alex.display.Quad(a,b,j);this.progress=function(a){k.width=a*this.fullW},this.progress(0),this.addChild(k);var l=new PIXI.Graphics;l.beginFill(f,0);var h=5*e,i=.5*h;l.lineStyle(h,16777215,1),l.moveTo(0,0),l.lineTo(a,0),l.lineTo(a,b),l.lineTo(0,b),l.lineTo(0,0),l.endFill(),this.addChild(l)},alex.ui.LoadBar.constructor=alex.ui.LoadBar,alex.ui.LoadBar.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),alex.ui.PopupBase=function(){PIXI.DisplayObjectContainer.call(this),alex.utils.EventDispatcher.prototype.apply(this),this.quadAlpha=.5,this.fadeTime=250,this.tweenTime=750,this.minScale=.001,this.bgQuad=this.createQuad(),this.content=this.createContentHolder(),this.states={HIDDEN:0,OPENING:1,SHOWN:2,CLOSING:3},this.state=this.states.HIDDEN},alex.ui.PopupBase.constructor=alex.ui.PopupBase,alex.ui.PopupBase.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),alex.ui.PopupBase.prototype.createQuad=function(){var a=alex.statics.DEFAULT_W+2,b=alex.statics.DEFAULT_H,c=new alex.display.Quad(a,b,0);return c.alpha=0,this.addChild(c),c},alex.ui.PopupBase.prototype.createContentHolder=function(){var a=alex.statics.STAGE_W,b=alex.statics.STAGE_H,c=new PIXI.DisplayObjectContainer;return c.x=.5*a,c.y=.5*b,this.addChild(c),c},alex.ui.PopupBase.prototype.show=function(){this.state===this.states.HIDDEN&&(this.state=this.states.OPENING,this.bgQuad.alpha=0,this.content.scale.x=this.minScale,this.content.scale.y=this.minScale,this.fadeInQuad(),this.tweenInContent())},alex.ui.PopupBase.prototype.fadeInQuad=function(){var a={a:0},b={a:this.quadAlpha},c=new TWEEN.Tween(a);c.to(b,this.fadeTime);var d=this;c.onUpdate(function(){d.bgQuad.alpha=this.a}),c.start()},alex.ui.PopupBase.prototype.tweenInContent=function(){var a=this,b={scale:this.minScale},c={scale:1},d=new TWEEN.Tween(b);d.to(c,this.tweenTime),d.easing(TWEEN.Easing.Back.Out),d.onUpdate(function(){a.content.scale.x=this.scale,a.content.scale.y=this.scale}),d.onComplete(function(){a.state=a.states.SHOWN,a.onShown()}),d.start()},alex.ui.PopupBase.prototype.onShown=function(){this.dispatchEvent({type:"open"})},alex.ui.PopupBase.prototype.hide=function(){this.state!==this.states.CLOSING&&(this.state=this.states.CLOSING,this.fadeOutQuad(),this.tweenOutContent())},alex.ui.PopupBase.prototype.fadeOutQuad=function(){var a={a:this.bgQuad.alpha},b={a:0},c=new TWEEN.Tween(a);c.to(b,this.fadeTime);var d=this;c.onUpdate(function(){d.bgQuad.alpha=this.a}),c.start()},alex.ui.PopupBase.prototype.tweenOutContent=function(){var a=this,b={scale:this.content.scale.x},c={scale:this.minScale},d=new TWEEN.Tween(b);d.to(c,this.tweenTime),d.easing(TWEEN.Easing.Back.In),d.onUpdate(function(){a.content.scale.x=this.scale,a.content.scale.y=this.scale}),d.onComplete(function(){a.state=a.states.HIDDEN,a.onHidden()}),d.start()},alex.ui.PopupBase.prototype.onHidden=function(){this.parent&&this.parent.removeChild(this),this.dispatchEvent({type:"close"})},Object.defineProperty(alex.ui.PopupBase.prototype,"isShown",{get:function(){var a=this.state===this.states.SHOWN,b=this.state===this.states.OPENING;return a||b}}),alex.motion.Wiggle=function(a,b){alex.utils.EventDispatcher.call(this),this.img=a,void 0==b&&(b=.15),this.maxR=Math.PI*b,this.speed=.017,this.counter=0,this.duration=30},alex.motion.Wiggle.constructor=alex.motion.Wiggle,alex.motion.Wiggle.prototype=Object.create(alex.utils.EventDispatcher.prototype),alex.motion.Wiggle.prototype.startWiggle=function(){this.counter=0},alex.motion.Wiggle.prototype.wiggle=function(a){this.counter+=this.speed*a;var b=Math.sin(this.counter);this.img.rotation=b*this.maxR},alex.motion.Twanger=function(a,b){alex.motion.Wiggle.call(this,a,b),this.baseR=a.rotation,this.scale=1,this.decay=.95,this.MAX_R=.349,this.maxR=0,this.minR=.017},alex.motion.Twanger.constructor=alex.motion.Twanger,alex.motion.Twanger.prototype=Object.create(alex.motion.Wiggle.prototype),alex.motion.Twanger.prototype.start=function(){this.maxR=this.MAX_R},Object.defineProperty(alex.motion.Twanger.prototype,"isTwanging",{get:function(){return this.maxR>0},set:function(){}}),alex.motion.Twanger.prototype.update=function(a){var b=!1;return this.maxR>this.minR&&(this.wiggle(a),this.maxR*=this.decay,this.maxR<1e-5&&(this.stopTwang(),this.dispatchEvent({type:"complete"})),b=!0),b},alex.motion.Twanger.prototype.wiggle=function(a){this.counter+=this.speed*a;var b=Math.sin(this.counter),c=this.baseR-b*this.maxR;this.img.rotation=c*this.scale},alex.motion.Twanger.prototype.stopTwang=function(){this.maxR=0,this.img.rotation=this.baseR},alex.motion.Oscillator=function(){var a=0,b=5e-4,c=5e-4;this.x=0,this.y=0,this.randomise=function(){b=5e-4+.001*Math.random(),c=5e-4+.001*Math.random()},this.update=function(d){a+=d,this.x=Math.cos(a*b),this.y=Math.sin(a*c)}};var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},dragonBones;!function(a){!function(a){var b=function(){function a(){}return a.prototype.getVisible=function(){return this._display?this._display.visible:!1},a.prototype.setVisible=function(a){this._display&&(this._display.visible=a)},a.prototype.getDisplay=function(){return this._display},a.prototype.setDisplay=function(a){if(this._display!=a){var b=-1;if(this._display){var c=this._display.parent;c&&(b=this._display.parent.children.indexOf(this._display)),this.removeDisplay()}this._display=a,this.addDisplay(c,b)}},a.prototype.dispose=function(){this._display=null},a.prototype.updateTransform=function(a,b){this._display.x=a.tx,this._display.y=a.ty,this._display.rotation=b.skewX,this._display.scale.x=b.scaleX,this._display.scale.y=b.scaleY},a.prototype.updateColor=function(a,b,c,d,e){this._display&&(this._display.alpha=e)},a.prototype.addDisplay=function(a,b){var c=a;c&&this._display&&(0>b?c.addChild(this._display):c.addChildAt(this._display,Math.min(b,c.children.length)))},a.prototype.removeDisplay=function(){this._display&&this._display.parent&&this._display.parent.removeChild(this._display)},a.RADIAN_TO_ANGLE=180/Math.PI,a}();a.PixiDisplayBridge=b}(a.display||(a.display={}));var b=a.display;!function(b){var c=function(){function b(a,b,c){"undefined"==typeof c&&(c=1),this._regions={},this.image=a,this.scale=c,this.parseData(b)}return b.prototype.dispose=function(){this.image=null,this._regions=null},b.prototype.getRegion=function(a){return this._regions[a]},b.prototype.parseData=function(b){var c=a.objects.DataParser.parseTextureAtlasData(b,this.scale);this.name=c.__name,delete c.__name;for(var d in c)this._regions[d]=c[d]},b}();b.PixiTextureAtlas=c}(a.textures||(a.textures={}));a.textures;!function(c){var d=function(c){function d(){c.call(this)}return __extends(d,c),d.prototype._generateArmature=function(){var b=new a.Armature(new PIXI.DisplayObjectContainer);return b},d.prototype._generateSlot=function(){var c=new a.Slot(new b.PixiDisplayBridge);return c},d.prototype._generateDisplay=function(a,b,c,d){var e=PIXI.Texture.fromFrame(b+".png"),f=new PIXI.Sprite(e);return f.pivot.x=c,f.pivot.y=d,f},d}(c.BaseFactory);c.PixiFactory=d}(a.factorys||(a.factorys={}));a.factorys}(dragonBones||(dragonBones={})),dragonBones.parseJSONAtlas=function(a,b,c){function d(a,b){var c=a.frame,d={name:b};d.x=c.x,d.y=c.y,d.width=c.w,d.height=c.h,e.SubTexture[n]=d}var e={};e.name=b,e.SubTexture=[];var f=c.length,g=a.frames,h=Array.isArray(g),i=0;h&&(i=g.length);for(var j,k,l,m,n=0;f>n;n++)if(j=c[n],m=null!==j.match(/.png/i),m?(l=j,j=l.substr(-4)):l=j+".png",h){for(var o=0;i>o;o++)if(k=g[o],k.filename==l){d(k,j);break}}else for(var p in g)if(p==l){d(g[p],j);break}return e},dragonBones.makeArmaturePIXI=function(a,b,c,d){var e=a.skeletonId,f=a.armatureName,g=a.animationId,h=a.partsList,i=dragonBones.parseJSONAtlas(c,e,h),j=new dragonBones.factorys.PixiFactory;j.addSkeletonData(dragonBones.objects.DataParser.parseSkeletonData(b));var k=new dragonBones.textures.PixiTextureAtlas(d,i);j.addTextureAtlas(k);var l=j.buildArmature(f,g,e);return dragonBones.animation.WorldClock.clock.add(l),l.animation.gotoAndPlay(g,.2),l},function(a,b){function c(a,b,d,e){c._super_.call(this),this.reset(a,b,d,e)}function d(a,b,c,e){d._super_.call(this),this.x=a,this.y=b,this.width=c,this.height=e}function e(a,b){e._super_.call(this),this.x=a,this.y=b}function f(a,b,c){f._super_.call(this),this.x=a,this.y=b,this.radius=c,this.angle=0,this.center={x:this.x,y:this.y}}function g(a,b,c,d,e){g._super_.call(this),c-a>=0?(this.x1=a,this.y1=b,this.x2=c,this.y2=d):(this.x1=c,this.y1=d,this.x2=a,this.y2=b),this.dx=this.x2-this.x1,this.dy=this.y2-this.y1,this.minx=Math.min(this.x1,this.x2),this.miny=Math.min(this.y1,this.y2),this.maxx=Math.max(this.x1,this.x2),this.maxy=Math.max(this.y1,this.y2),this.dot=this.x2*this.y1-this.x1*this.y2,this.xxyy=this.dx*this.dx+this.dy*this.dy,this.gradient=this.getGradient(),this.length=this.getLength(),this.direction=V.Util.initValue(e,">")}function h(){this.vector=new V.Vector2D(0,0),this.random=0,this.crossType="dead",this.alert=!0}function i(a,b){i._super_.call(this,a,b),this.gl=this.element.getContext("experimental-webgl",{antialias:!0,stencil:!1,depth:!1}),this.gl||alert("Sorry your browser do not suppest WebGL!"),this.initVar(),this.setMaxRadius(),this.initShaders(),this.initBuffers(),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND)}function j(a,b,c){j._super_.call(this,a,b),this.context=this.element.getContext("2d"),this.imageData=null,this.rectangle=null,this.rectangle=c,this.createImageData(c)}function k(a,b){k._super_.call(this,a,b),this.stroke=null,this.context=this.element.getContext("2d"),this.bufferCache={}}function l(a,b,c){l._super_.call(this,a,b),this.stroke=c}function m(a,b){m._super_.call(this,a,b),this.stroke=null}function n(a,b,c){this.proton=a,this.element=b,this.stroke=c}function o(a,b,c){this.element=c,this.type=V.Util.initValue(a,"canvas"),this.proton=b,this.renderer=this.getRenderer()}function p(b,c,d){this.mouseTarget=V.Util.initValue(b,a),this.ease=V.Util.initValue(c,.7),this._allowEmitting=!1,this.initEventHandler(),p._super_.call(this,d)}function q(a){this.selfBehaviours=[],q._super_.call(this,a)}function r(a){this.initializes=[],this.particles=[],this.behaviours=[],this.emitTime=0,this.emitTotalTimes=-1,this.damping=.006,this.bindEmitter=!0,this.rate=new V.Rate(1,.1),r._super_.call(this,a),this.id="emitter_"+r.ID++}function s(a,b,c,d){s._super_.call(this,c,d),this.distanceVec=new V.Vector2D,this.centerPoint=V.Util.initValue(a,new V.Vector2D),this.force=V.Util.initValue(this.normalizeValue(b),100),this.name="GravityWell"}function t(a,b,c,d){t._super_.call(this,c,d),this.reset(a,b),this.name="Color"}function u(a,b,c,d,e){u._super_.call(this,d,e),this.reset(a,b,c),this.name="Rotate"}function v(a,b,c,d){v._super_.call(this,c,d),this.reset(a,b),this.name="Scale"}function w(a,b,c,d){w._super_.call(this,c,d),this.reset(a,b),this.name="Alpha"}function x(a,b,c,d){x._super_.call(this,c,d),this.reset(a,b),this.name="CrossZone"}function y(a,b,c,d,e){y._super_.call(this,d,e),this.reset(a,b,c),this.name="Collision"}function z(a,b,c){z._super_.call(this,0,a,b,c),this.name="Gravity"}function A(a,b,c,d,e){A._super_.call(this,a,b,c,d,e),this.force*=-1,this.name="Repulsion"}function B(a,b,c,d,e){B._super_.call(this,d,e),this.reset(a,b,c),this.time=0,this.name="RandomDrift"}function C(a,b,c,d,e){C._super_.call(this,d,e),this.targetPosition=V.Util.initValue(a,new V.Vector2D),this.radius=V.Util.initValue(c,1e3),this.force=V.Util.initValue(this.normalizeValue(b),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new V.Vector2D,this.lengthSq=0,this.name="Attraction"}function D(a,b,c,d){D._super_.call(this,c,d),this.force=this.normalizeForce(new V.Vector2D(a,b)),this.name="Force"}function E(a,b,c){E._super_.call(this),this.image=this.setSpanValue(a),this.w=V.Util.initValue(b,20),this.h=V.Util.initValue(c,this.w)}function F(a,b,c){F._super_.call(this),this.radius=V.Util.setSpanValue(a,b,c)}function G(a,b,c){G._super_.call(this),this.massPan=V.Util.setSpanValue(a,b,c)}function H(a,b,c){H._super_.call(this),this.rPan=V.Util.setSpanValue(a),this.thaPan=V.Util.setSpanValue(b),this.type=V.Util.initValue(c,"vector")}function I(a){I._super_.call(this),this.zone=V.Util.initValue(a,new V.PointZone)}function J(a,b,c){J._super_.call(this),this.lifePan=V.Util.setSpanValue(a,b,c)}function K(){}function L(a,b){this.numPan=V.Util.initValue(a,1),this.timePan=V.Util.initValue(b,1),this.numPan=V.Util.setSpanValue(this.numPan),this.timePan=V.Util.setSpanValue(this.timePan),this.startTime=0,this.nextTime=0,this.init()}function M(a,b){this.id="Behaviour_"+M.id++,this.life=V.Util.initValue(a,1/0),this.easing=V.ease.setEasingByName(b),this.age=0,this.energy=1,this.dead=!1,this.parents=[],this.name="Behaviour"}function N(a,b,c,d){this.x=a,this.y=b,this.width=c,this.height=d,this.bottom=this.y+this.height,this.right=this.x+this.width}function O(a){this.colorArr=V.Util.isArray(a)?a:[a]}function P(a,b,c){this.isArray=!1,V.Util.isArray(a)?(this.isArray=!0,this.a=a):(this.a=V.Util.initValue(a,1),this.b=V.Util.initValue(b,this.a),this.center=V.Util.initValue(c,!1))}function Q(a,b){this.proParticleCount=V.Util.initValue(a,0),this.releaseTime=V.Util.initValue(b,-1),this.poolList=[],this.timeoutID=0;for(var c=0;c<this.proParticleCount;c++)this.add();this.releaseTime>0&&(this.timeoutID=setTimeout(this.release,this.releaseTime/1e3))}function R(a){this.id="particle_"+R.ID++,this.reset(!0),V.Util.setPrototypeByObject(this,a)}function S(){this.mats=[],this.size=0;for(var a=0;20>a;a++)this.mats.push(V.Mat3.create([0,0,0,0,0,0,0,0,0]))}function T(a){this.type="null",this.particle=null,this.emitter=null,this.particles=[],V.Util.setPrototypeByObject(this,a)}function U(){this.initialize()}function V(a,b){this.proParticleCount=V.Util.initValue(a,V.POOL_MAX),this.integrationType=V.Util.initValue(b,V.EULER),this.emitters=[],this.renderers=[],this.time=0,this.oldTime=0,V.pool=new V.ParticlePool(this.proParticleCount),V.integrator=new V.NumericalIntegration(this.integrationType)}V.POOL_MAX=1e3,V.TIME_STEP=60,V.MEASURE=100,V.EULER="euler",V.RK2="runge-kutta2",V.RK4="runge-kutta4",V.VERLET="verlet",V.PARTICLE_CREATED="partilcleCreated",V.PARTICLE_UPDATE="partilcleUpdate",V.PARTICLE_SLEEP="particleSleep",V.PARTICLE_DEAD="partilcleDead",V.PROTON_UPDATE="protonUpdate",V.PROTON_UPDATE_AFTER="protonUpdateAfter",V.EMITTER_ADDED="emitterAdded",V.EMITTER_REMOVED="emitterRemoved",V.amendChangeTabsBug=!0,V.TextureBuffer={},V.TextureCanvasBuffer={},V.prototype={addRender:function(a){a.proton=this,this.renderers.push(a.proton)},addEmitter:function(a){this.emitters.push(a),a.parent=this,this.dispatchEvent(new V.Event({type:V.EMITTER_ADDED,emitter:a}))},removeEmitter:function(a){var b=this.emitters.indexOf(a);this.emitters.splice(b,1),a.parent=null,this.dispatchEvent(new V.Event({type:V.EMITTER_REMOVED,emitter:a}))},update:function(){this.dispatchEvent(new V.Event({type:V.PROTON_UPDATE})),this.oldTime||(this.oldTime=(new Date).getTime());var a=(new Date).getTime();if(this.elapsed=(a-this.oldTime)/1e3,V.amendChangeTabsBug&&this.amendChangeTabsBug(),this.oldTime=a,this.elapsed>0)for(var b=0;b<this.emitters.length;b++)this.emitters[b].update(this.elapsed);this.dispatchEvent(new V.Event({type:V.PROTON_UPDATE_AFTER}))},amendChangeTabsBug:function(){this.elapsed>.5&&(this.oldTime=(new Date).getTime(),this.elapsed=0)},getParticleNumber:function(){for(var a=0,b=0;b<this.emitters.length;b++)a+=this.emitters[b].particles.length;return a},destory:function(){for(var a=0;a<this.emitters.length;a++)this.emitters[a].destory(),delete this.emitters[a];this.emitters=[],this.time=0,this.oldTime=0,V.pool.release()}},a.Proton=V;var W=U.prototype;U.initialize=function(a){a.addEventListener=W.addEventListener,a.removeEventListener=W.removeEventListener,a.removeAllEventListeners=W.removeAllEventListeners,a.hasEventListener=W.hasEventListener,a.dispatchEvent=W.dispatchEvent},W._listeners=null,W.initialize=function(){},W.addEventListener=function(a,b){var c=this._listeners;c?this.removeEventListener(a,b):c=this._listeners={};var d=c[a];return d||(d=c[a]=[]),d.push(b),b},W.removeEventListener=function(a,b){var c=this._listeners;if(c){var d=c[a];if(!d)return;for(var e=0,f=d.length;f>e;e++)if(d[e]==b){1==f?delete c[a]:d.splice(e,1);break}}},W.removeAllEventListeners=function(a){a?this._listeners&&delete this._listeners[a]:this._listeners=null},W.dispatchEvent=function(a,b){var c=!1,d=this._listeners;if(a&&d){"string"==typeof a&&(a={type:a});var e=d[a.type];if(!e)return c;a.target=b||this,e=e.slice();for(var f=0,g=e.length;g>f;f++){var h=e[f];c=h.handleEvent?c||h.handleEvent(a):c||h(a)}}return!!c},W.hasEventListener=function(a){var b=this._listeners;return!!b&&!!b[a]},V.EventDispatcher=U,V.EventDispatcher.initialize(V.prototype),T.PARTICLE_CREATED=V.PARTICLE_CREATED,T.PARTICLE_UPDATA=V.PARTICLE_UPDATA,T.PARTICLE_SLEEP=V.PARTICLE_SLEEP,T.PARTICLE_DEAD=V.PARTICLE_DEAD,V.Event=T;var X=X||{initValue:function(a,c){var a=null!=a&&a!=b?a:c;return a},isArray:function(a){return"object"==typeof a&&a.hasOwnProperty("length")},destroyArray:function(a){a.length=0},destroyObject:function(a){for(var b in a)delete a[b]},getVector2D:function(a,b){if("object"==typeof a)return a;var c=new V.Vector2D(a,b);return c},judgeVector2D:function(a){var b="";return(a.hasOwnProperty("x")||a.hasOwnProperty("y")||a.hasOwnProperty("p")||a.hasOwnProperty("position"))&&(b+="p"),(a.hasOwnProperty("vx")||a.hasOwnProperty("vx")||a.hasOwnProperty("v")||a.hasOwnProperty("velocity"))&&(b+="v"),(a.hasOwnProperty("ax")||a.hasOwnProperty("ax")||a.hasOwnProperty("a")||a.hasOwnProperty("accelerate"))&&(b+="a"),b},setVector2DByObject:function(a,b){b.hasOwnProperty("x")&&(a.p.x=b.x),b.hasOwnProperty("y")&&(a.p.y=b.y),b.hasOwnProperty("vx")&&(a.v.x=b.vx),b.hasOwnProperty("vy")&&(a.v.y=b.vy),b.hasOwnProperty("ax")&&(a.a.x=b.ax),b.hasOwnProperty("ay")&&(a.a.y=b.ay),b.hasOwnProperty("p")&&particle.p.copy(b.p),b.hasOwnProperty("v")&&particle.v.copy(b.v),b.hasOwnProperty("a")&&particle.a.copy(b.a),b.hasOwnProperty("position")&&particle.p.copy(b.position),b.hasOwnProperty("velocity")&&particle.v.copy(b.velocity),b.hasOwnProperty("accelerate")&&particle.a.copy(b.accelerate)},addPrototypeByObject:function(a,b,c){for(var d in b)c?c.indexOf(d)<0&&(a[d]=V.Util.getSpanValue(b[d])):a[d]=V.Util.getSpanValue(b[d]);return a},setPrototypeByObject:function(a,b,c){for(var d in b)a.hasOwnProperty(d)&&(c?c.indexOf(d)<0&&(a[d]=V.Util.getSpanValue(b[d])):a[d]=V.Util.getSpanValue(b[d]));return a},setSpanValue:function(a,b,c){return a instanceof V.Span?a:b?c?new V.Span(a,b,c):new V.Span(a,b):new V.Span(a)},getSpanValue:function(a){return a instanceof V.Span?a.getValue():a},inherits:function(a,b){if(a._super_=b,Object.create)a.prototype=Object.create(b.prototype,{constructor:{value:b}});else{var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},getImageData:function(a,b,c){a.drawImage(b,c.x,c.y);var d=a.getImageData(c.x,c.y,c.width,c.height);return a.clearRect(c.x,c.y,c.width,c.height),d},getImage:function(a,b,c,d){"string"==typeof a?this.loadAndSetImage(a,b,c,d):"object"==typeof a?this.loadAndSetImage(a.src,b,c,d):a instanceof Image&&this.loadedImage(a.src,b,c,d,a)},loadedImage:function(a,b,c,d,e){if(b.target=e,b.transform.src=a,V.TextureBuffer[a]||(V.TextureBuffer[a]=b.target),c)if(V.TextureCanvasBuffer[a])b.transform.canvas=V.TextureCanvasBuffer[a];else{var f=V.WebGLUtil.nhpot(b.target.width),g=V.WebGLUtil.nhpot(b.target.height);b.transform.canvas=V.DomUtil.createCanvas("canvas"+a,f,g);var h=b.transform.canvas.getContext("2d");h.drawImage(b.target,0,0,b.target.width,b.target.height),V.TextureCanvasBuffer[a]=b.transform.canvas}d&&d(b)},loadAndSetImage:function(a,b,c,d){if(V.TextureBuffer[a])this.loadedImage(a,b,c,d,V.TextureBuffer[a]);else{var e=this,f=new Image;f.onload=function(f){e.loadedImage(a,b,c,d,f.target)},f.src=a}},hexToRGB:function(a){var b="#"==a.charAt(0)?a.substring(1,7):a,c=parseInt(b.substring(0,2),16),d=parseInt(b.substring(2,4),16),e=parseInt(b.substring(4,6),16);return{r:c,g:d,b:e}},rgbToHex:function(a){return"rgb("+a.r+", "+a.g+", "+a.b+")"}};V.Util=X;var Y=Y||{ipot:function(a){return 0==(a&a-1)},nhpot:function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1},makeTranslation:function(a,b){return[1,0,0,0,1,0,a,b,1]},makeRotation:function(a){var b=Math.cos(a),c=Math.sin(a);return[b,-c,0,c,b,0,0,0,1]},makeScale:function(a,b){return[a,0,0,0,b,0,0,0,1]},matrixMultiply:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=b[0],m=b[1],n=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=b[8];return[c*l+d*o+e*r,c*m+d*p+e*s,c*n+d*q+e*t,f*l+g*o+h*r,f*m+g*p+h*s,f*n+g*q+h*t,i*l+j*o+k*r,i*m+j*p+k*s,i*n+j*q+k*t]}};V.WebGLUtil=Y;var Z=Z||{createCanvas:function(a,b,c,d){var e=document.createElement("canvas"),f=d?d:"absolute";return e.id=a,e.width=b,e.height=c,e.style.position=f,e.style.opacity=0,this.transformDom(e,-500,-500,0,0),e},transformDom:function(a,b,c,d,e){a.style.WebkitTransform="translate("+b+"px, "+c+"px) scale("+d+") rotate("+e+"deg)",a.style.MozTransform="translate("+b+"px, "+c+"px) scale("+d+") rotate("+e+"deg)",a.style.OTransform="translate("+b+"px, "+c+"px) scale("+d+") rotate("+e+"deg)",a.style.msTransform="translate("+b+"px, "+c+"px) scale("+d+") rotate("+e+"deg)",a.style.transform="translate("+b+"px, "+c+"px) scale("+d+") rotate("+e+"deg)"}};V.DomUtil=Z,S.prototype.set=function(a,b){0==b?V.Mat3.set(a,this.mats[0]):V.Mat3.multiply(this.mats[b-1],a,this.mats[b]),this.size=Math.max(this.size,b+1)},S.prototype.push=function(a){0==this.size?V.Mat3.set(a,this.mats[0]):V.Mat3.multiply(this.mats[this.size-1],a,this.mats[this.size]),this.size++},S.prototype.pop=function(){this.size>0&&this.size--},S.prototype.top=function(){return this.mats[this.size-1]},V.MStack=S,R.ID=0,R.prototype={getDirection:function(){return Math.atan2(this.v.x,-this.v.y)*(180/Math.PI)},reset:function(a){return this.life=1/0,this.age=0,this.energy=1,this.dead=!1,this.sleep=!1,this.target=null,this.sprite=null,this.parent=null,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.rotation=0,this.color=null,this.easing=V.ease.setEasingByName(V.easeLinear),a?(this.transform={},this.p=new V.Vector2D,this.v=new V.Vector2D,this.a=new V.Vector2D,this.old={p:new V.Vector2D,v:new V.Vector2D,a:new V.Vector2D},this.behaviours=[]):(V.Util.destroyObject(this.transform),this.p.set(0,0),this.v.set(0,0),this.a.set(0,0),this.old.p.set(0,0),this.old.v.set(0,0),this.old.a.set(0,0),this.removeAllBehaviours()),this.transform.rgb={r:255,g:255,b:255},this},update:function(a,b){if(!this.sleep){this.age+=a;var c,d=this.behaviours.length;for(c=0;d>c;c++)this.behaviours[c]&&this.behaviours[c].applyBehaviour(this,a,b)}if(this.age>=this.life)this.destory();else{var e=this.easing(this.age/this.life);this.energy=Math.max(1-e,0)}},addBehaviour:function(a){this.behaviours.push(a),a.hasOwnProperty("parents")&&a.parents.push(this),a.initialize(this)},addBehaviours:function(a){var b,c=a.length;for(b=0;c>b;b++)this.addBehaviour(a[b])},removeBehaviour:function(a){var b=this.behaviours.indexOf(a);if(b>-1){var a=this.behaviours.splice(b,1);a.parents=null}},removeAllBehaviours:function(){V.Util.destroyArray(this.behaviours)},destory:function(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null}},V.Particle=R,Q.prototype={create:function(a){return a?new newTypeParticle:new V.Particle},getCount:function(){return this.poolList.length},add:function(){return this.poolList.push(this.create())},get:function(){return 0===this.poolList.length?this.create():this.poolList.pop().reset()},set:function(a){return this.poolList.length<V.POOL_MAX?this.poolList.push(a):void 0},release:function(){for(var a=0;a<this.poolList.length;a++)this.poolList[a].destory&&this.poolList[a].destory(),delete this.poolList[a];this.poolList=[]}},V.ParticlePool=Q;var $={randomAToB:function(a,b,c){return c?Math.floor(Math.random()*(b-a))+a:a+Math.random()*(b-a)},randomFloating:function(a,b,c){return $.randomAToB(a-b,a+b,c)},randomZone:function(){},degreeTransform:function(a){return a*Math.PI/180},toColor16:function(a){return"#"+a.toString(16)},randomColor:function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)}};V.MathUtils=$;var _=function(a){this.type=V.Util.initValue(a,V.EULER)};_.prototype={integrate:function(a,b,c){this.eulerIntegrate(a,b,c)},eulerIntegrate:function(a,b,c){a.sleep||(a.old.p.copy(a.p),a.old.v.copy(a.v),a.a.multiplyScalar(1/a.mass),a.v.add(a.a.multiplyScalar(b)),a.p.add(a.old.v.multiplyScalar(b)),c&&a.v.multiplyScalar(c),a.a.clear())}},V.NumericalIntegration=_;var ab=function(a,b){this.x=a||0,this.y=b||0};ab.prototype={set:function(a,b){return this.x=a,this.y=b,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setComponent:function(a,b){switch(a){case 0:this.x=b;break;case 1:this.y=b;break;default:throw new Error("index is out of range: "+a)}},getGradient:function(){return 0!=this.x?Math.atan2(this.y,this.x):this.y>0?Math.PI/2:this.y<0?-Math.PI/2:void 0},getComponent:function(a){switch(a){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+a)}},copy:function(a){return this.x=a.x,this.y=a.y,this},add:function(a,c){return c!==b?this.addVectors(a,c):(this.x+=a.x,this.y+=a.y,this)},addXY:function(a,b){return this.x+=a,this.y+=b,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScalar:function(a){return this.x+=a,this.y+=a,this},sub:function(a,c){return c!==b?this.subVectors(a,c):(this.x-=a.x,this.y-=a.y,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this},divideScalar:function(a){return 0!==a?(this.x/=a,this.y/=a):this.set(0,0),this},min:function(a){return this.x>a.x&&(this.x=a.x),this.y>a.y&&(this.y=a.y),this},max:function(a){return this.x<a.x&&(this.x=a.x),this.y<a.y&&(this.y=a.y),this},clamp:function(a,b){return this.x<a.x?this.x=a.x:this.x>b.x&&(this.x=b.x),this.y<a.y?this.y=a.y:this.y>b.y&&(this.y=b.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},rotate:function(a){var b=this.x,c=this.y;return this.x=b*Math.cos(a)+c*Math.sin(a),this.y=-b*Math.sin(a)+c*Math.cos(a),this},distanceToSquared:function(a){var b=this.x-a.x,c=this.y-a.y;return b*b+c*c},setLength:function(a){var b=this.length();return 0!==b&&a!==b&&this.multiplyScalar(a/b),this},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this},equals:function(a){return a.x===this.x&&a.y===this.y},toArray:function(){return[this.x,this.y]},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new V.Vector2D(this.x,this.y)}},V.Vector2D=ab;var bb=function(a,b){this.r=Math.abs(a)||0,this.tha=b||0};bb.prototype={set:function(a,b){return this.r=a,this.tha=b,this},setR:function(a){return this.r=a,this},setTha:function(a){return this.tha=a,this},copy:function(a){return this.r=a.r,this.tha=a.tha,this},toVector:function(){return new V.Vector2D(this.getX(),this.getY())},getX:function(){return this.r*Math.sin(this.tha)},getY:function(){return-this.r*Math.cos(this.tha)},normalize:function(){return this.r=1,this},equals:function(a){return a.r===this.r&&a.tha===this.tha},toArray:function(){return[this.r,this.tha]},clear:function(){return this.r=0,this.tha=0,this},clone:function(){return new V.Polar2D(this.r,this.tha)}},V.Polar2D=bb,P.prototype={getValue:function(a){return this.isArray?this.a[Math.floor(this.a.length*Math.random())]:this.center?V.MathUtils.randomFloating(this.a,this.b,a):V.MathUtils.randomAToB(this.a,this.b,a)}},V.Span=P,V.getSpan=function(a,b,c){return new V.Span(a,b,c)},V.Util.inherits(O,V.Span),O.prototype.getValue=function(){var a=this.colorArr[Math.floor(this.colorArr.length*Math.random())];return"random"==a||"Random"==a?V.MathUtils.randomColor():a},V.ColorSpan=O,N.prototype={contains:function(a,b){return a<=this.right&&a>=this.x&&b<=this.bottom&&b>=this.y?!0:!1}},V.Rectangle=N;var cb=cb||{create:function(a){var b=new Float32Array(9);return a&&this.set(a,b),b},set:function(a,b){for(var c=0;9>c;c++)b[c]=a[c];return b},multiply:function(a,b,c){var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],i=a[6],j=a[7],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[6],q=b[7];return c[0]=k*d+l*g,c[1]=k*e+l*h,c[2]=f*m,c[3]=n*d+o*g,c[4]=n*e+o*h,c[6]=p*d+q*g+i,c[7]=p*e+q*h+j,c},inverse:function(a,b){var c,d=a[0],e=a[1],f=a[3],g=a[4],h=a[6],i=a[7],j=g,k=-f,l=i*f-g*h,m=d*j+e*k;return c=1/m,b[0]=j*c,b[1]=-e*c,b[3]=k*c,b[4]=d*c,b[6]=l*c,b[7]=(-i*d+e*h)*c,b},multiplyVec2:function(a,b,c){var d=b[0],e=b[1];return c[0]=d*a[0]+e*a[3]+a[6],c[1]=d*a[1]+e*a[4]+a[7],c}};V.Mat3=cb,M.id=0,M.prototype={reset:function(a,b){this.life=V.Util.initValue(a,1/0),this.easing=V.Util.initValue(b,V.ease.setEasingByName(V.easeLinear))},normalizeForce:function(a){return a.multiplyScalar(V.MEASURE)},normalizeValue:function(a){return a*V.MEASURE},initialize:function(){},applyBehaviour:function(a,b){if(this.age+=b,this.age>=this.life||this.dead)this.energy=0,this.dead=!0,this.destory();else{var c=this.easing(a.age/a.life);this.energy=Math.max(1-c,0)}},destory:function(){var a,b=this.parents.length;for(a=0;b>a;a++)this.parents[a].removeBehaviour(this);this.parents=[]}},V.Behaviour=M,L.prototype={init:function(){this.startTime=0,this.nextTime=this.timePan.getValue()},getValue:function(a){return this.startTime+=a,this.startTime>=this.nextTime?(this.startTime=0,this.nextTime=this.timePan.getValue(),1==this.numPan.b?this.numPan.getValue(!1)>.5?1:0:this.numPan.getValue(!0)):0}},V.Rate=L,K.prototype.reset=function(){},K.prototype.init=function(a,b){this.initialize(b?b:a)},K.prototype.initialize=function(){},V.Initialize=K;var db={initialize:function(a,b,c){var d,e=c.length;for(d=0;e>d;d++)c[d]instanceof V.Initialize?c[d].init(a,b):V.InitializeUtil.init(a,b,c[d]);V.InitializeUtil.bindEmitter(a,b)},init:function(a,b,c){V.Util.setPrototypeByObject(b,c),V.Util.setVector2DByObject(b,c)},bindEmitter:function(a,b){a.bindEmitter&&(b.p.add(a.p),b.v.add(a.v),b.a.add(a.a),b.v.rotate(V.MathUtils.degreeTransform(a.rotation)))}};V.InitializeUtil=db,V.Util.inherits(J,V.Initialize),J.prototype.initialize=function(a){a.life=1/0==this.lifePan.a?1/0:this.lifePan.getValue()},V.Life=J,V.Util.inherits(I,V.Initialize),I.prototype.reset=function(a){this.zone=V.Util.initValue(a,new V.PointZone)},I.prototype.initialize=function(a){this.zone.getPosition(),a.p.x=this.zone.vector.x,a.p.y=this.zone.vector.y},V.Position=I,V.P=I,V.Util.inherits(H,V.Initialize),H.prototype.reset=function(a,b,c){this.rPan=V.Util.setSpanValue(a),this.thaPan=V.Util.setSpanValue(b),this.type=V.Util.initValue(c,"vector")},H.prototype.normalizeVelocity=function(a){return a*V.MEASURE},H.prototype.initialize=function(a){if("p"==this.type||"P"==this.type||"polar"==this.type){var b=new V.Polar2D(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*Math.PI/180);a.v.x=b.getX(),a.v.y=b.getY()}else a.v.x=this.normalizeVelocity(this.rPan.getValue()),a.v.y=this.normalizeVelocity(this.thaPan.getValue())
},V.Velocity=H,V.V=H,V.Util.inherits(G,V.Initialize),G.prototype.initialize=function(a){a.mass=this.massPan.getValue()},V.Mass=G,V.Util.inherits(F,V.Initialize),F.prototype.reset=function(a,b,c){this.radius=V.Util.setSpanValue(a,b,c)},F.prototype.initialize=function(a){a.radius=this.radius.getValue(),a.transform.oldRadius=a.radius},V.Radius=F,V.Util.inherits(E,V.Initialize),E.prototype.initialize=function(a){var b=this.image.getValue();a.target="string"==typeof b?{width:this.w,height:this.h,src:b}:b},E.prototype.setSpanValue=function(a){return a instanceof V.ColorSpan?a:new V.ColorSpan(a)},V.ImageTarget=E,V.Util.inherits(D,V.Behaviour),D.prototype.reset=function(a,b,c,d){this.force=this.normalizeForce(new V.Vector2D(a,b)),c&&D._super_.prototype.reset.call(this,c,d)},D.prototype.applyBehaviour=function(a,b,c){D._super_.prototype.applyBehaviour.call(this,a,b,c),a.a.add(this.force)},V.Force=D,V.F=D,V.Util.inherits(C,V.Behaviour),C.prototype.reset=function(a,b,c,d,e){this.targetPosition=V.Util.initValue(a,new V.Vector2D),this.radius=V.Util.initValue(c,1e3),this.force=V.Util.initValue(this.normalizeValue(b),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new V.Vector2D,this.lengthSq=0,d&&C._super_.prototype.reset.call(this,d,e)},C.prototype.applyBehaviour=function(a,b,c){C._super_.prototype.applyBehaviour.call(this,a,b,c),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(a.p),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>4e-6&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq),this.attractionForce.multiplyScalar(this.force),a.a.add(this.attractionForce))},V.Attraction=C,V.Util.inherits(B,V.Behaviour),B.prototype.reset=function(a,b,c,d,e){this.panFoce=new V.Vector2D(a,b),this.panFoce=this.normalizeForce(this.panFoce),this.delay=c,d&&B._super_.prototype.reset.call(this,d,e)},B.prototype.applyBehaviour=function(a,b,c){B._super_.prototype.applyBehaviour.call(this,a,b,c),this.time+=b,this.time>=this.delay&&(a.a.addXY(V.MathUtils.randomAToB(-this.panFoce.x,this.panFoce.x),V.MathUtils.randomAToB(-this.panFoce.y,this.panFoce.y)),this.time=0)},V.RandomDrift=B,V.Util.inherits(A,V.Attraction),A.prototype.reset=function(a,b,c,d,e){A._super_.prototype.reset.call(this,a,b,c,d,e),this.force*=-1},V.Repulsion=A,V.Util.inherits(z,V.Force),z.prototype.reset=function(a,b,c){z._super_.prototype.reset.call(this,0,a,b,c)},V.Gravity=z,V.G=z,V.Util.inherits(y,V.Behaviour),y.prototype.reset=function(a,b,c,d,e){this.emitter=V.Util.initValue(a,null),this.mass=V.Util.initValue(b,!0),this.callback=V.Util.initValue(c,null),this.collisionPool=[],this.delta=new V.Vector2D,d&&y._super_.prototype.reset.call(this,d,e)},y.prototype.applyBehaviour=function(a,b,c){for(var d,e,f,g,h,i=this.emitter?this.emitter.particles.slice(c):this.pool.slice(c),j=i.length,k=0;j>k;k++)d=i[k],d!==a&&(this.delta.copy(d.p),this.delta.sub(a.p),e=this.delta.lengthSq(),distance=a.radius+d.radius,distance*distance>=e&&(f=distance-Math.sqrt(e),f+=.5,totalMass=a.mass+d.mass,g=this.mass?d.mass/totalMass:.5,h=this.mass?a.mass/totalMass:.5,a.p.add(this.delta.clone().normalize().multiplyScalar(f*-g)),d.p.add(this.delta.normalize().multiplyScalar(f*h)),this.callback&&this.callback(a,d)))},V.Collision=y,V.Util.inherits(x,V.Behaviour),x.prototype.reset=function(a,b,c,d){this.zone=a,this.zone.crossType=V.Util.initValue(b,"dead"),c&&x._super_.prototype.reset.call(this,c,d)},x.prototype.applyBehaviour=function(a,b,c){x._super_.prototype.applyBehaviour.call(this,a,b,c),this.zone.crossing(a)},V.CrossZone=x,V.Util.inherits(w,V.Behaviour),w.prototype.reset=function(a,c,d,e){this.same=null==c||c==b?!0:!1,this.a=V.Util.setSpanValue(V.Util.initValue(a,1)),this.b=V.Util.setSpanValue(c),d&&w._super_.prototype.reset.call(this,d,e)},w.prototype.initialize=function(a){a.transform.alphaA=this.a.getValue(),a.transform.alphaB=this.same?a.transform.alphaA:this.b.getValue()},w.prototype.applyBehaviour=function(a,b,c){w._super_.prototype.applyBehaviour.call(this,a,b,c),a.alpha=a.transform.alphaB+(a.transform.alphaA-a.transform.alphaB)*this.energy,a.alpha<.001&&(a.alpha=0)},V.Alpha=w,V.Util.inherits(v,V.Behaviour),v.prototype.reset=function(a,c,d,e){this.same=null==c||c==b?!0:!1,this.a=V.Util.setSpanValue(V.Util.initValue(a,1)),this.b=V.Util.setSpanValue(c),d&&v._super_.prototype.reset.call(this,d,e)},v.prototype.initialize=function(a){a.transform.scaleA=this.a.getValue(),a.transform.oldRadius=a.radius,a.transform.scaleB=this.same?a.transform.scaleA:this.b.getValue()},v.prototype.applyBehaviour=function(a,b,c){v._super_.prototype.applyBehaviour.call(this,a,b,c),a.scale=a.transform.scaleB+(a.transform.scaleA-a.transform.scaleB)*this.energy,a.scale<1e-4&&(a.scale=0),a.radius=a.transform.oldRadius*a.scale},V.Scale=v,V.Util.inherits(u,V.Behaviour),u.prototype.reset=function(a,c,d,e,f){this.same=null==c||c==b?!0:!1,this.a=V.Util.setSpanValue(V.Util.initValue(a,"Velocity")),this.b=V.Util.setSpanValue(V.Util.initValue(c,0)),this.style=V.Util.initValue(d,"to"),e&&u._super_.prototype.reset.call(this,e,f)},u.prototype.initialize=function(a){a.rotation=this.a.getValue(),a.transform.rotationA=this.a.getValue(),this.same||(a.transform.rotationB=this.b.getValue())},u.prototype.applyBehaviour=function(a,b,c){u._super_.prototype.applyBehaviour.call(this,a,b,c),this.same?("V"==this.a.a||"Velocity"==this.a.a||"v"==this.a.a)&&(a.rotation=a.getDirection()):a.rotation+="to"==this.style||"TO"==this.style||"_"==this.style?a.transform.rotationB+(a.transform.rotationA-a.transform.rotationB)*this.energy:a.transform.rotationB},V.Rotate=u,V.Util.inherits(t,V.Behaviour),t.prototype.reset=function(a,b,c,d){this.color1=this.setSpanValue(a),this.color2=this.setSpanValue(b),c&&t._super_.prototype.reset.call(this,c,d)},t.prototype.initialize=function(a){a.color=this.color1.getValue(),a.transform.beginRGB=V.Util.hexToRGB(a.color),this.color2&&(a.transform.endRGB=V.Util.hexToRGB(this.color2.getValue()))},t.prototype.applyBehaviour=function(a,b,c){this.color2?(t._super_.prototype.applyBehaviour.call(this,a,b,c),a.transform.rgb.r=a.transform.endRGB.r+(a.transform.beginRGB.r-a.transform.endRGB.r)*this.energy,a.transform.rgb.g=a.transform.endRGB.g+(a.transform.beginRGB.g-a.transform.endRGB.g)*this.energy,a.transform.rgb.b=a.transform.endRGB.b+(a.transform.beginRGB.b-a.transform.endRGB.b)*this.energy,a.transform.rgb.r=parseInt(a.transform.rgb.r,10),a.transform.rgb.g=parseInt(a.transform.rgb.g,10),a.transform.rgb.b=parseInt(a.transform.rgb.b,10)):(a.transform.rgb.r=a.transform.beginRGB.r,a.transform.rgb.g=a.transform.beginRGB.g,a.transform.rgb.b=a.transform.beginRGB.b)},t.prototype.setSpanValue=function(a){return a?a instanceof V.ColorSpan?a:new V.ColorSpan(a):null},V.Color=t,V.Util.inherits(s,V.Behaviour),s.prototype.reset=function(a,b,c,d){this.distanceVec=new V.Vector2D,this.centerPoint=V.Util.initValue(a,new V.Vector2D),this.force=V.Util.initValue(this.normalizeValue(b),100),c&&s._super_.prototype.reset.call(this,c,d)},s.prototype.initialize=function(){},s.prototype.applyBehaviour=function(a,b){this.distanceVec.set(this.centerPoint.x-a.p.x,this.centerPoint.y-a.p.y);var c=this.distanceVec.lengthSq();if(0!=c){var d=this.distanceVec.length(),e=this.force*b/(c*d);a.v.x+=e*this.distanceVec.x,a.v.y+=e*this.distanceVec.y}},V.GravityWell=s,r.ID=0,V.Util.inherits(r,V.Particle),V.EventDispatcher.initialize(r.prototype),r.prototype.emit=function(a,b){this.emitTime=0,this.emitTotalTimes=V.Util.initValue(a,1/0),1==b||"life"==b||"destroy"==b?this.life="once"==a?1:this.emitTotalTimes:isNaN(b)||(this.life=b),this.rate.init()},r.prototype.stopEmit=function(){this.emitTotalTimes=-1,this.emitTime=0},r.prototype.removeAllParticles=function(){for(var a=0;a<this.particles.length;a++)this.particles[a].dead=!0},r.prototype.createParticle=function(a,b){var c=V.pool.get();return this.setupParticle(c,a,b),this.dispatchEvent(new V.Event({type:V.PARTICLE_CREATED,particle:c})),c},r.prototype.addSelfInitialize=function(a){a.init?a.init(this):this.initAll()},r.prototype.addInitialize=function(){var a,b=arguments.length;for(a=0;b>a;a++)this.initializes.push(arguments[a])},r.prototype.removeInitialize=function(a){var b=this.initializes.indexOf(a);b>-1&&this.initializes.splice(b,1)},r.prototype.removeInitializers=function(){V.Util.destroyArray(this.initializes)},r.prototype.addBehaviour=function(){var a,b=arguments.length;for(a=0;b>a;a++)this.behaviours.push(arguments[a]),arguments[a].hasOwnProperty("parents")&&arguments[a].parents.push(this)},r.prototype.removeBehaviour=function(a){var b=this.behaviours.indexOf(a);b>-1&&this.behaviours.splice(b,1)},r.prototype.removeAllBehaviours=function(){V.Util.destroyArray(this.behaviours)},r.prototype.integrate=function(a){var b=1-this.damping;V.integrator.integrate(this,a,b);var c,d=this.particles.length;for(c=0;d>c;c++){var e=this.particles[c];e.update(a,c),V.integrator.integrate(e,a,b),this.dispatchEvent(new V.Event({type:V.PARTICLE_UPDATE,particle:e}))}},r.prototype.emitting=function(a){if("once"==this.emitTotalTimes){var b,c=this.rate.getValue(99999);for(b=0;c>b;b++)this.createParticle();this.emitTotalTimes="none"}else if(!isNaN(this.emitTotalTimes)&&(this.emitTime+=a,this.emitTime<this.emitTotalTimes)){var b,c=this.rate.getValue(a);for(b=0;c>b;b++)this.createParticle()}},r.prototype.update=function(a){this.age+=a,(this.age>=this.life||this.dead)&&this.destroy(),this.emitting(a),this.integrate(a);var b,c,d=this.particles.length;for(c=d-1;c>=0;c--)b=this.particles[c],b.dead&&(V.pool.set(b),this.particles.splice(c,1),this.dispatchEvent(new V.Event({type:V.PARTICLE_DEAD,particle:b})))},r.prototype.setupParticle=function(a,b,c){var d=this.initializes,e=this.behaviours;b&&(d=b instanceof Array?b:[b]),c&&(e=c instanceof Array?c:[c]),V.InitializeUtil.initialize(this,a,d),a.addBehaviours(e),a.parent=this,this.particles.push(a)},r.prototype.destroy=function(){this.dead=!0,this.emitTotalTimes=-1,0==this.particles.length&&(this.removeInitializers(),this.removeAllBehaviours(),this.parent&&this.parent.removeEmitter(this))},V.Emitter=r,V.Util.inherits(q,V.Emitter),q.prototype.addSelfBehaviour=function(){var a,b=arguments.length;for(a=0;b>a;a++)this.selfBehaviours.push(arguments[a])},q.prototype.removeSelfBehaviour=function(a){var b=this.selfBehaviours.indexOf(a);b>-1&&this.selfBehaviours.splice(b,1)},q.prototype.update=function(a){if(q._super_.prototype.update.call(this,a),!this.sleep){var b,c=this.selfBehaviours.length;for(b=0;c>b;b++)this.selfBehaviours[b].applyBehaviour(this,a,b)}},V.BehaviourEmitter=q,V.Util.inherits(p,V.Emitter),p.prototype.initEventHandler=function(){var a=this;this.mousemoveHandler=function(b){a.mousemove.call(a,b)},this.mousedownHandler=function(b){a.mousedown.call(a,b)},this.mouseupHandler=function(b){a.mouseup.call(a,b)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)},p.prototype.emit=function(){this._allowEmitting=!0},p.prototype.stopEmit=function(){this._allowEmitting=!1},p.prototype.mousemove=function(a){a.layerX||0==a.layerX?(this.p.x+=(a.layerX-this.p.x)*this.ease,this.p.y+=(a.layerY-this.p.y)*this.ease):(a.offsetX||0==a.offsetX)&&(this.p.x+=(a.offsetX-this.p.x)*this.ease,this.p.y+=(a.offsetY-this.p.y)*this.ease),this._allowEmitting&&p._super_.prototype.emit.call(this,"once")},p.prototype.destroy=function(){p._super_.prototype.destroy.call(this),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)},V.FollowEmitter=p;var eb=eb||{easeLinear:function(a){return a},easeInQuad:function(a){return Math.pow(a,2)},easeOutQuad:function(a){return-(Math.pow(a-1,2)-1)},easeInOutQuad:function(a){return(a/=.5)<1?.5*Math.pow(a,2):-.5*((a-=2)*a-2)},easeInCubic:function(a){return Math.pow(a,3)},easeOutCubic:function(a){return Math.pow(a-1,3)+1},easeInOutCubic:function(a){return(a/=.5)<1?.5*Math.pow(a,3):.5*(Math.pow(a-2,3)+2)},easeInQuart:function(a){return Math.pow(a,4)},easeOutQuart:function(a){return-(Math.pow(a-1,4)-1)},easeInOutQuart:function(a){return(a/=.5)<1?.5*Math.pow(a,4):-.5*((a-=2)*Math.pow(a,3)-2)},easeInSine:function(a){return-Math.cos(a*(Math.PI/2))+1},easeOutSine:function(a){return Math.sin(a*(Math.PI/2))},easeInOutSine:function(a){return-.5*(Math.cos(Math.PI*a)-1)},easeInExpo:function(a){return 0===a?0:Math.pow(2,10*(a-1))},easeOutExpo:function(a){return 1===a?1:-Math.pow(2,-10*a)+1},easeInOutExpo:function(a){return 0===a?0:1===a?1:(a/=.5)<1?.5*Math.pow(2,10*(a-1)):.5*(-Math.pow(2,-10*--a)+2)},easeInCirc:function(a){return-(Math.sqrt(1-a*a)-1)},easeOutCirc:function(a){return Math.sqrt(1-Math.pow(a-1,2))},easeInOutCirc:function(a){return(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)},easeInBack:function(a){var b=1.70158;return a*a*((b+1)*a-b)},easeOutBack:function(a){var b=1.70158;return(a-=1)*a*((b+1)*a+b)+1},easeInOutBack:function(a){var b=1.70158;return(a/=.5)<1?.5*a*a*(((b*=1.525)+1)*a-b):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},setEasingByName:function(a){switch(a){case"easeLinear":return V.ease.easeLinear;case"easeInQuad":return V.ease.easeInQuad;case"easeOutQuad":return V.ease.easeOutQuad;case"easeInOutQuad":return V.ease.easeInOutQuad;case"easeInCubic":return V.ease.easeInCubic;case"easeOutCubic":return V.ease.easeOutCubic;case"easeInOutCubic":return V.ease.easeInOutCubic;case"easeInQuart":return V.ease.easeInQuart;case"easeOutQuart":return V.ease.easeOutQuart;case"easeInOutQuart":return V.ease.easeInOutQuart;case"easeInSine":return V.ease.easeInSine;case"easeOutSine":return V.ease.easeOutSine;case"easeInOutSine":return V.ease.easeInOutSine;case"easeInExpo":return V.ease.easeInExpo;case"easeOutExpo":return V.ease.easeOutExpo;case"easeInOutExpo":return V.ease.easeInOutExpo;case"easeInCirc":return V.ease.easeInCirc;case"easeOutCirc":return V.ease.easeOutCirc;case"easeInOutCirc":return V.ease.easeInOutCirc;case"easeInBack":return V.ease.easeInBack;case"easeOutBack":return V.ease.easeOutBack;case"easeInOutBack":return V.ease.easeInOutBack;default:return V.ease.easeLinear}}};V.ease=eb,V.easeLinear="easeLinear",V.easeInQuad="easeInQuad",V.easeOutQuad="easeOutQuad",V.easeInOutQuad="easeInOutQuad",V.easeInCubic="easeInCubic",V.easeOutCubic="easeOutCubic",V.easeInOutCubic="easeInOutCubic",V.easeInQuart="easeInQuart",V.easeOutQuart="easeOutQuart",V.easeInOutQuart="easeInOutQuart",V.easeInSine="easeInSine",V.easeOutSine="easeOutSine",V.easeInOutSine="easeInOutSine",V.easeInExpo="easeInExpo",V.easeOutExpo="easeOutExpo",V.easeInOutExpo="easeInOutExpo",V.easeInCirc="easeInCirc",V.easeOutCirc="easeOutCirc",V.easeInOutCirc="easeInOutCirc",V.easeInBack="easeInBack",V.easeOutBack="easeOutBack",V.easeInOutBack="easeInOutBack",o.prototype={start:function(){this.addEventHandler(),this.renderer.start()},stop:function(){this.renderer.stop()},resize:function(a,b){this.renderer.resize(a,b)},setStroke:function(a,b){this.renderer.hasOwnProperty("stroke")?this.renderer.setStroke(a,b):alert("Sorry this renderer do not suppest stroke method!")},createImageData:function(a){this.renderer instanceof V.PixelRender&&this.renderer.createImageData(a)},setMaxRadius:function(a){this.renderer instanceof V.WebGLRender&&this.renderer.setMaxRadius(a)},blendEquation:function(a){this.renderer instanceof V.WebGLRender&&this.renderer.blendEquation(a)},blendFunc:function(a,b){this.renderer instanceof V.WebGLRender&&this.renderer.blendFunc(a,b)},setType:function(a){this.type=a,this.renderer=this.getRenderer()},getRenderer:function(){switch(this.type){case"dom":return new V.DomRender(this.proton,this.element);case"canvas":return new V.CanvasRender(this.proton,this.element);case"webgl":return new V.WebGLRender(this.proton,this.element);case"easel":return new V.EaselRender(this.proton,this.element);case"easeljs":return new V.EaselRender(this.proton,this.element);case"pixel":return new V.PixelRender(this.proton,this.element);default:return new V.BaseRender(this.proton,this.element)}},render:function(a){this.renderer.render(a)},addEventHandler:function(){this.onProtonUpdate&&(this.renderer.onProtonUpdate=this.onProtonUpdate),this.onParticleCreated&&(this.renderer.onParticleCreated=this.onParticleCreated),this.onParticleUpdate&&(this.renderer.onParticleUpdate=this.onParticleUpdate),this.onParticleDead&&(this.renderer.onParticleDead=this.onParticleDead)}},V.Renderer=o,n.prototype={start:function(){var a=this;this.proton.addEventListener(V.PROTON_UPDATE,function(){a.onProtonUpdate.call(a)}),this.proton.addEventListener(V.PROTON_UPDATE_AFTER,function(){a.onProtonUpdateAfter.call(a)}),this.proton.addEventListener(V.EMITTER_ADDED,function(b){a.onEmitterAdded.call(a,b.emitter)}),this.proton.addEventListener(V.EMITTER_REMOVED,function(b){a.onEmitterRemoved.call(a,b.emitter)});var b,c=this.proton.emitters.length;for(b=0;c>b;b++){var d=this.proton.emitters[b];this.addEmitterListener(d)}},resize:function(){},addEmitterListener:function(a){var b=this;a.addEventListener(V.PARTICLE_CREATED,function(a){b.onParticleCreated.call(b,a.particle)}),a.addEventListener(V.PARTICLE_UPDATE,function(a){b.onParticleUpdate.call(b,a.particle)}),a.addEventListener(V.PARTICLE_DEAD,function(a){b.onParticleDead.call(b,a.particle)})},stop:function(){var a,b=this.proton.emitters.length;for(this.proton.removeAllEventListeners(),a=0;b>a;a++){var c=this.proton.emitters[a];c.removeAllEventListeners()}},onEmitterAdded:function(a){this.addEmitterListener(a)},onEmitterRemoved:function(a){a.removeAllEventListeners()},onProtonUpdate:function(){},onProtonUpdateAfter:function(){},onParticleCreated:function(){},onParticleUpdate:function(){},onParticleDead:function(){}},V.BaseRender=n,V.Util.inherits(m,V.BaseRender),m.prototype.start=function(){m._super_.prototype.start.call(this)},m.prototype.setStroke=function(a,b){a=V.Util.initValue(a,"#000000"),b=V.Util.initValue(b,1),this.stroke={color:a,thinkness:b}},m.prototype.onProtonUpdate=function(){},m.prototype.onParticleCreated=function(a){if(a.target){var b=this;V.Util.getImage(a.target,a,!1,function(a){b.setImgInDIV.call(b,a)})}else a.transform.canvas=V.DomUtil.createCanvas(a.id+"_canvas",a.radius+1,a.radius+1,"absolute"),a.transform.bakOldRadius=a.radius,this.stroke?(a.transform.canvas.width=2*a.radius+2*this.stroke.thinkness,a.transform.canvas.height=2*a.radius+2*this.stroke.thinkness):(a.transform.canvas.width=2*a.radius+1,a.transform.canvas.height=2*a.radius+1),a.transform.context=a.transform.canvas.getContext("2d"),a.transform.context.fillStyle=a.color,a.transform.context.beginPath(),a.transform.context.arc(a.radius,a.radius,a.radius,0,2*Math.PI,!0),this.stroke&&(a.transform.context.strokeStyle=this.stroke.color,a.transform.context.lineWidth=this.stroke.thinkness,a.transform.context.stroke()),a.transform.context.closePath(),a.transform.context.fill(),this.element.appendChild(a.transform.canvas)},m.prototype.onParticleUpdate=function(a){a.target?a.target instanceof Image&&(a.transform.canvas.style.opacity=a.alpha,V.DomUtil.transformDom(a.transform.canvas,a.p.x-a.target.width/2,a.p.y-a.target.height/2,a.scale,a.rotation)):(a.transform.canvas.style.opacity=a.alpha,a.transform.oldRadius?V.DomUtil.transformDom(a.transform.canvas,a.p.x-a.transform.oldRadius,a.p.y-a.transform.oldRadius,a.scale,a.rotation):V.DomUtil.transformDom(a.transform.canvas,a.p.x-a.transform.bakOldRadius,a.p.y-a.transform.bakOldRadius,a.scale,a.rotation))},m.prototype.onParticleDead=function(a){a.transform.canvas&&this.element.removeChild(a.transform.canvas)},m.prototype.setImgInDIV=function(a){a.transform.canvas=V.DomUtil.createCanvas(a.id+"_canvas",a.target.width+1,a.target.height+1,"absolute",a.p.x-a.radius,a.p.y-a.radius),a.transform.context=a.transform.canvas.getContext("2d"),a.transform.context.drawImage(a.target,0,0,a.target.width,a.target.height),this.element.appendChild(a.transform.canvas)},V.DomRender=m,V.Util.inherits(l,V.BaseRender),l.prototype.resize=function(){},l.prototype.start=function(){l._super_.prototype.start.call(this)},l.prototype.onProtonUpdate=function(){},l.prototype.onParticleCreated=function(a){if(a.target)a.target=a.target.clone(),a.target.parent||(!a.target.image||(a.target.regX=a.target.image.width/2,a.target.regY=a.target.image.height/2),this.element.addChild(a.target));else{var b=new createjs.Graphics;this.stroke&&(1==this.stroke?b.beginStroke("#000000"):this.stroke instanceof String&&b.beginStroke(this.stroke)),b.beginFill(a.color).drawCircle(0,0,a.radius);var c=new createjs.Shape(b);a.target=c,this.element.addChild(a.target)}},l.prototype.onParticleUpdate=function(a){a.target&&(a.target.x=a.p.x,a.target.y=a.p.y,a.target.alpha=a.alpha,a.target.scaleX=a.target.scaleY=a.scale,a.target.rotation=a.rotation)},l.prototype.onParticleDead=function(a){a.target&&a.target.parent&&a.target.parent.removeChild(a.target)},V.EaselRender=l,V.Util.inherits(k,V.BaseRender),k.prototype.resize=function(a,b){this.element.width=a,this.element.height=b},k.prototype.start=function(){k._super_.prototype.start.call(this)},k.prototype.setStroke=function(a,b){a=V.Util.initValue(a,"#000000"),b=V.Util.initValue(b,1),this.stroke={color:a,thinkness:b}},k.prototype.onProtonUpdate=function(){this.context.clearRect(0,0,this.element.width,this.element.height)},k.prototype.onParticleCreated=function(a){a.target?V.Util.getImage(a.target,a,!1):a.color=a.color?a.color:"#ff0000"},k.prototype.onParticleUpdate=function(a){if(a.target){if(a.target instanceof Image){var b=a.target.width*a.scale|0,c=a.target.height*a.scale|0,d=a.p.x-b/2,e=a.p.y-c/2;if(a.color){a.transform.buffer||(a.transform.buffer=this.getBuffer(a.target));var f=a.transform.buffer.getContext("2d");f.clearRect(0,0,a.transform.buffer.width,a.transform.buffer.height),f.globalAlpha=a.alpha,f.drawImage(a.target,0,0),f.globalCompositeOperation="source-atop",f.fillStyle=V.Util.rgbToHex(a.transform.rgb),f.fillRect(0,0,a.transform.buffer.width,a.transform.buffer.height),f.globalCompositeOperation="source-over",f.globalAlpha=1,this.context.drawImage(a.transform.buffer,0,0,a.transform.buffer.width,a.transform.buffer.height,d,e,b,c)}else this.context.save(),this.context.globalAlpha=a.alpha,this.context.translate(a.p.x,a.p.y),this.context.rotate(V.MathUtils.degreeTransform(a.rotation)),this.context.translate(-a.p.x,-a.p.y),this.context.drawImage(a.target,0,0,a.target.width,a.target.height,d,e,b,c),this.context.globalAlpha=1,this.context.restore()}}else this.context.fillStyle=a.transform.rgb?"rgba("+a.transform.rgb.r+","+a.transform.rgb.g+","+a.transform.rgb.b+","+a.alpha+")":a.color,this.context.beginPath(),this.context.arc(a.p.x,a.p.y,a.radius,0,2*Math.PI,!0),this.stroke&&(this.context.strokeStyle=this.stroke.color,this.context.lineWidth=this.stroke.thinkness,this.context.stroke()),this.context.closePath(),this.context.fill()},k.prototype.onParticleDead=function(){},k.prototype.getBuffer=function(a){if(a instanceof Image){var b=a.width+"_"+a.height,c=this.bufferCache[b];return c||(c=document.createElement("canvas"),c.width=a.width,c.height=a.height,this.bufferCache[b]=c),c}},V.CanvasRender=k,V.Util.inherits(j,V.BaseRender),j.prototype.resize=function(a,b){this.element.width=a,this.element.height=b},j.prototype.createImageData=function(a){this.rectangle=a?a:new V.Rectangle(0,0,this.element.width,this.element.height),this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height),this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},j.prototype.start=function(){j._super_.prototype.start.call(this)},j.prototype.onProtonUpdate=function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)},j.prototype.onProtonUpdateAfter=function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},j.prototype.onParticleCreated=function(){},j.prototype.onParticleUpdate=function(a){this.imageData&&this.setPixel(this.imageData,Math.floor(a.p.x-this.rectangle.x),Math.floor(a.p.y-this.rectangle.y),a)},j.prototype.setPixel=function(a,b,c,d){var e=d.transform.rgb;if(!(0>b||b>this.element.width||0>c||c>this.elementwidth)){var f=4*((c>>0)*a.width+(b>>0));a.data[f]=e.r,a.data[f+1]=e.g,a.data[f+2]=e.b,a.data[f+3]=255*d.alpha}},j.prototype.onParticleDead=function(){},V.PixelRender=j,V.Util.inherits(i,V.BaseRender),i.prototype.resize=function(a,b){this.umat[4]=-2,this.umat[7]=1,this.smat[0]=1/a,this.smat[4]=1/b,this.mstack.set(this.umat,0),this.mstack.set(this.smat,1),this.gl.viewport(0,0,a,b),this.element.width=a,this.element.height=b},i.prototype.setMaxRadius=function(a){this.circleCanvasURL=this.createCircle(a)},i.prototype.getVertexShader=function(){var a=["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join("\n");return a},i.prototype.getFragmentShader=function(){var a=["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join("\n");return a},i.prototype.initVar=function(){this.mstack=new V.MStack,this.umat=V.Mat3.create([2,0,1,0,-2,0,-1,1,1]),this.smat=V.Mat3.create([.01,0,1,0,.01,0,0,0,1]),this.texturebuffers={}},i.prototype.start=function(){i._super_.prototype.start.call(this),this.resize(this.element.width,this.element.height)},i.prototype.blendEquation=function(a){this.gl.blendEquation(this.gl[a])},i.prototype.blendFunc=function(a,b){this.gl.blendFunc(this.gl[a],this.gl[b])},i.prototype.getShader=function(a,b,c){var d;return d=a.createShader(c?a.FRAGMENT_SHADER:a.VERTEX_SHADER),a.shaderSource(d,b),a.compileShader(d),a.getShaderParameter(d,a.COMPILE_STATUS)?d:(alert(a.getShaderInfoLog(d)),null)},i.prototype.initShaders=function(){var a=this.getShader(this.gl,this.getFragmentShader(),!0),b=this.getShader(this.gl,this.getVertexShader(),!1);this.sprogram=this.gl.createProgram(),this.gl.attachShader(this.sprogram,b),this.gl.attachShader(this.sprogram,a),this.gl.linkProgram(this.sprogram),this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS)||alert("Could not initialise shaders"),this.gl.useProgram(this.sprogram),this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition"),this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.sprogram.tca),this.gl.enableVertexAttribArray(this.sprogram.vpa),this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat"),this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler"),this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture"),this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor"),this.gl.uniform1i(this.sprogram.useTex,1)},i.prototype.initBuffers=function(){this.unitIBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);var a=[0,3,1,0,2,3];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),this.gl.STATIC_DRAW);for(var b=[],c=0;100>c;c++)b.push(c);for(idx=new Uint16Array(b),this.unitI33=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW),b=[],c=0;100>c;c++)b.push(c,c+1,c+2);idx=new Uint16Array(b),this.stripBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW)},i.prototype.createCircle=function(a){this.circleCanvasRadius=V.WebGLUtil.nhpot(V.Util.initValue(a,32));var b=V.DomUtil.createCanvas("circle_canvas",2*this.circleCanvasRadius,2*this.circleCanvasRadius),c=b.getContext("2d");return c.beginPath(),c.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,2*Math.PI,!0),c.closePath(),c.fillStyle="#FFF",c.fill(),b.toDataURL()},i.prototype.setImgInCanvas=function(a){var b=a.target.width,c=a.target.height,d=V.WebGLUtil.nhpot(a.target.width),e=V.WebGLUtil.nhpot(a.target.height),f=a.target.width/d,g=a.target.height/e;this.texturebuffers[a.transform.src]||(this.texturebuffers[a.transform.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()]),a.transform.texture=this.texturebuffers[a.transform.src][0],a.transform.vcBuffer=this.texturebuffers[a.transform.src][1],a.transform.tcBuffer=this.texturebuffers[a.transform.src][2],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.transform.tcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,f,0,0,g,g,g]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.transform.vcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,b,0,0,c,b,c]),this.gl.STATIC_DRAW);var h=a.transform.canvas.getContext("2d"),i=h.getImageData(0,0,d,e);this.gl.bindTexture(this.gl.TEXTURE_2D,a.transform.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST),this.gl.generateMipmap(this.gl.TEXTURE_2D),a.transform.textureLoaded=!0,a.transform.textureWidth=b,a.transform.textureHeight=c},i.prototype.setStroke=function(){},i.prototype.onProtonUpdate=function(){},i.prototype.onParticleCreated=function(a){var b=this;a.transform.textureLoaded=!1,a.transform.tmat=V.Mat3.create(),a.transform.tmat[8]=1,a.transform.imat=V.Mat3.create(),a.transform.imat[8]=1,a.target?V.Util.getImage(a.target,a,!0,function(a){b.setImgInCanvas.call(b,a),a.transform.oldScale=1}):V.Util.getImage(this.circleCanvasURL,a,!0,function(a){b.setImgInCanvas.call(b,a),a.transform.oldScale=a.radius/b.circleCanvasRadius})},i.prototype.onParticleUpdate=function(a){a.transform.textureLoaded&&(this.updateMatrix(a),this.gl.uniform3f(this.sprogram.color,a.transform.rgb.r/255,a.transform.rgb.g/255,a.transform.rgb.b/255),this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,!1,this.mstack.top()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.transform.vcBuffer),this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.transform.tcBuffer),this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,!1,0,0),this.gl.bindTexture(this.gl.TEXTURE_2D,a.transform.texture),this.gl.uniform1i(this.sprogram.samplerUniform,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.mstack.pop())},i.prototype.onParticleDead=function(){},i.prototype.updateMatrix=function(a){var b=V.WebGLUtil.makeTranslation(-a.transform.textureWidth/2,-a.transform.textureHeight/2),c=V.WebGLUtil.makeTranslation(a.p.x,a.p.y),d=a.rotation*(Math.PI/180),e=V.WebGLUtil.makeRotation(d),f=a.scale*a.transform.oldScale,g=V.WebGLUtil.makeScale(f,f),h=V.WebGLUtil.matrixMultiply(b,g);h=V.WebGLUtil.matrixMultiply(h,e),h=V.WebGLUtil.matrixMultiply(h,c),V.Mat3.inverse(h,a.transform.imat),h[2]=a.alpha,this.mstack.push(h)},V.WebGLRender=i,h.prototype={getPosition:function(){},crossing:function(){}},V.Zone=h,V.Util.inherits(g,V.Zone),g.prototype.getPosition=function(){return this.random=Math.random(),this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient),this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient),this.vector},g.prototype.getDirection=function(a,b){var c=this.dy,d=-this.dx,e=this.dot,f=0==d?1:d;return(c*a+d*b+e)*f>0?!0:!1},g.prototype.getDistance=function(a,b){var c=this.dy,d=-this.dx,e=this.dot,f=c*a+d*b+e;return f/Math.sqrt(this.xxyy)},g.prototype.getSymmetric=function(a){var b=a.getGradient(),c=this.getGradient(),d=2*(c-b),e=a.x,f=a.y;
return a.x=e*Math.cos(d)-f*Math.sin(d),a.y=e*Math.sin(d)+f*Math.cos(d),a},g.prototype.getGradient=function(){return Math.atan2(this.dy,this.dx)},g.prototype.getRange=function(a,b){var c=Math.abs(this.getGradient());c<=Math.PI/4?a.p.x<this.maxx&&a.p.x>this.minx&&b():a.p.y<this.maxy&&a.p.y>this.miny&&b()},g.prototype.getLength=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)},g.prototype.crossing=function(a){var b=this;"dead"==this.crossType?">"==this.direction||"R"==this.direction||"right"==this.direction||"down"==this.direction?this.getRange(a,function(){b.getDirection(a.p.x,a.p.y)&&(a.dead=!0)}):this.getRange(a,function(){b.getDirection(a.p.x,a.p.y)||(a.dead=!0)}):"bound"==this.crossType?this.getRange(a,function(){b.getDistance(a.p.x,a.p.y)<=a.radius&&(0==b.dx?a.v.x*=-1:0==b.dy?a.v.y*=-1:b.getSymmetric(a.v))}):"cross"==this.crossType&&this.alert&&(alert("Sorry lineZone does not support cross method"),this.alert=!1)},V.LineZone=g,V.Util.inherits(f,V.Zone),f.prototype.getPosition=function(){return this.random=Math.random(),this.angle=2*Math.PI*Math.random(),this.vector.x=this.x+this.random*this.radius*Math.cos(this.angle),this.vector.y=this.y+this.random*this.radius*Math.sin(this.angle),this.vector},f.prototype.setCenter=function(a,b){this.center.x=a,this.center.y=b},f.prototype.crossing=function(a){var b=a.p.distanceTo(this.center);"dead"==this.crossType?b-a.radius>this.radius&&(a.dead=!0):"bound"==this.crossType?b+a.radius>=this.radius&&this.getSymmetric(a):"cross"==this.crossType&&this.alert&&(alert("Sorry CircleZone does not support cross method"),this.alert=!1)},f.prototype.getSymmetric=function(a){var b=a.v.getGradient(),c=this.getGradient(a),d=2*(c-b),e=a.v.x,f=a.v.y;a.v.x=e*Math.cos(d)-f*Math.sin(d),a.v.y=e*Math.sin(d)+f*Math.cos(d)},f.prototype.getGradient=function(a){return-Math.PI/2+Math.atan2(a.p.y-this.center.y,a.p.x-this.center.x)},V.CircleZone=f,V.Util.inherits(e,V.Zone),e.prototype.getPosition=function(){return this.vector.x=this.x,this.vector.y=this.y,this.vector},e.prototype.crossing=function(){this.alert&&(alert("Sorry PointZone does not support crossing method"),this.alert=!1)},V.PointZone=e,V.Util.inherits(d,V.Zone),d.prototype.getPosition=function(){return this.vector.x=this.x+Math.random()*this.width,this.vector.y=this.y+Math.random()*this.height,this.vector},d.prototype.crossing=function(a){"dead"==this.crossType?(a.p.x+a.radius<this.x?a.dead=!0:a.p.x-a.radius>this.x+this.width&&(a.dead=!0),a.p.y+a.radius<this.y?a.dead=!0:a.p.y-a.radius>this.y+this.height&&(a.dead=!0)):"bound"==this.crossType?(a.p.x-a.radius<this.x?(a.p.x=this.x+a.radius,a.v.x*=-1):a.p.x+a.radius>this.x+this.width&&(a.p.x=this.x+this.width-a.radius,a.v.x*=-1),a.p.y-a.radius<this.y?(a.p.y=this.y+a.radius,a.v.y*=-1):a.p.y+a.radius>this.y+this.height&&(a.p.y=this.y+this.height-a.radius,a.v.y*=-1)):"cross"==this.crossType&&(a.p.x+a.radius<this.x&&a.v.x<=0?a.p.x=this.x+this.width+a.radius:a.p.x-a.radius>this.x+this.width&&a.v.x>=0&&(a.p.x=this.x-a.radius),a.p.y+a.radius<this.y&&a.v.y<=0?a.p.y=this.y+this.height+a.radius:a.p.y-a.radius>this.y+this.height&&a.v.y>=0&&(a.p.y=this.y-a.radius))},V.RectZone=d,V.Util.inherits(c,V.Zone),c.prototype.reset=function(a,b,c,d){this.imageData=a,this.x=V.Util.initValue(b,0),this.y=V.Util.initValue(c,0),this.d=V.Util.initValue(d,2),this.vectors=[],this.setVectors()},c.prototype.setVectors=function(){var a,b,c=this.imageData.width,d=this.imageData.height;for(a=0;c>a;a+=this.d)for(b=0;d>b;b+=this.d){var e=4*((b>>0)*c+(a>>0));this.imageData.data[e+3]>0&&this.vectors.push({x:a+this.x,y:b+this.y})}return this.vector},c.prototype.getBound=function(a,b){var c=4*((b>>0)*this.imageData.width+(a>>0));return this.imageData.data[c+3]>0?!0:!1},c.prototype.getPosition=function(){return this.vector.copy(this.vectors[Math.floor(Math.random()*this.vectors.length)])},c.prototype.getColor=function(a,b){a-=this.x,b-=this.y;var c=4*((b>>0)*this.imageData.width+(a>>0));return{r:this.imageData.data[c],g:this.imageData.data[c+1],b:this.imageData.data[c+2],a:this.imageData.data[c+3]}},c.prototype.crossing=function(a){"dead"==this.crossType?a.dead=this.getBound(a.p.x-this.x,a.p.y-this.y)?!0:!1:"bound"==this.crossType&&(this.getBound(a.p.x-this.x,a.p.y-this.y)||a.v.negate())},V.ImageZone=c;var fb=function(){if(a.console&&a.console.log){var b=arguments;if("string"==typeof arguments[0])if(0==arguments[0].indexOf("+")){var c=parseInt(arguments[0]);fb.once<c&&(delete b[0],console.log(b),fb.once++)}else console.log(b);else console.log(b)}};fb.once=0,V.log=fb;var gb=gb||{addEventListener:function(a,b){a.addEventListener(V.PROTON_UPDATE,function(){b()})},setStyle:function(a){var b=a||"#ff0000",c=V.Util.hexToRGB(b),d="rgba("+c.r+","+c.g+","+c.b+",0.5)";return d},drawZone:function(a,b,c,d){var e=b.getContext("2d"),f=this.setStyle();this.addEventListener(a,function(){d&&e.clearRect(0,0,b.width,b.height),c instanceof V.PointZone?(e.beginPath(),e.fillStyle=f,e.arc(c.x,c.y,10,0,2*Math.PI,!0),e.fill(),e.closePath()):c instanceof V.LineZone?(e.beginPath(),e.strokeStyle=f,e.moveTo(c.x1,c.y1),e.lineTo(c.x2,c.y2),e.stroke(),e.closePath()):c instanceof V.RectZone?(e.beginPath(),e.strokeStyle=f,e.drawRect(c.x,c.y,c.width,c.height),e.stroke(),e.closePath()):c instanceof V.CircleZone&&(e.beginPath(),e.strokeStyle=f,e.arc(c.x,c.y,c.radius,0,2*Math.PI,!0),e.stroke(),e.closePath())})},drawEmitter:function(a,b,c,d){var e=b.getContext("2d"),f=this.setStyle();this.addEventListener(a,function(){d&&e.clearRect(0,0,b.width,b.height),e.beginPath(),e.fillStyle=f,e.arc(c.p.x,c.p.y,10,0,2*Math.PI,!0),e.fill(),e.closePath()})},test:{},setTest:function(a,b){this.test[a]=b},getTest:function(a){return this.test.hasOwnProperty(a)?this.test[a]:!1}};V.Debug=gb}(window),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}();var NinjaPig=function(){this.scene={},this.level={},this.ui={},this.data={},this.player={},this.fx={},this.intro={},this.onReady=function(){alex.log(" ** NinjaPig ** w: "+alex.statics.STAGE_W+" h: "+alex.statics.STAGE_H),this.playerData=new this.data.PlayerData,this.playerData.saveData.retrieve(),game_shell.game.NinjaPigSnd.call(this.sndMgr),this.loadAssets(),this.game.gameScreens.call(game_shell.screenMgr),this.screenMgr.showScreen("load")},this.onAssetsLoaded=function(){this.loader.flow.debug&&alex.log(this.loader.flow.log),this.sndMgr.init(),this.levelData=new game_shell.LevelLayoutData(game_shell.json);var a=alex.statics.MAX_TEXTURES+2;this.canvasPool=new game_shell.ui.CanvasPool(a)}.bind(this),this.loadAssets=function(){this.loader=new alex.load.BulkLoader,this.loader.addEventListener("complete",this.onAssetsLoaded),this.loader.load(alex.statics.ASSET_MANIFEST)}};NinjaPig.call(game_shell),alex.statics.NUM_LEVELS=10,alex.statics.MAX_TEXTURES=14,alex.statics.PLATFORM_RANGE=400,alex.statics.FIRST_SCREEN="title",alex.statics.NONE=-1,alex.statics.ANY=0,alex.statics.VERTICAL=1,alex.statics.HORIZONTAL=2,alex.statics.NOT_DOWN=4,alex.statics.NOT_UP=0,alex.statics.CHEAT_LEVELS=!1,alex.statics.CHEAT_AMMO=!1,alex.statics.CHEAT_RESPAWN=-1,alex.statics.SKIP_INTRO=!1,alex.statics.SKIP_TRAINING=!1,alex.statics.BOSS_LIVES=30,alex.statics.ASSET_MANIFEST="./json/asset_manifest.json",game_shell.LevelLayoutData=function(a){this.data=a,this.getLevelData=function(a){var b="level_"+a,c=this.data[b];return c}},game_shell.data.SaveData=function(a,b){function c(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}}function d(a,b){var c=!0;try{localStorage.removeItem(a),localStorage.setItem(a,b)}catch(d){alex.log("*** LOCAL STORAGE ERROR! "+d.message),c=!1}return c}this.score=a,this.settings=b,this.game="ninja_pig";var e=this.game+"_sfxMuted",f=this.game+"_musicMuted";this.isSupported=c(),this.save=function(){this.isSupported&&(d(this.game,game_shell.version),this.saveScores(),this.saveSettings())},this.saveScores=function(){for(var a,b,c=this.score.getSaveData(),e=c.length,f=0;e>f;f++)a=this.game+"_level_"+(f+1),b=c[f],d(a,b)},this.saveSettings=function(){alex.log("saveSettings"),alex.log("sfxMuted: "+this.settings.sfxMuted),alex.log("musicMuted: "+this.settings.musicMuted),d(e,this.settings.sfxMuted),d(f,this.settings.musicMuted)},this.retrieve=function(){if(this.isSupported&&this.check()){var a,b,c=this.score.getSaveData(),d=c.length,g=[];try{for(var h=0;d>h;h++)a=this.game+"_level_"+(h+1),b=localStorage[a],g[h]=b}catch(i){alex.log("*** SaveData -> ERROR restoring from saved")}g.length>0&&this.score.restoreSaved(g),this.settings.sfxMuted="true"==localStorage[e],this.settings.musicMuted="true"==localStorage[f]}},this.check=function(){var a=!1;if(!this.isSupported)return a;var b=localStorage[this.game];return"string"==typeof b&&b.length>0&&(a=!0),a}},game_shell.data.DummySave=function(){this.isSupported=!1,this.save=function(){},this.saveScores=function(){},this.saveSettings=function(){},this.retrieve=function(){},this.check=function(){var a=!1;return a}},game_shell.data.Score=function(){var a=alex.statics;this.levels=[];for(var b=0;b<a.NUM_LEVELS;b++)this.levels[b]=new game_shell.data.LevelScore(b);this.levels[0].unlock(),this.getLevelData=function(a){return this.levels[a-1]},this.getSaveData=function(){for(var a,b=this.levels.length,c=[],d=0;b>d;d++)a=this.levels[d],c[d]=a.getData();return c},this.restoreSaved=function(a){for(var b,c,d=a.length,e=0;d>e;e++)b=this.levels[e],c=a[e],b.restore(c)},this.levelCompleted=function(a){var b=a.index;if(a.levelCompleted(),a.index<this.levels.length-1){var c=this.levels[b+1];c.unlock()}},this.getTotalStars=function(){for(var a,b=0,c=this.levels.length,d=0;c>d;d++)a=this.levels[d],a.unlocked&&(b+=a.getBestStarRating());return b}},game_shell.data.LevelScore=function(a){this.index=a,this.currentScore=new game_shell.data.ScoreData,this.bestScore=new game_shell.data.ScoreData,this.collect=function(){this.currentScore.ammo++,this.currentScore.collected++},this.unlock=function(){this.currentScore.unlocked=!0,this.bestScore.unlocked=!0},this.levelCompleted=function(){this.isBetter()&&this.bestScore.copy(this.currentScore)},this.reset=function(){this.currentScore.reset()},this.getBestStarRating=function(){return this.bestScore.getStarRating()},this.getCurrentStarRating=function(){return this.currentScore.getStarRating()},this.isBetter=function(){var a=!1,b=this.getCurrentStarRating(),c=this.getBestStarRating();return b>c&&(a=!0),a},this.playerRespawn=function(){this.currentScore.ammo=0,this.currentScore.kills=0,this.currentScore.respawns++},this.makeKill=function(){this.currentScore.kills++},this.useAmmo=function(){this.currentScore.ammo--},this.getAmmo=function(){return this.currentScore.ammo},this.restore=function(a){var b=JSON.parse(a);this.bestScore.ammo=b.ammo,this.bestScore.kills=b.kills,this.bestScore.collected=b.collected,this.bestScore.unlocked=b.unlocked,this.bestScore.respawns=b.respawns},this.getData=function(){var a=this.isBetter(),b=null;b=a?this.currentScore:this.bestScore;var c={ammo:b.ammo,kills:b.kills,collected:b.collected,unlocked:b.unlocked,respawns:b.respawns};return JSON.stringify(c)}},Object.defineProperty(game_shell.data.LevelScore.prototype,"unlocked",{get:function(){return this.bestScore.unlocked}}),game_shell.data.ScoreData=function(){this.ammo=0,this.collected=0,this.kills=0,this.respawns=0,this.unlocked=!1,this.reset=function(){this.ammo=0,this.collected=0,this.kills=0,this.respawns=0},this.copy=function(a){this.ammo=a.ammo,this.collected=a.collected,this.kills=a.kills,this.respawns=a.respawns},this.getStarRating=function(){var a=0;return 0===this.respawns&&this.kills>1&&this.ammo>0?a=3:this.respawns<2&&this.kills>0&&this.ammo>0?a=2:this.respawns<5&&this.collected>0&&(a=1),a}},game_shell.data.UserSettings=function(){this.sfxMuted=!1,this.musicMuted=!1},game_shell.data.PlayerData=function(){this.level=1,this.introViewed=!1,this.chosenLevel="title",this.score=new game_shell.data.Score,this.settings=new game_shell.data.UserSettings,this.saveData=new game_shell.data.SaveData(this.score,this.settings)},game_shell.ItemTypes={TYPE_PLAYER:1,TYPE_PLATFORM:2,TYPE_CONVEYOR:3,TYPE_JUMP_PAD:4,TYPE_COLLECTABLE:5,TYPE_MOVING_PLATFORM:6,TYPE_EVENT_TRIGGER:7,TYPE_BOSS:8,TYPE_DOOR:10,TYPE_LEVEL_END:11,TYPE_HAZARD:12,TYPE_SLOPE_UP:13,TYPE_SLOPE_DOWN:14,TYPE_VERTICAL_PLATFORM:16,TYPE_BULLET:17,TYPE_FG_ITEM:19,TYPE_PARALLAX_1:20,TYPE_PARALLAX_2:21,TYPE_PARALLAX_3:22,TYPE_BLOCK:23,TYPE_HORIZONTAL_HAZARD:24,TYPE_VERTICAL_HAZARD:25,TYPE_SINKING_PLATFORM:26,TYPE_BG_ITEM:27},game_shell.HazardTypes={STATIC:1,HORIZONTAL:2,VERTICAL:3,TRAP:4},game_shell.ui.BackgroundUtil=function(){var a=alex.statics;this.cache={},this.focusY=.5;var b=100;return this.getPreset=function(a){var c=null;switch(a){case"load":c={c1:"#ae2b01",c2:"#fdc500",c3:"#fd2800",focusY:.5,segs:b};break;case"game":c={c1:"#FFDF6D",c2:"#FFF0B4",c3:"#EECF4F",focusY:.8,segs:b}}return c},this.applyPreset=function(a){var b=this.getBackground(a);return this.setBackground(b),b},this.getBackground=function(b){var c=this.cache[b];if("undefined"==typeof c){var d=this.getPreset(b);this.focusY=d.focusY;var e=a.SCALE_FACTOR,f=a.DEFAULT_W*e,g=a.DEFAULT_H*e;c=this.generateBackground(d.c1,d.c2,d.c3,d.segs,f,g,document.createElement("canvas")),this.cache[b]=c}else c=this.cache[b];return c},this.getSprite=function(a){var b=game_shell.ui.BackgroundUtil.getBackground(a),c=new PIXI.BaseTexture(b),d=new PIXI.Texture(c),e=new PIXI.Sprite(d);return e.pivot.x=.5*e.width,e},this.generateBackground=function(b,c,d,e,f,g,h){var h=h||document.createElement("canvas"),i=a.SCALE_FACTOR,j=f||a.DEFAULT_W*i,k=g||a.DEFAULT_H*i;h.width=j,h.height=k;var l=h.getContext("2d");l.fillStyle=b,l.fillRect(0,0,j,k);var m=.5*j,n=k*this.focusY,o=l.createRadialGradient(m,n,10,m,n,j);o.addColorStop(0,c),o.addColorStop(1,d),l.fillStyle=o;for(var p=e||36,q=0,r=2*Math.PI/p,s=0;p>s;s++)s%2===0&&(q=r*s,l.beginPath(),l.moveTo(m,n),l.arc(m,n,j,q,q+r),l.lineTo(m,n),l.closePath(),l.fill());return h},this.createSegments=function(){var c=game_shell.canvasPool.next(),d=1.2*a.DEFAULT_W,e=d;c.width=d,c.height=e;var f=c.getContext("2d");f.fillStyle="#ffffff";for(var g=.5*d,h=.5*e,i=b,j=0,k=2*Math.PI/i,l=0;i>l;l++)l%2===0&&(j=k*l,f.beginPath(),f.moveTo(g,h),f.arc(g,h,d,j,j+k,!1),f.lineTo(g,h),f.closePath(),f.fill());var m=new PIXI.BaseTexture(c),n=new PIXI.Texture(m),o=new PIXI.Sprite(n);return o.pivot.x=.5*o.width,o.pivot.y=.5*o.height,o},this.setBackground=function(a){var b=document.getElementById("game"),c=a.toDataURL();b.style.backgroundImage="url("+c+")",b.style.backgroundSize="100% 100%",b.style.backgroundPosition="center",b.style.backgroundOrigin="content-box"},this}(),game_shell.ui.CanvasPool=function(a){for(this.pool=[];a>0;)a--,this.pool[this.pool.length]=document.createElement("canvas");this.next=function(){var a=this.pool[0];return this.pool[this.pool.length]=a,this.pool.shift(),a}},PIXI.CanvasBuffer=function(a,b){this.width=a,this.height=b,this.canvas=game_shell.canvasPool.next(),this.context=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=b},game_shell.ui.ParchmentMenu=function(a){function b(){var a=new PIXI.RenderTexture(s.width,s.height);a.render(w);var b=new PIXI.Sprite(a);return b.x=w.x,b.y=w.y,b}function c(a,b){var c=new alex.display.Button("menu_btn.png","menu_btn_down.png");c.x=a*n,c.y=b*n,w.addChild(c),y[y.length]=c,c.index=y.length;var f=c.index.toString(),g=40*n,h=g.toString()+"px epicslash",i={font:h,align:"left"},j=new PIXI.BitmapText(f,i);j.pivot.y=.5*g;var k=c.x+35*n;j.x=k,j.y=c.y+.5*c.height;var l=game_shell.playerData.score.getLevelData(c.index),o=l.unlocked||m.CHEAT_LEVELS||1===c.index;if(o){w.addChild(j),c.addEventListener("release",d);var p=l.getBestStarRating();p>0&&e(a,b,99),p>1&&e(a,b,148),p>2&&e(a,b,198)}else{var q=new PIXI.Sprite(PIXI.TextureCache["locked.png"]);q.x=k,q.y=b*n,w.addChild(q),c.enabled=!1}return c}function d(a){var b=a.target,c=b.index;p.isReady=!1,alex.log("select "+c),p.dispatchEvent({type:"select",index:c})}function e(a,b,c){var d=b*n+9*n,e=a*n+c*n,f=new PIXI.Sprite(PIXI.TextureCache["star_icon.png"]);f.x=e,f.y=d,w.addChild(f)}function f(){z.removeFromParent(),o.addChild(w),o.addChild(A),o.addChild(B),this.isReady=!0}function g(){var a={open:r,l:-q,r:q},b={open:1,l:-u,r:u},c=new TWEEN.Tween(a),d=350;c.to(b,d),c.onUpdate(function(){E(this.open),A.x=this.l,B.x=this.r}),c.onComplete(function(){f()}),c.easing(TWEEN.Easing.Quartic.In),c.start(),game_shell.sndMgr.play("MENU_OPEN")}function h(){var a={open:r,l:-q,r:q},b={open:1,l:-u,r:u},c=new TWEEN.Tween(b),d=350;c.to(a,d),c.onUpdate(function(){E(this.open),A.x=this.l,B.x=this.r});var e=this;c.onComplete(function(){l.call(e)}),c.easing(TWEEN.Easing.Quartic.In),c.start(),game_shell.sndMgr.play("MENU_OPEN")}function i(a){var b=a*t,c=(1-a)*u,d=v+c,e=z;x.width=b,x.x=c,e.x=d,e.texture.setFrame(x)}function j(a){var b=a*t,c=(1-a)*u,d=v+c;x.width=b,x.x=c,z.x=d;var e=z.texture;e.frame=x,e.crop=x,e.width=x.width,e.height=x.height,PIXI.Texture.frameUpdates.push(e)}function k(){o.scale.x=o.scale.y=r;var a={scale:r},b={scale:1},c=new TWEEN.Tween(a),d=350;c.to(b,d),c.onUpdate(function(){o.scale.x=this.scale,o.scale.y=this.scale}),c.delay(250),c.onComplete(function(){g()}),c.easing(TWEEN.Easing.Quartic.In),c.onStart(function(){game_shell.sndMgr.play("FIRE")}),c.start()}function l(){var a={scale:0},b={scale:1},c=new TWEEN.Tween(b),d=350;c.to(a,d),c.onUpdate(function(){o.scale.x=this.scale,o.scale.y=this.scale}),c.delay(150);var e=this;c.onComplete(function(){o.visible=!1,z.removeFromParent(),e.dispatchEvent({type:"exit"})}),c.easing(TWEEN.Easing.Quartic.In),c.start(),game_shell.sndMgr.play("FIRE")}alex.utils.EventDispatcher.call(this);var m=alex.statics,n=m.SCALE_FACTOR,o=new PIXI.DisplayObjectContainer;o.y=.5*m.STAGE_H,a.addChild(o),this.isReady=!1;var p=this,q=70*n,r=.12,s=new PIXI.Sprite(PIXI.TextureCache["scroll_body.png"]),t=s.width,u=(s.height,.5*t),v=-u,w=new PIXI.DisplayObjectContainer;w.x=v,w.y=s.height*-.5,w.addChild(s),o.addChild(w);var x=new PIXI.Rectangle(0,0,t,s.height),y=[];c(87,13),c(87,80),c(87,147),c(87,214),c(87,281),c(438,13),c(438,80),c(438,147),c(438,214),c(438,281);var z=b();w.removeFromParent(),o.addChild(z);var A=new PIXI.Sprite(PIXI.TextureCache["scroll_end.png"]);A.pivot.x=.5*A.width,A.pivot.y=.5*A.height,A.x=-q,o.addChild(A);var B=new PIXI.Sprite(PIXI.TextureCache["scroll_end.png"]);B.pivot.x=.5*B.width,B.pivot.y=.5*B.height,B.x=q,o.addChild(B);var C=PIXI.defaultRenderer.type,D=C===PIXI.WEBGL_RENDERER,E=null;E=D?j:i,this.exit=function(){w.removeFromParent(),o.addChild(z),o.addChild(A),o.addChild(B),h.call(this)},this.show=function(){E(r),k()}},game_shell.ui.ParchmentMenu.constructor=game_shell.ui.ParchmentMenu,game_shell.ui.ParchmentMenu.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.ui.EndLevelPopup=function(){function a(a){var b=new PIXI.Sprite(PIXI.TextureCache["popup_star_empty.png"]);b.pivot.x=.5*b.width,b.pivot.y=.5*b.height,b.x=a*c,this.content.addChild(b);var d=new PIXI.Sprite(PIXI.TextureCache["popup_star_glow.png"]);return d.pivot.x=.5*d.width,d.pivot.y=.5*d.height,d.x=a*c,this.content.addChild(d),d.visible=!1,d}alex.ui.PopupBase.call(this);var b=alex.statics,c=b.SCALE_FACTOR,d=new PIXI.Sprite(PIXI.TextureCache["bamboo_panel.png"]);d.pivot.x=.5*d.width;var e=.5*d.height;d.pivot.y=e,this.content.addChild(d),this.minScale=0,this.isClosing=!1;var f=new PIXI.Sprite(PIXI.TextureCache["sword_low.png"]);f.pivot.x=.5*f.width,f.pivot.y=.5*f.height,f.y=.8*e,this.content.addChild(f);var g=new PIXI.Sprite(PIXI.TextureCache["sword_high.png"]);g.pivot.x=.5*g.width,g.pivot.y=.5*g.height,g.y=e*-.8,this.content.addChild(g),this.star1=a.call(this,-160),this.star2=a.call(this,0),this.star3=a.call(this,160);var h=new PIXI.DisplayObjectContainer;h.x=0,h.y=30*c,this.content.addChild(h),this.protonFx=new game_shell.fx.Particles(h,"particle_star",4)},game_shell.ui.EndLevelPopup.constructor=alex.ui.PopupBase,game_shell.ui.EndLevelPopup.prototype=Object.create(alex.ui.PopupBase.prototype),game_shell.ui.EndLevelPopup.prototype.show=function(a){this.starRating=a.getCurrentStarRating(),alex.log("EndLevelPopup -> star rating = "+this.starRating),game_shell.sndMgr.play("WIN_POPUP"),alex.ui.PopupBase.prototype.show.call(this)},game_shell.ui.EndLevelPopup.prototype.onShown=function(){this.totalizer(),alex.ui.PopupBase.prototype.onShown.call(this)},game_shell.ui.EndLevelPopup.prototype.totalizer=function(){var a=this,b={t:0},c={t:this.starRating},d=new TWEEN.Tween(b),e=1e3;d.to(c,1e3),d.delay(250),d.onUpdate(function(){a.totalize(this.t)}),d.onComplete(function(){a.onTotalizerComplete()}),d.onStart(function(){a.fireParticles(e/1e3)}),d.start()},game_shell.ui.EndLevelPopup.prototype.fireParticles=function(a){if(this.starRating>0){var b=0,c=-30*alex.statics.SCALE_FACTOR,d=a||this.starRating;this.protonFx.fire(b,c,d),game_shell.sndMgr.play("WIN_LEVEL")}},game_shell.ui.EndLevelPopup.prototype.onTotalizerComplete=function(){},game_shell.ui.EndLevelPopup.prototype.totalize=function(a){var b=Math.floor(a);b>0&&(this.star1.visible=!0),b>1&&(this.star2.visible=!0),b>2&&(this.star3.visible=!0)},game_shell.ui.SettingsPanel=function(){function a(){var a=alex.statics.STAGE_W,j=alex.statics.STAGE_H;i.blackQuad=new alex.display.Quad(1.3*a,j,0),i.blackQuad.alpha=0,i.addChild(i.blackQuad),i.blackQuad.interactive=!0,i.blackQuad.mousedown=i.blackQuad.touchstart=function(){alex.log("hide!"),i.hide()};var k=new PIXI.Sprite(PIXI.TextureCache["bamboo_panel.png"]),m=k.height;k.y=20*l,k.rotation=90*(Math.PI/180),k.interactive=!0,k.mousedown=k.touchstart=function(){},k.mouseup=k.touchend=function(){},i.blackQuad.x=-m,i.addChild(k),i.buttons=[];{var n=-170,o=80,p=120;b("btn_close.png","btn_close_down.png",d,-40,30,"btnClose"),b("btn_menu.png","btn_menu_down.png",e,n,o,"btnHome")}i.btnSfx=c("btn_mute_sfx_on.png","btn_mute_sfx.png",f,n,o+p,"btnSfx"),i.btnMusic=c("btn_mute_music_on.png","btn_mute_music.png",g,n,o+2*p,"btnMusic");b("btn_help.png","btn_help_down.png",h,n,o+3*p,"btnHelp");i.visible=!1,i.isOpen=!1}function b(a,b,c,d,e,f){var g=new alex.display.Button(a,b);return g.x=d*l,g.y=e*l,g.name=f,i.addChild(g),i.buttons[i.buttons.length]=g,g.addEventListener("release",c.bind(i)),g}function c(a,b,c,d,e,f){var g=new alex.display.Toggle(a,b,!1);return g.x=d*l,g.y=e*l,g.name=f,i.addChild(g),i.buttons[i.buttons.length]=g,g.addEventListener("toggle",c.bind(i)),g}function d(){this.hide(),game_shell.sndMgr.play("BUTTON_PRESS")}function e(){game_shell.sndMgr.play("BUTTON_PRESS"),i.dispatchEvent({type:"home"})}function f(a){var b=a.target,c=b.isOn;alex.log("onSfxPressed -> muted = "+c),m.muteGroup(k,c),game_shell.playerData.settings.sfxMuted=c,game_shell.playerData.saveData.saveSettings()}function g(a){var b=a.target,c=b.isOn;alex.log("onMusicPressed -> muted = "+c),m.muteGroup(j,c),game_shell.playerData.settings.musicMuted=c,game_shell.playerData.saveData.saveSettings()}function h(a){alex.log("onHelpPressed"+a.target.name),game_shell.sndMgr.play("BUTTON_PRESS"),i.dispatchEvent({type:"help"})}PIXI.DisplayObjectContainer.call(this),alex.utils.EventDispatcher.prototype.apply(this);var i=this,j="music",k="sfx",l=alex.statics.SCALE_FACTOR,m=game_shell.sndMgr;this.blackQuad=null,this.quadAlpha=.3,a(),this.updateToggleStates=function(){var a=game_shell.playerData.settings,b=a.musicMuted,c=this.btnSfx,d=this.btnMusic;b&&!d.isOn?d.setOn():!b&&d.isOn&&d.setOff();var e=a.sfxMuted;e&&!c.isOn?c.setOn():!e&&c.isOn&&c.setOff()}},game_shell.ui.SettingsPanel.constructor=game_shell.ui.SettingsPanel,game_shell.ui.SettingsPanel.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),game_shell.ui.SettingsPanel.prototype.show=function(){if(!this.isOpen){this.visible=!0;var a={x:this.x,a:0},b=alex.statics.SCALE_FACTOR,c={x:200*b,a:this.quadAlpha},d=new TWEEN.Tween(a);d.to(c,250);var e=this;d.onUpdate(function(){e.x=this.x,e.blackQuad.alpha=this.a}),d.onComplete(function(){e.isOpen=!0}),d.start(),this.updateToggleStates(),game_shell.sndMgr.play("BUTTON_PRESS")}},game_shell.ui.SettingsPanel.prototype.toString=function(){return"[object SettingsPanel]"},game_shell.ui.SettingsPanel.prototype.hide=function(){var a={x:this.x,a:this.quadAlpha},b={x:0,a:0},c=new TWEEN.Tween(a);c.to(b,250);var d=this;c.onUpdate(function(){d.x=this.x,d.blackQuad.alpha=this.a}),c.onComplete(function(){d.onClosed()}),c.start()},game_shell.ui.SettingsPanel.prototype.onClosed=function(){this.visible=!1,this.isOpen=!1,this.dispatchEvent({type:"closed"})},game_shell.ui.AmmoCounter=function(){var a=alex.statics;this.root=new PIXI.DisplayObjectContainer;var b=new PIXI.Sprite(PIXI.TextureCache["ammo_counter.png"]);this.root.addChild(b);var c=new PIXI.Sprite(PIXI.TextureCache["shuriken.png"]);c.pivot.x=.5*c.width,c.x=.5*b.width,this.root.addChild(c),b.y=c.height;var d=a.SCALE_FACTOR,e=60*d,f=e.toString()+"px epicslash",g={font:f},h=new PIXI.BitmapText("0",g);h.x=.5*b.width,h.y=b.y,this.root.addChild(h),this.setCount=function(a){h.setText(a.toString()),a>9&&(h.x=.3*b.width)}},game_shell.ui.InGameTraining=function(){alex.utils.EventDispatcher.call(this),this.elements={},this.settings={},game_shell.ui.HelpBuilder.call(this),this.isPlaying=!1;var a=new game_shell.ui.HelpStateManager(this),b=this;this.play=function(b){this.isPlaying||(this.isPlaying=!0,this.reset(),b.addChild(this.elements.root),a.next())},this.cancel=function(){TWEEN.removeAll(),this.isPlaying=!1,this.elements.root.removeFromParent(),this.reset()},this.fadeInOverlay=function(){var a=this,b={a:0},c={a:this.settings.quadAlpha},d=new TWEEN.Tween(b);d.to(c,this.settings.duration),d.onUpdate(function(){a.elements.overlay.alpha=this.a}),d.onComplete(function(){a.fadeInContent.call(a)}),d.start()},this.fadeInContent=function(){this.elements.content.visible=!0;var c={a:0},d={a:1},e=new TWEEN.Tween(c);e.to(d,this.settings.duration),e.onUpdate(function(){b.elements.content.alpha=this.a}),e.onComplete(function(){a.next()}),e.start()},this.jumpHandOn=function(){this.elements.handFrame.height=this.settings.handMinH,this.elements.handJump.texture.setFrame(this.elements.handFrame),this.elements.handJump.visible=!0;var c={y:this.elements.handJump.y,h:this.settings.handMinH},d={y:this.elements.ring1.y,h:.8*this.settings.handH},e=new TWEEN.Tween(c);e.to(d,this.settings.duration),e.onUpdate(function(){b.elements.handJump.y=this.y,b.elements.handFrame.height=this.h,b.elements.handJump.texture.setFrame(b.elements.handFrame)}),e.onComplete(function(){a.next()}),e.start()},this.figureJumpUp=function(){var a={y:this.settings.stickY},c={y:this.settings.stickY-this.settings.jumpH},d=new TWEEN.Tween(a);d.to(c,this.settings.duration),d.easing(TWEEN.Easing.Quartic.Out),d.onUpdate(function(){b.elements.stickman.y=this.y}),d.onComplete(function(){b.figureJumpDown()}),d.start(),game_shell.sndMgr.jump()},this.figureJumpDown=function(){var a={y:this.settings.stickY-this.settings.jumpH},c={y:this.settings.stickY},d=new TWEEN.Tween(a);d.to(c,this.settings.duration),d.easing(TWEEN.Easing.Quartic.In),d.onUpdate(function(){b.elements.stickman.y=this.y}),d.start()},this.jumpRings=function(){game_shell.sndMgr.play("BUTTON_PRESS");var b={p:0},c={p:4},d=new TWEEN.Tween(b),e=this.elements.ring3,f=this.elements.ring4;d.to(c,2*this.settings.duration),d.onUpdate(function(){e.visible=this.p<3,f.visible=this.p>1&&this.p<4}),d.onComplete(function(){a.next()}),d.start()},this.jumpHandOff=function(){var c={y:this.elements.ring1.y,h:this.elements.handFrame.h},d={y:this.settings.handOffY,h:this.settings.handMinH},e=new TWEEN.Tween(c);e.to(d,this.settings.duration),e.onUpdate(function(){b.elements.handJump.y=this.y,b.elements.handFrame.height=this.h,b.elements.handJump.texture.setFrame(b.elements.handFrame)}),e.onComplete(function(){b.elements.handJump.visible=!1,b.elements.handJump.texture.setFrame(b.elements.defFrame),a.next()}),e.start()},this.fireHandOn=function(){this.elements.fireFrame.height=this.settings.handMinH,this.elements.handFire.texture.setFrame(this.elements.fireFrame),this.elements.handFire.visible=!0;var c={y:this.elements.handFire.y,h:this.settings.handMinH},d={y:this.elements.ring1.y,h:.8*this.settings.handH},e=new TWEEN.Tween(c);e.to(d,this.settings.duration),e.onUpdate(function(){b.elements.handFire.y=this.y,b.elements.fireFrame.height=this.h,b.elements.handFire.texture.setFrame(b.elements.fireFrame)}),e.delay(this.settings.duration),e.onComplete(function(){a.next()}),e.start()},this.figureFire=function(){this.elements.bullet.visible=!0;var c={x:0,r:0},d={x:0,r:0},e={x:this.settings.bulletOffX,r:7},f={x:this.settings.bulletOffX,r:7},g=new TWEEN.Tween(c);g.to(e,1.5*this.settings.duration),g.onUpdate(function(){b.elements.bullet.x=this.x,b.elements.bullet.rotation=this.r});var h=new TWEEN.Tween(d);h.to(f,1.5*this.settings.duration),h.delay(1.6*this.settings.duration),h.onUpdate(function(){b.elements.bullet.x=this.x,b.elements.bullet.rotation=this.r}),h.onComplete(function(){b.elements.bullet.visible=!1,a.state===a.stateExit&&a.next()}),h.onStart(function(){game_shell.sndMgr.play("FIRE")}),h.start(),g.start(),game_shell.sndMgr.play("FIRE")},this.fireRings=function(){game_shell.sndMgr.play("BUTTON_PRESS");var b={p:0},c={p:4},d=new TWEEN.Tween(b),e=this.elements.ring1,f=this.elements.ring2;d.to(c,2*this.settings.duration),d.onUpdate(function(){e.visible=this.p<3,f.visible=this.p>1&&this.p<4}),d.onComplete(function(){a.next()}),d.start()},this.fireHandOff=function(){var c={y:this.elements.ring1.y,h:this.elements.fireFrame.height},d={y:this.settings.handOffY,h:this.settings.handMinH},e=new TWEEN.Tween(c);e.to(d,this.settings.duration),e.onUpdate(function(){b.elements.handFire.y=this.y,b.elements.fireFrame.height=this.h,b.elements.handFire.texture.setFrame(b.elements.fireFrame)}),e.onComplete(function(){b.elements.handFire.visible=!1,b.elements.handFire.texture.setFrame(b.elements.defFrame),a.next()}),e.start()},this.keysOn=function(){var c={y:this.elements.keyHolder.y},d={y:0},e=new TWEEN.Tween(c);e.to(d,this.settings.duration),e.onUpdate(function(){b.elements.keyHolder.y=this.y}),e.onComplete(function(){a.next()}),e.start()},this.arrowPress=function(){var c={s:0},d={s:Math.PI},e=new TWEEN.Tween(c);e.to(d,this.settings.duration),e.delay(2*this.settings.duration),e.onStart(function(){game_shell.sndMgr.play("BUTTON_PRESS")}),e.onUpdate(function(){var a=1-Math.sin(this.s);b.elements.upKey.scale.x=b.elements.upKey.scale.y=.9+.1*a}),e.onComplete(function(){b.elements.upKey.scale.x=b.elements.upKey.scale.y=1,a.next()}),e.start()},this.spacePress=function(){game_shell.sndMgr.play("BUTTON_PRESS");var c={s:0},d={s:Math.PI},e=new TWEEN.Tween(c);e.to(d,this.settings.duration),e.onStart(function(){game_shell.sndMgr.play("BUTTON_PRESS")}),e.delay(3*this.settings.duration),e.onUpdate(function(){var a=1-Math.sin(this.s);b.elements.spaceKey.scale.x=b.elements.spaceKey.scale.y=.9+.1*a}),e.onComplete(function(){b.elements.spaceKey.scale.x=b.elements.spaceKey.scale.y=1,a.next()}),e.start()},this.reset=function(){this.elements.content.visible=!1,this.elements.ring1.visible=!1,this.elements.ring2.visible=!1,this.elements.ring3.visible=!1,this.elements.ring4.visible=!1,this.elements.content.alpha=0,this.elements.overlay.alpha=0,this.elements.handJump.y=this.settings.handOffY,this.elements.ring1.visible=!1,this.elements.ring2.visible=!1,this.elements.handJump.visible=!1,this.elements.handFire.visible=!1,this.elements.bullet.visible=!1,this.elements.bullet.x=0,a.reset()},this.complete=function(){var a={a1:1,a2:this.settings.quadAlpha},c={a1:0,a2:0},d=new TWEEN.Tween(a);d.to(c,this.settings.duration),d.delay(3*this.settings.duration),d.onUpdate(function(){b.elements.content.alpha=this.a1,b.elements.overlay.alpha=this.a2
}),d.onComplete(function(){b.remove()}),d.start()},this.remove=function(){this.elements.root.removeFromParent(),this.isPlaying=!1,this.dispatchEvent({type:"complete"})}},game_shell.ui.InGameTraining.constructor=game_shell.ui.InGameTraining,game_shell.ui.InGameTraining.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.ui.HelpStateManager=function(a){this.help=a;var b=-1;this.stateNone=b,this.stateEnter=++b,this.stateJumpHandOn=++b,this.stateJumpRings=++b,this.stateJumpHandOff=++b,this.stateFireHandOn=++b,this.stateFireRings=++b,this.stateFireHandOff=++b,this.stateKeysOn=++b,this.stateArrowKey=++b,this.stateSpaceKey=++b,this.stateExit=++b,this.state=this.stateNone,this.reset=function(){this.state=this.stateNone},this.next=function(){switch(this.state){case this.stateNone:this.help.fadeInOverlay(),this.state=this.stateEnter;break;case this.stateEnter:this.help.jumpHandOn(),this.state=this.stateJumpHandOn;break;case this.stateJumpHandOn:this.help.jumpRings(),this.state=this.stateJumpRings;break;case this.stateJumpRings:this.help.figureJumpUp(),this.help.jumpHandOff(),this.state=this.stateJumpHandOff;break;case this.stateJumpHandOff:this.help.fireHandOn(),this.state=this.stateFireHandOn;break;case this.stateFireHandOn:this.help.fireRings(),this.state=this.stateFireRings;break;case this.stateFireRings:this.help.fireHandOff(),this.help.figureFire(),this.state=this.stateFireHandOff;break;case this.stateFireHandOff:this.help.keysOn(),this.state=this.stateKeysOn;break;case this.stateKeysOn:this.help.arrowPress(),this.state=this.stateArrowKey;break;case this.stateArrowKey:this.help.figureJumpUp(),this.state=this.stateSpaceKey,this.help.spacePress();break;case this.stateSpaceKey:this.help.figureFire(),this.state=this.stateExit;break;case this.stateExit:this.help.complete()}}},game_shell.ui.HelpBuilder=function(){function a(a){for(var b,c,d=new PIXI.Rectangle,e=game_shell.json.atlas1,f=e.frames,g=f.length,h=0;g>h;h++)if(b=f[h],b.filename==a){c=b.frame,d.x=c.x,d.y=c.y,d.width=c.w,d.height=c.h;break}return d}function b(a){var b=new PIXI.Sprite(PIXI.TextureCache["hand.png"]);return w=b.height,b.pivot.x=.44*b.width,b.pivot.y=.16*w,b.y=t,b.x=a,d.addChild(b),b}var c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=0,t=0,u=0,v=0,w=0,x=.35,y=alex.statics,z=y.SCALE_FACTOR,A=y.STAGE_W,B=y.STAGE_H,C=1,D=300;c=new PIXI.DisplayObjectContainer,e=new alex.display.Quad(A,B,0),e.pivot.x=.5*A,e.alpha=x,c.interactive=!0,c.mousedown=c.touchstart=function(){},c.mouseup=c.touchend=function(){},c.addChild(e),d=new PIXI.DisplayObjectContainer,c.addChild(d),r=new PIXI.Sprite(PIXI.TextureCache["device.png"]),r.pivot.x=.5*r.width,r.pivot.y=.5*r.height,r.y=.5*B,d.addChild(r),f=new PIXI.Sprite(PIXI.TextureCache["ring1.png"]),f.pivot.x=.5*f.width,f.pivot.y=.5*f.height,f.y=r.y+.05*r.height,f.x=r.width*-.2,d.addChild(f),g=new PIXI.Sprite(PIXI.TextureCache["ring2.png"]),g.pivot.x=.5*g.width,g.pivot.y=.5*g.height,g.y=f.y,g.x=f.x,d.addChild(g),h=new PIXI.Sprite(PIXI.TextureCache["ring1.png"]),h.pivot.x=.5*h.width,h.pivot.y=.5*h.height,h.y=f.y,h.x=.2*r.width,d.addChild(h),i=new PIXI.Sprite(PIXI.TextureCache["ring2.png"]),i.pivot.x=.5*i.width,i.pivot.y=.5*i.height,i.y=f.y,i.x=h.x,d.addChild(i),t=r.y+r.pivot.y,k=b(f.x),j=b(i.x),k.scale.x=-1,l=new PIXI.Sprite(PIXI.TextureCache["stick_man.png"]),l.pivot.x=.5*l.width,l.pivot.y=l.height,u=r.y+.35*r.pivot.y,l.y=u,v=.5*r.pivot.y,d.addChild(l),m=new PIXI.Sprite(PIXI.TextureCache["training_bullet.png"]),m.pivot.x=.5*m.width,m.pivot.y=.5*m.height,m.y=r.y,s=.75*r.pivot.x,d.addChild(m),n=new PIXI.DisplayObjectContainer,d.addChild(n),n.y=r.y,o=new PIXI.Sprite(PIXI.TextureCache["arrows_lr.png"]),o.x=.5*r.width-o.width,o.y=r.y+.8*r.height,n.addChild(o);var E=8*z;p=new PIXI.Sprite(PIXI.TextureCache["arrow_up.png"]),p.pivot.x=.5*p.width,p.pivot.y=.5*p.height,p.x=o.x+1.5*p.width+E,p.y=o.y-(p.pivot.y+E),n.addChild(p),q=new PIXI.Sprite(PIXI.TextureCache["space_bar.png"]),q.pivot.x=.5*q.width,q.pivot.y=.5*q.height,q.x=r.x-.5*r.width+q.pivot.x,q.y=o.y+q.pivot.y,n.addChild(q),this.elements.root=c,this.elements.content=d,this.elements.overlay=e,this.elements.ring1=f,this.elements.ring2=g,this.elements.ring3=h,this.elements.ring4=i,this.elements.handJump=j,this.elements.handFire=k,this.elements.stickman=l,this.elements.bullet=m,this.elements.keyHolder=n,this.elements.arrowKeys=o,this.elements.upKey=p,this.elements.spaceKey=q,this.elements.phone=r,this.elements.handFrame=a("hand.png"),this.elements.defFrame=new PIXI.Rectangle(this.elements.handFrame.x,this.elements.handFrame.y,this.elements.handFrame.width,this.elements.handFrame.height),this.elements.fireFrame=new PIXI.Rectangle(this.elements.handFrame.x,this.elements.handFrame.y,this.elements.handFrame.width,this.elements.handFrame.height),this.settings.bulletOffX=s,this.settings.handOffY=t,this.settings.stickY=u,this.settings.jumpH=v,this.settings.handH=w,this.settings.quadAlpha=x,this.settings.duration=D,this.settings.handMinH=C},game_shell.ui.StarField=function(){function a(){var a=c.shift();c[c.length]=a,a.alpha=0,a.x=0,a.y=0,a.rotation=Math.random()*Math.PI,a.scale.x=a.scale.y=.1,d.addChild(a);var b=h*-Math.random(),e=g*Math.cos(b),f=g*Math.sin(b),j={x:0,y:0,a:0,s:.1},k={x:e,y:f,a:10,s:1},l=new TWEEN.Tween(j);l.to(k,i),l.onUpdate(function(){var b=this.a;b>1&&(b=1),a.alpha=b,a.x=this.x,a.y=this.y,a.scale.x=a.scale.y=this.s}),l.onComplete(function(){a.removeFromParent()}),l.easing(TWEEN.Easing.Quadratic.In),l.start()}PIXI.DisplayObjectContainer.call(this);for(var b,c=[],d=this,e=150,f=0;e>f;f++)b=new PIXI.Sprite(PIXI.TextureCache["popup_star_glow.png"]),b.pivot.x=.5*b.width,b.pivot.y=.5*b.height,c[f]=b;this.y=.5*alex.statics.STAGE_H;var g=.65*alex.statics.STAGE_W,h=2*Math.PI,i=1500,j=0,k=20;this.update=function(b){return j+=b,j>k&&(a(),j=0),!0}},game_shell.ui.StarField.constructor=game_shell.ui.StarField,game_shell.ui.StarField.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),game_shell.fx.Particles=function(a,b,c){function d(){var a=game_shell.loader.urls.getURL(i),b=PIXI.TextureCache[a],c=.5*j*l,d=j*l,e=1,f=2,g=.35*j,h=.5*j,k=new Proton.BehaviourEmitter;return k.addInitialize(new Proton.ImageTarget(b)),k.rate=new Proton.Rate(new Proton.Span(15,30),new Proton.Span(.2,.5)),k.addInitialize(new Proton.Mass(e)),k.addBehaviour(new Proton.Gravity(f)),k.addInitialize(new Proton.Life(g,h)),k.addInitialize(new Proton.Velocity(new Proton.Span(c,d),new Proton.Span(0,360),"polar")),k.addBehaviour(new Proton.Scale(Proton.getSpan(.5,1.5))),k.addBehaviour(new Proton.Alpha(1,0,1/0,Proton.easeInQuart)),k.addBehaviour(new Proton.Rotate(Proton.getSpan(0,360),Proton.getSpan(-3,3),"add")),k.p.x=0,k.p.y=0,k}function e(){var a=new Proton.Renderer("other",h);a.onProtonUpdate=function(){},a.onParticleCreated=function(a){var b=new PIXI.Sprite(a.target);a.sprite=b,g.addChild(a.sprite)},a.onParticleUpdate=function(a){f(a.sprite,a)},a.onParticleDead=function(a){g.removeChild(a.sprite)},a.start()}function f(a,b){a.x=b.p.x,a.y=b.p.y,a.scale.x=b.scale,a.scale.x=b.scale,a.pivot.x=.5*a.width,a.pivot.y=.5*a.height,a.alpha=b.alpha,a.rotation=b.rotation*k}var g=a,h=new Proton,i=b||"particle",j=c||3,k=Math.PI/180,l=alex.statics.SCALE_FACTOR,m=d();h.addEmitter(m),e(),this.dispose=function(){null!==h&&(h.destory(),h=null)},this.fire=function(a,b,c){var d=c||.5;this.move(a,b),m.emit(d)},this.move=function(a,b){m.p.x=a,m.p.y=b},this.update=function(){return h.update(),!0},this.emit=function(a){m.emit(a)}},game_shell.fx.ScreenShaker=function(a){alex.utils.EventDispatcher.call(this);var b=alex.statics,c=b.SCALE_FACTOR,d=0;this.target=a,this.rootPt=new PIXI.Point(a.x,a.y),this.rangeX=10*c,this.duration=3e3,this.update=function(a){if(this.isActive){d+=a;var b=Math.sin(.005*d),c=Math.cos(d);this.target.x=this.rootPt.x+c*this.rangeX*b,d>this.duration&&this.end()}},this.activate=function(){d=0,this.isActive=!0,this.rootPt.x=this.target.x,this.rootPt.y=this.target.y},this.end=function(){this.isActive=!1,this.target.x=this.rootPt.x,this.dispatchEvent({type:"complete"})}},game_shell.fx.ScreenShaker.constructor=game_shell.fx.ScreenShaker,game_shell.fx.ScreenShaker.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.scene.GameObject=function(a){alex.utils.EventDispatcher.call(this),this.last=new PIXI.Point(0,0),this.position=new PIXI.Point(0,0),this.velocity=new PIXI.Point(0,0),this.gravity=.016,this.drag=1,this.gfx=a||new PIXI.DisplayObjectContainer,this.type=-1,this.id=-1,this.name="",this._w=this.gfx.width||10,this._h=this.gfx.height||10,this.scaleFactor=alex.statics.SCALE_FACTOR,this.immovable=!0,this.allowCollisions=alex.statics.ANY,this.moves=!1,this.remove=!1},game_shell.scene.GameObject.constructor=game_shell.scene.GameObject,game_shell.scene.GameObject.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.scene.GameObject.prototype.preUpdate=function(){this.last.x=this.position.x,this.last.y=this.position.y},game_shell.scene.GameObject.prototype.update=function(a){return this.immovable||(this.position.x+=this.velocity.x*a,this.position.y+=this.velocity.y*a,this.velocity.y+=this.gravity,this.velocity.x*=this.drag),!1},game_shell.scene.GameObject.prototype.draw=function(){this.gfx.x=this.position.x,this.gfx.y=this.position.y},Object.defineProperty(game_shell.scene.GameObject.prototype,"width",{get:function(){return this._w},set:function(a){this._w=a}}),Object.defineProperty(game_shell.scene.GameObject.prototype,"height",{get:function(){return this._h},set:function(a){this._h=a}}),Object.defineProperty(game_shell.scene.GameObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}}),Object.defineProperty(game_shell.scene.GameObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=a}}),game_shell.scene.GameLayer=function(){PIXI.DisplayObjectContainer.call(this),this.screenW=alex.statics.STAGE_W,this.maxDist=2*this.screenW,this.minDist=-this.maxDist},game_shell.scene.GameLayer.constructor=game_shell.scene.GameLayer,game_shell.scene.GameLayer.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),game_shell.scene.GameLayer.prototype.hideChildren=function(){for(var a=null,b=this.children.length,c=0,d=0-this.x+.5*this.screenW,e=0;b>e;e++)a=this.children[e],c=a.x-d,a.visible=c>this.maxDist||c<this.minDist?!1:!0},game_shell.scene.Platform=function(a){game_shell.scene.GameObject.call(this,a),this._w=this.gfx.width,this._h=this.gfx.height,this.type=game_shell.ItemTypes.TYPE_PLATFORM},game_shell.scene.Platform.constructor=game_shell.scene.Platform,game_shell.scene.Platform.prototype=Object.create(game_shell.scene.GameObject.prototype),game_shell.scene.SlopeUp=function(a){game_shell.scene.Platform.call(this,a),this.type=game_shell.ItemTypes.TYPE_SLOPE_UP,this.count=0},game_shell.scene.SlopeUp.constructor=game_shell.scene.SlopeUp,game_shell.scene.SlopeUp.prototype=Object.create(game_shell.scene.Platform.prototype),game_shell.scene.SlopeUp.prototype.jump=function(){this.allowCollisions=-1,this.count=100},game_shell.scene.SlopeUp.prototype.update=function(a){this.count>0&&(this.count-=a,this.count<=0&&(this.count=0,this.allowCollisions=alex.statics.ANY))},game_shell.scene.SlopeDown=function(a){game_shell.scene.Platform.call(this,a),this.type=game_shell.ItemTypes.TYPE_SLOPE_DOWN,this.count=0},game_shell.scene.SlopeDown.constructor=game_shell.scene.SlopeDown,game_shell.scene.SlopeDown.prototype=Object.create(game_shell.scene.Platform.prototype),game_shell.scene.SlopeDown.prototype.jump=function(){this.allowCollisions=-1,this.count=100},game_shell.scene.SlopeDown.prototype.update=function(a){this.count>0&&(this.count-=a,this.count<=0&&(this.count=0,this.allowCollisions=alex.statics.ANY))},game_shell.scene.Conveyor=function(a){game_shell.scene.Platform.call(this,a),this.type=game_shell.ItemTypes.TYPE_CONVEYOR,this.gfx.fps=4,this.gfx.duration=500,this.gfx.play(),this.update=function(a){this.gfx.update(a)}},game_shell.scene.Conveyor.constructor=game_shell.scene.Conveyor,game_shell.scene.Conveyor.prototype=Object.create(game_shell.scene.Platform.prototype),game_shell.scene.Hazard=function(a){game_shell.scene.GameObject.call(this,a),this.type=game_shell.ItemTypes.TYPE_HAZARD,this.hazardType=game_shell.HazardTypes.STATIC,this.active=!0,this.startY=0,this.startX=0,this.gravity=alex.statics.GRAVITY,this.offScreen=2e3*this.scaleFactor,this.fullRect=new game_shell.scene.GameObject(a)},game_shell.scene.Hazard.constructor=game_shell.scene.Hazard,game_shell.scene.Hazard.prototype=Object.create(game_shell.scene.GameObject.prototype),game_shell.scene.Hazard.prototype.setHitRect=function(a){this.hitRect=a,this._w=this.hitRect.width,this._h=this.hitRect.height,this.last.x=this.x,this.last.y=this.y},game_shell.scene.Hazard.prototype.activate=function(){},game_shell.scene.Hazard.prototype.preUpdate=function(){game_shell.scene.GameObject.prototype.preUpdate.call(this),this.fullRect.preUpdate()},game_shell.scene.Hazard.prototype.init=function(){this.startY=this.position.y,this.startX=this.position.x,this.fullRect.x=this.position.x,this.fullRect.y=this.position.y},game_shell.scene.Hazard.prototype.reset=function(){this.position.y=this.startY,this.position.x=this.startX,this.velocity.y=0,this.velocity.x=0,this.active=!0},game_shell.scene.Hazard.prototype.draw=function(){this.gfx.x=this.position.x-this.hitRect.x,this.gfx.y=this.position.y-this.hitRect.y},game_shell.scene.Hazard.prototype.getShot=function(){this.active=!1,this.velocity.y=-.2*this.scaleFactor,this.velocity.x=0},game_shell.scene.Hazard.prototype.update=function(a){!this.active&&this.position.y<this.offScreen&&(this.velocity.y+=this.gravity,this.position.y+=this.velocity.y*a)},game_shell.scene.Collectable=function(a){game_shell.scene.GameObject.call(this,a),this._w=this.gfx.width,this._h=this.gfx.height,this.allowCollisions=-1,this.type=game_shell.ItemTypes.TYPE_COLLECTABLE,this.collected=!1},game_shell.scene.Collectable.constructor=game_shell.scene.Collectable,game_shell.scene.Collectable.prototype=Object.create(game_shell.scene.GameObject.prototype),game_shell.scene.Collectable.prototype.collect=function(){this.collected=!0,this.gfx.visible=!1},game_shell.scene.Collectable.prototype.reset=function(){this.collected=!1,this.gfx.visible=!0},game_shell.scene.MovingPlatform=function(a){game_shell.scene.GameObject.call(this,a)},game_shell.scene.MovingPlatform.constructor=game_shell.scene.MovingPlatform,game_shell.scene.MovingPlatform.prototype=Object.create(game_shell.scene.GameObject.prototype),game_shell.scene.MovingPlatform.prototype.setHitRect=function(a){this.hitRect=a,this._w=this.hitRect.width,this._h=this.hitRect.height,this.last.x=this.x,this.last.y=this.y},game_shell.scene.MovingPlatform.prototype.draw=function(){this.gfx.x=this.position.x-this.hitRect.x,this.gfx.y=this.position.y-this.hitRect.y},game_shell.scene.MovingPlatform.prototype.showDebugRect=function(){var a=new PIXI.Graphics;a.lineStyle(1,16711680,1);var b=this.hitRect.x,c=this.hitRect.x+this.hitRect.width,d=this.hitRect.y,e=this.hitRect.y+this.hitRect.height;a.moveTo(b,d),a.lineTo(c,d),a.lineTo(c,e),a.lineTo(b,e),a.lineTo(b,d),this.gfx.addChild(a)},game_shell.scene.HorizontalPlatform=function(a){game_shell.scene.MovingPlatform.call(this,a),this.type=game_shell.ItemTypes.TYPE_MOVING_PLATFORM,this.moves=!0,this.allowCollisions=alex.statics.NOT_UP},game_shell.scene.HorizontalPlatform.constructor=game_shell.scene.HorizontalPlatform,game_shell.scene.HorizontalPlatform.prototype=Object.create(game_shell.scene.MovingPlatform.prototype),game_shell.scene.HorizontalPlatform.prototype.initRange=function(a,b,c){a||(a=alex.statics.PLATFORM_RANGE),this.start=b+c.x,this.gfx.x=this.start,this._v=.1*this.scaleFactor,a>0?(this.minX=this.start,this.maxX=this.minX+a,this.velocity.x=this._v):(this.maxX=this.start,this.minX=this.maxX+a,this.velocity.x=-this._v)},game_shell.scene.HorizontalPlatform.prototype.reset=function(){this.position.x=this.start,this.gfx.x=this.start,this.velocity.x=this.start===this.minX?this._v:-this._v},game_shell.scene.HorizontalPlatform.prototype.update=function(a){var b=this.position.x,c=b+a*this.velocity.x;return c>this.maxX?(c=this.maxX,this.velocity.x=-this.velocity.x):c<this.minX&&(c=this.minX,this.velocity.x=-this.velocity.x),this.position.x=c,!0},game_shell.scene.VerticalPlatform=function(a){game_shell.scene.MovingPlatform.call(this,a),this.type=game_shell.ItemTypes.TYPE_VERTICAL_PLATFORM,this.moves=!0,this.allowCollisions=alex.statics.NOT_UP},game_shell.scene.VerticalPlatform.constructor=game_shell.scene.VerticalPlatform,game_shell.scene.VerticalPlatform.prototype=Object.create(game_shell.scene.MovingPlatform.prototype),game_shell.scene.VerticalPlatform.prototype.initRange=function(a,b,c){a||(a=alex.statics.PLATFORM_RANGE),this.start=b+c.y,this.gfx.y=this.start,this._v=.1*this.scaleFactor,a>0?(this.minY=this.start,this.maxY=this.minY+a,this.velocity.y=this._v):(this.maxY=this.start,this.minY=this.maxY+a,this.velocity.y=-this._v)},game_shell.scene.VerticalPlatform.prototype.reset=function(){this.position.y=this.start,this.gfx.y=this.start,this.velocity.y=this.start===this.minY?this._v:-this._v},game_shell.scene.VerticalPlatform.prototype.update=function(a){var b=this.position.y,c=b+a*this.velocity.y;return c>this.maxY?(c=this.maxY,this.velocity.y=-this.velocity.y):c<this.minY&&(c=this.minY,this.velocity.y=-this.velocity.y),this.position.y=c,!0},game_shell.scene.HorizontalHazard=function(a){game_shell.scene.Hazard.call(this,a),this.type=game_shell.ItemTypes.TYPE_HORIZONTAL_HAZARD,this.hazardType=game_shell.HazardTypes.HORIZONTAL;var b=0,c=0;this.range=200*this.scaleFactor,this.gfx.fps=2,this.gfx.duration=1e3,this.update=function(a){if(this.active){this.gfx.update(a),b+=2e-4*a;var c=Math.sin(b),d=this.range*c;this.position.x=this.startX+d,this.fullRect.x=this.position.x,this.fullRect.y=this.position.y}else game_shell.scene.Hazard.prototype.update.call(this,a)},this.init=function(a){game_shell.scene.Hazard.prototype.init.call(this),b=0>a?Math.PI:0,c=b,this.gfx.play(),this.reset()},this.reset=function(){game_shell.scene.Hazard.prototype.reset.call(this),b=c;var a=this.range*Math.sin(b);this.position.x=this.startX+a,this.fullRect.x=this.position.x,this.fullRect.y=this.position.y}},game_shell.scene.HorizontalHazard.constructor=game_shell.scene.HorizontalHazard,game_shell.scene.HorizontalHazard.prototype=Object.create(game_shell.scene.Hazard.prototype),game_shell.scene.VerticalHazard=function(a){game_shell.scene.Hazard.call(this,a),this.type=game_shell.ItemTypes.TYPE_VERTICAL_HAZARD,this.hazardType=game_shell.HazardTypes.VERTICAL;var b=0,c=0;this.range=200*this.scaleFactor,this.gfx.fps=2,this.gfx.duration=1e3,this.update=function(a){if(this.active){this.gfx.update(a),b+=2e-4*a;var c=Math.cos(b),d=this.range*c;this.position.y=this.startY+d,this.fullRect.x=this.position.x,this.fullRect.y=this.position.y}else game_shell.scene.Hazard.prototype.update.call(this,a)},this.init=function(a){game_shell.scene.Hazard.prototype.init.call(this),b=0>a?Math.PI:0,c=b,this.gfx.play(),this.reset()},this.reset=function(){game_shell.scene.Hazard.prototype.reset.call(this),b=c;var a=this.range*Math.cos(b);this.position.y=this.startY+a,this.fullRect.x=this.position.x,this.fullRect.y=this.position.y}},game_shell.scene.VerticalHazard.constructor=game_shell.scene.VerticalHazard,game_shell.scene.VerticalHazard.prototype=Object.create(game_shell.scene.Hazard.prototype),game_shell.scene.SinkingPlatform=function(a){game_shell.scene.GameObject.call(this,a),this._w=this.gfx.width,this._h=this.gfx.height,this.type=game_shell.ItemTypes.TYPE_SINKING_PLATFORM,this.isSinking=!1,this.deadY=150*this.scaleFactor,this.moves=!0},game_shell.scene.SinkingPlatform.constructor=game_shell.scene.SinkingPlatform,game_shell.scene.SinkingPlatform.prototype=Object.create(game_shell.scene.GameObject.prototype),game_shell.scene.SinkingPlatform.prototype.start=function(){this.velocity.y=.05,this.isSinking=!0},game_shell.scene.SinkingPlatform.prototype.reset=function(){this.position.y=this.restoreY,this.velocity.y=0,this.isSinking=!1,this.gfx.y=this.position.y},game_shell.scene.SinkingPlatform.prototype.update=function(a){this.isSinking&&(this.position.y+=this.velocity.y*a,this.position.y>this.deadY?(this.velocity.y=0,this.isSinking=!1):this.velocity.y*=1.1)},game_shell.scene.BearTrap=function(a){game_shell.scene.Hazard.call(this,a),this.hazardType=game_shell.HazardTypes.TRAP;var b=this.scaleFactor,c=52*b,d=-68*b;this.setSnapFrame=function(a){this.snapFrame=PIXI.TextureCache[a],this.defaultFrame=this.gfx.texture},this.activate=function(){this.gfx.setTexture(this.snapFrame),this.position.x=this.startX+c,this.position.y=this.startY+d,game_shell.sndMgr.play("BEAR_TRAP",.4)},this.reset=function(){this.gfx.setTexture(this.defaultFrame),game_shell.scene.Hazard.prototype.reset.call(this)}},game_shell.scene.BearTrap.constructor=game_shell.scene.BearTrap,game_shell.scene.BearTrap.prototype=Object.create(game_shell.scene.Hazard.prototype),game_shell.scene.JumpPad=function(a){game_shell.scene.Platform.call(this,a),this.baseY=0,this.baseH=this.gfx.height,this.bounce=10*alex.statics.SCALE_FACTOR,this.type=game_shell.ItemTypes.TYPE_JUMP_PAD},game_shell.scene.JumpPad.constructor=game_shell.scene.JumpPad,game_shell.scene.JumpPad.prototype=Object.create(game_shell.scene.Platform.prototype),game_shell.scene.JumpPad.prototype.activate=function(){this.y=this.baseY+this.bounce,this.gfx.height=this.baseH-this.bounce;var a={y:this.y,h:this.gfx.height},b={y:this.baseY,h:this.baseH},c=this,d=new TWEEN.Tween(a);d.to(b,200),d.onUpdate(function(){c.y=this.y,c.gfx.height=this.h}),d.start()},game_shell.scene.Bullet=function(a,b){var c=new PIXI.Sprite(PIXI.TextureCache[a]);this.r=Math.PI/180*15,"undefined"==typeof b&&(b=.9),game_shell.scene.GameObject.call(this,c),this.type=game_shell.ItemTypes.TYPE_BULLET;var d=this.gfx.width,e=this.gfx.height;this.gfx.pivot.x=.5*this._w,this.gfx.pivot.y=.5*this._h,this._w=d*b,this._h=e*b,this.insetX=.5*(d-this._w),this.insetY=.5*(e-this._h),this.screen=game_shell.screenMgr.currentScreen,this.maxDist=2e3*this.scaleFactor,this.active=!1},game_shell.scene.Bullet.constructor=game_shell.scene.Bullet,game_shell.scene.Bullet.prototype=Object.create(game_shell.scene.GameObject.prototype),game_shell.scene.Bullet.prototype.fire=function(a){a||(a=40*this.scaleFactor),this.speedX=a,this.active=!0,this.remove=!1},game_shell.scene.Bullet.prototype.draw=function(){this.gfx.x=this.position.x+this.insetX+this.gfx.pivot.x,this.gfx.y=this.position.y+this.insetY+this.gfx.pivot.y},game_shell.scene.Bullet.prototype.update=function(){if(this.active){this.position.x+=this.speedX,this.gfx.rotation+=this.r;var a=this.screen.player.x,b=this.x-a;(b>this.maxDist||b<-this.maxDist)&&this.destroy()}},game_shell.scene.Bullet.prototype.destroy=function(){this.active=!1,this.remove=!0,this.gfx.removeFromParent()},game_shell.scene.RubbleMaker=function(a){function b(){for(var a,b=[];b.length<10;)a=new game_shell.scene.Rubble(g),b[b.length]=a;return b}alex.utils.EventDispatcher.call(this),this.active=!1;var c=alex.statics;this.parent=a;var d=c.STAGE_H,e=c.STAGE_W,f=c.SCALE_FACTOR,g=c.GRAVITY,h=b(),i=d+50*f,j=[];alex.log("!!!! gravity: "+g),this.update=function(a){if(this.active){this.count+=.005*a;var b=Math.floor(this.count);if(b<h.length){var c=h[b];c.active||(j[j.length]=c,c.active=!0,c.img.visible=!0,this.parent.addChild(c.img))}for(var d,e=j.length,f=3e3,g=0;e>g;g++){d=j[g];var k=d.move(a);f>k&&(f=k)}e===h.length&&f>i&&(this.hide(),this.dispatchEvent({type:"complete"}))}return this.active},this.activate=function(a){this.playerX=a,this.reset(),this.active=!0},this.reset=function(){this.count=0,j.length=0;for(var a,b=h.length,c=0;b>c;c++)a=h[c],a.reset(),a.img.y=-1.1*d,a.img.x=Math.floor(e*-.4+.8*Math.random()*e),a.rotation=2*Math.PI*Math.random()},this.hide=function(){this.active=!0,j.length=0;for(var a,b=h.length,c=0;b>c;c++)a=h[c],a.img.visible=!1,a.img.removeFromParent()}},game_shell.scene.RubbleMaker.constructor=game_shell.scene.RubbleMaker,game_shell.scene.RubbleMaker.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.scene.Rubble=function(a){alex.utils.EventDispatcher.call(this),this.vy=0,this.active=!1,this.img=new PIXI.Sprite(PIXI.TextureCache["rubble.png"]),this.img.pivot.x=.5*this.img.width,this.img.pivot.y=.5*this.img.height,this.gravity=a,this.toString=function(){return"[Rubble]"},this.reset=function(){this.active=!1,this.vy=0},this.move=function(a){this.vy+=this.gravity;var b=this.vy*a;return this.img.y+=b,this.img.y}},game_shell.scene.Rubble.constructor=game_shell.scene.Rubble,game_shell.scene.Rubble.prototype=Object.create(alex.utils.EventDispatcher.prototype),game_shell.scene.EventTrigger=function(a){game_shell.scene.GameObject.call(this,a),this._w=this.gfx.width,this._h=this.gfx.height,this.type=game_shell.ItemTypes.TYPE_EVENT_TRIGGER,this.activated=!1},game_shell.scene.EventTrigger.constructor=game_shell.scene.EventTrigger,game_shell.scene.EventTrigger.prototype=Object.create(game_shell.scene.GameObject.prototype),game_shell.scene.EventTrigger.prototype.activate=function(){this.activated=!0,this.dispatchEvent({type:"activate"})},game_shell.scene.EventTrigger.prototype.reset=function(){this.activated=!1},game_shell.scene.EnemyBoss=function(){function a(){var a=this.x+this.firePt.x,b=this.y+this.firePt.y;this.dispatchEvent({type:"fire",x:a,y:b})}function b(){var a=new PIXI.DisplayObjectContainer,b=f(["flame_a1.png","flame_a2.png"],99,211);a.addChild(b);var g=f(["flame_b1.png","flame_b2.png"],346,211);a.addChild(g),m=[b,g];var h=new PIXI.Sprite(PIXI.TextureCache["boss_craft.png"]);h.y=82*k,a.addChild(h),this.head=new PIXI.Sprite(PIXI.TextureCache["boss_head.png"]),this.head.x=236*k,a.addChild(this.head),this.headHit=new PIXI.Sprite(PIXI.TextureCache["boss_head_hit.png"]),this.headHit.pivot.x=59*k,this.headHit.pivot.y=80*k,this.headHit.x=274*k,this.headHit.y=85*k,this.headHit.visible=!1,a.addChild(this.headHit),this._w=h.width,this._h=h.height,c.call(this,a),this.explosions=[];var i=e();return this.explosions[this.explosions.length]=d(219,26,a,i),this.explosions[this.explosions.length]=d(279,44,a,i),this.explosions[this.explosions.length]=d(48,113,a,i),this.explosions[this.explosions.length]=d(125,183,a,i),this.explosions[this.explosions.length]=d(258,101,a,i),this.explosions[this.explosions.length]=d(141,123,a,i),this.explosions[this.explosions.length]=d(240,165,a,i),this.explosions[this.explosions.length]=d(326,150,a,i),this.white=new PIXI.Sprite(PIXI.TextureCache["boss_white.png"]),this.white.visible=!1,a.addChild(this.white),a}function c(a){var b=["1_zap.png","2_zap.png"],c=g(b);this.zapAnim=new PIXI.MovieClip(c),this.zapAnim.x=103*k,this.zapAnim.y=87*k,this.zapAnim.visible=!1,this.zapAnim.alpha=.6,this.zapAnim.play(),a.addChild(this.zapAnim)}function d(a,b,c,d){var e=g(d),f=new PIXI.MovieClip(e);return f.x=a*k,f.y=b*k,f.visible=!1,c.addChild(f),f}function e(){for(var a=[],b="explosion00",c=1;33>c;c++)a[a.length]=10>c?b+"0"+c.toString()+".png":b+c.toString()+".png";return a}function f(a,b,c){var d=g(a),e=new PIXI.MovieClip(d);return e.fps=4,e.setDuration(),e.x=b*k,e.y=c*k,e.play(),e}function g(a){for(var b=a.length,c=[],d=null,e=null,f=0;b>f;f++)d=a[f],e=PIXI.Texture.fromFrame(d),c[f]=e;return c}function h(){var a,b,c,d;return a=234*k,b=1*k,c=80*k,d=260*k,new PIXI.Rectangle(a,b,c,d)}function i(){var a=[];return a[a.length]=j.call(this),a[a.length]=j.call(this),a[a.length]=j.call(this),a}function j(){var a=new alex.motion.Oscillator;return a.randomise(),a}var k=alex.statics.SCALE_FACTOR,l=alex.statics.BOSS_LIVES,m=null,n=b.call(this);game_shell.scene.GameObject.call(this,n),this.type=game_shell.ItemTypes.TYPE_BOSS,this.bossStates={NONE:0,TWEEN_ON:1,ATTACK:2,DYING:3,DEAD:4},this.state=this.bossStates.NONE,this.rootPt=new PIXI.Point;var o=50*k,p=50*k,q=0;this.rad=Math.PI/180*2,this.headTime=0,this.flicker=0,this.headCount=0;var r=50*k;this.active=!1;var s=l;this.name="boss",this.fullRect=new game_shell.scene.GameObject(n),this.hitRect=h.call(this),this.fullRect.width=this.hitRect.width,this.fullRect.height=this.hitRect.height,this.fullRect.x=this.x+this.hitRect.x,this.fullRect.y=this.y+this.hitRect.y;var t=-80*k-this.hitRect.x,u=136*k,v=1e3;this.firePt=new PIXI.Point(t,u),this.setOffScreen=function(a){r=a},this.startPt=new PIXI.Point,this.reset=function(){s=l,this.active=!1,this.x=this.startPt.x,this.y=this.startPt.y},this.setStartPt=function(a,b){this.startPt.x=a,this.startPt.y=b,this.x=this.startPt.x,this.y=this.startPt.y},this.activate=function(){},this.oscillators=i.call(this),this.attack=function(){this.rootPt.x=this.x,this.rootPt.y=this.y,this.fullRect.x=this.x,this.fullRect.y=this.y,this.last.x=this.x,this.last.y=this.y,this.active=!0},this.getShot=function(){s>0&&(s--,this.showHitHead(),this.zapAnim.visible=!0,alex.log("boss shot -> lives: "+s),this.dispatchEvent({type:"hit",lives:s}),1>s&&(this.flicker=1500,this.explode=1e3,this.exp=0,this.expCount=-1,this.state=this.bossStates.DYING))},this.showHitHead=function(){this.head.visible=!1,this.headHit.rotation=0,this.headTime=0,this.headHit.visible=!0,this.headCount=1500},this.gameOver=function(){this.active=!1,this.dispatchEvent({type:"gameover"})},this.update=function(b){var c=!1;if(this.active){c=!0;for(var d,e=null,f=this.explosions.length,g=0;f>g;g++)e=this.explosions[g],e.update(b);if(this.state===this.bossStates.DYING){if(this.flicker>0){this.flicker-=b;var h=this.flicker>this.explode,i=!1;h&&(i=Math.floor(this.flicker/50)%2),this.white.visible=i,h||(this.exp+=b,this.exp>100&&(this.exp-=100,this.expCount++,this.expCount<this.explosions.length&&(e=this.explosions[this.expCount],e.visible=!0,e.play()))),this.flicker<=0&&(this.state=this.bossStates.DEAD,this.deathR=0,this.white.visible=!1),this.zapAnim.update(b)}}else if(this.state===this.bossStates.DEAD)this.deathR+=.01*b,this.gfx.rotation=Math.cos(this.deathR)*this.rad,this.y+=.2*b,this.zapAnim.update(b),this.headTime+=b,d=Math.sin(.03*this.headTime),this.headHit.rotation=d*this.rad,this.y>r&&this.gameOver();else{1>q&&(q+=.01,q>1&&(q=1)),f=this.oscillators.length;var j=null,k=0,l=0;for(g=0;f>g;g++)j=this.oscillators[g],j.update(b),k+=j.x*o,l+=j.y*p;for(this.x=this.rootPt.x+k*q,this.y=this.rootPt.y+l*q,this.fullRect.x=this.x,this.fullRect.y=this.y,f=m.length,g=0;f>g;g++)e=m[g],e.update(b);v-=b,0>v&&(a.call(this),v=1e3+3e3*Math.random()),this.headCount>0&&(this.headCount-=b,this.zapAnim.update(b),this.headTime+=b,d=Math.sin(.03*this.headTime),this.headHit.rotation=d*this.rad,this.headCount<0&&(this.head.visible=!0,this.headHit.visible=!1,this.zapAnim.visible=!1))}}return c}},game_shell.scene.EnemyBoss.constructor=game_shell.scene.EnemyBoss,game_shell.scene.EnemyBoss.prototype=Object.create(game_shell.scene.GameObject.prototype),game_shell.scene.EnemyBoss.prototype.draw=function(){this.gfx.x=this.position.x-this.hitRect.x,this.gfx.y=this.position.y-this.hitRect.y},game_shell.scene.BossStates={TWEEN_ON:1,ATTACK:2,DEAD:3},game_shell.level.AmmoCounterMixin=function(){this.createAmmoCounter=function(){this.ammoCounter=new game_shell.ui.AmmoCounter,this.uiLayer.addChild(this.ammoCounter.root)},this.refreshAmmoCounter=function(){this.ammoCounter.setCount(this.score.getAmmo())},this.gainAmmo=function(){this.snd.play("COLLECT"),this.score.collect(),this.refreshAmmoCounter()},this.useAmmo=function(){this.score.useAmmo(),this.refreshAmmoCounter()}},game_shell.level.UIManager=function(){function a(){this.btnSettings=new alex.display.Button("btn_settings.png","btn_settings_down.png"),this.btnSettings.x=c,this.btnSettings.y=.25*(this.screenH-this.btnSettings.height),this.uiLayer.addChild(this.btnSettings),this.btnSettings.addEventListener("release",this.openSettings.bind(this))}function b(){this.settingsPanel=new game_shell.ui.SettingsPanel,this.settingsPanel.addEventListener("closed",this.onSettingsClosed.bind(this)),this.settingsPanel.addEventListener("home",this.onHomeBtn.bind(this)),this.settingsPanel.addEventListener("help",this.onHelpBtn.bind(this)),this.uiLayer.addChild(this.settingsPanel)
}var c=-200*this.scaleFactor;this.exitTarget=game_shell.screens.SCR_MENU,this.createUI=function(){a.call(this),b.call(this)},this.tweenOffSettingsButton=function(){var a={x:this.btnSettings.x},b={x:c},d=new TWEEN.Tween(a);d.to(b,400);var e=this.btnSettings;d.onUpdate(function(){e.x=this.x}),d.start()},this.tweenOnSettingsButton=function(){var a={x:this.btnSettings.x},b={x:10*this.scaleFactor},c=new TWEEN.Tween(a);c.to(b,400);var d=this.btnSettings;c.onUpdate(function(){d.x=this.x}),c.start()},this.openSettings=function(){alex.log("openSettings "+this),this.settingsPanel.show(),this.input.enable(!1),this.pauseGame(!0)},this.onSettingsClosed=function(){this.inGameTraining.isPlaying||this.input.enable(!0),this.pauseGame(!1)},this.onHomeBtn=function(){var a=this;this.transitionOut(function(){a.newScreen(a.exitTarget)})},this.onHelpBtn=function(){this.settingsPanel.hide(),this.playInGameTraining()},this.createInGameTraining=function(){this.inGameTraining=new game_shell.ui.InGameTraining;var a=this;this.inGameTraining.addEventListener("complete",function(){a.input.enable(!0),a.btnSettings.enabled=!0})},this.playInGameTraining=function(){this.input.enable(!1),this.btnSettings.enabled=!1,this.inGameTraining.play(this)},this.showWinPopup=function(){this.winPopup=new game_shell.ui.EndLevelPopup,this.winPopup.content.x=.5*this.screenW,this.addUpdateItem(this.winPopup.protonFx),this.winPopup.show(this.score),this.uiLayer.addChild(this.winPopup)},this.hideWinPopup=function(){var a=this;this.winPopup.addEventListener("close",function(){a.winPopup.visible=!1,a.delay(function(){alex.log("GO TO NEXT SCREEN!"),game_shell.playerData.nextScreen="level_"+(a.level+1),a.newScreen(game_shell.screens.SCR_BETWEEN)},50)}),this.winPopup.hide(),this.fader.transitionOut(),this.snd.play("SWISH_1")}},game_shell.level.GameLoop=function(){this.deadY=150*this.scaleFactor,this.startGameLoop=function(){var a=this;this.gameLoop=new function(){this.update=function(b){a.updateGame.call(a,b)}},this.addUpdateItem(this.gameLoop)},this.pauseGame=function(a){a?this.removeUpdateItem(this.gameLoop):this.addUpdateItem(this.gameLoop)},this.updateGame=function(a){dragonBones.animation.WorldClock.clock.advanceTime(a/1e3),this.levelState.isPlaying?(this.preUpdate(),this.updateGameObjects(a),this.postUpdate(a),this.drawGameObjects(),this.input.checkKeys(),this.keys.update(a),this.checkComplete(a)):this.levelState.isRespawning?(this.drawGameObjects(),this.input.checkKeys(),this.keys.update(a)):this.levelState.isCompleted&&(this.input.checkKeys(),this.keys.update(a))},this.preUpdate=function(){for(var a,b=this.gameObjects.length,c=b-1;c>-1;c--)a=this.gameObjects[c],a.remove?this.gameObjects.splice(c,1):a.preUpdate()},this.updateGameObjects=function(a){for(var b,c=this.gameObjects.length,d=0;c>d;d++)b=this.gameObjects[d],b.update(a)},this.postUpdate=function(a){var b=this.player.y,c=this.player.x,d=this.player.isDead;if(b>this.deadY)this.onPlayerReset(null),b=this.player.y,c=this.player.x,d=!0;else if(!d){var e=this.player.hitTest(this.gameObjects,a);1===e&&this.gainAmmo()}d||(this.camera.track(),this.bulletManager.activeBullets.length>0&&this.bulletManager.bulletCheck(c))},this.drawGameObjects=function(){for(var a,b=this.gameObjects.length,c=0;b>c;c++)a=this.gameObjects[c],a.draw()},this.checkComplete=function(){var a=this.screenW-this.player.position.x;a<this.maxX&&this.levelComplete()}},game_shell.level.LevelFactory=function(a){this.screen=a,this.screen.gameObjects=[],this.screen.sceneryBG=[],this.screen.sceneryFG=[],this.screen.activeHazards=[],this.screen.platforms=[],this.scaleFactor=this.screen.scaleFactor,this.parseJSON=function(a){for(var b,c,d,e,f,g,h=a.items,i=h.length,j=game_shell.ItemTypes,k=0,l=null,m=0;i>m;m++)switch(b=h[m],c=b.x,d=b.y,e=b.image,f=b.allowCollisions,g=b.name,l=null,++k,b.type){case j.TYPE_PLATFORM:l=this.createPlatform(c,d,e,k,f);break;case j.TYPE_FG_ITEM:l=this.addForegroundItem(c,d,e);break;case j.TYPE_BG_ITEM:l=this.addBackgroundItem(c,d,e);break;case j.TYPE_PARALLAX_1:l=this.addToParallax1(c,d,e);break;case j.TYPE_PARALLAX_2:l=this.addToParallax2(c,d,e);break;case j.TYPE_PARALLAX_3:l=this.addToParallax3(c,d,e);break;case j.TYPE_BLOCK:l=this.parallaxQuad(c,d,b.width,b.height);break;case j.TYPE_SLOPE_UP:l=this.createSlopeUp(c,d,k);break;case j.TYPE_SLOPE_DOWN:l=this.createSlopeDown(c,d,k);break;case j.TYPE_COLLECTABLE:l=this.createCollectable(c,d,e,k);break;case j.TYPE_HAZARD:l=b.hasOwnProperty("frames")?this.createBearTrap(c,d,b.frames,b.hit.x,b.hit.y,b.hit.width,b.hit.height,k):this.createHazard(c,d,e,b.hit.x,b.hit.y,b.hit.width,b.hit.height,k);break;case j.TYPE_HORIZONTAL_HAZARD:l=this.createHorizontalHazard(c,d,b.frames,b.hit.x,b.hit.y,b.hit.width,b.hit.height,b.direction,k);break;case j.TYPE_VERTICAL_HAZARD:l=this.createVerticalHazard(c,d,b.frames,b.hit.x,b.hit.y,b.hit.width,b.hit.height,b.direction,k);break;case j.TYPE_MOVING_PLATFORM:l=this.createHorizontalPlatform(c,d,k,b.direction,b.hit);break;case j.TYPE_VERTICAL_PLATFORM:l=this.createVerticalPlatform(c,d,k,b.direction,b.hit);break;case j.TYPE_CONVEYOR:l=this.createConveyor(c,d,k);break;case j.TYPE_JUMP_PAD:l=this.createJumpPad(c,d,k);break;case j.TYPE_SINKING_PLATFORM:l=this.createSinkingPlatform(c,d,e,k);break;case j.TYPE_EVENT_TRIGGER:l=this.createEventTrigger(c,d,e,k,g);break;case j.TYPE_LEVEL_END:l=this.createLevelEnd(c,d,e,k,f);break;case j.TYPE_DOOR:l=this.createDoor(c,d,b.isFG,e,k)}this.screen.platforms.sort(function(a,b){return a.x>b.x?-1:a.x<b.x?1:0})},this.createPlayer=function(){var a=new game_shell.player.Player,b=this.screen.respawnManager.getRespawnPoint(a.x);a.x=b.x,a.y=b.y,a.gfx.visible=!1;var c=this;return a.addEventListener("reset",function(){c.onPlayerReset.call(c)}),a.particles=this.screen.particles,this.screen.gameObjects[this.screen.gameObjects.length]=a,this.screen.scene.addChild(a.gfx),this.screen.player=a,b},this.createPlatform=function(a,b,c,d,e){var f=this.createGameObj(a,b,d,c,game_shell.scene.Platform);return"undefined"!=typeof e&&(f.allowCollisions=e),this.screen.platforms[this.screen.platforms.length]=f,f},this.createLevelEnd=function(a,b,c,d,e){var f=this.createPlatform(a,b,c,d,e);f.type=game_shell.ItemTypes.TYPE_LEVEL_END,this.screen.maxX!==this.screen.screenW&&alex.log("ERROR! should only be one level end...");var g=f.x+f.width;return this.screen.levelEndR=g,this.screen.maxX=this.screen.screenW-this.screen.levelEndR,f},this.createDoor=function(a,b,c,d,e){var f=this.createPlatform(a,b,d,e,-1);return f.type=game_shell.ItemTypes.TYPE_DOOR,c&&(f.draw(),this.screen.foreground.addChild(f.gfx)),f},this.createCollectable=function(a,b,c,d){var e=this.createGameObj(a,b,d,c,game_shell.scene.Collectable);return e.allowCollisions=-1,this.screen.foreground.addChild(e.gfx),e},this.createJumpPad=function(a,b,c){var d=this.createGameObj(a,b,c,"jumppad.png",game_shell.scene.JumpPad);return d.baseY=d.y,d},this.createConveyor=function(a,b,c){var d=this.createAnimatedGameObj(a,b,c,["01_conveyor.png","02_conveyor.png"],game_shell.scene.Conveyor);return d},this.createSinkingPlatform=function(a,b,c,d){var e=this.createGameObj(a,b,d,c,game_shell.scene.SinkingPlatform);return e.restoreY=e.position.y,this.screen.addUpdateItem(e),e},this.createEventTrigger=function(a,b,c,d,e){var f=this.createGameObj(a,b,d,c,game_shell.scene.EventTrigger),g=this;return f.addEventListener("activate",function(a){g.screen.onPlatformEventTrigger.call(g.screen,a,e)}),f},this.createHazard=function(a,b,c,d,e,f,g,h){var i=this.createHitRect(d,e,f,g);a+=d,b+=e;var j=this.createGameObj(a,b,h,c,game_shell.scene.Hazard);return j.setHitRect(i),j.init(),this.screen.activeHazards[this.screen.activeHazards.length]=j,j},this.createVerticalHazard=function(a,b,c,d,e,f,g,h,i){return this.createMovingHazard(a,b,c,d,e,f,g,h,i,game_shell.scene.VerticalHazard)},this.createHorizontalHazard=function(a,b,c,d,e,f,g,h,i){return this.createMovingHazard(a,b,c,d,e,f,g,h,i,game_shell.scene.HorizontalHazard)},this.createMovingHazard=function(a,b,c,d,e,f,g,h,i,j){var k=this.createHitRect(d,e,f,g);a+=d,b+=e;var l=this.createAnimatedGameObj(a,b,i,c,j);return l.setHitRect(k),l.init(h),this.screen.activeHazards[this.screen.activeHazards.length]=l,l},this.createBearTrap=function(a,b,c,d,e,f,g,h){var i=this.createHitRect(d,e,f,g);a+=d,b+=e;var j=this.createGameObj(a,b,h,c[0],game_shell.scene.BearTrap);return j.setHitRect(i),j.setSnapFrame(c[1]),j.init(),this.screen.activeHazards[this.screen.activeHazards.length]=j,j},this.createSlopeUp=function(a,b,c){var d=this.createGameObj(a,b,c,"slope_up.png",game_shell.scene.SlopeUp);return d},this.createSlopeDown=function(a,b,c){var d=this.createGameObj(a,b,c,"slope_down.png",game_shell.scene.SlopeDown);return d},this.createVerticalPlatform=function(a,b,c,d,e){return this.createMovingPlatform(a,b,c,d,e,game_shell.scene.VerticalPlatform,b*this.scaleFactor)},this.createHorizontalPlatform=function(a,b,c,d,e){return this.createMovingPlatform(a,b,c,d,e,game_shell.scene.HorizontalPlatform,a*this.scaleFactor)},this.createMovingPlatform=function(a,b,c,d,e,f,g){a+=e.x,b+=e.y;var h=this.createGameObj(a,b,c,"moving_platform.png",f),i=alex.statics.PLATFORM_RANGE*d*this.scaleFactor;h.initRange(i,g,e);var j=this.createHitRect(e.x,e.y,e.width,e.height);return h.setHitRect(j),h},this.addForegroundItem=function(a,b,c){var d=this.createGameImg(c);return d.x=Math.round(a*this.scaleFactor),d.y=Math.round(b*this.scaleFactor),this.screen.scene.addChild(d),this.screen.sceneryFG[this.screen.sceneryFG.length]=d,null},this.addBackgroundItem=function(a,b,c){var d=this.createGameImg(c);return d.x=Math.round(a*this.scaleFactor),d.y=Math.round(b*this.scaleFactor),this.screen.scene.addChild(d),this.screen.sceneryBG[this.screen.sceneryBG.length]=d,null},this.addToParallax1=function(a,b,c){var d=new PIXI.Sprite(PIXI.TextureCache[c]);return d.y=b*this.scaleFactor,d.x=a*this.scaleFactor,this.screen.parallax1.addChild(d),null},this.addToParallax2=function(a,b,c){var d=new PIXI.Sprite(PIXI.TextureCache[c]);return d.y=b*this.scaleFactor,d.x=a*this.scaleFactor,this.screen.parallax2.addChild(d),null},this.addToParallax3=function(a,b,c){var d=new PIXI.Sprite(PIXI.TextureCache[c]);return d.y=b*this.scaleFactor,d.x=a*this.scaleFactor,this.screen.parallax3.addChild(d),null},this.parallaxQuad=function(a,b,c,d){c*=this.scaleFactor,d*=this.scaleFactor;var e=new alex.display.Quad(c,d,0);return e.y=b*this.scaleFactor,e.x=a*this.scaleFactor,this.screen.parallax1.addChild(e),null},this.createHitRect=function(a,b,c,d){var e=this.scaleFactor,f=a*e,g=b*e,h=c*e,i=d*e;return new PIXI.Rectangle(f,g,h,i)},this.createGameObj=function(a,b,c,d,e){if("undefined"==typeof e)throw new Error("LevelFactory -> createGameObj - undefined constructor for "+d);var f=this.createGameImg(d),g=new e(f);return g.position.x=Math.round(a*this.scaleFactor),g.position.y=Math.round(b*this.scaleFactor),g.id=c,this.screen.gameObjects[this.screen.gameObjects.length]=g,this.screen.scene.addChild(g.gfx),g},this.createAnimatedGameObj=function(a,b,c,d,e){var f=this.createGameMC(d),g=new e(f);return g.position.x=Math.round(a*this.scaleFactor),g.position.y=Math.round(b*this.scaleFactor),g.id=c,this.screen.gameObjects[this.screen.gameObjects.length]=g,this.screen.scene.addChild(g.gfx),g},this.createGameMC=function(a){for(var b=a.length,c=[],d=null,e=null,f=0;b>f;f++)d=a[f],e=PIXI.Texture.fromFrame(d),c[f]=e;return new PIXI.MovieClip(c)},this.createGameImg=function(a){return new PIXI.Sprite(PIXI.TextureCache[a])}},game_shell.level.LayerManager=function(){this.initLayers=function(a){this.baseY=a.baseY,a.bg=this.setBg(a),a.content=new PIXI.DisplayObjectContainer,a.content.x=a.screenW*-.5,a.addChild(a.content),a.parallax3=this.addLayer(a.content),a.parallax2=this.addLayer(a.content),a.parallax1=this.addLayer(a.content),a.scene=this.addLayer(a.content),a.particleLayer=new PIXI.DisplayObjectContainer,a.particleLayer.y=this.baseY,a.content.addChild(a.particleLayer),a.foreground=new PIXI.DisplayObjectContainer,a.foreground.y=this.baseY,a.content.addChild(a.foreground),a.uiLayer=new PIXI.DisplayObjectContainer,a.content.addChild(a.uiLayer)},this.setBg=function(a){var b=game_shell.ui.BackgroundUtil.getSprite("game");return a.addChild(b),b},this.addLayer=function(a){var b=new game_shell.scene.GameLayer;return b.y=this.baseY,a.addChild(b),b}},game_shell.level.FadeTransition=function(){this.initTransition=function(){this.fader=new game_shell.game.ScreenFader(this),this.fader.showCover()},this.transitionOut=function(a){this.levelState.isTransition=!0,this.tweenOffSettingsButton(),this.fader.transitionOut(a)},this.doTransition=function(){var a=this;this.player.particlesFollow(),this.particles.emit(1),this.fader.transitionIn(function(){a.respawn(),1!==a.level||alex.statics.SKIP_TRAINING?a.input.enable(!0):a.playInGameTraining(),a.tweenOnSettingsButton()})}},game_shell.level.GameEvents=function(){this.startRunning=function(){this.levelState.isPlaying=!0,this.player.startRunning(),this.snd.playTheme()},this.levelComplete=function(){alex.log("LevelScreenBase - levelComplete!"),this.player.levelComplete(),this.levelState.isCompleted=!0,this.snd.fadeTheme(),game_shell.playerData.score.levelCompleted(this.score),this.keys.clear(),this.showWinPopup(),this.tweenOffSettingsButton(),game_shell.playerData.saveData.save(),game_shell.eventQueue.queueEvent({type:alex.events.GAME_EVENT,msg:"level_up",level:this.level})},this.respawn=function(){var a=this.respawnManager.getRespawnPoint(this.player.x),b=a.x,c=a.y;this.player.start(b,c),this.camera.track(),this.layerUpdate.doTrack(),this.levelState.isRespawning=!0,this.refreshAmmoCounter(),this.snd.play("RESPAWN")},this.onPlayerReset=function(){this.snd.fadeTheme(),this.respawn(),this.resetObjects(),this.score.playerRespawn(),this.refreshAmmoCounter()},this.resetObjects=function(){for(var a,b=this.gameObjects.length,c=0;b>c;c++)a=this.gameObjects[c],"function"==typeof a.reset&&a.reset()},this.playerJump=function(){if(this.player.isJumping)alex.log("ALREADY JUMPING!");else{var a=this.player.jump();a&&this.snd.jump()}},this.playerFire=function(){var a=this.score.getAmmo();if(alex.statics.CHEAT_AMMO&&(a=100),a>0){var b=this.player.x+.5*this.player.width,c=this.player.y+2*this.scaleFactor,d=this.bulletManager.playerFire(b,c);this.scene.addChild(d.gfx),this.gameObjects[this.gameObjects.length]=d,this.player.fire(),this.useAmmo(),game_shell.sndMgr.play("FIRE")}},this.hazardShot=function(a,b){alex.log("HIT HAZARD!!! "+a.id),a.getShot(),b.destroy(),this.score.makeKill(),game_shell.sndMgr.play("KILL_HAZARD")}},game_shell.level.LevelFlatten=function(){var a=alex.statics.SCALE_FACTOR,b=alex.statics.DEFAULT_W*a,c=alex.statics.DEFAULT_H*a*2,d=new PIXI.DisplayObjectContainer;this.flattenScene=function(){var a=this.renderLayer||this.createRenderLayer(),e=this.furthestX,f=0,g=null,h=null,i=8,j=0;for(d.x=0,d.addChild(a);e>f;)j++,g=new PIXI.RenderTexture(b+i,c),h=new PIXI.Sprite(g),h.y=-c,h.x=f,g.render(d),this.scene.addChildAt(h,0),a.x-=b,f+=b;return d.removeChild(a),j},this.createRenderLayer=function(){var a,b,d=new PIXI.DisplayObjectContainer,e=null;for(a=this.sceneryBG.length,b=0;a>b;b++)e=this.sceneryBG[b],e.y+=c,d.addChild(e);a=this.gameObjects.length;var f=null,g=0,h=0,i=game_shell.ItemTypes;for(b=0;a>b;b++)if(f=this.gameObjects[b],e=f.gfx,f.draw(),e.y+=c,h=e.x+e.width,h>g&&(g=h),e.parent===this.scene)switch(f.type){case i.TYPE_PLATFORM:d.addChild(e);break;case i.TYPE_DOOR:d.addChild(e);break;case i.TYPE_LEVEL_END:d.addChild(e);break;case i.TYPE_SLOPE_UP:d.addChild(e);break;case i.TYPE_SLOPE_DOWN:d.addChild(e)}for(a=this.sceneryFG.length,b=0;a>b;b++)e=this.sceneryFG[b],e.y+=c,d.addChild(e);return this.renderLayer=d,this.furthestX=g,d}},game_shell.game.NinjaPigSnd=function(){var a=.5,b=.4,c=.7,d="THEME",e="WIN",f="BATTLE";this.checkMute=function(){var a=game_shell.playerData.settings;this.muteGroup("music",a.musicMuted),this.muteGroup("sfx",a.sfxMuted)},this.initAudioSprite=function(b){var c=game_shell.loader.audioSpriteManifest[0],b=alex.statics.SND_DIR+c.src;this.snd=new alex.audio.MusicLoop(b,a,!0),this.checkMute()},this.initWebAudio=function(){this.snd=new alex.audio.WebAudioMgr,this.checkMute()},this.playTheme=function(){this.stop(d),this.play(d,a,!0)},this.fadeTheme=function(){alex.log("NinjaPigSnd - fadeTheme"),this.fadeOut(d,.3)},this.playWin=function(){this.stop(e),this.play(e,a,!0)},this.fadeWin=function(){this.fadeOut(e,.3)},this.playBattle=function(){this.stop(f),this.play(f,a,!0)},this.fadeBattle=function(){this.fadeOut(f,.3)},this.jump=function(){this.play("JUMP",b)},this.roll=function(){this.play("ROLL",c)}},game_shell.intro.IntroScene1=function(){function a(){this.dispatchEvent({type:"complete"})}function b(){l=new PIXI.DisplayObjectContainer;var a=1.1*j,b=new alex.display.Quad(a,i,0);l.addChild(b),l.pivot.x=.5*a}function c(){for(var a,b=3*h,c=100,d=j,e=i,f=0,g=0,k=0,m=.5,n=PIXI.TextureCache["intro_star.png"],p=0;c>p;p++)f=b+Math.random()*b,g=Math.random()*d,k=Math.random()*e,a=new PIXI.Sprite(n),a.width=a.height=f,a.x=g,a.y=k,a.alpha=m+Math.random()*m,l.addChild(a),o[p]=a;this.addChild(l)}function d(){m=new PIXI.Sprite(PIXI.TextureCache["ufo.png"]),m.pivot.x=.5*m.width,m.pivot.y=.5*m.height,m.x=j*-.5,m.y=i+m.pivot.y,this.addChild(m)}function e(){var a=new PIXI.Sprite(PIXI.TextureCache["the_earth.png"]);a.y=.5*i,a.pivot.y=.5*a.width,a.pivot.x=.5*a.height,this.addChild(a)}function f(){w=new game_shell.intro.Twinkler(h,o),this.addChild(w.gfx)}PIXI.DisplayObjectContainer.call(this),alex.utils.EventDispatcher.prototype.apply(this);var g=alex.statics,h=g.SCALE_FACTOR,i=g.DEFAULT_H*h,j=g.DEFAULT_W*h,k=null,l=null,m=null,n=Math.PI/180,o=[],p=Math.PI,q=!1,r=.5*j,s=i,t=.19*h,u=.08*h,v=-1,w=null;this.display=function(){b.call(this),c.call(this),f.call(this),d.call(this),e.call(this)},this.start=function(){p=Math.PI,q=!0,m.rotation=16*n,game_shell.sndMgr.play("UFO_FLY")},this.update=function(b){if(w.update(b),q){p+=.001*b,m.x=Math.cos(p)*r,m.y=i+Math.sin(p)*s,r-=b*t,s-=b*u;var c=m.scale.x;if(c>.02){var d=c-6e-4*b;m.scale.x=m.scale.y=d}else p>5.5&&a.call(this);var e=5e-4*b;v+=e+e,m.rotation=v*-.5}},this.dispose=function(){k=null,l=null,o.length=0}},game_shell.intro.IntroScene1.constructor=game_shell.intro.IntroScene1,game_shell.intro.IntroScene1.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),game_shell.intro.Twinkler=function(a,b){function c(a){var b=20*a,c=new alex.display.Circle(b,0);return c.alpha=.6,c.x=-100,c.y=-100,c}function d(){var a=f.shift();f[f.length]=a,this.gfx.x=a.x-e,this.gfx.y=a.y}this.gfx=c(a);var e=.5*alex.statics.STAGE_W,f=b.slice(),g=0,h=300;this.update=function(a){g+=a;var b=!1;return g>h&&(g=0,d.call(this),b=!0),b}},game_shell.intro.IntroScene2=function(){function a(){var a=game_shell.ui.BackgroundUtil.getSprite("game");a.pivot.x=0;var c=new PIXI.DisplayObjectContainer;c.addChild(a),b(47,207,"cloud1.png",c),b(8,-36,"cloud3.png",c),b(886,-28,"cloud4.png",c),b(860,294,"cloud2.png",c),b(93,304,"mountain3.png",c),b(-63,250,"mountain1.png",c),b(664,240,"mountain2.png",c),b(-12,138,"pagoda1.png",c),b(211,266,"silhouette1.png",c),b(903,284,"building2.png",c);var d=164*i,e=new alex.display.Quad(k,d,"#000000");e.y=476*i,c.addChild(e);var f=new PIXI.RenderTexture(k,j);f.render(c),m=new PIXI.Sprite(f),m.pivot.y=.5*j,m.y=m.pivot.y,m.pivot.x=.5*k,m.scale.x=m.scale.y=1.1,this.addChild(m)}function b(a,b,c,d){var e=new PIXI.Sprite(PIXI.TextureCache[c]);return e.x=a*i,e.y=b*i,d.addChild(e),e}function c(){n=new PIXI.Sprite(PIXI.TextureCache["pig_look_1.png"]),n.pivot.x=.5*n.width,n.y=j,this.addChild(n)}function d(){var a={s:1.1},b={s:1},c=new TWEEN.Tween(a);c.to(b,l),c.onUpdate(function(){m.scale.x=m.scale.y=this.s}),c.start()}function e(){var a={y:j},b={y:240*i},c=new TWEEN.Tween(a);c.to(b,l),c.onUpdate(function(){n.y=this.y}),c.start(),c.onComplete(function(){f.call(g)})}function f(){o=new PIXI.Sprite(PIXI.TextureCache["exclamation.png"]),o.y=n.y-o.height-30*i,o.x=-60*i,o.visible=!1,this.addChild(o),p=new PIXI.Sprite(PIXI.TextureCache["exclamation.png"]),p.y=n.y-p.height-30*i,p.x=-120*i,p.visible=!1,this.addChild(p),q=r}PIXI.DisplayObjectContainer.call(this),alex.utils.EventDispatcher.prototype.apply(this);var g=this,h=alex.statics,i=h.SCALE_FACTOR,j=h.DEFAULT_H*i,k=h.DEFAULT_W*i,l=1e3,m=null,n=null,o=null,p=null,q=-1,r=3;this.display=function(){alex.log("IntroScene2"),a.call(this),c.call(this),this.start()},this.start=function(){alex.log("start"),d.call(this),e.call(this),game_shell.sndMgr.play("INTRO_2")},this.dispose=function(){m=null},this.update=function(a){return q>0&&(q-=.002*a,!o.visible&&r-1>q&&(o.visible=!0),!p.visible&&r-2>q&&(p.visible=!0),0>=q&&this.dispatchEvent({type:"complete"})),!0}},game_shell.intro.IntroScene2.constructor=game_shell.intro.IntroScene2,game_shell.intro.IntroScene2.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),game_shell.intro.IntroScene3=function(){function a(){var a=game_shell.ui.BackgroundUtil.getSprite("game");a.pivot.x=.5*a.width,this.addChild(a);var b=new PIXI.DisplayObjectContainer;c(982,38,"cloud1.png",b),c(599,135,"cloud3.png",b),c(204,-4,"cloud4.png",b),c(14,254,"cloud2.png",b),c(604,387,"mountain3.png",b),c(364,328,"mountain1.png",b),c(60,326,"mountain2.png",b),c(905,228,"pagoda1.png",b),c(-66,306,"silhouette1.png",b),c(590,324,"building2.png",b);var d=150*h,e=new alex.display.Quad(j,d,0);e.y=510*h,b.addChild(e);var f=new PIXI.RenderTexture(j,i);k=new PIXI.Sprite(f),f.render(b),k.pivot.y=.5*i,k.y=k.pivot.y+l,k.pivot.x=.5*j,k.scaleX=k.scaleY=1.1,this.addChild(k)}function b(){o=new PIXI.DisplayObjectContainer;var a=c(0,0,"beam.png",o);a.pivot.x=.5*a.width,a.y=-20*h,o.y=60*h;var b=c(0,0,"ufo.png",o);b.pivot.x=.5*b.width,b.pivot.y=b.height,this.addChild(o)}function c(a,b,c,d){var e=new PIXI.Sprite(PIXI.TextureCache[c]);return e.x=a*h,e.y=b*h,d.addChild(e),e}function d(){var a={y:k.y},b={y:k.pivot.y},c=new TWEEN.Tween(a);c.to(b,m),c.onUpdate(function(){k.y=this.y}),c.start()}function e(){var a={y:o.y,d:0},b={y:n,d:4},c=new TWEEN.Tween(a);c.to(b,m);var d=!1;c.onUpdate(function(){o.y=this.y,d||this.d>3&&(d=!0,f.dispatchEvent({type:"complete"}))}),c.start()}PIXI.DisplayObjectContainer.call(this),alex.utils.EventDispatcher.prototype.apply(this);var f=this,g=alex.statics,h=g.SCALE_FACTOR,i=g.DEFAULT_H*h,j=g.DEFAULT_W*h,k=null,l=100*h,m=3e3,n=.5*i,o=null;this.display=function(){a.call(this),b.call(this),this.start()},this.start=function(){d(),e(),game_shell.sndMgr.play("UFO_LAND")},this.update=function(){}},game_shell.intro.IntroScene3.constructor=game_shell.intro.IntroScene3,game_shell.intro.IntroScene3.prototype=Object.create(PIXI.DisplayObjectContainer.prototype),game_shell.game.ScreenFader=function(a){this.fadeImg=game_shell.ui.BackgroundUtil.getSprite("load"),this.root=a,this.delay=250,this.duration=500,this.transitionIn=function(a){this.fadeImg.alpha=1,this.root.addChild(this.fadeImg);var b={a:1},c={a:0},d=new TWEEN.Tween(b);d.to(c,this.duration),d.delay(this.delay);var e=this;d.onUpdate(function(){e.fadeImg.alpha=this.a}),d.onComplete(function(){e.fadeImg.removeFromParent(),"undefined"!=typeof a&&a()}),d.start()},this.transitionOut=function(a){this.fadeImg.alpha=0,this.root.addChild(this.fadeImg);var b={a:0},c={a:1},d=new TWEEN.Tween(b);d.to(c,this.duration),d.delay(this.delay);var e=this;d.onUpdate(function(){e.fadeImg.alpha=this.a}),d.onComplete(function(){"undefined"!=typeof a&&a()}),d.start()},this.showCover=function(){this.fadeImg.alpha=1,this.root.addChild(this.fadeImg)}},game_shell.game.Camera=function(a){this.oldX=-100,this.oldY=-100,this.p1=.9,this.p2=.7,this.p3=.5,this.parallax1=a.parallax1,this.parallax2=a.parallax2,this.parallax3=a.parallax3,this.scene=a.scene,this.foreground=a.foreground,this.particleLayer=a.particleLayer,this.player=a.player,this.screenW=a.screenW,this.scaleFactor=a.scaleFactor,this.baseY=a.baseY,this.maxX=a.maxX,this.trackX=150*this.scaleFactor,this.trackPosY=300*this.scaleFactor,this.capY=800*this.scaleFactor,this.track=function(){this.move(this.player.x,this.player.y)},this.move=function(a,b){if(a!==this.oldX&&(this.oldX=a,this.scrollX(this.trackX-a)),b!==this.oldY){this.oldY=b;var c=this.getTrackingY();this.scrollY(c)}},this.scrollX=function(a){var b=!1;return a<this.maxX&&(a=this.maxX,b=!0),this.scene.x=a,this.foreground.x=a,this.particleLayer.x=a,this.parallax1.x=a*this.p1,this.parallax2.x=a*this.p2,this.parallax3.x=a*this.p3,b},this.getTrackingY=function(){var a=this.player.y,b=Math.floor(a+this.trackPosY);return b>0&&(b=0),this.baseY-b},this.scrollY=function(a){a>this.capY?a=this.capY:0>a&&(a=0),this.scene.y=a,this.foreground.y=a,this.particleLayer.y=a;var b=a-this.baseY;this.parallax1.y=this.baseY+b*this.p1,this.parallax2.y=this.baseY+b*this.p2,this.parallax3.y=this.baseY+b*this.p3}},game_shell.game.LayerUpdate=function(a){this.time=0,this.interval=1e3,this.parallax1=a.parallax1,this.parallax2=a.parallax2,this.parallax3=a.parallax3,this.scene=a.scene,this.update=function(a){this.time+=a,this.time>this.interval&&(this.time-=this.interval,this.doTrack())},this.doTrack=function(){this.parallax1.hideChildren(),this.parallax2.hideChildren(),this.parallax3.hideChildren(),this.scene.hideChildren()}},game_shell.game.LevelState=function(){this.stateRespawning=1,this.statePlaying=2,this.stateCompleted=3,this.stateTransition=4,this.state=this.stateTransition,this.toString=function(){return"[LevelState]"}},Object.defineProperty(game_shell.game.LevelState.prototype,"isRespawning",{get:function(){return this.state===this.stateRespawning},set:function(){this.state=this.stateRespawning}}),Object.defineProperty(game_shell.game.LevelState.prototype,"isPlaying",{get:function(){return this.state===this.statePlaying},set:function(){this.state=this.statePlaying}}),Object.defineProperty(game_shell.game.LevelState.prototype,"isCompleted",{get:function(){return this.state===this.stateCompleted},set:function(){this.state=this.stateCompleted}}),Object.defineProperty(game_shell.game.LevelState.prototype,"isTransition",{get:function(){return this.state===this.stateTransition},set:function(){this.state=this.stateTransition}}),game_shell.game.Collision=function(){function a(a,b){return a>b?a:b}function b(a,b){return b>a?a:b}var c=new PIXI.Rectangle(0,0,10,10),d=new PIXI.Rectangle(0,0,10,10),e=4,f=alex.statics,g=(f.NONE,f.ANY,f.VERTICAL),h=(f.HORIZONTAL,f.NOT_UP,f.NOT_DOWN,game_shell.ItemTypes),i=this;this.separate=function(a,b){var c=i.separateY(a,b),d=i.separateX(a,b);return 0!==d||0!==c},this.separateX=function(a,b){var f=a.immovable,h=b.immovable;if(f&&h)return 0;var i,j,k,l=0,m=a.x-a.last.x,n=b.x-b.last.x;if(m!=n&&(i=m>0?m:-m,j=n>0?n:-n,c.x=a.x-(m>0?m:0),c.y=a.last.y,c.width=a.width+(m>0?m:-m),c.height=a.height,d.x=b.x-(n>0?n:0),d.y=b.last.y,d.width=b.width+(n>0?n:-n),d.height=b.height,c.x+c.width>d.x&&c.x<d.x+d.width&&c.y+c.height>d.y&&c.y<d.y+d.height&&(k=i+j+e,m>n?(l=a.x+a.width-b.x,(l>k||a.allowCollisions===g||b.allowCollisions===g)&&(l=0)):n>m&&(l=a.x-b.width-b.x,(-l>k||a.allowCollisions===g||b.allowCollisions===g)&&(l=0)))),0!=l){var o=a.velocity.x,p=b.velocity.x;if(f||h)f?h||(b.x+=l,b.velocity.x=0):(a.x=a.x-l,a.velocity.x=0);else{l*=.5,a.x=a.x-l,b.x+=l;var q=Math.sqrt(p*p)*(p>0?1:-1),r=Math.sqrt(o*o)*(o>0?1:-1),s=.5*(q+r);a.velocity.x=s+0,b.velocity.x=s+0}return l}return 0},this.separateY=function(a,b){var f=a.immovable,g=b.immovable;if(f&&g)return 0;var h=0,i=a.y-a.last.y,j=b.y-b.last.y;if(i!=j){var k=i>0?i:-i,l=j>0?j:-j;if(c.x=a.x,c.y=a.y-(i>0?i:0),c.width=a.width,c.height=a.height+k,d.x=b.x,d.y=b.y-(j>0?j:0),d.width=b.width,d.height=b.height+l,c.x+c.width>d.x&&c.x<d.x+d.width&&c.y+c.height>d.y&&c.y<d.y+d.height){var m=k+l+e;i>j?(h=a.y+a.height-b.y,h>m&&(h=0)):j>i&&(h=a.y-b.height-b.y,-h>m&&(h=0))}}if(0!=h){var n=a.velocity.y,o=b.velocity.y;if(f||g)f?g||(b.y+=h,b.velocity.y=0,a.moves&&j>i&&(b.x+=a.x-a.last.x)):(a.y=a.y-h,a.velocity.y=0,b.moves&&i>j&&(a.x+=b.x-b.last.x));else{h*=.5,a.y=a.y-h,b.y+=h;var p=Math.sqrt(o*o)*(o>0?1:-1),q=Math.sqrt(n*n)*(n>0?1:-1),r=.5*(p+q);a.velocity.y=r,b.velocity.y=r}return h}return 0},this.intersection=function(e,f){var g=0;c.x=e.x,c.y=e.y,c.width=e.width,c.height=e.height,d.x=f.x,d.y=f.y,d.width=f.width,d.height=f.height;var h=c.x+c.width,i=d.x+d.width,j=c.y+c.height,k=d.y+d.height;if(h>d.x&&c.x<i&&j>d.y&&c.y<k){var l=a(c.x,d.x),m=b(h,i),n=m-l,o=a(c.y,d.y),p=b(j,k),q=p-o;g=a(n,q)}return g},this.intersects=function(a,b){var e,f,g=0,h=a.x-a.last.x,i=b.x-b.last.x;return h!==i&&(e=h>0?h:-h,f=i>0?i:-i,c.x=a.x-(h>0?h:0),c.y=a.last.y,c.width=a.width+(h>0?h:-h),c.height=a.height,d.x=b.x-(i>0?i:0),d.y=b.last.y,d.width=b.width+(i>0?i:-i),d.height=b.height,c.x+c.width>d.x&&c.x<d.x+d.width&&c.y+c.height>d.y&&c.y<d.y+d.height&&(h>i?g=a.x+a.width-b.x:i>h&&(g=a.x-b.width-b.x))),0===g&&(h=a.y-a.last.y,i=b.y-b.last.y,h!=i&&(e=h>0?h:-h,f=i>0?i:-i,c.x=a.x,c.y=a.y-(h>0?h:0),c.width=a.width,c.height=a.height+e,d.x=b.x,d.y=b.y-(i>0?i:0),d.width=b.width,d.height=b.height+f,c.x+c.width>d.x&&c.x<d.x+d.width&&c.y+c.height>d.y&&c.y<d.y+d.height&&(h>i?g=a.y+a.height-b.y:i>h&&(g=a.y-b.height-b.y)))),0!==g},this.separateSlopeY=function(a,b){var e=0,f=0,g=b.y-b.last.y;if(f!=g){var j=g>0?g:-g;c.x=a.x,c.y=a.y,c.width=a.width,c.height=a.height,d.x=b.x,d.y=b.y-(g>0?g:0),d.width=b.width,d.height=b.height+j;var k=b.y+b.height,l=a.y+a.height,m=l>k;if(m&&b.velocity.y<0)return 0;if(m){var n=a.type===h.TYPE_SLOPE_UP,o=a.width,p=a.x-.5*b.width,q=b.x-p;0>q&&(q=0);var r=0;r=n?(o-q)/o:q/o;var s=c.height*r;c.y+=s,c.height-=s}if(c.x+c.width>d.x&&c.x<d.x+d.width&&c.y+c.height>d.y&&c.y<d.y+d.height){f>g?e=c.y+c.height-b.y:g>f&&(e=c.y-b.height-b.y)}}return 0!=e?m?(b.velocity.y=0,b.y+=e,e):i.separate(a,b)?1:0:0}},game_shell.game.RespawnManager=function(){this.scaleFactor=alex.statics.SCALE_FACTOR,this.respawnPoints=[]},game_shell.game.RespawnManager.prototype.parseRespawnPoints=function(a){for(var b,c,d,e=a,f=e.length,g=0;f>g;g++)b=e[g],c=b.x,d=b.y,this.addRespawnPoint(c,d);this.respawnPoints.sort(function(a,b){return a.x<b.x?-1:a.x>b.x?1:0})},game_shell.game.RespawnManager.prototype.addRespawnPoint=function(a,b){var c=a*this.scaleFactor,d=b*this.scaleFactor;this.respawnPoints[this.respawnPoints.length]=new PIXI.Point(c,d)},game_shell.game.RespawnManager.prototype.getRespawnPoint=function(a){var b=alex.statics.CHEAT_RESPAWN,c=null,d=this.respawnPoints.length-1;if(b>-1)b>d&&(b=d),c=this.respawnPoints[b];else for(var e=a,f=d;f>-1&&(c=this.respawnPoints[f],!(e>c.x));f--);return c},game_shell.game.BulletManager=function(a){this.resolver=game_shell.game.resolver,this.scaleFactor=a.scaleFactor,this.activeBullets=[],this.bossBullets=[],this.activeHazards=a.activeHazards,this.platforms=a.platforms;var b=.5*a.screenW;this.player=a.player,this.bulletPool=new game_shell.game.BulletPool(30,"shuriken.png"),10===a.level&&(this.enemyBullets=new game_shell.game.BulletPool(40,"boss_lazer.png",!1)),this.bulletCheck=function(a){var c,d=this.activeBullets.length,e=game_shell.HazardTypes.TRAP;for(c=d-1;c>-1;c--)h=this.activeBullets[c],h.active||(this.activeBullets.splice(c,1),d--);var f=this.activeHazards.length,g=this.platforms.length;if(d>0){var h=null;for(c=0;d>c;c++){h=this.activeBullets[c];for(var i=null,j=0;f>j;j++)if(i=this.activeHazards[j],i.hazardType!==e&&i.active&&i.x>a&&this.resolver.intersection(i.fullRect,h)>0){this.hazardShot(i,h);break}var k=null,l=h.x,m=0;for(j=0;g>j;j++){if(k=this.platforms[j],k.x<a){this.platforms.length=j,g=j;break}var n=k.x-l;if(0>n&&(n=-n),b>n&&(m=this.resolver.intersection(k,h),m>0)){h.destroy();break}}}}},this.playerFire=function(a,b){var c=this.bulletPool.next();return c.x=a,c.y=b,c.draw(),this.activeBullets[this.activeBullets.length]=c,c.fire(),c},this.bossFire=function(a,b){var c=this.enemyBullets.next();return c.x=a,c.y=b,c.draw(),this.bossBullets[this.bossBullets.length]=c,c.fire(-40*this.scaleFactor),c},this.killBossBullets=function(){for(var a,b=this.bossBullets.length,c=b-1;c>-1;c--)a=this.bossBullets[c],a.destroy()},this.bossBulletCheck=function(){var a=this.bossBullets.length;if(0!==a){var c;for(c=a-1;c>-1;c--)f=this.bossBullets[c],f.active||(this.bossBullets.splice(c,1),a--);
var d=!1,e=this.platforms.length;if(a>0){var f=null;for(c=0;a>c;c++){if(f=this.bossBullets[c],this.resolver.intersection(this.player,f)>0){d=!0;break}for(var g=null,h=f.x,i=0,j=0;e>j;j++){g=this.platforms[j];var k=g.x-h;if(0>k&&(k=-k),b>k&&(i=this.resolver.intersection(g,f),i>0)){f.destroy(),game_shell.sndMgr.play("BOSS_MISS");break}}}}return d}},this.hazardShot=function(){}},game_shell.game.BulletPool=function(a,b,c,d){function e(a){for(var e,g=b;a>0;)e=new game_shell.scene.Bullet(g,d),c||(e.r=0),f[f.length]=e,a--}var f=[];"undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d=.9),e(a),this.next=function(){if(f.length>0){var a=f[0];return f.shift(),f[f.length]=a,a}return null}},game_shell.game.UserInput=function(a){this.keys=a.keys,this.bg=a.bg,this.screenW=a.screenW,this.touchHandler=function(a){this.processInput(a.global.x)},this.checkKeys=function(){var a=this.keys.SPACE_KEY,b=this.keys.UP_KEY,c=this.screenW,d=10;this.keys.wasPressed(b)&&this.processInput(c),this.keys.wasPressed(a)&&this.processInput(d)},this.enable=function(a){if(this.bg.interactive=a,a){var b=this;this.bg.mousedown=this.bg.touchstart=function(a){b.touchHandler(a)}}else this.bg.mousedown=this.bg.touchstart=null;this.keys.enable(a)},this.processInput=function(a){var b=this.levelState;if(b.isRespawning)this.startRunning();else if(b.isPlaying){var c=this.parent.x;a>c?this.playerJump():this.playerFire()}else b.isCompleted&&"undefined"!=typeof this.winPopup&&(game_shell.eventQueue.queueEvent({type:alex.events.GAME_EVENT,msg:"dismiss"}),this.hideWinPopup())}.bind(a)},game_shell.player.Player=function(){game_shell.scene.GameObject.call(this);var a=alex.statics,b=a.SCALE_FACTOR,c=game_shell.ItemTypes;this.type=c.TYPE_PLAYER,this.immovable=!1,this._w=112*b,this._h=118*b,this.state=new game_shell.player.PlayerState,this.particles=null,game_shell.player.PlayerMotion.call(this),this.slope=null,game_shell.player.PlayerBones.call(this),this.initBones(),game_shell.player.PlayerFade.call(this),this.snapshot(),this.dispose=function(){this.flatImage=null,this.disposeBones()},this.start=function(a,b){this.startVars(),this.position.x=a,this.position.y=b,this.last.x=a,this.last.y=b,this.velocity.y=0,this.draw(),this.state.current=this.state.stateOnTile,this.armature.animation.gotoAndPlay("idle",.1),this.fadeIn(),this.particlesFollow(),this.particles.emit(.6)}},game_shell.player.Player.constructor=game_shell.player.Player,game_shell.player.Player.prototype=Object.create(game_shell.scene.GameObject.prototype),game_shell.player.PlayerState=function(){this.stateOnTile=1,this.stateJumping=2,this.stateDead=3,this.stateOnMovingTile=4,this.stateWon=5,this.stateStopped=6,this.current=-1,this.toString=function(){return"[PlayerState]"}},game_shell.player.PlayerBones=function(){function a(a){var d=a.target,e=d.animation.getLastAnimationName();(e==b||e==c)&&this.animationState()}var b="roll",c="fire";this.initBones=function(){var b="PigDragonBones",c="piggy",d=game_shell.json.piggy,e="run",f="atlas1",g=game_shell.json[f],h=["arm_front","head_ninja","body","fore_leg","rear_leg","rear arm"],i=game_shell.loader.urls.getURL(f),j=PIXI.TextureCache[i],k={armatureName:b,skeletonId:c,animationId:e,partsList:h};this.armature=dragonBones.makeArmaturePIXI(k,d,g,j),this.armature.addEventListener(dragonBones.events.AnimationEvent.COMPLETE,a.bind(this)),this.bonesBase=this.armature.getDisplay(),this.gfx.addChild(this.bonesBase),this.gfx.name="player"},this.animationState=function(){var a=this.state,b=this.armature.animation,c=this.bonesBase;switch(a.current){case a.stateOnTile:c.rotation=0,b.stop(),b.gotoAndPlay("run",.1);break;case a.stateJumping:b.stop(),b.gotoAndPlay("jump",-1),b.advanceTime(.1),b.stop();break;case a.stateOnMovingTile:case a.stateStopped:c.rotation=0,b.stop(),b.gotoAndPlay("idle",.1);break;case a.stateDead:b.stop(),b.gotoAndPlay("die",.1)}},this.levelComplete=function(){this.velocity.x=0,this.velocity.y=0;var a=this.armature.animation;a.stop();var b=this.bonesBase;b.rotation=0,b.visible=!1,b.removeFromParent(),this.disposeBones()},this.disposeBones=function(){null!==this.armature&&(this.bonesBase.removeFromParent(),this.armature.dispose(),this.armature=null)},this.particlesFollow=function(){var a=this.position.x+.5*this._w,b=this.position.y+.5*this._h;this.particles&&this.particles.move(a,b)},this.particleEmit=function(){this.particlesFollow(),this.particles.emit(.5)},this.doRoll=function(){this.armature.animation.stop(),this.armature.animation.gotoAndPlay("roll",.1),game_shell.sndMgr.roll()},this.startRunning=function(){this.state.current=this.state.stateOnTile,this.armature.animation.gotoAndPlay("run",.1)},this.stopped=function(){this.state.current=this.state.stateStopped,this.animationState()},this.fire=function(){this.armature.animation.gotoAndPlay("fire",.1)}},game_shell.player.PlayerMotion=function(){var a=alex.statics,b=game_shell.ItemTypes,c=game_shell.game.resolver,d=a.SCALE_FACTOR,e=2*d,f=.2*e,g=f,h=800*d,i=a.GRAVITY,j=i,k=20*i,l=-1,m=-1,n=f*-.5,o=-1*f,p=!1,q=-.22*e,r=.05,s=1.5;this.offTile=0,this.maxOffTile=60,this.startVars=function(){p=!0},this.jumpPad=function(a){this.jump(s),a.activate(),game_shell.sndMgr.play("JUMP_PAD",.6)},this.jump=function(a){var c=!1;return a||(a=1),p&&this.state.current!==this.state.stateDead&&(this.particleEmit(),j=i,this.velocity.y=q*a,(l===b.TYPE_SLOPE_UP||l===b.TYPE_SLOPE_DOWN)&&null!==this.slope&&(this.slope.jump(),this.slope=null),m=-1,l=-1,this.state.current!==this.state.stateJumping&&(c=!0),this.state.current=this.state.stateJumping,this.animationState(),this.bonesBase.rotation=r),c},this.hitHazard=function(a){this.state.current=this.state.stateDead,this.animationState(),this.velocity.y=-1*this.scaleFactor,this.velocity.x=0,null!==a&&a.activate(),game_shell.sndMgr.play("HIT_HAZARD")},this.update=function(a){var c=this.state.current;if(c!==this.state.stateDead){var d=this.velocity.y;if(this.velocity.y+=j,c===this.state.stateJumping){var e=this.velocity.y>0;0>d&&e&&this.armature.animation.play(),e&&this.bonesBase.rotation>-r&&(this.bonesBase.rotation-=2e-4*a)}c===this.state.stateWon?this.velocity.x=0:l===b.TYPE_CONVEYOR?this.velocity.x>o&&(this.velocity.x+=n):this.velocity.x=c===this.state.stateOnMovingTile?this.velocity.x*this.drag*this.drag*this.drag:f,this.position.y+=this.velocity.y*a,this.position.x+=this.velocity.x*a}else this.velocity.y+=5*j,this.position.y+=this.velocity.y*a},this.hitTest=function(a,d){if(this.state.current===this.state.stateDead)return!1;for(var e,f,g,n,o,q=!1,r=this.velocity.y,s=a.length,t=this.position.x,u=-1,v=0;s>v;v++)if(g=a[v],n=g.x-t,!(n>h||-h>n))if(o=g.type,o===b.TYPE_HAZARD||o===b.TYPE_HORIZONTAL_HAZARD||o===b.TYPE_VERTICAL_HAZARD)g.active&&c.intersects(g,this)&&(this.state.current=this.state.stateOnTile,m=g.id,l=o,q=!0,this.hitHazard(g));else if(o!==b.TYPE_COLLECTABLE||g.collected){if(o===b.TYPE_DOOR||o===b.TYPE_BULLET);else if(o===b.TYPE_SLOPE_UP||o===b.TYPE_SLOPE_DOWN)0!==c.separateSlopeY(g,this)&&(m=g.id,l=o,this.bonesBase.rotation=0,this.state.current!==this.state.stateOnTile&&(this.state.current=this.state.stateOnTile,this.animationState()),q=!0,this.slope=g,g.type===b.TYPE_SLOPE_DOWN&&(j=k));else if(g!==this){if(g.allowCollisions<0)e=!1,f=!1;else{var w=c.separateX(g,this),x=c.separateY(g,this);e=0!==w,f=0!==x}if(e||f){if(m=g.id,l=o,this.state.current===this.state.stateJumping&&f&&r>0){this.bonesBase.rotation=0;var y=!1;l===b.TYPE_MOVING_PLATFORM||l===b.TYPE_VERTICAL_PLATFORM?(l===b.TYPE_VERTICAL_PLATFORM&&(j=k),this.state.current=this.state.stateOnMovingTile,this.velocity.x=0):(this.state.current=this.state.stateOnTile,y=!0),l===b.TYPE_JUMP_PAD?this.jumpPad(g):l!==b.TYPE_SINKING_PLATFORM||g.isSinking?(l!==b.TYPE_EVENT_TRIGGER||g.activated||(alex.log("***** LANDED ON EVENT TRIGGER!!!!!"),g.activate()),y?this.doRoll():this.animationState()):(g.start(),this.animationState(),q=!0,j=k)}0>x&&(q=!0),l===b.TYPE_LEVEL_END&&f&&!e&&(p=!1)}}}else c.intersects(g,this)&&(g.collect(),u=1);if(q)this.offTile=0,this.position.x===this.last.x&&this.state.current===this.state.stateOnTile&&this.stopped();else{var z=!0;l>-1&&this.velocity.y>=0&&(l===b.TYPE_SLOPE_DOWN&&(z=!1),j=i),m=-1,l=-1,z&&(this.state.current===this.state.stateOnMovingTile&&alex.log("fall off tile!"),this.state.current=this.state.stateJumping),this.offTile+=d}return u},this.cancelX=function(){f=0},this.restoreX=function(){f=g}},Object.defineProperty(game_shell.player.Player.prototype,"isOnMovingTile",{get:function(){return this.state.current===this.state.stateOnMovingTile}}),Object.defineProperty(game_shell.player.Player.prototype,"isJumping",{get:function(){return this.offTile>this.maxOffTile}}),Object.defineProperty(game_shell.player.Player.prototype,"isDead",{get:function(){return this.state.current===this.state.stateDead}}),game_shell.player.PlayerFade=function(){this.snapshot=function(){this.state.current=this.state.stateStopped,this.animationState(),this.draw();var a=alex.statics.SCALE_FACTOR,b=200*a,c=200*a,d=new PIXI.RenderTexture(b,c);d.render(this.gfx),this.flatImage=new PIXI.Sprite(d),this.flatImage.visible=!1},this.fadeIn=function(){var a=this,b=this.gfx;b.alpha=0,b.visible=!0,b.removeChild(this.bonesBase),b.addChild(this.flatImage);var c={alpha:0},d={alpha:1},e=new TWEEN.Tween(c);e.to(d,500),e.delay(500),e.onStart(function(){a.flatImage.visible=!0}),e.onUpdate(function(){b.alpha=this.alpha}),e.onComplete(function(){b.addChild(a.bonesBase),b.removeChild(a.flatImage),a.flatImage.visible=!1,a.dispatchEvent({type:"faded_in"})}),e.start()}},game_shell.screens.SCR_LOAD="load",game_shell.screens.SCR_TITLE="title",game_shell.screens.SCR_MENU="menu",game_shell.screens.SCR_INTRO="intro",game_shell.screens.SCR_LEVEL_1="level_1",game_shell.screens.SCR_LEVEL_2="level_2",game_shell.screens.SCR_LEVEL_3="level_3",game_shell.screens.SCR_LEVEL_4="level_4",game_shell.screens.SCR_LEVEL_5="level_5",game_shell.screens.SCR_LEVEL_6="level_6",game_shell.screens.SCR_LEVEL_7="level_7",game_shell.screens.SCR_LEVEL_8="level_8",game_shell.screens.SCR_LEVEL_9="level_9",game_shell.screens.SCR_LEVEL_10="level_10",game_shell.screens.SCR_BETWEEN="between",game_shell.screens.SCR_GAME_OVER="game_over",game_shell.game.gameScreens=function(){this.createScreen=function(a){var b,c=game_shell.screens;switch(a){case c.SCR_LOAD:b=new c.LoadScreen;break;case c.SCR_TITLE:b=new c.TitleScreen;break;case c.SCR_MENU:b=new c.MenuScreen;break;case c.SCR_INTRO:b=new c.IntroScreen;break;case c.SCR_BETWEEN:b=new c.BetweenScreen;break;case c.SCR_LEVEL_1:b=new c.LevelScreenBase(1);break;case c.SCR_LEVEL_2:b=new c.LevelScreenBase(2);break;case c.SCR_LEVEL_3:b=new c.LevelScreenBase(3);break;case c.SCR_LEVEL_4:b=new c.LevelScreenBase(4);break;case c.SCR_LEVEL_5:b=new c.LevelScreenBase(5);break;case c.SCR_LEVEL_6:b=new c.LevelScreenBase(6);break;case c.SCR_LEVEL_7:b=new c.LevelScreenBase(7);break;case c.SCR_LEVEL_8:b=new c.LevelScreenBase(8);break;case c.SCR_LEVEL_9:b=new c.LevelScreenBase(9);break;case c.SCR_LEVEL_10:b=new c.BossLevelScreen;break;case c.SCR_GAME_OVER:b=new c.GameOverScreen}return b.screenId=a,b}},game_shell.screens.LoadScreen=function(){function a(){var a=game_shell.ui.BackgroundUtil.getSprite(game_shell.screens.SCR_LOAD);this.addChild(a)}function b(){var a=this,b={a:1},c={a:0},e=new TWEEN.Tween(b);e.to(c,500),e.onUpdate(function(){d.alpha=this.a}),e.onComplete(function(){a.newScreen(alex.statics.FIRST_SCREEN)}),e.start()}function c(){var a=400*this.scaleFactor,b=60*this.scaleFactor,c=new alex.ui.LoadBar(a,b,0,11414273);return c.y=.5*this.screenH,c.pivot.x=.5*a,c.pivot.y=.5*b,this.addChild(c),c}alex.screens.ScreenBase.call(this);var d=null;this.run=function(){a.call(this),d=c.call(this);var e=this;game_shell.loader.addEventListener("progress",function(a){var b=a.value;d.progress(b)}),game_shell.loader.addEventListener("complete",function(){d.progress(1),b.call(e)})}},game_shell.screens.LoadScreen.constructor=game_shell.screens.LoadScreen,game_shell.screens.LoadScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.TitleScreen=function(){function a(){var a=game_shell.ui.BackgroundUtil.getSprite(game_shell.screens.SCR_LOAD);this.addChild(a),a.interactive=!0;var b=this;a.mousedown=a.touchstart=function(){n||l.call(b)}}function b(a){var b=new PIXI.Sprite(PIXI.TextureCache["shuriken_in_flight.png"]);b.x=this.screenW*-.6,b.y=.2*this.screenH,b.visible=!1;var c=-2*b.width;return this.addChild(b),k.call(this,b,c,a,e),b}function c(a){var b=new PIXI.Sprite(PIXI.TextureCache["shuriken_in_flight.png"]);b.x=.6*this.screenW,b.y=.4*this.screenH,b.visible=!1;var c=2*b.width;return b.scale.x=-1,this.addChild(b),k.call(this,b,c,a,e),b}function d(a){var b=new PIXI.Sprite(PIXI.TextureCache["shuriken_in_flight.png"]);b.x=this.screenW*-.6,b.y=.6*this.screenH,b.visible=!1;var c=-1.5*b.width;return this.addChild(b),k.call(this,b,c,a,e),b}function e(a){a.setTexture(PIXI.TextureCache["shuriken_embedded.png"])}function f(a,b){a.setTexture(PIXI.TextureCache["shuriken_in_flight.png"]);var c;c=a.x>0?.8*this.screenW:this.screenW*-.8,k.call(this,a,c,b)}function g(a){var b=PIXI.TextureCache["title_text.png"],c=new PIXI.Sprite(b);c.pivot.x=.5*c.width,c.pivot.y=.5*c.height,c.x=0,c.y=.5*this.screenH;var d=.001;c.scale.x=c.scale.y=d,this.addChild(c);var e={scale:d},f={scale:1},g=new TWEEN.Tween(e);return g.to(f,750),g.delay(a),g.easing(TWEEN.Easing.Back.Out),g.onUpdate(function(){c.scale.x=this.scale,c.scale.y=this.scale}),g.onStart(function(){game_shell.sndMgr.play("INTRO")}),g.start(),c}function h(a){var b=new PIXI.Sprite(PIXI.TextureCache["sword_low.png"]);return b.pivot.x=.5*b.width,b.y=this.screenH,this.addChild(b),j(b,390*this.scaleFactor,a),b}function i(a){var b=new PIXI.Sprite(PIXI.TextureCache["sword_high.png"]);return b.pivot.x=.5*b.width,b.y=-b.height,this.addChild(b),j(b,200*this.scaleFactor,a),b}function j(a,b,c){var d={y:a.y},e={y:b},f=new TWEEN.Tween(d);f.to(e,350),f.delay(c),f.easing(TWEEN.Easing.Exponential.Out),f.onUpdate(function(){a.y=this.y}),f.start()}function k(a,b,c,d){var e={x:a.x},f={x:b},g=new TWEEN.Tween(e);g.to(f,75),g.delay(c),g.onUpdate(function(){a.x=this.x});var h=this;g.onStart(function(){a.visible=!0}),d&&g.onComplete(function(){d.call(h,a)}),g.start()}function l(){TWEEN.removeAll(),n=!0,game_shell.sndMgr.isReady&&(game_shell.sndMgr.fadeOut("INTRO"),game_shell.sndMgr.play("SWISH_1")),j.call(this,this.swordAbove,-60*this.scaleFactor,100),j.call(this,this.swordBelow,this.screenH,200),f.call(this,this.shuriken1,0),f.call(this,this.shuriken2,50),f.call(this,this.shuriken3,100),m.call(this,10)}function m(a){var b={scale:1},c={scale:.001},d=new TWEEN.Tween(b);d.to(c,600),d.delay(a),d.easing(TWEEN.Easing.Exponential.In);var e=this;d.onUpdate(function(){e.title.scale.x=this.scale,e.title.scale.y=this.scale}),d.onComplete(function(){e.newScreen(game_shell.screens.SCR_MENU)}),d.start()}alex.screens.ScreenBase.call(this);var n=!1;this.run=function(){a.call(this),this.title=g.call(this,1e3),this.swordBelow=h.call(this,2e3),this.swordAbove=i.call(this,2500),this.shuriken1=b.call(this,3e3),this.shuriken2=c.call(this,3250),this.shuriken3=d.call(this,3350)}},game_shell.screens.TitleScreen.constructor=game_shell.screens.TitleScreen,game_shell.screens.TitleScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.MenuScreen=function(){function a(){this.uiLayer=new PIXI.DisplayObjectContainer,this.uiLayer.x=this.screenW*-.5,this.addChild(this.uiLayer)}function b(){var a=game_shell.ui.BackgroundUtil.getSprite(game_shell.screens.SCR_LOAD);this.addChild(a)}function c(){e=new game_shell.ui.ParchmentMenu(this),e.addEventListener("select",function(b){var c=b.index;game_shell.playerData.introViewed||d.SKIP_INTRO?f="level_"+c:(game_shell.playerData.chosenLevel="level_"+c,f=game_shell.screens.SCR_INTRO),game_shell.sndMgr.play("BUTTON_PRESS"),e.exit(),a.settingsPanel.hide(),a.tweenOffSettingsButton.call(a)});var a=this;e.addEventListener("exit",function(){alex.log("exit"),a.newScreen(f)})}alex.screens.ScreenBase.call(this);var d=alex.statics,e=null,f="";this.run=function(){b.call(this),c.call(this),a.call(this),game_shell.level.UIManager.call(this),this.createUI(),this.createInGameTraining(),this.createNullObjects(),this.fader=new game_shell.game.ScreenFader(this),e.show(),this.tweenOnSettingsButton(),game_shell.eventQueue.queueEvent({type:alex.events.GAME_EVENT,msg:"main_menu"})},this.transitionOut=function(a){this.tweenOffSettingsButton(),this.fader.transitionOut(a)},this.createNullObjects=function(){this.exitTarget=this.exitTarget=game_shell.screens.SCR_TITLE,this.input={},this.input.enable=function(){},this.pauseGame=function(){}},this.resize=function(a,b){alex.screens.ScreenBase.prototype.resize.call(this,a,b),this.uiLayer.x=this.screenW*-.5}},game_shell.screens.MenuScreen.constructor=game_shell.screens.MenuScreen,game_shell.screens.MenuScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.IntroScreen=function(){function a(){h=new alex.display.Button("btn_skip.png","btn_skip_down.png");var a=10*this.scaleFactor;h.y=this.screenH-h.height-a,h.x=.5*this.screenW-h.width-a,this.addChild(h);var c=this;h.addEventListener("release",function(){l=!0,j=i,TWEEN.removeAll(),b.call(c)})}function b(){this.fader.transitionOut(function(){var a=game_shell.playerData.chosenLevel;alex.log("EXIT! "+a),f.newScreen(a)})}function c(a){i=new a,g.addChild(i),i.display(),i.addEventListener("complete",d),this.addUpdateItem(i)}function d(){k++,alex.log("nextScene "+k);var a=null;switch(k){case 1:a=game_shell.intro.IntroScene1;break;case 2:a=game_shell.intro.IntroScene2;break;case 3:a=game_shell.intro.IntroScene3}null===a?b.call(f):(e(),c.call(f,a))}function e(){null!==i&&(j=i,i.removeFromParent(),i.dispose(),i=null)}alex.screens.ScreenBase.call(this);var f=this,g=null,h=null,i=null,j=null,k=0,l=!0;this.run=function(){game_shell.playerData.introViewed=!0,g=new PIXI.DisplayObjectContainer,this.addChild(g),d.call(this),a.call(this),this.fader=new game_shell.game.ScreenFader(this),this.fader.transitionIn(function(){alex.log("fader transition in complete"),i.start(),l=!1})},this.update=function(a){null!==j&&(f.removeUpdateItem(j),j=null),alex.screens.ScreenBase.prototype.update.call(this,a)}},game_shell.screens.IntroScreen.constructor=game_shell.screens.IntroScreen,game_shell.screens.IntroScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.LevelScreenBase=function(a){alex.screens.ScreenBase.call(this),this.run=function(){this.level=a;var b=game_shell.levelData.getLevelData(this.level);this.baseY=this.screenH,this.maxX=this.screenW,alex.statics.GRAVITY=.024*this.scaleFactor,this.keys=game_shell.Keys,this.snd=game_shell.sndMgr,"undefined"==typeof game_shell.game.resolver&&(game_shell.game.resolver=new game_shell.game.Collision),this.resolver=game_shell.game.resolver,this.levelState=new game_shell.game.LevelState,this.score=game_shell.playerData.score.getLevelData(this.level),this.score.reset(),this.layerManager=new game_shell.level.LayerManager,this.layerManager.initLayers(this),game_shell.level.AmmoCounterMixin.call(this),this.createAmmoCounter(),game_shell.level.UIManager.call(this),this.createUI(),this.createInGameTraining(),this.settingsPanel.addEventListener("home",function(){game_shell.sndMgr.fadeTheme()}),this.respawnManager=new game_shell.game.RespawnManager,this.respawnManager.parseRespawnPoints(b.respawn),this.levelFactory=new game_shell.level.LevelFactory(this),this.levelFactory.parseJSON(b),this.particles=new game_shell.fx.Particles(this.particleLayer,"particle_star"),this.addUpdateItem(this.particles),this.levelFactory.createPlayer(),this.camera=new game_shell.game.Camera(this),this.camera.track(),this.layerUpdate=new game_shell.game.LayerUpdate(this),this.addUpdateItem(this.layerUpdate),game_shell.level.GameEvents.call(this),game_shell.level.GameLoop.call(this),this.drawGameObjects(),this.initScroll(),game_shell.level.FadeTransition.call(this),this.initTransition(),game_shell.level.LevelFlatten.call(this),this.flattenScene(),this.input=new game_shell.game.UserInput(this),this.bulletManager=new game_shell.game.BulletManager(this),this.bulletManager.hazardShot=this.hazardShot.bind(this),this.startGameLoop(),this.doTransition()},this.resize=function(a,b){alex.screens.ScreenBase.prototype.resize.call(this,a,b),this.content.x=this.screenW*-.5},this.initScroll=function(){var a=this.respawnManager.getRespawnPoint(this.player.x);this.player.y=a.y,this.camera.track()}},game_shell.screens.LevelScreenBase.constructor=game_shell.screens.LevelScreenBase,game_shell.screens.LevelScreenBase.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.BetweenScreen=function(){function a(){var a=game_shell.ui.BackgroundUtil.getSprite(game_shell.screens.SCR_LOAD);this.addChild(a)}function b(){var a=new PIXI.Sprite(PIXI.TextureCache["big_shuriken.png"]);a.pivot.x=.5*a.width,a.pivot.y=.5*a.height,a.x=0,a.y=.5*g.screenH,this.title=a,c.call(this),d.call(this),this.addChild(a)}function c(){var a=this.title,b=.001;a.scale.x=a.scale.y=b;var c={scale:b},d={scale:1},f=new TWEEN.Tween(c);f.to(d,750),f.delay(500),f.easing(TWEEN.Easing.Back.Out),f.onUpdate(function(){a.scale.x=this.scale,a.scale.y=this.scale}),f.onStart(function(){game_shell.sndMgr.isReady&&game_shell.sndMgr.play("BETWEEN")});var g=this;f.onComplete(function(){e.call(g)}),f.start()}function d(){var a={r:0},b={r:2*Math.PI},c=new TWEEN.Tween(a);c.to(b,1200),c.delay(1e3),c.easing(TWEEN.Easing.Quartic.InOut),c.onUpdate(function(){g.title.rotation=this.r}),c.start()}function e(){var a={scale:1},b={scale:5e-4},c=new TWEEN.Tween(a);c.to(b,600),c.delay(700),c.easing(TWEEN.Easing.Exponential.In),c.onUpdate(function(){g.title.scale.x=this.scale,g.title.scale.y=this.scale}),c.onComplete(function(){g.title.visible=!1,g.delay(f,150)}),c.start()}function f(){g.newScreen(g.nextScreen)}alex.screens.ScreenBase.call(this);var g=this;this.run=function(){a.call(this),this.nextScreen=game_shell.playerData.nextScreen||"menu",game_shell.playerData.nextScreen=null,b.call(this)}},game_shell.screens.BetweenScreen.constructor=game_shell.screens.BetweenScreen,game_shell.screens.BetweenScreen.prototype=Object.create(game_shell.screens.LevelScreenBase.prototype),game_shell.screens.GameOverScreen=function(){function a(){var a=game_shell.json.pig_dance,b="atlas1",c=game_shell.json[b],d=game_shell.loader.urls.getURL(b),e=PIXI.TextureCache[d],f={armatureName:"PigDance",skeletonId:"pig_dance",animationId:"jump",partsList:["DanceForearm","DanceHead","DanceBody","DanceForeleg","DanceRearleg","DanceReararm"]};m=dragonBones.makeArmaturePIXI(f,a,c,e);var g=m.getDisplay();g.pivot.x=180*this.scaleFactor,g.y=200*this.scaleFactor,this.addChild(g)}function b(){var a=m.getDisplay(),b=a.scale.x;a.scale.x=b>0?-1:1}function c(){var a=this;n=new alex.display.Button("btn_menu.png","btn_menu_down.png"),n.addEventListener("release",function(){game_shell.sndMgr.fadeWin(),game_shell.eventQueue.queueEvent({type:alex.events.GAME_EVENT,msg:"dismiss"}),d.call(a),n.enabled=!1});var b=10*this.scaleFactor;n.x=.5*this.screenW-n.width-b,n.y=this.screenH-n.height-b,this.addChild(n)}function d(){var a=this;this.fader.transitionOut(function(){a.newScreen(game_shell.screens.SCR_TITLE)})}function e(){var a=game_shell.ui.BackgroundUtil.getSprite(game_shell.screens.SCR_LOAD);this.addChild(a)}function f(){var a=game_shell.ui.BackgroundUtil.createSegments();return a.y=.5*this.screenH,a.alpha=.2,this.addChild(a),a}function g(){l=new game_shell.ui.StarField,this.addChild(l)}function h(){var a=0,b=0,c=10;r=1e3*c,k.fire(a,b,c)}function i(){var a=new PIXI.DisplayObjectContainer;a.x=0,a.y=.5*this.screenH,this.addChild(a),k=new game_shell.fx.Particles(a,"particle_star",4),this.addUpdateItem(k)}alex.screens.ScreenBase.call(this);var j=null,k=null,l=null,m=null,n=null,o=0,p=3e3,q=p,r=0;this.run=function(){e.call(this),this.fader=new game_shell.game.ScreenFader(this),this.fader.transitionIn(),j=f.call(this),i.call(this),g.call(this),a.call(this),h(),c.call(this),game_shell.sndMgr.playWin(),game_shell.eventQueue.queueEvent({type:alex.events.GAME_EVENT,msg:"game_complete"})},this.update=function(a){return o+=a,j.rotation=1e-4*o,dragonBones.animation.WorldClock.clock.advanceTime(a/1e3),l.update(a),r-=a,0>r&&h(),q-=a,0>q&&(q=p,b.call(this)),alex.screens.ScreenBase.prototype.update.call(this),!0}},game_shell.screens.GameOverScreen.constructor=game_shell.screens.GameOverScreen,game_shell.screens.GameOverScreen.prototype=Object.create(alex.screens.ScreenBase.prototype),game_shell.screens.BossLevelScreen=function(){function a(){this.bossParticles=new game_shell.fx.Particles(this.particleLayer,"boss_star"),this.addUpdateItem(this.bossParticles)}function b(){this.screenShaker=new game_shell.fx.ScreenShaker(this.scene);var a=this;this.screenShaker.addEventListener("complete",function(){a.removeUpdateItem(a.screenShaker)})}game_shell.screens.LevelScreenBase.call(this,10),this.delayedExit=0,this.exitDelay=1750,this.boss=null;var c=this.run,d=null,e=null;this.run=function(){c.call(this),a.call(this),b.call(this),d=this.postUpdate,this.postUpdate=this.bossPostUpdate,e=this.respawn,this.respawn=this.bossScreenRespawn},this.bossScreenRespawn=function(){alex.log("player respawn!"),e.call(this),this.player.restoreX(),this.bulletManager.killBossBullets(),game_shell.sndMgr.fadeOut("BOSS_CRAFT",.3),game_shell.sndMgr.fadeBattle()},this.dispose=function(){this.bossParticles.dispose(),game_shell.sndMgr.stopAll(),null!==this.boss&&(this.boss.dispose(),this.boss=null),alex.screens.ScreenBase.prototype.dispose.call(this)},this.bossPostUpdate=function(a){d.call(this,a);var b=this.bulletManager.bossBulletCheck();if(b&&this.playerHitByBoss(),this.delayedExit>0&&(this.delayedExit-=a,this.delayedExit<=0)){alex.log("delayed exit!");var c=this;this.transitionOut(function(){c.newScreen(game_shell.screens.SCR_GAME_OVER)})}},this.onPlatformEventTrigger=function(){alex.log("BossLevelScreen - onPlatformEventTrigger"),this.activateRubble(),this.input.enable(!1),this.player.cancelX(),this.snd.fadeTheme(),this.activateScreenShaker(),this.createBoss(),game_shell.sndMgr.play("BOSS_ENTER")},this.playerHitByBoss=function(){this.player.hitHazard(this.boss),game_shell.sndMgr.play("BOSS_HIT_PLAYER",.6)}},game_shell.screens.BossLevelScreen.constructor=game_shell.screens.BossLevelScreen,game_shell.screens.BossLevelScreen.prototype=Object.create(game_shell.screens.LevelScreenBase.prototype),game_shell.screens.BossLevelScreen.prototype.activateRubble=function(){this.rubbleMaker||(this.rubbleMaker=new game_shell.scene.RubbleMaker(this),this.addUpdateItem(this.rubbleMaker)),this.rubbleMaker.activate(this.player.x)},game_shell.screens.BossLevelScreen.prototype.createBoss=function(){var a=this.boss=new game_shell.scene.EnemyBoss,b=this.player.x+1.2*this.screenW,c=this.player.x+600*this.scaleFactor,d=3e3,e=1e3;this.boss.setStartPt(b,-1*this.screenH),this.foreground.addChild(this.boss.gfx),this.gameObjects.push(this.boss),this.activeHazards.push(this.boss),a.addEventListener("fire",this.onBossFire.bind(this)),a.addEventListener("hit",this.onBossHit.bind(this)),a.addEventListener("gameover",this.onBossDestroyed.bind(this));var f={x:b},g={x:c},h=new TWEEN.Tween(f);h.to(g,d),h.delay(e),h.onUpdate(function(){a.x=this.x}),h.onStart(function(){game_shell.sndMgr.play("BOSS_CRAFT",1,!0)});var i=this;h.onComplete(function(){i.input.enable(!0),a.attack(),game_shell.sndMgr.playBattle()}),h.start()},game_shell.screens.BossLevelScreen.prototype.onBossDestroyed=function(){this.delayedExit=this.exitDelay},game_shell.screens.BossLevelScreen.prototype.onBossHit=function(a){var b=this.boss.x+.5*this.boss.hitRect.width,c=this.boss.y+.5*this.boss.hitRect.height;this.bossParticles.fire(b,c);var d=a.lives;0===d?(this.input.enable(!1),game_shell.sndMgr.play("BOSS_IS_DESTROYED"),game_shell.sndMgr.fadeBattle(),game_shell.sndMgr.fadeOut("BOSS_CRAFT",500)):game_shell.sndMgr.play("BOSS_IS_HIT")},game_shell.screens.BossLevelScreen.prototype.onBossFire=function(a){var b=a.x,c=a.y,d=this.bulletManager.bossFire(b,c);this.scene.addChild(d.gfx),this.gameObjects[this.gameObjects.length]=d,game_shell.sndMgr.play("BOSS_SHOOT")},game_shell.screens.BossLevelScreen.prototype.activateScreenShaker=function(){this.screenShaker.activate(),this.addUpdateItem(this.screenShaker)},game_shell.onGameEvent=function(a){var b=a.msg;console.log("External API - onGameEvent : "+a.msg);var c,d;switch(b){case"level_up":c=game_shell.playerData.score.getTotalStars(),d=a.level,game_shell.showWidget(c,2e3,0);break;case"game_complete":c=game_shell.playerData.score.getTotalStars(),game_shell.showWidget(c,2e3,300);break;case"dismiss":game_shell.tgsWidget&&(game_shell.tgsWidget.close(),game_shell.tgsWidget=null);break;case"main_menu":break;case"more_games":break;case"loaded":}},game_shell.showWidget=function(a,b,c){var d=new Object;d.placementFunc=function(){var a=window.innerHeight,b=window.innerWidth,d=a/alex.statics.DEFAULT_H,e=150*d,f=300*d,g=.5*(b-f-c),h={x:g,y:e,scale:d};return h},d.shareMessage="I just got "+a+" stars in Ninja Pig!",setTimeout(function(){game_shell.tgsWidget=TGS.Widget.CreateWidget(d)},b)},game_shell.init();